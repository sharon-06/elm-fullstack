module CompilationInterface.ElmMake.Generated_ecf78655 exposing (..)

elm_make_output_src_Frontend_Main_elm_debug_html =
    { base64 = "PCFET0NUWVBFIEhUTUw+CjxodG1sPgo8aGVhZD4KICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgPHRpdGxlPkZyb250ZW5kLk1haW48L3RpdGxlPgogIDxzdHlsZT5ib2R5IHsgcGFkZGluZzogMDsgbWFyZ2luOiAwOyB9PC9zdHlsZT4KPC9oZWFkPgoKPGJvZHk+Cgo8cHJlIGlkPSJlbG0iPjwvcHJlPgoKPHNjcmlwdD4KdHJ5IHsKKGZ1bmN0aW9uKHNjb3BlKXsKJ3VzZSBzdHJpY3QnOwoKZnVuY3Rpb24gRihhcml0eSwgZnVuLCB3cmFwcGVyKSB7CiAgd3JhcHBlci5hID0gYXJpdHk7CiAgd3JhcHBlci5mID0gZnVuOwogIHJldHVybiB3cmFwcGVyOwp9CgpmdW5jdGlvbiBGMihmdW4pIHsKICByZXR1cm4gRigyLCBmdW4sIGZ1bmN0aW9uKGEpIHsgcmV0dXJuIGZ1bmN0aW9uKGIpIHsgcmV0dXJuIGZ1bihhLGIpOyB9OyB9KQp9CmZ1bmN0aW9uIEYzKGZ1bikgewogIHJldHVybiBGKDMsIGZ1biwgZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKGIpIHsgcmV0dXJuIGZ1bmN0aW9uKGMpIHsgcmV0dXJuIGZ1bihhLCBiLCBjKTsgfTsgfTsKICB9KTsKfQpmdW5jdGlvbiBGNChmdW4pIHsKICByZXR1cm4gRig0LCBmdW4sIGZ1bmN0aW9uKGEpIHsgcmV0dXJuIGZ1bmN0aW9uKGIpIHsgcmV0dXJuIGZ1bmN0aW9uKGMpIHsKICAgIHJldHVybiBmdW5jdGlvbihkKSB7IHJldHVybiBmdW4oYSwgYiwgYywgZCk7IH07IH07IH07CiAgfSk7Cn0KZnVuY3Rpb24gRjUoZnVuKSB7CiAgcmV0dXJuIEYoNSwgZnVuLCBmdW5jdGlvbihhKSB7IHJldHVybiBmdW5jdGlvbihiKSB7IHJldHVybiBmdW5jdGlvbihjKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oZCkgeyByZXR1cm4gZnVuY3Rpb24oZSkgeyByZXR1cm4gZnVuKGEsIGIsIGMsIGQsIGUpOyB9OyB9OyB9OyB9OwogIH0pOwp9CmZ1bmN0aW9uIEY2KGZ1bikgewogIHJldHVybiBGKDYsIGZ1biwgZnVuY3Rpb24oYSkgeyByZXR1cm4gZnVuY3Rpb24oYikgeyByZXR1cm4gZnVuY3Rpb24oYykgewogICAgcmV0dXJuIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGZ1bmN0aW9uKGUpIHsgcmV0dXJuIGZ1bmN0aW9uKGYpIHsKICAgIHJldHVybiBmdW4oYSwgYiwgYywgZCwgZSwgZik7IH07IH07IH07IH07IH07CiAgfSk7Cn0KZnVuY3Rpb24gRjcoZnVuKSB7CiAgcmV0dXJuIEYoNywgZnVuLCBmdW5jdGlvbihhKSB7IHJldHVybiBmdW5jdGlvbihiKSB7IHJldHVybiBmdW5jdGlvbihjKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oZCkgeyByZXR1cm4gZnVuY3Rpb24oZSkgeyByZXR1cm4gZnVuY3Rpb24oZikgewogICAgcmV0dXJuIGZ1bmN0aW9uKGcpIHsgcmV0dXJuIGZ1bihhLCBiLCBjLCBkLCBlLCBmLCBnKTsgfTsgfTsgfTsgfTsgfTsgfTsKICB9KTsKfQpmdW5jdGlvbiBGOChmdW4pIHsKICByZXR1cm4gRig4LCBmdW4sIGZ1bmN0aW9uKGEpIHsgcmV0dXJuIGZ1bmN0aW9uKGIpIHsgcmV0dXJuIGZ1bmN0aW9uKGMpIHsKICAgIHJldHVybiBmdW5jdGlvbihkKSB7IHJldHVybiBmdW5jdGlvbihlKSB7IHJldHVybiBmdW5jdGlvbihmKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oZykgeyByZXR1cm4gZnVuY3Rpb24oaCkgewogICAgcmV0dXJuIGZ1bihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKTsgfTsgfTsgfTsgfTsgfTsgfTsgfTsKICB9KTsKfQpmdW5jdGlvbiBGOShmdW4pIHsKICByZXR1cm4gRig5LCBmdW4sIGZ1bmN0aW9uKGEpIHsgcmV0dXJuIGZ1bmN0aW9uKGIpIHsgcmV0dXJuIGZ1bmN0aW9uKGMpIHsKICAgIHJldHVybiBmdW5jdGlvbihkKSB7IHJldHVybiBmdW5jdGlvbihlKSB7IHJldHVybiBmdW5jdGlvbihmKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oZykgeyByZXR1cm4gZnVuY3Rpb24oaCkgeyByZXR1cm4gZnVuY3Rpb24oaSkgewogICAgcmV0dXJuIGZ1bihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBpKTsgfTsgfTsgfTsgfTsgfTsgfTsgfTsgfTsKICB9KTsKfQoKZnVuY3Rpb24gQTIoZnVuLCBhLCBiKSB7CiAgcmV0dXJuIGZ1bi5hID09PSAyID8gZnVuLmYoYSwgYikgOiBmdW4oYSkoYik7Cn0KZnVuY3Rpb24gQTMoZnVuLCBhLCBiLCBjKSB7CiAgcmV0dXJuIGZ1bi5hID09PSAzID8gZnVuLmYoYSwgYiwgYykgOiBmdW4oYSkoYikoYyk7Cn0KZnVuY3Rpb24gQTQoZnVuLCBhLCBiLCBjLCBkKSB7CiAgcmV0dXJuIGZ1bi5hID09PSA0ID8gZnVuLmYoYSwgYiwgYywgZCkgOiBmdW4oYSkoYikoYykoZCk7Cn0KZnVuY3Rpb24gQTUoZnVuLCBhLCBiLCBjLCBkLCBlKSB7CiAgcmV0dXJuIGZ1bi5hID09PSA1ID8gZnVuLmYoYSwgYiwgYywgZCwgZSkgOiBmdW4oYSkoYikoYykoZCkoZSk7Cn0KZnVuY3Rpb24gQTYoZnVuLCBhLCBiLCBjLCBkLCBlLCBmKSB7CiAgcmV0dXJuIGZ1bi5hID09PSA2ID8gZnVuLmYoYSwgYiwgYywgZCwgZSwgZikgOiBmdW4oYSkoYikoYykoZCkoZSkoZik7Cn0KZnVuY3Rpb24gQTcoZnVuLCBhLCBiLCBjLCBkLCBlLCBmLCBnKSB7CiAgcmV0dXJuIGZ1bi5hID09PSA3ID8gZnVuLmYoYSwgYiwgYywgZCwgZSwgZiwgZykgOiBmdW4oYSkoYikoYykoZCkoZSkoZikoZyk7Cn0KZnVuY3Rpb24gQTgoZnVuLCBhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgcmV0dXJuIGZ1bi5hID09PSA4ID8gZnVuLmYoYSwgYiwgYywgZCwgZSwgZiwgZywgaCkgOiBmdW4oYSkoYikoYykoZCkoZSkoZikoZykoaCk7Cn0KZnVuY3Rpb24gQTkoZnVuLCBhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBpKSB7CiAgcmV0dXJuIGZ1bi5hID09PSA5ID8gZnVuLmYoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaSkgOiBmdW4oYSkoYikoYykoZCkoZSkoZikoZykoaCkoaSk7Cn0KCmNvbnNvbGUud2FybignQ29tcGlsZWQgaW4gREVCVUcgbW9kZS4gRm9sbG93IHRoZSBhZHZpY2UgYXQgaHR0cHM6Ly9lbG0tbGFuZy5vcmcvMC4xOS4xL29wdGltaXplIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2UgYW5kIHNtYWxsZXIgYXNzZXRzLicpOwoKCi8vIEVRVUFMSVRZCgpmdW5jdGlvbiBfVXRpbHNfZXEoeCwgeSkKewoJZm9yICgKCQl2YXIgcGFpciwgc3RhY2sgPSBbXSwgaXNFcXVhbCA9IF9VdGlsc19lcUhlbHAoeCwgeSwgMCwgc3RhY2spOwoJCWlzRXF1YWwgJiYgKHBhaXIgPSBzdGFjay5wb3AoKSk7CgkJaXNFcXVhbCA9IF9VdGlsc19lcUhlbHAocGFpci5hLCBwYWlyLmIsIDAsIHN0YWNrKQoJCSkKCXt9CgoJcmV0dXJuIGlzRXF1YWw7Cn0KCmZ1bmN0aW9uIF9VdGlsc19lcUhlbHAoeCwgeSwgZGVwdGgsIHN0YWNrKQp7CglpZiAoZGVwdGggPiAxMDApCgl7CgkJc3RhY2sucHVzaChfVXRpbHNfVHVwbGUyKHgseSkpOwoJCXJldHVybiB0cnVlOwoJfQoKCWlmICh4ID09PSB5KQoJewoJCXJldHVybiB0cnVlOwoJfQoKCWlmICh0eXBlb2YgeCAhPT0gJ29iamVjdCcgfHwgeCA9PT0gbnVsbCB8fCB5ID09PSBudWxsKQoJewoJCXR5cGVvZiB4ID09PSAnZnVuY3Rpb24nICYmIF9EZWJ1Z19jcmFzaCg1KTsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJLyoqLwoJaWYgKHguJCA9PT0gJ1NldF9lbG1fYnVpbHRpbicpCgl7CgkJeCA9ICRlbG0kY29yZSRTZXQkdG9MaXN0KHgpOwoJCXkgPSAkZWxtJGNvcmUkU2V0JHRvTGlzdCh5KTsKCX0KCWlmICh4LiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nIHx8IHguJCA9PT0gJ1JCRW1wdHlfZWxtX2J1aWx0aW4nKQoJewoJCXggPSAkZWxtJGNvcmUkRGljdCR0b0xpc3QoeCk7CgkJeSA9ICRlbG0kY29yZSREaWN0JHRvTGlzdCh5KTsKCX0KCS8vKi8KCgkvKipfVU5VU0VELwoJaWYgKHguJCA8IDApCgl7CgkJeCA9ICRlbG0kY29yZSREaWN0JHRvTGlzdCh4KTsKCQl5ID0gJGVsbSRjb3JlJERpY3QkdG9MaXN0KHkpOwoJfQoJLy8qLwoKCWZvciAodmFyIGtleSBpbiB4KQoJewoJCWlmICghX1V0aWxzX2VxSGVscCh4W2tleV0sIHlba2V5XSwgZGVwdGggKyAxLCBzdGFjaykpCgkJewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoJcmV0dXJuIHRydWU7Cn0KCnZhciBfVXRpbHNfZXF1YWwgPSBGMihfVXRpbHNfZXEpOwp2YXIgX1V0aWxzX25vdEVxdWFsID0gRjIoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gIV9VdGlsc19lcShhLGIpOyB9KTsKCgoKLy8gQ09NUEFSSVNPTlMKCi8vIENvZGUgaW4gR2VuZXJhdGUvSmF2YVNjcmlwdC5ocywgQmFzaWNzLmpzLCBhbmQgTGlzdC5qcyBkZXBlbmRzIG9uCi8vIHRoZSBwYXJ0aWN1bGFyIGludGVnZXIgdmFsdWVzIGFzc2lnbmVkIHRvIExULCBFUSwgYW5kIEdULgoKZnVuY3Rpb24gX1V0aWxzX2NtcCh4LCB5LCBvcmQpCnsKCWlmICh0eXBlb2YgeCAhPT0gJ29iamVjdCcpCgl7CgkJcmV0dXJuIHggPT09IHkgPyAvKkVRKi8gMCA6IHggPCB5ID8gLypMVCovIC0xIDogLypHVCovIDE7Cgl9CgoJLyoqLwoJaWYgKHggaW5zdGFuY2VvZiBTdHJpbmcpCgl7CgkJdmFyIGEgPSB4LnZhbHVlT2YoKTsKCQl2YXIgYiA9IHkudmFsdWVPZigpOwoJCXJldHVybiBhID09PSBiID8gMCA6IGEgPCBiID8gLTEgOiAxOwoJfQoJLy8qLwoKCS8qKl9VTlVTRUQvCglpZiAodHlwZW9mIHguJCA9PT0gJ3VuZGVmaW5lZCcpCgkvLyovCgkvKiovCglpZiAoeC4kWzBdID09PSAnIycpCgkvLyovCgl7CgkJcmV0dXJuIChvcmQgPSBfVXRpbHNfY21wKHguYSwgeS5hKSkKCQkJPyBvcmQKCQkJOiAob3JkID0gX1V0aWxzX2NtcCh4LmIsIHkuYikpCgkJCQk/IG9yZAoJCQkJOiBfVXRpbHNfY21wKHguYywgeS5jKTsKCX0KCgkvLyB0cmF2ZXJzZSBjb25zZXMgdW50aWwgZW5kIG9mIGEgbGlzdCBvciBhIG1pc21hdGNoCglmb3IgKDsgeC5iICYmIHkuYiAmJiAhKG9yZCA9IF9VdGlsc19jbXAoeC5hLCB5LmEpKTsgeCA9IHguYiwgeSA9IHkuYikge30gLy8gV0hJTEVfQ09OU0VTCglyZXR1cm4gb3JkIHx8ICh4LmIgPyAvKkdUKi8gMSA6IHkuYiA/IC8qTFQqLyAtMSA6IC8qRVEqLyAwKTsKfQoKdmFyIF9VdGlsc19sdCA9IEYyKGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIF9VdGlsc19jbXAoYSwgYikgPCAwOyB9KTsKdmFyIF9VdGlsc19sZSA9IEYyKGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIF9VdGlsc19jbXAoYSwgYikgPCAxOyB9KTsKdmFyIF9VdGlsc19ndCA9IEYyKGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIF9VdGlsc19jbXAoYSwgYikgPiAwOyB9KTsKdmFyIF9VdGlsc19nZSA9IEYyKGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIF9VdGlsc19jbXAoYSwgYikgPj0gMDsgfSk7Cgp2YXIgX1V0aWxzX2NvbXBhcmUgPSBGMihmdW5jdGlvbih4LCB5KQp7Cgl2YXIgbiA9IF9VdGlsc19jbXAoeCwgeSk7CglyZXR1cm4gbiA8IDAgPyAkZWxtJGNvcmUkQmFzaWNzJExUIDogbiA/ICRlbG0kY29yZSRCYXNpY3MkR1QgOiAkZWxtJGNvcmUkQmFzaWNzJEVROwp9KTsKCgovLyBDT01NT04gVkFMVUVTCgp2YXIgX1V0aWxzX1R1cGxlMF9VTlVTRUQgPSAwOwp2YXIgX1V0aWxzX1R1cGxlMCA9IHsgJDogJyMwJyB9OwoKZnVuY3Rpb24gX1V0aWxzX1R1cGxlMl9VTlVTRUQoYSwgYikgeyByZXR1cm4geyBhOiBhLCBiOiBiIH07IH0KZnVuY3Rpb24gX1V0aWxzX1R1cGxlMihhLCBiKSB7IHJldHVybiB7ICQ6ICcjMicsIGE6IGEsIGI6IGIgfTsgfQoKZnVuY3Rpb24gX1V0aWxzX1R1cGxlM19VTlVTRUQoYSwgYiwgYykgeyByZXR1cm4geyBhOiBhLCBiOiBiLCBjOiBjIH07IH0KZnVuY3Rpb24gX1V0aWxzX1R1cGxlMyhhLCBiLCBjKSB7IHJldHVybiB7ICQ6ICcjMycsIGE6IGEsIGI6IGIsIGM6IGMgfTsgfQoKZnVuY3Rpb24gX1V0aWxzX2Nocl9VTlVTRUQoYykgeyByZXR1cm4gYzsgfQpmdW5jdGlvbiBfVXRpbHNfY2hyKGMpIHsgcmV0dXJuIG5ldyBTdHJpbmcoYyk7IH0KCgovLyBSRUNPUkRTCgpmdW5jdGlvbiBfVXRpbHNfdXBkYXRlKG9sZFJlY29yZCwgdXBkYXRlZEZpZWxkcykKewoJdmFyIG5ld1JlY29yZCA9IHt9OwoKCWZvciAodmFyIGtleSBpbiBvbGRSZWNvcmQpCgl7CgkJbmV3UmVjb3JkW2tleV0gPSBvbGRSZWNvcmRba2V5XTsKCX0KCglmb3IgKHZhciBrZXkgaW4gdXBkYXRlZEZpZWxkcykKCXsKCQluZXdSZWNvcmRba2V5XSA9IHVwZGF0ZWRGaWVsZHNba2V5XTsKCX0KCglyZXR1cm4gbmV3UmVjb3JkOwp9CgoKLy8gQVBQRU5ECgp2YXIgX1V0aWxzX2FwcGVuZCA9IEYyKF9VdGlsc19hcCk7CgpmdW5jdGlvbiBfVXRpbHNfYXAoeHMsIHlzKQp7CgkvLyBhcHBlbmQgU3RyaW5ncwoJaWYgKHR5cGVvZiB4cyA9PT0gJ3N0cmluZycpCgl7CgkJcmV0dXJuIHhzICsgeXM7Cgl9CgoJLy8gYXBwZW5kIExpc3RzCglpZiAoIXhzLmIpCgl7CgkJcmV0dXJuIHlzOwoJfQoJdmFyIHJvb3QgPSBfTGlzdF9Db25zKHhzLmEsIHlzKTsKCXhzID0geHMuYgoJZm9yICh2YXIgY3VyciA9IHJvb3Q7IHhzLmI7IHhzID0geHMuYikgLy8gV0hJTEVfQ09OUwoJewoJCWN1cnIgPSBjdXJyLmIgPSBfTGlzdF9Db25zKHhzLmEsIHlzKTsKCX0KCXJldHVybiByb290Owp9CgoKCnZhciBfTGlzdF9OaWxfVU5VU0VEID0geyAkOiAwIH07CnZhciBfTGlzdF9OaWwgPSB7ICQ6ICdbXScgfTsKCmZ1bmN0aW9uIF9MaXN0X0NvbnNfVU5VU0VEKGhkLCB0bCkgeyByZXR1cm4geyAkOiAxLCBhOiBoZCwgYjogdGwgfTsgfQpmdW5jdGlvbiBfTGlzdF9Db25zKGhkLCB0bCkgeyByZXR1cm4geyAkOiAnOjonLCBhOiBoZCwgYjogdGwgfTsgfQoKCnZhciBfTGlzdF9jb25zID0gRjIoX0xpc3RfQ29ucyk7CgpmdW5jdGlvbiBfTGlzdF9mcm9tQXJyYXkoYXJyKQp7Cgl2YXIgb3V0ID0gX0xpc3RfTmlsOwoJZm9yICh2YXIgaSA9IGFyci5sZW5ndGg7IGktLTsgKQoJewoJCW91dCA9IF9MaXN0X0NvbnMoYXJyW2ldLCBvdXQpOwoJfQoJcmV0dXJuIG91dDsKfQoKZnVuY3Rpb24gX0xpc3RfdG9BcnJheSh4cykKewoJZm9yICh2YXIgb3V0ID0gW107IHhzLmI7IHhzID0geHMuYikgLy8gV0hJTEVfQ09OUwoJewoJCW91dC5wdXNoKHhzLmEpOwoJfQoJcmV0dXJuIG91dDsKfQoKdmFyIF9MaXN0X21hcDIgPSBGMyhmdW5jdGlvbihmLCB4cywgeXMpCnsKCWZvciAodmFyIGFyciA9IFtdOyB4cy5iICYmIHlzLmI7IHhzID0geHMuYiwgeXMgPSB5cy5iKSAvLyBXSElMRV9DT05TRVMKCXsKCQlhcnIucHVzaChBMihmLCB4cy5hLCB5cy5hKSk7Cgl9CglyZXR1cm4gX0xpc3RfZnJvbUFycmF5KGFycik7Cn0pOwoKdmFyIF9MaXN0X21hcDMgPSBGNChmdW5jdGlvbihmLCB4cywgeXMsIHpzKQp7Cglmb3IgKHZhciBhcnIgPSBbXTsgeHMuYiAmJiB5cy5iICYmIHpzLmI7IHhzID0geHMuYiwgeXMgPSB5cy5iLCB6cyA9IHpzLmIpIC8vIFdISUxFX0NPTlNFUwoJewoJCWFyci5wdXNoKEEzKGYsIHhzLmEsIHlzLmEsIHpzLmEpKTsKCX0KCXJldHVybiBfTGlzdF9mcm9tQXJyYXkoYXJyKTsKfSk7Cgp2YXIgX0xpc3RfbWFwNCA9IEY1KGZ1bmN0aW9uKGYsIHdzLCB4cywgeXMsIHpzKQp7Cglmb3IgKHZhciBhcnIgPSBbXTsgd3MuYiAmJiB4cy5iICYmIHlzLmIgJiYgenMuYjsgd3MgPSB3cy5iLCB4cyA9IHhzLmIsIHlzID0geXMuYiwgenMgPSB6cy5iKSAvLyBXSElMRV9DT05TRVMKCXsKCQlhcnIucHVzaChBNChmLCB3cy5hLCB4cy5hLCB5cy5hLCB6cy5hKSk7Cgl9CglyZXR1cm4gX0xpc3RfZnJvbUFycmF5KGFycik7Cn0pOwoKdmFyIF9MaXN0X21hcDUgPSBGNihmdW5jdGlvbihmLCB2cywgd3MsIHhzLCB5cywgenMpCnsKCWZvciAodmFyIGFyciA9IFtdOyB2cy5iICYmIHdzLmIgJiYgeHMuYiAmJiB5cy5iICYmIHpzLmI7IHZzID0gdnMuYiwgd3MgPSB3cy5iLCB4cyA9IHhzLmIsIHlzID0geXMuYiwgenMgPSB6cy5iKSAvLyBXSElMRV9DT05TRVMKCXsKCQlhcnIucHVzaChBNShmLCB2cy5hLCB3cy5hLCB4cy5hLCB5cy5hLCB6cy5hKSk7Cgl9CglyZXR1cm4gX0xpc3RfZnJvbUFycmF5KGFycik7Cn0pOwoKdmFyIF9MaXN0X3NvcnRCeSA9IEYyKGZ1bmN0aW9uKGYsIHhzKQp7CglyZXR1cm4gX0xpc3RfZnJvbUFycmF5KF9MaXN0X3RvQXJyYXkoeHMpLnNvcnQoZnVuY3Rpb24oYSwgYikgewoJCXJldHVybiBfVXRpbHNfY21wKGYoYSksIGYoYikpOwoJfSkpOwp9KTsKCnZhciBfTGlzdF9zb3J0V2l0aCA9IEYyKGZ1bmN0aW9uKGYsIHhzKQp7CglyZXR1cm4gX0xpc3RfZnJvbUFycmF5KF9MaXN0X3RvQXJyYXkoeHMpLnNvcnQoZnVuY3Rpb24oYSwgYikgewoJCXZhciBvcmQgPSBBMihmLCBhLCBiKTsKCQlyZXR1cm4gb3JkID09PSAkZWxtJGNvcmUkQmFzaWNzJEVRID8gMCA6IG9yZCA9PT0gJGVsbSRjb3JlJEJhc2ljcyRMVCA/IC0xIDogMTsKCX0pKTsKfSk7CgoKCnZhciBfSnNBcnJheV9lbXB0eSA9IFtdOwoKZnVuY3Rpb24gX0pzQXJyYXlfc2luZ2xldG9uKHZhbHVlKQp7CiAgICByZXR1cm4gW3ZhbHVlXTsKfQoKZnVuY3Rpb24gX0pzQXJyYXlfbGVuZ3RoKGFycmF5KQp7CiAgICByZXR1cm4gYXJyYXkubGVuZ3RoOwp9Cgp2YXIgX0pzQXJyYXlfaW5pdGlhbGl6ZSA9IEYzKGZ1bmN0aW9uKHNpemUsIG9mZnNldCwgZnVuYykKewogICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheShzaXplKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykKICAgIHsKICAgICAgICByZXN1bHRbaV0gPSBmdW5jKG9mZnNldCArIGkpOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0pOwoKdmFyIF9Kc0FycmF5X2luaXRpYWxpemVGcm9tTGlzdCA9IEYyKGZ1bmN0aW9uIChtYXgsIGxzKQp7CiAgICB2YXIgcmVzdWx0ID0gbmV3IEFycmF5KG1heCk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXggJiYgbHMuYjsgaSsrKQogICAgewogICAgICAgIHJlc3VsdFtpXSA9IGxzLmE7CiAgICAgICAgbHMgPSBscy5iOwogICAgfQoKICAgIHJlc3VsdC5sZW5ndGggPSBpOwogICAgcmV0dXJuIF9VdGlsc19UdXBsZTIocmVzdWx0LCBscyk7Cn0pOwoKdmFyIF9Kc0FycmF5X3Vuc2FmZUdldCA9IEYyKGZ1bmN0aW9uKGluZGV4LCBhcnJheSkKewogICAgcmV0dXJuIGFycmF5W2luZGV4XTsKfSk7Cgp2YXIgX0pzQXJyYXlfdW5zYWZlU2V0ID0gRjMoZnVuY3Rpb24oaW5kZXgsIHZhbHVlLCBhcnJheSkKewogICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgIHZhciByZXN1bHQgPSBuZXcgQXJyYXkobGVuZ3RoKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKQogICAgewogICAgICAgIHJlc3VsdFtpXSA9IGFycmF5W2ldOwogICAgfQoKICAgIHJlc3VsdFtpbmRleF0gPSB2YWx1ZTsKICAgIHJldHVybiByZXN1bHQ7Cn0pOwoKdmFyIF9Kc0FycmF5X3B1c2ggPSBGMihmdW5jdGlvbih2YWx1ZSwgYXJyYXkpCnsKICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICB2YXIgcmVzdWx0ID0gbmV3IEFycmF5KGxlbmd0aCArIDEpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICAgcmVzdWx0W2ldID0gYXJyYXlbaV07CiAgICB9CgogICAgcmVzdWx0W2xlbmd0aF0gPSB2YWx1ZTsKICAgIHJldHVybiByZXN1bHQ7Cn0pOwoKdmFyIF9Kc0FycmF5X2ZvbGRsID0gRjMoZnVuY3Rpb24oZnVuYywgYWNjLCBhcnJheSkKewogICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKQogICAgewogICAgICAgIGFjYyA9IEEyKGZ1bmMsIGFycmF5W2ldLCBhY2MpOwogICAgfQoKICAgIHJldHVybiBhY2M7Cn0pOwoKdmFyIF9Kc0FycmF5X2ZvbGRyID0gRjMoZnVuY3Rpb24oZnVuYywgYWNjLCBhcnJheSkKewogICAgZm9yICh2YXIgaSA9IGFycmF5Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKQogICAgewogICAgICAgIGFjYyA9IEEyKGZ1bmMsIGFycmF5W2ldLCBhY2MpOwogICAgfQoKICAgIHJldHVybiBhY2M7Cn0pOwoKdmFyIF9Kc0FycmF5X21hcCA9IEYyKGZ1bmN0aW9uKGZ1bmMsIGFycmF5KQp7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheShsZW5ndGgpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICAgcmVzdWx0W2ldID0gZnVuYyhhcnJheVtpXSk7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKfSk7Cgp2YXIgX0pzQXJyYXlfaW5kZXhlZE1hcCA9IEYzKGZ1bmN0aW9uKGZ1bmMsIG9mZnNldCwgYXJyYXkpCnsKICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICB2YXIgcmVzdWx0ID0gbmV3IEFycmF5KGxlbmd0aCk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykKICAgIHsKICAgICAgICByZXN1bHRbaV0gPSBBMihmdW5jLCBvZmZzZXQgKyBpLCBhcnJheVtpXSk7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKfSk7Cgp2YXIgX0pzQXJyYXlfc2xpY2UgPSBGMyhmdW5jdGlvbihmcm9tLCB0bywgYXJyYXkpCnsKICAgIHJldHVybiBhcnJheS5zbGljZShmcm9tLCB0byk7Cn0pOwoKdmFyIF9Kc0FycmF5X2FwcGVuZE4gPSBGMyhmdW5jdGlvbihuLCBkZXN0LCBzb3VyY2UpCnsKICAgIHZhciBkZXN0TGVuID0gZGVzdC5sZW5ndGg7CiAgICB2YXIgaXRlbXNUb0NvcHkgPSBuIC0gZGVzdExlbjsKCiAgICBpZiAoaXRlbXNUb0NvcHkgPiBzb3VyY2UubGVuZ3RoKQogICAgewogICAgICAgIGl0ZW1zVG9Db3B5ID0gc291cmNlLmxlbmd0aDsKICAgIH0KCiAgICB2YXIgc2l6ZSA9IGRlc3RMZW4gKyBpdGVtc1RvQ29weTsKICAgIHZhciByZXN1bHQgPSBuZXcgQXJyYXkoc2l6ZSk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZXN0TGVuOyBpKyspCiAgICB7CiAgICAgICAgcmVzdWx0W2ldID0gZGVzdFtpXTsKICAgIH0KCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zVG9Db3B5OyBpKyspCiAgICB7CiAgICAgICAgcmVzdWx0W2kgKyBkZXN0TGVuXSA9IHNvdXJjZVtpXTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9KTsKCgoKLy8gTE9HCgp2YXIgX0RlYnVnX2xvZ19VTlVTRUQgPSBGMihmdW5jdGlvbih0YWcsIHZhbHVlKQp7CglyZXR1cm4gdmFsdWU7Cn0pOwoKdmFyIF9EZWJ1Z19sb2cgPSBGMihmdW5jdGlvbih0YWcsIHZhbHVlKQp7Cgljb25zb2xlLmxvZyh0YWcgKyAnOiAnICsgX0RlYnVnX3RvU3RyaW5nKHZhbHVlKSk7CglyZXR1cm4gdmFsdWU7Cn0pOwoKCi8vIFRPRE9TCgpmdW5jdGlvbiBfRGVidWdfdG9kbyhtb2R1bGVOYW1lLCByZWdpb24pCnsKCXJldHVybiBmdW5jdGlvbihtZXNzYWdlKSB7CgkJX0RlYnVnX2NyYXNoKDgsIG1vZHVsZU5hbWUsIHJlZ2lvbiwgbWVzc2FnZSk7Cgl9Owp9CgpmdW5jdGlvbiBfRGVidWdfdG9kb0Nhc2UobW9kdWxlTmFtZSwgcmVnaW9uLCB2YWx1ZSkKewoJcmV0dXJuIGZ1bmN0aW9uKG1lc3NhZ2UpIHsKCQlfRGVidWdfY3Jhc2goOSwgbW9kdWxlTmFtZSwgcmVnaW9uLCB2YWx1ZSwgbWVzc2FnZSk7Cgl9Owp9CgoKLy8gVE8gU1RSSU5HCgpmdW5jdGlvbiBfRGVidWdfdG9TdHJpbmdfVU5VU0VEKHZhbHVlKQp7CglyZXR1cm4gJzxpbnRlcm5hbHM+JzsKfQoKZnVuY3Rpb24gX0RlYnVnX3RvU3RyaW5nKHZhbHVlKQp7CglyZXR1cm4gX0RlYnVnX3RvQW5zaVN0cmluZyhmYWxzZSwgdmFsdWUpOwp9CgpmdW5jdGlvbiBfRGVidWdfdG9BbnNpU3RyaW5nKGFuc2ksIHZhbHVlKQp7CglpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKQoJewoJCXJldHVybiBfRGVidWdfaW50ZXJuYWxDb2xvcihhbnNpLCAnPGZ1bmN0aW9uPicpOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykKCXsKCQlyZXR1cm4gX0RlYnVnX2N0b3JDb2xvcihhbnNpLCB2YWx1ZSA/ICdUcnVlJyA6ICdGYWxzZScpOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKQoJewoJCXJldHVybiBfRGVidWdfbnVtYmVyQ29sb3IoYW5zaSwgdmFsdWUgKyAnJyk7Cgl9CgoJaWYgKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nKQoJewoJCXJldHVybiBfRGVidWdfY2hhckNvbG9yKGFuc2ksICInIiArIF9EZWJ1Z19hZGRTbGFzaGVzKHZhbHVlLCB0cnVlKSArICInIik7Cgl9CgoJaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpCgl7CgkJcmV0dXJuIF9EZWJ1Z19zdHJpbmdDb2xvcihhbnNpLCAnIicgKyBfRGVidWdfYWRkU2xhc2hlcyh2YWx1ZSwgZmFsc2UpICsgJyInKTsKCX0KCglpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiAnJCcgaW4gdmFsdWUpCgl7CgkJdmFyIHRhZyA9IHZhbHVlLiQ7CgoJCWlmICh0eXBlb2YgdGFnID09PSAnbnVtYmVyJykKCQl7CgkJCXJldHVybiBfRGVidWdfaW50ZXJuYWxDb2xvcihhbnNpLCAnPGludGVybmFscz4nKTsKCQl9CgoJCWlmICh0YWdbMF0gPT09ICcjJykKCQl7CgkJCXZhciBvdXRwdXQgPSBbXTsKCQkJZm9yICh2YXIgayBpbiB2YWx1ZSkKCQkJewoJCQkJaWYgKGsgPT09ICckJykgY29udGludWU7CgkJCQlvdXRwdXQucHVzaChfRGVidWdfdG9BbnNpU3RyaW5nKGFuc2ksIHZhbHVlW2tdKSk7CgkJCX0KCQkJcmV0dXJuICcoJyArIG91dHB1dC5qb2luKCcsJykgKyAnKSc7CgkJfQoKCQlpZiAodGFnID09PSAnU2V0X2VsbV9idWlsdGluJykKCQl7CgkJCXJldHVybiBfRGVidWdfY3RvckNvbG9yKGFuc2ksICdTZXQnKQoJCQkJKyBfRGVidWdfZmFkZUNvbG9yKGFuc2ksICcuZnJvbUxpc3QnKSArICcgJwoJCQkJKyBfRGVidWdfdG9BbnNpU3RyaW5nKGFuc2ksICRlbG0kY29yZSRTZXQkdG9MaXN0KHZhbHVlKSk7CgkJfQoKCQlpZiAodGFnID09PSAnUkJOb2RlX2VsbV9idWlsdGluJyB8fCB0YWcgPT09ICdSQkVtcHR5X2VsbV9idWlsdGluJykKCQl7CgkJCXJldHVybiBfRGVidWdfY3RvckNvbG9yKGFuc2ksICdEaWN0JykKCQkJCSsgX0RlYnVnX2ZhZGVDb2xvcihhbnNpLCAnLmZyb21MaXN0JykgKyAnICcKCQkJCSsgX0RlYnVnX3RvQW5zaVN0cmluZyhhbnNpLCAkZWxtJGNvcmUkRGljdCR0b0xpc3QodmFsdWUpKTsKCQl9CgoJCWlmICh0YWcgPT09ICdBcnJheV9lbG1fYnVpbHRpbicpCgkJewoJCQlyZXR1cm4gX0RlYnVnX2N0b3JDb2xvcihhbnNpLCAnQXJyYXknKQoJCQkJKyBfRGVidWdfZmFkZUNvbG9yKGFuc2ksICcuZnJvbUxpc3QnKSArICcgJwoJCQkJKyBfRGVidWdfdG9BbnNpU3RyaW5nKGFuc2ksICRlbG0kY29yZSRBcnJheSR0b0xpc3QodmFsdWUpKTsKCQl9CgoJCWlmICh0YWcgPT09ICc6OicgfHwgdGFnID09PSAnW10nKQoJCXsKCQkJdmFyIG91dHB1dCA9ICdbJzsKCgkJCXZhbHVlLmIgJiYgKG91dHB1dCArPSBfRGVidWdfdG9BbnNpU3RyaW5nKGFuc2ksIHZhbHVlLmEpLCB2YWx1ZSA9IHZhbHVlLmIpCgoJCQlmb3IgKDsgdmFsdWUuYjsgdmFsdWUgPSB2YWx1ZS5iKSAvLyBXSElMRV9DT05TCgkJCXsKCQkJCW91dHB1dCArPSAnLCcgKyBfRGVidWdfdG9BbnNpU3RyaW5nKGFuc2ksIHZhbHVlLmEpOwoJCQl9CgkJCXJldHVybiBvdXRwdXQgKyAnXSc7CgkJfQoKCQl2YXIgb3V0cHV0ID0gJyc7CgkJZm9yICh2YXIgaSBpbiB2YWx1ZSkKCQl7CgkJCWlmIChpID09PSAnJCcpIGNvbnRpbnVlOwoJCQl2YXIgc3RyID0gX0RlYnVnX3RvQW5zaVN0cmluZyhhbnNpLCB2YWx1ZVtpXSk7CgkJCXZhciBjMCA9IHN0clswXTsKCQkJdmFyIHBhcmVubGVzcyA9IGMwID09PSAneycgfHwgYzAgPT09ICcoJyB8fCBjMCA9PT0gJ1snIHx8IGMwID09PSAnPCcgfHwgYzAgPT09ICciJyB8fCBzdHIuaW5kZXhPZignICcpIDwgMDsKCQkJb3V0cHV0ICs9ICcgJyArIChwYXJlbmxlc3MgPyBzdHIgOiAnKCcgKyBzdHIgKyAnKScpOwoJCX0KCQlyZXR1cm4gX0RlYnVnX2N0b3JDb2xvcihhbnNpLCB0YWcpICsgb3V0cHV0OwoJfQoKCWlmICh0eXBlb2YgRGF0YVZpZXcgPT09ICdmdW5jdGlvbicgJiYgdmFsdWUgaW5zdGFuY2VvZiBEYXRhVmlldykKCXsKCQlyZXR1cm4gX0RlYnVnX3N0cmluZ0NvbG9yKGFuc2ksICc8JyArIHZhbHVlLmJ5dGVMZW5ndGggKyAnIGJ5dGVzPicpOwoJfQoKCWlmICh0eXBlb2YgRmlsZSA9PT0gJ2Z1bmN0aW9uJyAmJiB2YWx1ZSBpbnN0YW5jZW9mIEZpbGUpCgl7CgkJcmV0dXJuIF9EZWJ1Z19pbnRlcm5hbENvbG9yKGFuc2ksICc8JyArIHZhbHVlLm5hbWUgKyAnPicpOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKQoJewoJCXZhciBvdXRwdXQgPSBbXTsKCQlmb3IgKHZhciBrZXkgaW4gdmFsdWUpCgkJewoJCQl2YXIgZmllbGQgPSBrZXlbMF0gPT09ICdfJyA/IGtleS5zbGljZSgxKSA6IGtleTsKCQkJb3V0cHV0LnB1c2goX0RlYnVnX2ZhZGVDb2xvcihhbnNpLCBmaWVsZCkgKyAnID0gJyArIF9EZWJ1Z190b0Fuc2lTdHJpbmcoYW5zaSwgdmFsdWVba2V5XSkpOwoJCX0KCQlpZiAob3V0cHV0Lmxlbmd0aCA9PT0gMCkKCQl7CgkJCXJldHVybiAne30nOwoJCX0KCQlyZXR1cm4gJ3sgJyArIG91dHB1dC5qb2luKCcsICcpICsgJyB9JzsKCX0KCglyZXR1cm4gX0RlYnVnX2ludGVybmFsQ29sb3IoYW5zaSwgJzxpbnRlcm5hbHM+Jyk7Cn0KCmZ1bmN0aW9uIF9EZWJ1Z19hZGRTbGFzaGVzKHN0ciwgaXNDaGFyKQp7Cgl2YXIgcyA9IHN0cgoJCS5yZXBsYWNlKC9cXC9nLCAnXFxcXCcpCgkJLnJlcGxhY2UoL1xuL2csICdcXG4nKQoJCS5yZXBsYWNlKC9cdC9nLCAnXFx0JykKCQkucmVwbGFjZSgvXHIvZywgJ1xccicpCgkJLnJlcGxhY2UoL1x2L2csICdcXHYnKQoJCS5yZXBsYWNlKC9cMC9nLCAnXFwwJyk7CgoJaWYgKGlzQ2hhcikKCXsKCQlyZXR1cm4gcy5yZXBsYWNlKC9cJy9nLCAnXFxcJycpOwoJfQoJZWxzZQoJewoJCXJldHVybiBzLnJlcGxhY2UoL1wiL2csICdcXCInKTsKCX0KfQoKZnVuY3Rpb24gX0RlYnVnX2N0b3JDb2xvcihhbnNpLCBzdHJpbmcpCnsKCXJldHVybiBhbnNpID8gJ1x4MWJbOTZtJyArIHN0cmluZyArICdceDFiWzBtJyA6IHN0cmluZzsKfQoKZnVuY3Rpb24gX0RlYnVnX251bWJlckNvbG9yKGFuc2ksIHN0cmluZykKewoJcmV0dXJuIGFuc2kgPyAnXHgxYls5NW0nICsgc3RyaW5nICsgJ1x4MWJbMG0nIDogc3RyaW5nOwp9CgpmdW5jdGlvbiBfRGVidWdfc3RyaW5nQ29sb3IoYW5zaSwgc3RyaW5nKQp7CglyZXR1cm4gYW5zaSA/ICdceDFiWzkzbScgKyBzdHJpbmcgKyAnXHgxYlswbScgOiBzdHJpbmc7Cn0KCmZ1bmN0aW9uIF9EZWJ1Z19jaGFyQ29sb3IoYW5zaSwgc3RyaW5nKQp7CglyZXR1cm4gYW5zaSA/ICdceDFiWzkybScgKyBzdHJpbmcgKyAnXHgxYlswbScgOiBzdHJpbmc7Cn0KCmZ1bmN0aW9uIF9EZWJ1Z19mYWRlQ29sb3IoYW5zaSwgc3RyaW5nKQp7CglyZXR1cm4gYW5zaSA/ICdceDFiWzM3bScgKyBzdHJpbmcgKyAnXHgxYlswbScgOiBzdHJpbmc7Cn0KCmZ1bmN0aW9uIF9EZWJ1Z19pbnRlcm5hbENvbG9yKGFuc2ksIHN0cmluZykKewoJcmV0dXJuIGFuc2kgPyAnXHgxYls5NG0nICsgc3RyaW5nICsgJ1x4MWJbMG0nIDogc3RyaW5nOwp9CgpmdW5jdGlvbiBfRGVidWdfdG9IZXhEaWdpdChuKQp7CglyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShuIDwgMTAgPyA0OCArIG4gOiA1NSArIG4pOwp9CgoKLy8gQ1JBU0gKCgpmdW5jdGlvbiBfRGVidWdfY3Jhc2hfVU5VU0VEKGlkZW50aWZpZXIpCnsKCXRocm93IG5ldyBFcnJvcignaHR0cHM6Ly9naXRodWIuY29tL2VsbS9jb3JlL2Jsb2IvMS4wLjAvaGludHMvJyArIGlkZW50aWZpZXIgKyAnLm1kJyk7Cn0KCgpmdW5jdGlvbiBfRGVidWdfY3Jhc2goaWRlbnRpZmllciwgZmFjdDEsIGZhY3QyLCBmYWN0MywgZmFjdDQpCnsKCXN3aXRjaChpZGVudGlmaWVyKQoJewoJCWNhc2UgMDoKCQkJdGhyb3cgbmV3IEVycm9yKCdXaGF0IG5vZGUgc2hvdWxkIEkgdGFrZSBvdmVyPyBJbiBKYXZhU2NyaXB0IEkgbmVlZCBzb21ldGhpbmcgbGlrZTpcblxuICAgIEVsbS5NYWluLmluaXQoe1xuICAgICAgICBub2RlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxtLW5vZGUiKVxuICAgIH0pXG5cbllvdSBuZWVkIHRvIGRvIHRoaXMgd2l0aCBhbnkgQnJvd3Nlci5zYW5kYm94IG9yIEJyb3dzZXIuZWxlbWVudCBwcm9ncmFtLicpOwoKCQljYXNlIDE6CgkJCXRocm93IG5ldyBFcnJvcignQnJvd3Nlci5hcHBsaWNhdGlvbiBwcm9ncmFtcyBjYW5ub3QgaGFuZGxlIFVSTHMgbGlrZSB0aGlzOlxuXG4gICAgJyArIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgKyAnXG5cbldoYXQgaXMgdGhlIHJvb3Q/IFRoZSByb290IG9mIHlvdXIgZmlsZSBzeXN0ZW0/IFRyeSBsb29raW5nIGF0IHRoaXMgcHJvZ3JhbSB3aXRoIGBlbG0gcmVhY3RvcmAgb3Igc29tZSBvdGhlciBzZXJ2ZXIuJyk7CgoJCWNhc2UgMjoKCQkJdmFyIGpzb25FcnJvclN0cmluZyA9IGZhY3QxOwoJCQl0aHJvdyBuZXcgRXJyb3IoJ1Byb2JsZW0gd2l0aCB0aGUgZmxhZ3MgZ2l2ZW4gdG8geW91ciBFbG0gcHJvZ3JhbSBvbiBpbml0aWFsaXphdGlvbi5cblxuJyArIGpzb25FcnJvclN0cmluZyk7CgoJCWNhc2UgMzoKCQkJdmFyIHBvcnROYW1lID0gZmFjdDE7CgkJCXRocm93IG5ldyBFcnJvcignVGhlcmUgY2FuIG9ubHkgYmUgb25lIHBvcnQgbmFtZWQgYCcgKyBwb3J0TmFtZSArICdgLCBidXQgeW91ciBwcm9ncmFtIGhhcyBtdWx0aXBsZS4nKTsKCgkJY2FzZSA0OgoJCQl2YXIgcG9ydE5hbWUgPSBmYWN0MTsKCQkJdmFyIHByb2JsZW0gPSBmYWN0MjsKCQkJdGhyb3cgbmV3IEVycm9yKCdUcnlpbmcgdG8gc2VuZCBhbiB1bmV4cGVjdGVkIHR5cGUgb2YgdmFsdWUgdGhyb3VnaCBwb3J0IGAnICsgcG9ydE5hbWUgKyAnYDpcbicgKyBwcm9ibGVtKTsKCgkJY2FzZSA1OgoJCQl0aHJvdyBuZXcgRXJyb3IoJ1RyeWluZyB0byB1c2UgYCg9PSlgIG9uIGZ1bmN0aW9ucy5cblRoZXJlIGlzIG5vIHdheSB0byBrbm93IGlmIGZ1bmN0aW9ucyBhcmUgInRoZSBzYW1lIiBpbiB0aGUgRWxtIHNlbnNlLlxuUmVhZCBtb3JlIGFib3V0IHRoaXMgYXQgaHR0cHM6Ly9wYWNrYWdlLmVsbS1sYW5nLm9yZy9wYWNrYWdlcy9lbG0vY29yZS9sYXRlc3QvQmFzaWNzIz09IHdoaWNoIGRlc2NyaWJlcyB3aHkgaXQgaXMgdGhpcyB3YXkgYW5kIHdoYXQgdGhlIGJldHRlciB2ZXJzaW9uIHdpbGwgbG9vayBsaWtlLicpOwoKCQljYXNlIDY6CgkJCXZhciBtb2R1bGVOYW1lID0gZmFjdDE7CgkJCXRocm93IG5ldyBFcnJvcignWW91ciBwYWdlIGlzIGxvYWRpbmcgbXVsdGlwbGUgRWxtIHNjcmlwdHMgd2l0aCBhIG1vZHVsZSBuYW1lZCAnICsgbW9kdWxlTmFtZSArICcuIE1heWJlIGEgZHVwbGljYXRlIHNjcmlwdCBpcyBnZXR0aW5nIGxvYWRlZCBhY2NpZGVudGFsbHk/IElmIG5vdCwgcmVuYW1lIG9uZSBvZiB0aGVtIHNvIEkga25vdyB3aGljaCBpcyB3aGljaCEnKTsKCgkJY2FzZSA4OgoJCQl2YXIgbW9kdWxlTmFtZSA9IGZhY3QxOwoJCQl2YXIgcmVnaW9uID0gZmFjdDI7CgkJCXZhciBtZXNzYWdlID0gZmFjdDM7CgkJCXRocm93IG5ldyBFcnJvcignVE9ETyBpbiBtb2R1bGUgYCcgKyBtb2R1bGVOYW1lICsgJ2AgJyArIF9EZWJ1Z19yZWdpb25Ub1N0cmluZyhyZWdpb24pICsgJ1xuXG4nICsgbWVzc2FnZSk7CgoJCWNhc2UgOToKCQkJdmFyIG1vZHVsZU5hbWUgPSBmYWN0MTsKCQkJdmFyIHJlZ2lvbiA9IGZhY3QyOwoJCQl2YXIgdmFsdWUgPSBmYWN0MzsKCQkJdmFyIG1lc3NhZ2UgPSBmYWN0NDsKCQkJdGhyb3cgbmV3IEVycm9yKAoJCQkJJ1RPRE8gaW4gbW9kdWxlIGAnICsgbW9kdWxlTmFtZSArICdgIGZyb20gdGhlIGBjYXNlYCBleHByZXNzaW9uICcKCQkJCSsgX0RlYnVnX3JlZ2lvblRvU3RyaW5nKHJlZ2lvbikgKyAnXG5cbkl0IHJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgdmFsdWU6XG5cbiAgICAnCgkJCQkrIF9EZWJ1Z190b1N0cmluZyh2YWx1ZSkucmVwbGFjZSgnXG4nLCAnXG4gICAgJykKCQkJCSsgJ1xuXG5CdXQgdGhlIGJyYW5jaCB0aGF0IGhhbmRsZXMgaXQgc2F5czpcblxuICAgICcgKyBtZXNzYWdlLnJlcGxhY2UoJ1xuJywgJ1xuICAgICcpCgkJCSk7CgoJCWNhc2UgMTA6CgkJCXRocm93IG5ldyBFcnJvcignQnVnIGluIGh0dHBzOi8vZ2l0aHViLmNvbS9lbG0vdmlydHVhbC1kb20vaXNzdWVzJyk7CgoJCWNhc2UgMTE6CgkJCXRocm93IG5ldyBFcnJvcignQ2Fubm90IHBlcmZvcm0gbW9kIDAuIERpdmlzaW9uIGJ5IHplcm8gZXJyb3IuJyk7Cgl9Cn0KCmZ1bmN0aW9uIF9EZWJ1Z19yZWdpb25Ub1N0cmluZyhyZWdpb24pCnsKCWlmIChyZWdpb24uc3RhcnQubGluZSA9PT0gcmVnaW9uLmVuZC5saW5lKQoJewoJCXJldHVybiAnb24gbGluZSAnICsgcmVnaW9uLnN0YXJ0LmxpbmU7Cgl9CglyZXR1cm4gJ29uIGxpbmVzICcgKyByZWdpb24uc3RhcnQubGluZSArICcgdGhyb3VnaCAnICsgcmVnaW9uLmVuZC5saW5lOwp9CgoKCi8vIE1BVEgKCnZhciBfQmFzaWNzX2FkZCA9IEYyKGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGEgKyBiOyB9KTsKdmFyIF9CYXNpY3Nfc3ViID0gRjIoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYSAtIGI7IH0pOwp2YXIgX0Jhc2ljc19tdWwgPSBGMihmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhICogYjsgfSk7CnZhciBfQmFzaWNzX2ZkaXYgPSBGMihmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhIC8gYjsgfSk7CnZhciBfQmFzaWNzX2lkaXYgPSBGMihmdW5jdGlvbihhLCBiKSB7IHJldHVybiAoYSAvIGIpIHwgMDsgfSk7CnZhciBfQmFzaWNzX3BvdyA9IEYyKE1hdGgucG93KTsKCnZhciBfQmFzaWNzX3JlbWFpbmRlckJ5ID0gRjIoZnVuY3Rpb24oYiwgYSkgeyByZXR1cm4gYSAlIGI7IH0pOwoKLy8gaHR0cHM6Ly93d3cubWljcm9zb2Z0LmNvbS9lbi11cy9yZXNlYXJjaC93cC1jb250ZW50L3VwbG9hZHMvMjAxNi8wMi9kaXZtb2Rub3RlLWxldHRlci5wZGYKdmFyIF9CYXNpY3NfbW9kQnkgPSBGMihmdW5jdGlvbihtb2R1bHVzLCB4KQp7Cgl2YXIgYW5zd2VyID0geCAlIG1vZHVsdXM7CglyZXR1cm4gbW9kdWx1cyA9PT0gMAoJCT8gX0RlYnVnX2NyYXNoKDExKQoJCToKCSgoYW5zd2VyID4gMCAmJiBtb2R1bHVzIDwgMCkgfHwgKGFuc3dlciA8IDAgJiYgbW9kdWx1cyA+IDApKQoJCT8gYW5zd2VyICsgbW9kdWx1cwoJCTogYW5zd2VyOwp9KTsKCgovLyBUUklHT05PTUVUUlkKCnZhciBfQmFzaWNzX3BpID0gTWF0aC5QSTsKdmFyIF9CYXNpY3NfZSA9IE1hdGguRTsKdmFyIF9CYXNpY3NfY29zID0gTWF0aC5jb3M7CnZhciBfQmFzaWNzX3NpbiA9IE1hdGguc2luOwp2YXIgX0Jhc2ljc190YW4gPSBNYXRoLnRhbjsKdmFyIF9CYXNpY3NfYWNvcyA9IE1hdGguYWNvczsKdmFyIF9CYXNpY3NfYXNpbiA9IE1hdGguYXNpbjsKdmFyIF9CYXNpY3NfYXRhbiA9IE1hdGguYXRhbjsKdmFyIF9CYXNpY3NfYXRhbjIgPSBGMihNYXRoLmF0YW4yKTsKCgovLyBNT1JFIE1BVEgKCmZ1bmN0aW9uIF9CYXNpY3NfdG9GbG9hdCh4KSB7IHJldHVybiB4OyB9CmZ1bmN0aW9uIF9CYXNpY3NfdHJ1bmNhdGUobikgeyByZXR1cm4gbiB8IDA7IH0KZnVuY3Rpb24gX0Jhc2ljc19pc0luZmluaXRlKG4pIHsgcmV0dXJuIG4gPT09IEluZmluaXR5IHx8IG4gPT09IC1JbmZpbml0eTsgfQoKdmFyIF9CYXNpY3NfY2VpbGluZyA9IE1hdGguY2VpbDsKdmFyIF9CYXNpY3NfZmxvb3IgPSBNYXRoLmZsb29yOwp2YXIgX0Jhc2ljc19yb3VuZCA9IE1hdGgucm91bmQ7CnZhciBfQmFzaWNzX3NxcnQgPSBNYXRoLnNxcnQ7CnZhciBfQmFzaWNzX2xvZyA9IE1hdGgubG9nOwp2YXIgX0Jhc2ljc19pc05hTiA9IGlzTmFOOwoKCi8vIEJPT0xFQU5TCgpmdW5jdGlvbiBfQmFzaWNzX25vdChib29sKSB7IHJldHVybiAhYm9vbDsgfQp2YXIgX0Jhc2ljc19hbmQgPSBGMihmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhICYmIGI7IH0pOwp2YXIgX0Jhc2ljc19vciAgPSBGMihmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhIHx8IGI7IH0pOwp2YXIgX0Jhc2ljc194b3IgPSBGMihmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhICE9PSBiOyB9KTsKCgoKdmFyIF9TdHJpbmdfY29ucyA9IEYyKGZ1bmN0aW9uKGNociwgc3RyKQp7CglyZXR1cm4gY2hyICsgc3RyOwp9KTsKCmZ1bmN0aW9uIF9TdHJpbmdfdW5jb25zKHN0cmluZykKewoJdmFyIHdvcmQgPSBzdHJpbmcuY2hhckNvZGVBdCgwKTsKCXJldHVybiB3b3JkCgkJPyAkZWxtJGNvcmUkTWF5YmUkSnVzdCgKCQkJMHhEODAwIDw9IHdvcmQgJiYgd29yZCA8PSAweERCRkYKCQkJCT8gX1V0aWxzX1R1cGxlMihfVXRpbHNfY2hyKHN0cmluZ1swXSArIHN0cmluZ1sxXSksIHN0cmluZy5zbGljZSgyKSkKCQkJCTogX1V0aWxzX1R1cGxlMihfVXRpbHNfY2hyKHN0cmluZ1swXSksIHN0cmluZy5zbGljZSgxKSkKCQkpCgkJOiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZzsKfQoKdmFyIF9TdHJpbmdfYXBwZW5kID0gRjIoZnVuY3Rpb24oYSwgYikKewoJcmV0dXJuIGEgKyBiOwp9KTsKCmZ1bmN0aW9uIF9TdHJpbmdfbGVuZ3RoKHN0cikKewoJcmV0dXJuIHN0ci5sZW5ndGg7Cn0KCnZhciBfU3RyaW5nX21hcCA9IEYyKGZ1bmN0aW9uKGZ1bmMsIHN0cmluZykKewoJdmFyIGxlbiA9IHN0cmluZy5sZW5ndGg7Cgl2YXIgYXJyYXkgPSBuZXcgQXJyYXkobGVuKTsKCXZhciBpID0gMDsKCXdoaWxlIChpIDwgbGVuKQoJewoJCXZhciB3b3JkID0gc3RyaW5nLmNoYXJDb2RlQXQoaSk7CgkJaWYgKDB4RDgwMCA8PSB3b3JkICYmIHdvcmQgPD0gMHhEQkZGKQoJCXsKCQkJYXJyYXlbaV0gPSBmdW5jKF9VdGlsc19jaHIoc3RyaW5nW2ldICsgc3RyaW5nW2krMV0pKTsKCQkJaSArPSAyOwoJCQljb250aW51ZTsKCQl9CgkJYXJyYXlbaV0gPSBmdW5jKF9VdGlsc19jaHIoc3RyaW5nW2ldKSk7CgkJaSsrOwoJfQoJcmV0dXJuIGFycmF5LmpvaW4oJycpOwp9KTsKCnZhciBfU3RyaW5nX2ZpbHRlciA9IEYyKGZ1bmN0aW9uKGlzR29vZCwgc3RyKQp7Cgl2YXIgYXJyID0gW107Cgl2YXIgbGVuID0gc3RyLmxlbmd0aDsKCXZhciBpID0gMDsKCXdoaWxlIChpIDwgbGVuKQoJewoJCXZhciBjaGFyID0gc3RyW2ldOwoJCXZhciB3b3JkID0gc3RyLmNoYXJDb2RlQXQoaSk7CgkJaSsrOwoJCWlmICgweEQ4MDAgPD0gd29yZCAmJiB3b3JkIDw9IDB4REJGRikKCQl7CgkJCWNoYXIgKz0gc3RyW2ldOwoJCQlpKys7CgkJfQoKCQlpZiAoaXNHb29kKF9VdGlsc19jaHIoY2hhcikpKQoJCXsKCQkJYXJyLnB1c2goY2hhcik7CgkJfQoJfQoJcmV0dXJuIGFyci5qb2luKCcnKTsKfSk7CgpmdW5jdGlvbiBfU3RyaW5nX3JldmVyc2Uoc3RyKQp7Cgl2YXIgbGVuID0gc3RyLmxlbmd0aDsKCXZhciBhcnIgPSBuZXcgQXJyYXkobGVuKTsKCXZhciBpID0gMDsKCXdoaWxlIChpIDwgbGVuKQoJewoJCXZhciB3b3JkID0gc3RyLmNoYXJDb2RlQXQoaSk7CgkJaWYgKDB4RDgwMCA8PSB3b3JkICYmIHdvcmQgPD0gMHhEQkZGKQoJCXsKCQkJYXJyW2xlbiAtIGldID0gc3RyW2kgKyAxXTsKCQkJaSsrOwoJCQlhcnJbbGVuIC0gaV0gPSBzdHJbaSAtIDFdOwoJCQlpKys7CgkJfQoJCWVsc2UKCQl7CgkJCWFycltsZW4gLSBpXSA9IHN0cltpXTsKCQkJaSsrOwoJCX0KCX0KCXJldHVybiBhcnIuam9pbignJyk7Cn0KCnZhciBfU3RyaW5nX2ZvbGRsID0gRjMoZnVuY3Rpb24oZnVuYywgc3RhdGUsIHN0cmluZykKewoJdmFyIGxlbiA9IHN0cmluZy5sZW5ndGg7Cgl2YXIgaSA9IDA7Cgl3aGlsZSAoaSA8IGxlbikKCXsKCQl2YXIgY2hhciA9IHN0cmluZ1tpXTsKCQl2YXIgd29yZCA9IHN0cmluZy5jaGFyQ29kZUF0KGkpOwoJCWkrKzsKCQlpZiAoMHhEODAwIDw9IHdvcmQgJiYgd29yZCA8PSAweERCRkYpCgkJewoJCQljaGFyICs9IHN0cmluZ1tpXTsKCQkJaSsrOwoJCX0KCQlzdGF0ZSA9IEEyKGZ1bmMsIF9VdGlsc19jaHIoY2hhciksIHN0YXRlKTsKCX0KCXJldHVybiBzdGF0ZTsKfSk7Cgp2YXIgX1N0cmluZ19mb2xkciA9IEYzKGZ1bmN0aW9uKGZ1bmMsIHN0YXRlLCBzdHJpbmcpCnsKCXZhciBpID0gc3RyaW5nLmxlbmd0aDsKCXdoaWxlIChpLS0pCgl7CgkJdmFyIGNoYXIgPSBzdHJpbmdbaV07CgkJdmFyIHdvcmQgPSBzdHJpbmcuY2hhckNvZGVBdChpKTsKCQlpZiAoMHhEQzAwIDw9IHdvcmQgJiYgd29yZCA8PSAweERGRkYpCgkJewoJCQlpLS07CgkJCWNoYXIgPSBzdHJpbmdbaV0gKyBjaGFyOwoJCX0KCQlzdGF0ZSA9IEEyKGZ1bmMsIF9VdGlsc19jaHIoY2hhciksIHN0YXRlKTsKCX0KCXJldHVybiBzdGF0ZTsKfSk7Cgp2YXIgX1N0cmluZ19zcGxpdCA9IEYyKGZ1bmN0aW9uKHNlcCwgc3RyKQp7CglyZXR1cm4gc3RyLnNwbGl0KHNlcCk7Cn0pOwoKdmFyIF9TdHJpbmdfam9pbiA9IEYyKGZ1bmN0aW9uKHNlcCwgc3RycykKewoJcmV0dXJuIHN0cnMuam9pbihzZXApOwp9KTsKCnZhciBfU3RyaW5nX3NsaWNlID0gRjMoZnVuY3Rpb24oc3RhcnQsIGVuZCwgc3RyKSB7CglyZXR1cm4gc3RyLnNsaWNlKHN0YXJ0LCBlbmQpOwp9KTsKCmZ1bmN0aW9uIF9TdHJpbmdfdHJpbShzdHIpCnsKCXJldHVybiBzdHIudHJpbSgpOwp9CgpmdW5jdGlvbiBfU3RyaW5nX3RyaW1MZWZ0KHN0cikKewoJcmV0dXJuIHN0ci5yZXBsYWNlKC9eXHMrLywgJycpOwp9CgpmdW5jdGlvbiBfU3RyaW5nX3RyaW1SaWdodChzdHIpCnsKCXJldHVybiBzdHIucmVwbGFjZSgvXHMrJC8sICcnKTsKfQoKZnVuY3Rpb24gX1N0cmluZ193b3JkcyhzdHIpCnsKCXJldHVybiBfTGlzdF9mcm9tQXJyYXkoc3RyLnRyaW0oKS5zcGxpdCgvXHMrL2cpKTsKfQoKZnVuY3Rpb24gX1N0cmluZ19saW5lcyhzdHIpCnsKCXJldHVybiBfTGlzdF9mcm9tQXJyYXkoc3RyLnNwbGl0KC9cclxufFxyfFxuL2cpKTsKfQoKZnVuY3Rpb24gX1N0cmluZ190b1VwcGVyKHN0cikKewoJcmV0dXJuIHN0ci50b1VwcGVyQ2FzZSgpOwp9CgpmdW5jdGlvbiBfU3RyaW5nX3RvTG93ZXIoc3RyKQp7CglyZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCk7Cn0KCnZhciBfU3RyaW5nX2FueSA9IEYyKGZ1bmN0aW9uKGlzR29vZCwgc3RyaW5nKQp7Cgl2YXIgaSA9IHN0cmluZy5sZW5ndGg7Cgl3aGlsZSAoaS0tKQoJewoJCXZhciBjaGFyID0gc3RyaW5nW2ldOwoJCXZhciB3b3JkID0gc3RyaW5nLmNoYXJDb2RlQXQoaSk7CgkJaWYgKDB4REMwMCA8PSB3b3JkICYmIHdvcmQgPD0gMHhERkZGKQoJCXsKCQkJaS0tOwoJCQljaGFyID0gc3RyaW5nW2ldICsgY2hhcjsKCQl9CgkJaWYgKGlzR29vZChfVXRpbHNfY2hyKGNoYXIpKSkKCQl7CgkJCXJldHVybiB0cnVlOwoJCX0KCX0KCXJldHVybiBmYWxzZTsKfSk7Cgp2YXIgX1N0cmluZ19hbGwgPSBGMihmdW5jdGlvbihpc0dvb2QsIHN0cmluZykKewoJdmFyIGkgPSBzdHJpbmcubGVuZ3RoOwoJd2hpbGUgKGktLSkKCXsKCQl2YXIgY2hhciA9IHN0cmluZ1tpXTsKCQl2YXIgd29yZCA9IHN0cmluZy5jaGFyQ29kZUF0KGkpOwoJCWlmICgweERDMDAgPD0gd29yZCAmJiB3b3JkIDw9IDB4REZGRikKCQl7CgkJCWktLTsKCQkJY2hhciA9IHN0cmluZ1tpXSArIGNoYXI7CgkJfQoJCWlmICghaXNHb29kKF9VdGlsc19jaHIoY2hhcikpKQoJCXsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCX0KCXJldHVybiB0cnVlOwp9KTsKCnZhciBfU3RyaW5nX2NvbnRhaW5zID0gRjIoZnVuY3Rpb24oc3ViLCBzdHIpCnsKCXJldHVybiBzdHIuaW5kZXhPZihzdWIpID4gLTE7Cn0pOwoKdmFyIF9TdHJpbmdfc3RhcnRzV2l0aCA9IEYyKGZ1bmN0aW9uKHN1Yiwgc3RyKQp7CglyZXR1cm4gc3RyLmluZGV4T2Yoc3ViKSA9PT0gMDsKfSk7Cgp2YXIgX1N0cmluZ19lbmRzV2l0aCA9IEYyKGZ1bmN0aW9uKHN1Yiwgc3RyKQp7CglyZXR1cm4gc3RyLmxlbmd0aCA+PSBzdWIubGVuZ3RoICYmCgkJc3RyLmxhc3RJbmRleE9mKHN1YikgPT09IHN0ci5sZW5ndGggLSBzdWIubGVuZ3RoOwp9KTsKCnZhciBfU3RyaW5nX2luZGV4ZXMgPSBGMihmdW5jdGlvbihzdWIsIHN0cikKewoJdmFyIHN1YkxlbiA9IHN1Yi5sZW5ndGg7CgoJaWYgKHN1YkxlbiA8IDEpCgl7CgkJcmV0dXJuIF9MaXN0X05pbDsKCX0KCgl2YXIgaSA9IDA7Cgl2YXIgaXMgPSBbXTsKCgl3aGlsZSAoKGkgPSBzdHIuaW5kZXhPZihzdWIsIGkpKSA+IC0xKQoJewoJCWlzLnB1c2goaSk7CgkJaSA9IGkgKyBzdWJMZW47Cgl9CgoJcmV0dXJuIF9MaXN0X2Zyb21BcnJheShpcyk7Cn0pOwoKCi8vIFRPIFNUUklORwoKZnVuY3Rpb24gX1N0cmluZ19mcm9tTnVtYmVyKG51bWJlcikKewoJcmV0dXJuIG51bWJlciArICcnOwp9CgoKLy8gSU5UIENPTlZFUlNJT05TCgpmdW5jdGlvbiBfU3RyaW5nX3RvSW50KHN0cikKewoJdmFyIHRvdGFsID0gMDsKCXZhciBjb2RlMCA9IHN0ci5jaGFyQ29kZUF0KDApOwoJdmFyIHN0YXJ0ID0gY29kZTAgPT0gMHgyQiAvKiArICovIHx8IGNvZGUwID09IDB4MkQgLyogLSAqLyA/IDEgOiAwOwoKCWZvciAodmFyIGkgPSBzdGFydDsgaSA8IHN0ci5sZW5ndGg7ICsraSkKCXsKCQl2YXIgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpOwoJCWlmIChjb2RlIDwgMHgzMCB8fCAweDM5IDwgY29kZSkKCQl7CgkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZzsKCQl9CgkJdG90YWwgPSAxMCAqIHRvdGFsICsgY29kZSAtIDB4MzA7Cgl9CgoJcmV0dXJuIGkgPT0gc3RhcnQKCQk/ICRlbG0kY29yZSRNYXliZSROb3RoaW5nCgkJOiAkZWxtJGNvcmUkTWF5YmUkSnVzdChjb2RlMCA9PSAweDJEID8gLXRvdGFsIDogdG90YWwpOwp9CgoKLy8gRkxPQVQgQ09OVkVSU0lPTlMKCmZ1bmN0aW9uIF9TdHJpbmdfdG9GbG9hdChzKQp7CgkvLyBjaGVjayBpZiBpdCBpcyBhIGhleCwgb2N0YWwsIG9yIGJpbmFyeSBudW1iZXIKCWlmIChzLmxlbmd0aCA9PT0gMCB8fCAvW1xzeGJvXS8udGVzdChzKSkKCXsKCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJE5vdGhpbmc7Cgl9Cgl2YXIgbiA9ICtzOwoJLy8gZmFzdGVyIGlzTmFOIGNoZWNrCglyZXR1cm4gbiA9PT0gbiA/ICRlbG0kY29yZSRNYXliZSRKdXN0KG4pIDogJGVsbSRjb3JlJE1heWJlJE5vdGhpbmc7Cn0KCmZ1bmN0aW9uIF9TdHJpbmdfZnJvbUxpc3QoY2hhcnMpCnsKCXJldHVybiBfTGlzdF90b0FycmF5KGNoYXJzKS5qb2luKCcnKTsKfQoKCgoKZnVuY3Rpb24gX0NoYXJfdG9Db2RlKGNoYXIpCnsKCXZhciBjb2RlID0gY2hhci5jaGFyQ29kZUF0KDApOwoJaWYgKDB4RDgwMCA8PSBjb2RlICYmIGNvZGUgPD0gMHhEQkZGKQoJewoJCXJldHVybiAoY29kZSAtIDB4RDgwMCkgKiAweDQwMCArIGNoYXIuY2hhckNvZGVBdCgxKSAtIDB4REMwMCArIDB4MTAwMDAKCX0KCXJldHVybiBjb2RlOwp9CgpmdW5jdGlvbiBfQ2hhcl9mcm9tQ29kZShjb2RlKQp7CglyZXR1cm4gX1V0aWxzX2NocigKCQkoY29kZSA8IDAgfHwgMHgxMEZGRkYgPCBjb2RlKQoJCQk/ICdcdUZGRkQnCgkJCToKCQkoY29kZSA8PSAweEZGRkYpCgkJCT8gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKQoJCQk6CgkJKGNvZGUgLT0gMHgxMDAwMCwKCQkJU3RyaW5nLmZyb21DaGFyQ29kZShNYXRoLmZsb29yKGNvZGUgLyAweDQwMCkgKyAweEQ4MDAsIGNvZGUgJSAweDQwMCArIDB4REMwMCkKCQkpCgkpOwp9CgpmdW5jdGlvbiBfQ2hhcl90b1VwcGVyKGNoYXIpCnsKCXJldHVybiBfVXRpbHNfY2hyKGNoYXIudG9VcHBlckNhc2UoKSk7Cn0KCmZ1bmN0aW9uIF9DaGFyX3RvTG93ZXIoY2hhcikKewoJcmV0dXJuIF9VdGlsc19jaHIoY2hhci50b0xvd2VyQ2FzZSgpKTsKfQoKZnVuY3Rpb24gX0NoYXJfdG9Mb2NhbGVVcHBlcihjaGFyKQp7CglyZXR1cm4gX1V0aWxzX2NocihjaGFyLnRvTG9jYWxlVXBwZXJDYXNlKCkpOwp9CgpmdW5jdGlvbiBfQ2hhcl90b0xvY2FsZUxvd2VyKGNoYXIpCnsKCXJldHVybiBfVXRpbHNfY2hyKGNoYXIudG9Mb2NhbGVMb3dlckNhc2UoKSk7Cn0KCgoKLyoqLwpmdW5jdGlvbiBfSnNvbl9lcnJvclRvU3RyaW5nKGVycm9yKQp7CglyZXR1cm4gJGVsbSRqc29uJEpzb24kRGVjb2RlJGVycm9yVG9TdHJpbmcoZXJyb3IpOwp9Ci8vKi8KCgovLyBDT1JFIERFQ09ERVJTCgpmdW5jdGlvbiBfSnNvbl9zdWNjZWVkKG1zZykKewoJcmV0dXJuIHsKCQkkOiAwLAoJCWE6IG1zZwoJfTsKfQoKZnVuY3Rpb24gX0pzb25fZmFpbChtc2cpCnsKCXJldHVybiB7CgkJJDogMSwKCQlhOiBtc2cKCX07Cn0KCmZ1bmN0aW9uIF9Kc29uX2RlY29kZVByaW0oZGVjb2RlcikKewoJcmV0dXJuIHsgJDogMiwgYjogZGVjb2RlciB9Owp9Cgp2YXIgX0pzb25fZGVjb2RlSW50ID0gX0pzb25fZGVjb2RlUHJpbShmdW5jdGlvbih2YWx1ZSkgewoJcmV0dXJuICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKQoJCT8gX0pzb25fZXhwZWN0aW5nKCdhbiBJTlQnLCB2YWx1ZSkKCQk6CgkoLTIxNDc0ODM2NDcgPCB2YWx1ZSAmJiB2YWx1ZSA8IDIxNDc0ODM2NDcgJiYgKHZhbHVlIHwgMCkgPT09IHZhbHVlKQoJCT8gJGVsbSRjb3JlJFJlc3VsdCRPayh2YWx1ZSkKCQk6CgkoaXNGaW5pdGUodmFsdWUpICYmICEodmFsdWUgJSAxKSkKCQk/ICRlbG0kY29yZSRSZXN1bHQkT2sodmFsdWUpCgkJOiBfSnNvbl9leHBlY3RpbmcoJ2FuIElOVCcsIHZhbHVlKTsKfSk7Cgp2YXIgX0pzb25fZGVjb2RlQm9vbCA9IF9Kc29uX2RlY29kZVByaW0oZnVuY3Rpb24odmFsdWUpIHsKCXJldHVybiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpCgkJPyAkZWxtJGNvcmUkUmVzdWx0JE9rKHZhbHVlKQoJCTogX0pzb25fZXhwZWN0aW5nKCdhIEJPT0wnLCB2YWx1ZSk7Cn0pOwoKdmFyIF9Kc29uX2RlY29kZUZsb2F0ID0gX0pzb25fZGVjb2RlUHJpbShmdW5jdGlvbih2YWx1ZSkgewoJcmV0dXJuICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKQoJCT8gJGVsbSRjb3JlJFJlc3VsdCRPayh2YWx1ZSkKCQk6IF9Kc29uX2V4cGVjdGluZygnYSBGTE9BVCcsIHZhbHVlKTsKfSk7Cgp2YXIgX0pzb25fZGVjb2RlVmFsdWUgPSBfSnNvbl9kZWNvZGVQcmltKGZ1bmN0aW9uKHZhbHVlKSB7CglyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPayhfSnNvbl93cmFwKHZhbHVlKSk7Cn0pOwoKdmFyIF9Kc29uX2RlY29kZVN0cmluZyA9IF9Kc29uX2RlY29kZVByaW0oZnVuY3Rpb24odmFsdWUpIHsKCXJldHVybiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykKCQk/ICRlbG0kY29yZSRSZXN1bHQkT2sodmFsdWUpCgkJOiAodmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcpCgkJCT8gJGVsbSRjb3JlJFJlc3VsdCRPayh2YWx1ZSArICcnKQoJCQk6IF9Kc29uX2V4cGVjdGluZygnYSBTVFJJTkcnLCB2YWx1ZSk7Cn0pOwoKZnVuY3Rpb24gX0pzb25fZGVjb2RlTGlzdChkZWNvZGVyKSB7IHJldHVybiB7ICQ6IDMsIGI6IGRlY29kZXIgfTsgfQpmdW5jdGlvbiBfSnNvbl9kZWNvZGVBcnJheShkZWNvZGVyKSB7IHJldHVybiB7ICQ6IDQsIGI6IGRlY29kZXIgfTsgfQoKZnVuY3Rpb24gX0pzb25fZGVjb2RlTnVsbCh2YWx1ZSkgeyByZXR1cm4geyAkOiA1LCBjOiB2YWx1ZSB9OyB9Cgp2YXIgX0pzb25fZGVjb2RlRmllbGQgPSBGMihmdW5jdGlvbihmaWVsZCwgZGVjb2RlcikKewoJcmV0dXJuIHsKCQkkOiA2LAoJCWQ6IGZpZWxkLAoJCWI6IGRlY29kZXIKCX07Cn0pOwoKdmFyIF9Kc29uX2RlY29kZUluZGV4ID0gRjIoZnVuY3Rpb24oaW5kZXgsIGRlY29kZXIpCnsKCXJldHVybiB7CgkJJDogNywKCQllOiBpbmRleCwKCQliOiBkZWNvZGVyCgl9Owp9KTsKCmZ1bmN0aW9uIF9Kc29uX2RlY29kZUtleVZhbHVlUGFpcnMoZGVjb2RlcikKewoJcmV0dXJuIHsKCQkkOiA4LAoJCWI6IGRlY29kZXIKCX07Cn0KCmZ1bmN0aW9uIF9Kc29uX21hcE1hbnkoZiwgZGVjb2RlcnMpCnsKCXJldHVybiB7CgkJJDogOSwKCQlmOiBmLAoJCWc6IGRlY29kZXJzCgl9Owp9Cgp2YXIgX0pzb25fYW5kVGhlbiA9IEYyKGZ1bmN0aW9uKGNhbGxiYWNrLCBkZWNvZGVyKQp7CglyZXR1cm4gewoJCSQ6IDEwLAoJCWI6IGRlY29kZXIsCgkJaDogY2FsbGJhY2sKCX07Cn0pOwoKZnVuY3Rpb24gX0pzb25fb25lT2YoZGVjb2RlcnMpCnsKCXJldHVybiB7CgkJJDogMTEsCgkJZzogZGVjb2RlcnMKCX07Cn0KCgovLyBERUNPRElORyBPQkpFQ1RTCgp2YXIgX0pzb25fbWFwMSA9IEYyKGZ1bmN0aW9uKGYsIGQxKQp7CglyZXR1cm4gX0pzb25fbWFwTWFueShmLCBbZDFdKTsKfSk7Cgp2YXIgX0pzb25fbWFwMiA9IEYzKGZ1bmN0aW9uKGYsIGQxLCBkMikKewoJcmV0dXJuIF9Kc29uX21hcE1hbnkoZiwgW2QxLCBkMl0pOwp9KTsKCnZhciBfSnNvbl9tYXAzID0gRjQoZnVuY3Rpb24oZiwgZDEsIGQyLCBkMykKewoJcmV0dXJuIF9Kc29uX21hcE1hbnkoZiwgW2QxLCBkMiwgZDNdKTsKfSk7Cgp2YXIgX0pzb25fbWFwNCA9IEY1KGZ1bmN0aW9uKGYsIGQxLCBkMiwgZDMsIGQ0KQp7CglyZXR1cm4gX0pzb25fbWFwTWFueShmLCBbZDEsIGQyLCBkMywgZDRdKTsKfSk7Cgp2YXIgX0pzb25fbWFwNSA9IEY2KGZ1bmN0aW9uKGYsIGQxLCBkMiwgZDMsIGQ0LCBkNSkKewoJcmV0dXJuIF9Kc29uX21hcE1hbnkoZiwgW2QxLCBkMiwgZDMsIGQ0LCBkNV0pOwp9KTsKCnZhciBfSnNvbl9tYXA2ID0gRjcoZnVuY3Rpb24oZiwgZDEsIGQyLCBkMywgZDQsIGQ1LCBkNikKewoJcmV0dXJuIF9Kc29uX21hcE1hbnkoZiwgW2QxLCBkMiwgZDMsIGQ0LCBkNSwgZDZdKTsKfSk7Cgp2YXIgX0pzb25fbWFwNyA9IEY4KGZ1bmN0aW9uKGYsIGQxLCBkMiwgZDMsIGQ0LCBkNSwgZDYsIGQ3KQp7CglyZXR1cm4gX0pzb25fbWFwTWFueShmLCBbZDEsIGQyLCBkMywgZDQsIGQ1LCBkNiwgZDddKTsKfSk7Cgp2YXIgX0pzb25fbWFwOCA9IEY5KGZ1bmN0aW9uKGYsIGQxLCBkMiwgZDMsIGQ0LCBkNSwgZDYsIGQ3LCBkOCkKewoJcmV0dXJuIF9Kc29uX21hcE1hbnkoZiwgW2QxLCBkMiwgZDMsIGQ0LCBkNSwgZDYsIGQ3LCBkOF0pOwp9KTsKCgovLyBERUNPREUKCnZhciBfSnNvbl9ydW5PblN0cmluZyA9IEYyKGZ1bmN0aW9uKGRlY29kZXIsIHN0cmluZykKewoJdHJ5Cgl7CgkJdmFyIHZhbHVlID0gSlNPTi5wYXJzZShzdHJpbmcpOwoJCXJldHVybiBfSnNvbl9ydW5IZWxwKGRlY29kZXIsIHZhbHVlKTsKCX0KCWNhdGNoIChlKQoJewoJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycihBMigkZWxtJGpzb24kSnNvbiREZWNvZGUkRmFpbHVyZSwgJ1RoaXMgaXMgbm90IHZhbGlkIEpTT04hICcgKyBlLm1lc3NhZ2UsIF9Kc29uX3dyYXAoc3RyaW5nKSkpOwoJfQp9KTsKCnZhciBfSnNvbl9ydW4gPSBGMihmdW5jdGlvbihkZWNvZGVyLCB2YWx1ZSkKewoJcmV0dXJuIF9Kc29uX3J1bkhlbHAoZGVjb2RlciwgX0pzb25fdW53cmFwKHZhbHVlKSk7Cn0pOwoKZnVuY3Rpb24gX0pzb25fcnVuSGVscChkZWNvZGVyLCB2YWx1ZSkKewoJc3dpdGNoIChkZWNvZGVyLiQpCgl7CgkJY2FzZSAyOgoJCQlyZXR1cm4gZGVjb2Rlci5iKHZhbHVlKTsKCgkJY2FzZSA1OgoJCQlyZXR1cm4gKHZhbHVlID09PSBudWxsKQoJCQkJPyAkZWxtJGNvcmUkUmVzdWx0JE9rKGRlY29kZXIuYykKCQkJCTogX0pzb25fZXhwZWN0aW5nKCdudWxsJywgdmFsdWUpOwoKCQljYXNlIDM6CgkJCWlmICghX0pzb25faXNBcnJheSh2YWx1ZSkpCgkJCXsKCQkJCXJldHVybiBfSnNvbl9leHBlY3RpbmcoJ2EgTElTVCcsIHZhbHVlKTsKCQkJfQoJCQlyZXR1cm4gX0pzb25fcnVuQXJyYXlEZWNvZGVyKGRlY29kZXIuYiwgdmFsdWUsIF9MaXN0X2Zyb21BcnJheSk7CgoJCWNhc2UgNDoKCQkJaWYgKCFfSnNvbl9pc0FycmF5KHZhbHVlKSkKCQkJewoJCQkJcmV0dXJuIF9Kc29uX2V4cGVjdGluZygnYW4gQVJSQVknLCB2YWx1ZSk7CgkJCX0KCQkJcmV0dXJuIF9Kc29uX3J1bkFycmF5RGVjb2RlcihkZWNvZGVyLmIsIHZhbHVlLCBfSnNvbl90b0VsbUFycmF5KTsKCgkJY2FzZSA2OgoJCQl2YXIgZmllbGQgPSBkZWNvZGVyLmQ7CgkJCWlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnIHx8IHZhbHVlID09PSBudWxsIHx8ICEoZmllbGQgaW4gdmFsdWUpKQoJCQl7CgkJCQlyZXR1cm4gX0pzb25fZXhwZWN0aW5nKCdhbiBPQkpFQ1Qgd2l0aCBhIGZpZWxkIG5hbWVkIGAnICsgZmllbGQgKyAnYCcsIHZhbHVlKTsKCQkJfQoJCQl2YXIgcmVzdWx0ID0gX0pzb25fcnVuSGVscChkZWNvZGVyLmIsIHZhbHVlW2ZpZWxkXSk7CgkJCXJldHVybiAoJGVsbSRjb3JlJFJlc3VsdCRpc09rKHJlc3VsdCkpID8gcmVzdWx0IDogJGVsbSRjb3JlJFJlc3VsdCRFcnIoQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJEZpZWxkLCBmaWVsZCwgcmVzdWx0LmEpKTsKCgkJY2FzZSA3OgoJCQl2YXIgaW5kZXggPSBkZWNvZGVyLmU7CgkJCWlmICghX0pzb25faXNBcnJheSh2YWx1ZSkpCgkJCXsKCQkJCXJldHVybiBfSnNvbl9leHBlY3RpbmcoJ2FuIEFSUkFZJywgdmFsdWUpOwoJCQl9CgkJCWlmIChpbmRleCA+PSB2YWx1ZS5sZW5ndGgpCgkJCXsKCQkJCXJldHVybiBfSnNvbl9leHBlY3RpbmcoJ2EgTE9OR0VSIGFycmF5LiBOZWVkIGluZGV4ICcgKyBpbmRleCArICcgYnV0IG9ubHkgc2VlICcgKyB2YWx1ZS5sZW5ndGggKyAnIGVudHJpZXMnLCB2YWx1ZSk7CgkJCX0KCQkJdmFyIHJlc3VsdCA9IF9Kc29uX3J1bkhlbHAoZGVjb2Rlci5iLCB2YWx1ZVtpbmRleF0pOwoJCQlyZXR1cm4gKCRlbG0kY29yZSRSZXN1bHQkaXNPayhyZXN1bHQpKSA/IHJlc3VsdCA6ICRlbG0kY29yZSRSZXN1bHQkRXJyKEEyKCRlbG0kanNvbiRKc29uJERlY29kZSRJbmRleCwgaW5kZXgsIHJlc3VsdC5hKSk7CgoJCWNhc2UgODoKCQkJaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcgfHwgdmFsdWUgPT09IG51bGwgfHwgX0pzb25faXNBcnJheSh2YWx1ZSkpCgkJCXsKCQkJCXJldHVybiBfSnNvbl9leHBlY3RpbmcoJ2FuIE9CSkVDVCcsIHZhbHVlKTsKCQkJfQoKCQkJdmFyIGtleVZhbHVlUGFpcnMgPSBfTGlzdF9OaWw7CgkJCS8vIFRPRE8gdGVzdCBwZXJmIG9mIE9iamVjdC5rZXlzIGFuZCBzd2l0Y2ggd2hlbiBzdXBwb3J0IGlzIGdvb2QgZW5vdWdoCgkJCWZvciAodmFyIGtleSBpbiB2YWx1ZSkKCQkJewoJCQkJaWYgKHZhbHVlLmhhc093blByb3BlcnR5KGtleSkpCgkJCQl7CgkJCQkJdmFyIHJlc3VsdCA9IF9Kc29uX3J1bkhlbHAoZGVjb2Rlci5iLCB2YWx1ZVtrZXldKTsKCQkJCQlpZiAoISRlbG0kY29yZSRSZXN1bHQkaXNPayhyZXN1bHQpKQoJCQkJCXsKCQkJCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKEEyKCRlbG0kanNvbiRKc29uJERlY29kZSRGaWVsZCwga2V5LCByZXN1bHQuYSkpOwoJCQkJCX0KCQkJCQlrZXlWYWx1ZVBhaXJzID0gX0xpc3RfQ29ucyhfVXRpbHNfVHVwbGUyKGtleSwgcmVzdWx0LmEpLCBrZXlWYWx1ZVBhaXJzKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPaygkZWxtJGNvcmUkTGlzdCRyZXZlcnNlKGtleVZhbHVlUGFpcnMpKTsKCgkJY2FzZSA5OgoJCQl2YXIgYW5zd2VyID0gZGVjb2Rlci5mOwoJCQl2YXIgZGVjb2RlcnMgPSBkZWNvZGVyLmc7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGVjb2RlcnMubGVuZ3RoOyBpKyspCgkJCXsKCQkJCXZhciByZXN1bHQgPSBfSnNvbl9ydW5IZWxwKGRlY29kZXJzW2ldLCB2YWx1ZSk7CgkJCQlpZiAoISRlbG0kY29yZSRSZXN1bHQkaXNPayhyZXN1bHQpKQoJCQkJewoJCQkJCXJldHVybiByZXN1bHQ7CgkJCQl9CgkJCQlhbnN3ZXIgPSBhbnN3ZXIocmVzdWx0LmEpOwoJCQl9CgkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JE9rKGFuc3dlcik7CgoJCWNhc2UgMTA6CgkJCXZhciByZXN1bHQgPSBfSnNvbl9ydW5IZWxwKGRlY29kZXIuYiwgdmFsdWUpOwoJCQlyZXR1cm4gKCEkZWxtJGNvcmUkUmVzdWx0JGlzT2socmVzdWx0KSkKCQkJCT8gcmVzdWx0CgkJCQk6IF9Kc29uX3J1bkhlbHAoZGVjb2Rlci5oKHJlc3VsdC5hKSwgdmFsdWUpOwoKCQljYXNlIDExOgoJCQl2YXIgZXJyb3JzID0gX0xpc3RfTmlsOwoJCQlmb3IgKHZhciB0ZW1wID0gZGVjb2Rlci5nOyB0ZW1wLmI7IHRlbXAgPSB0ZW1wLmIpIC8vIFdISUxFX0NPTlMKCQkJewoJCQkJdmFyIHJlc3VsdCA9IF9Kc29uX3J1bkhlbHAodGVtcC5hLCB2YWx1ZSk7CgkJCQlpZiAoJGVsbSRjb3JlJFJlc3VsdCRpc09rKHJlc3VsdCkpCgkJCQl7CgkJCQkJcmV0dXJuIHJlc3VsdDsKCQkJCX0KCQkJCWVycm9ycyA9IF9MaXN0X0NvbnMocmVzdWx0LmEsIGVycm9ycyk7CgkJCX0KCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKCRlbG0kanNvbiRKc29uJERlY29kZSRPbmVPZigkZWxtJGNvcmUkTGlzdCRyZXZlcnNlKGVycm9ycykpKTsKCgkJY2FzZSAxOgoJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRFcnIoQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJEZhaWx1cmUsIGRlY29kZXIuYSwgX0pzb25fd3JhcCh2YWx1ZSkpKTsKCgkJY2FzZSAwOgoJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPayhkZWNvZGVyLmEpOwoJfQp9CgpmdW5jdGlvbiBfSnNvbl9ydW5BcnJheURlY29kZXIoZGVjb2RlciwgdmFsdWUsIHRvRWxtVmFsdWUpCnsKCXZhciBsZW4gPSB2YWx1ZS5sZW5ndGg7Cgl2YXIgYXJyYXkgPSBuZXcgQXJyYXkobGVuKTsKCWZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspCgl7CgkJdmFyIHJlc3VsdCA9IF9Kc29uX3J1bkhlbHAoZGVjb2RlciwgdmFsdWVbaV0pOwoJCWlmICghJGVsbSRjb3JlJFJlc3VsdCRpc09rKHJlc3VsdCkpCgkJewoJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRFcnIoQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJEluZGV4LCBpLCByZXN1bHQuYSkpOwoJCX0KCQlhcnJheVtpXSA9IHJlc3VsdC5hOwoJfQoJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkT2sodG9FbG1WYWx1ZShhcnJheSkpOwp9CgpmdW5jdGlvbiBfSnNvbl9pc0FycmF5KHZhbHVlKQp7CglyZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgKHR5cGVvZiBGaWxlTGlzdCAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgaW5zdGFuY2VvZiBGaWxlTGlzdCk7Cn0KCmZ1bmN0aW9uIF9Kc29uX3RvRWxtQXJyYXkoYXJyYXkpCnsKCXJldHVybiBBMigkZWxtJGNvcmUkQXJyYXkkaW5pdGlhbGl6ZSwgYXJyYXkubGVuZ3RoLCBmdW5jdGlvbihpKSB7IHJldHVybiBhcnJheVtpXTsgfSk7Cn0KCmZ1bmN0aW9uIF9Kc29uX2V4cGVjdGluZyh0eXBlLCB2YWx1ZSkKewoJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKEEyKCRlbG0kanNvbiRKc29uJERlY29kZSRGYWlsdXJlLCAnRXhwZWN0aW5nICcgKyB0eXBlLCBfSnNvbl93cmFwKHZhbHVlKSkpOwp9CgoKLy8gRVFVQUxJVFkKCmZ1bmN0aW9uIF9Kc29uX2VxdWFsaXR5KHgsIHkpCnsKCWlmICh4ID09PSB5KQoJewoJCXJldHVybiB0cnVlOwoJfQoKCWlmICh4LiQgIT09IHkuJCkKCXsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJc3dpdGNoICh4LiQpCgl7CgkJY2FzZSAwOgoJCWNhc2UgMToKCQkJcmV0dXJuIHguYSA9PT0geS5hOwoKCQljYXNlIDI6CgkJCXJldHVybiB4LmIgPT09IHkuYjsKCgkJY2FzZSA1OgoJCQlyZXR1cm4geC5jID09PSB5LmM7CgoJCWNhc2UgMzoKCQljYXNlIDQ6CgkJY2FzZSA4OgoJCQlyZXR1cm4gX0pzb25fZXF1YWxpdHkoeC5iLCB5LmIpOwoKCQljYXNlIDY6CgkJCXJldHVybiB4LmQgPT09IHkuZCAmJiBfSnNvbl9lcXVhbGl0eSh4LmIsIHkuYik7CgoJCWNhc2UgNzoKCQkJcmV0dXJuIHguZSA9PT0geS5lICYmIF9Kc29uX2VxdWFsaXR5KHguYiwgeS5iKTsKCgkJY2FzZSA5OgoJCQlyZXR1cm4geC5mID09PSB5LmYgJiYgX0pzb25fbGlzdEVxdWFsaXR5KHguZywgeS5nKTsKCgkJY2FzZSAxMDoKCQkJcmV0dXJuIHguaCA9PT0geS5oICYmIF9Kc29uX2VxdWFsaXR5KHguYiwgeS5iKTsKCgkJY2FzZSAxMToKCQkJcmV0dXJuIF9Kc29uX2xpc3RFcXVhbGl0eSh4LmcsIHkuZyk7Cgl9Cn0KCmZ1bmN0aW9uIF9Kc29uX2xpc3RFcXVhbGl0eShhRGVjb2RlcnMsIGJEZWNvZGVycykKewoJdmFyIGxlbiA9IGFEZWNvZGVycy5sZW5ndGg7CglpZiAobGVuICE9PSBiRGVjb2RlcnMubGVuZ3RoKQoJewoJCXJldHVybiBmYWxzZTsKCX0KCWZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspCgl7CgkJaWYgKCFfSnNvbl9lcXVhbGl0eShhRGVjb2RlcnNbaV0sIGJEZWNvZGVyc1tpXSkpCgkJewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoJcmV0dXJuIHRydWU7Cn0KCgovLyBFTkNPREUKCnZhciBfSnNvbl9lbmNvZGUgPSBGMihmdW5jdGlvbihpbmRlbnRMZXZlbCwgdmFsdWUpCnsKCXJldHVybiBKU09OLnN0cmluZ2lmeShfSnNvbl91bndyYXAodmFsdWUpLCBudWxsLCBpbmRlbnRMZXZlbCkgKyAnJzsKfSk7CgpmdW5jdGlvbiBfSnNvbl93cmFwKHZhbHVlKSB7IHJldHVybiB7ICQ6IDAsIGE6IHZhbHVlIH07IH0KZnVuY3Rpb24gX0pzb25fdW53cmFwKHZhbHVlKSB7IHJldHVybiB2YWx1ZS5hOyB9CgpmdW5jdGlvbiBfSnNvbl93cmFwX1VOVVNFRCh2YWx1ZSkgeyByZXR1cm4gdmFsdWU7IH0KZnVuY3Rpb24gX0pzb25fdW53cmFwX1VOVVNFRCh2YWx1ZSkgeyByZXR1cm4gdmFsdWU7IH0KCmZ1bmN0aW9uIF9Kc29uX2VtcHR5QXJyYXkoKSB7IHJldHVybiBbXTsgfQpmdW5jdGlvbiBfSnNvbl9lbXB0eU9iamVjdCgpIHsgcmV0dXJuIHt9OyB9Cgp2YXIgX0pzb25fYWRkRmllbGQgPSBGMyhmdW5jdGlvbihrZXksIHZhbHVlLCBvYmplY3QpCnsKCW9iamVjdFtrZXldID0gX0pzb25fdW53cmFwKHZhbHVlKTsKCXJldHVybiBvYmplY3Q7Cn0pOwoKZnVuY3Rpb24gX0pzb25fYWRkRW50cnkoZnVuYykKewoJcmV0dXJuIEYyKGZ1bmN0aW9uKGVudHJ5LCBhcnJheSkKCXsKCQlhcnJheS5wdXNoKF9Kc29uX3Vud3JhcChmdW5jKGVudHJ5KSkpOwoJCXJldHVybiBhcnJheTsKCX0pOwp9Cgp2YXIgX0pzb25fZW5jb2RlTnVsbCA9IF9Kc29uX3dyYXAobnVsbCk7CgoKCi8vIFRBU0tTCgpmdW5jdGlvbiBfU2NoZWR1bGVyX3N1Y2NlZWQodmFsdWUpCnsKCXJldHVybiB7CgkJJDogMCwKCQlhOiB2YWx1ZQoJfTsKfQoKZnVuY3Rpb24gX1NjaGVkdWxlcl9mYWlsKGVycm9yKQp7CglyZXR1cm4gewoJCSQ6IDEsCgkJYTogZXJyb3IKCX07Cn0KCmZ1bmN0aW9uIF9TY2hlZHVsZXJfYmluZGluZyhjYWxsYmFjaykKewoJcmV0dXJuIHsKCQkkOiAyLAoJCWI6IGNhbGxiYWNrLAoJCWM6IG51bGwKCX07Cn0KCnZhciBfU2NoZWR1bGVyX2FuZFRoZW4gPSBGMihmdW5jdGlvbihjYWxsYmFjaywgdGFzaykKewoJcmV0dXJuIHsKCQkkOiAzLAoJCWI6IGNhbGxiYWNrLAoJCWQ6IHRhc2sKCX07Cn0pOwoKdmFyIF9TY2hlZHVsZXJfb25FcnJvciA9IEYyKGZ1bmN0aW9uKGNhbGxiYWNrLCB0YXNrKQp7CglyZXR1cm4gewoJCSQ6IDQsCgkJYjogY2FsbGJhY2ssCgkJZDogdGFzawoJfTsKfSk7CgpmdW5jdGlvbiBfU2NoZWR1bGVyX3JlY2VpdmUoY2FsbGJhY2spCnsKCXJldHVybiB7CgkJJDogNSwKCQliOiBjYWxsYmFjawoJfTsKfQoKCi8vIFBST0NFU1NFUwoKdmFyIF9TY2hlZHVsZXJfZ3VpZCA9IDA7CgpmdW5jdGlvbiBfU2NoZWR1bGVyX3Jhd1NwYXduKHRhc2spCnsKCXZhciBwcm9jID0gewoJCSQ6IDAsCgkJZTogX1NjaGVkdWxlcl9ndWlkKyssCgkJZjogdGFzaywKCQlnOiBudWxsLAoJCWg6IFtdCgl9OwoKCV9TY2hlZHVsZXJfZW5xdWV1ZShwcm9jKTsKCglyZXR1cm4gcHJvYzsKfQoKZnVuY3Rpb24gX1NjaGVkdWxlcl9zcGF3bih0YXNrKQp7CglyZXR1cm4gX1NjaGVkdWxlcl9iaW5kaW5nKGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJY2FsbGJhY2soX1NjaGVkdWxlcl9zdWNjZWVkKF9TY2hlZHVsZXJfcmF3U3Bhd24odGFzaykpKTsKCX0pOwp9CgpmdW5jdGlvbiBfU2NoZWR1bGVyX3Jhd1NlbmQocHJvYywgbXNnKQp7Cglwcm9jLmgucHVzaChtc2cpOwoJX1NjaGVkdWxlcl9lbnF1ZXVlKHByb2MpOwp9Cgp2YXIgX1NjaGVkdWxlcl9zZW5kID0gRjIoZnVuY3Rpb24ocHJvYywgbXNnKQp7CglyZXR1cm4gX1NjaGVkdWxlcl9iaW5kaW5nKGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJX1NjaGVkdWxlcl9yYXdTZW5kKHByb2MsIG1zZyk7CgkJY2FsbGJhY2soX1NjaGVkdWxlcl9zdWNjZWVkKF9VdGlsc19UdXBsZTApKTsKCX0pOwp9KTsKCmZ1bmN0aW9uIF9TY2hlZHVsZXJfa2lsbChwcm9jKQp7CglyZXR1cm4gX1NjaGVkdWxlcl9iaW5kaW5nKGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJdmFyIHRhc2sgPSBwcm9jLmY7CgkJaWYgKHRhc2suJCA9PT0gMiAmJiB0YXNrLmMpCgkJewoJCQl0YXNrLmMoKTsKCQl9CgoJCXByb2MuZiA9IG51bGw7CgoJCWNhbGxiYWNrKF9TY2hlZHVsZXJfc3VjY2VlZChfVXRpbHNfVHVwbGUwKSk7Cgl9KTsKfQoKCi8qIFNURVAgUFJPQ0VTU0VTCgp0eXBlIGFsaWFzIFByb2Nlc3MgPQogIHsgJCA6IHRhZwogICwgaWQgOiB1bmlxdWVfaWQKICAsIHJvb3QgOiBUYXNrCiAgLCBzdGFjayA6IG51bGwgfCB7ICQ6IFNVQ0NFRUQgfCBGQUlMLCBhOiBjYWxsYmFjaywgYjogc3RhY2sgfQogICwgbWFpbGJveCA6IFttc2ddCiAgfQoKKi8KCgp2YXIgX1NjaGVkdWxlcl93b3JraW5nID0gZmFsc2U7CnZhciBfU2NoZWR1bGVyX3F1ZXVlID0gW107CgoKZnVuY3Rpb24gX1NjaGVkdWxlcl9lbnF1ZXVlKHByb2MpCnsKCV9TY2hlZHVsZXJfcXVldWUucHVzaChwcm9jKTsKCWlmIChfU2NoZWR1bGVyX3dvcmtpbmcpCgl7CgkJcmV0dXJuOwoJfQoJX1NjaGVkdWxlcl93b3JraW5nID0gdHJ1ZTsKCXdoaWxlIChwcm9jID0gX1NjaGVkdWxlcl9xdWV1ZS5zaGlmdCgpKQoJewoJCV9TY2hlZHVsZXJfc3RlcChwcm9jKTsKCX0KCV9TY2hlZHVsZXJfd29ya2luZyA9IGZhbHNlOwp9CgoKZnVuY3Rpb24gX1NjaGVkdWxlcl9zdGVwKHByb2MpCnsKCXdoaWxlIChwcm9jLmYpCgl7CgkJdmFyIHJvb3RUYWcgPSBwcm9jLmYuJDsKCQlpZiAocm9vdFRhZyA9PT0gMCB8fCByb290VGFnID09PSAxKQoJCXsKCQkJd2hpbGUgKHByb2MuZyAmJiBwcm9jLmcuJCAhPT0gcm9vdFRhZykKCQkJewoJCQkJcHJvYy5nID0gcHJvYy5nLmk7CgkJCX0KCQkJaWYgKCFwcm9jLmcpCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQlwcm9jLmYgPSBwcm9jLmcuYihwcm9jLmYuYSk7CgkJCXByb2MuZyA9IHByb2MuZy5pOwoJCX0KCQllbHNlIGlmIChyb290VGFnID09PSAyKQoJCXsKCQkJcHJvYy5mLmMgPSBwcm9jLmYuYihmdW5jdGlvbihuZXdSb290KSB7CgkJCQlwcm9jLmYgPSBuZXdSb290OwoJCQkJX1NjaGVkdWxlcl9lbnF1ZXVlKHByb2MpOwoJCQl9KTsKCQkJcmV0dXJuOwoJCX0KCQllbHNlIGlmIChyb290VGFnID09PSA1KQoJCXsKCQkJaWYgKHByb2MuaC5sZW5ndGggPT09IDApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQlwcm9jLmYgPSBwcm9jLmYuYihwcm9jLmguc2hpZnQoKSk7CgkJfQoJCWVsc2UgLy8gaWYgKHJvb3RUYWcgPT09IDMgfHwgcm9vdFRhZyA9PT0gNCkKCQl7CgkJCXByb2MuZyA9IHsKCQkJCSQ6IHJvb3RUYWcgPT09IDMgPyAwIDogMSwKCQkJCWI6IHByb2MuZi5iLAoJCQkJaTogcHJvYy5nCgkJCX07CgkJCXByb2MuZiA9IHByb2MuZi5kOwoJCX0KCX0KfQoKCgpmdW5jdGlvbiBfUHJvY2Vzc19zbGVlcCh0aW1lKQp7CglyZXR1cm4gX1NjaGVkdWxlcl9iaW5kaW5nKGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJdmFyIGlkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJY2FsbGJhY2soX1NjaGVkdWxlcl9zdWNjZWVkKF9VdGlsc19UdXBsZTApKTsKCQl9LCB0aW1lKTsKCgkJcmV0dXJuIGZ1bmN0aW9uKCkgeyBjbGVhclRpbWVvdXQoaWQpOyB9OwoJfSk7Cn0KCgoKCi8vIFBST0dSQU1TCgoKdmFyIF9QbGF0Zm9ybV93b3JrZXIgPSBGNChmdW5jdGlvbihpbXBsLCBmbGFnRGVjb2RlciwgZGVidWdNZXRhZGF0YSwgYXJncykKewoJcmV0dXJuIF9QbGF0Zm9ybV9pbml0aWFsaXplKAoJCWZsYWdEZWNvZGVyLAoJCWFyZ3MsCgkJaW1wbC5pbml0LAoJCWltcGwudXBkYXRlLAoJCWltcGwuc3Vic2NyaXB0aW9ucywKCQlmdW5jdGlvbigpIHsgcmV0dXJuIGZ1bmN0aW9uKCkge30gfQoJKTsKfSk7CgoKCi8vIElOSVRJQUxJWkUgQSBQUk9HUkFNCgoKZnVuY3Rpb24gX1BsYXRmb3JtX2luaXRpYWxpemUoZmxhZ0RlY29kZXIsIGFyZ3MsIGluaXQsIHVwZGF0ZSwgc3Vic2NyaXB0aW9ucywgc3RlcHBlckJ1aWxkZXIpCnsKCXZhciByZXN1bHQgPSBBMihfSnNvbl9ydW4sIGZsYWdEZWNvZGVyLCBfSnNvbl93cmFwKGFyZ3MgPyBhcmdzWydmbGFncyddIDogdW5kZWZpbmVkKSk7CgkkZWxtJGNvcmUkUmVzdWx0JGlzT2socmVzdWx0KSB8fCBfRGVidWdfY3Jhc2goMiAvKiovLCBfSnNvbl9lcnJvclRvU3RyaW5nKHJlc3VsdC5hKSAvKiovKTsKCXZhciBtYW5hZ2VycyA9IHt9OwoJcmVzdWx0ID0gaW5pdChyZXN1bHQuYSk7Cgl2YXIgbW9kZWwgPSByZXN1bHQuYTsKCXZhciBzdGVwcGVyID0gc3RlcHBlckJ1aWxkZXIoc2VuZFRvQXBwLCBtb2RlbCk7Cgl2YXIgcG9ydHMgPSBfUGxhdGZvcm1fc2V0dXBFZmZlY3RzKG1hbmFnZXJzLCBzZW5kVG9BcHApOwoKCWZ1bmN0aW9uIHNlbmRUb0FwcChtc2csIHZpZXdNZXRhZGF0YSkKCXsKCQlyZXN1bHQgPSBBMih1cGRhdGUsIG1zZywgbW9kZWwpOwoJCXN0ZXBwZXIobW9kZWwgPSByZXN1bHQuYSwgdmlld01ldGFkYXRhKTsKCQlfUGxhdGZvcm1fZGlzcGF0Y2hFZmZlY3RzKG1hbmFnZXJzLCByZXN1bHQuYiwgc3Vic2NyaXB0aW9ucyhtb2RlbCkpOwoJfQoKCV9QbGF0Zm9ybV9kaXNwYXRjaEVmZmVjdHMobWFuYWdlcnMsIHJlc3VsdC5iLCBzdWJzY3JpcHRpb25zKG1vZGVsKSk7CgoJcmV0dXJuIHBvcnRzID8geyBwb3J0czogcG9ydHMgfSA6IHt9Owp9CgoKCi8vIFRSQUNLIFBSRUxPQURTCi8vCi8vIFRoaXMgaXMgdXNlZCBieSBjb2RlIGluIGVsbS9icm93c2VyIGFuZCBlbG0vaHR0cAovLyB0byByZWdpc3RlciBhbnkgSFRUUCByZXF1ZXN0cyB0aGF0IGFyZSB0cmlnZ2VyZWQgYnkgaW5pdC4KLy8KCgp2YXIgX1BsYXRmb3JtX3ByZWxvYWQ7CgoKZnVuY3Rpb24gX1BsYXRmb3JtX3JlZ2lzdGVyUHJlbG9hZCh1cmwpCnsKCV9QbGF0Zm9ybV9wcmVsb2FkLmFkZCh1cmwpOwp9CgoKCi8vIEVGRkVDVCBNQU5BR0VSUwoKCnZhciBfUGxhdGZvcm1fZWZmZWN0TWFuYWdlcnMgPSB7fTsKCgpmdW5jdGlvbiBfUGxhdGZvcm1fc2V0dXBFZmZlY3RzKG1hbmFnZXJzLCBzZW5kVG9BcHApCnsKCXZhciBwb3J0czsKCgkvLyBzZXR1cCBhbGwgbmVjZXNzYXJ5IGVmZmVjdCBtYW5hZ2VycwoJZm9yICh2YXIga2V5IGluIF9QbGF0Zm9ybV9lZmZlY3RNYW5hZ2VycykKCXsKCQl2YXIgbWFuYWdlciA9IF9QbGF0Zm9ybV9lZmZlY3RNYW5hZ2Vyc1trZXldOwoKCQlpZiAobWFuYWdlci5hKQoJCXsKCQkJcG9ydHMgPSBwb3J0cyB8fCB7fTsKCQkJcG9ydHNba2V5XSA9IG1hbmFnZXIuYShrZXksIHNlbmRUb0FwcCk7CgkJfQoKCQltYW5hZ2Vyc1trZXldID0gX1BsYXRmb3JtX2luc3RhbnRpYXRlTWFuYWdlcihtYW5hZ2VyLCBzZW5kVG9BcHApOwoJfQoKCXJldHVybiBwb3J0czsKfQoKCmZ1bmN0aW9uIF9QbGF0Zm9ybV9jcmVhdGVNYW5hZ2VyKGluaXQsIG9uRWZmZWN0cywgb25TZWxmTXNnLCBjbWRNYXAsIHN1Yk1hcCkKewoJcmV0dXJuIHsKCQliOiBpbml0LAoJCWM6IG9uRWZmZWN0cywKCQlkOiBvblNlbGZNc2csCgkJZTogY21kTWFwLAoJCWY6IHN1Yk1hcAoJfTsKfQoKCmZ1bmN0aW9uIF9QbGF0Zm9ybV9pbnN0YW50aWF0ZU1hbmFnZXIoaW5mbywgc2VuZFRvQXBwKQp7Cgl2YXIgcm91dGVyID0gewoJCWc6IHNlbmRUb0FwcCwKCQloOiB1bmRlZmluZWQKCX07CgoJdmFyIG9uRWZmZWN0cyA9IGluZm8uYzsKCXZhciBvblNlbGZNc2cgPSBpbmZvLmQ7Cgl2YXIgY21kTWFwID0gaW5mby5lOwoJdmFyIHN1Yk1hcCA9IGluZm8uZjsKCglmdW5jdGlvbiBsb29wKHN0YXRlKQoJewoJCXJldHVybiBBMihfU2NoZWR1bGVyX2FuZFRoZW4sIGxvb3AsIF9TY2hlZHVsZXJfcmVjZWl2ZShmdW5jdGlvbihtc2cpCgkJewoJCQl2YXIgdmFsdWUgPSBtc2cuYTsKCgkJCWlmIChtc2cuJCA9PT0gMCkKCQkJewoJCQkJcmV0dXJuIEEzKG9uU2VsZk1zZywgcm91dGVyLCB2YWx1ZSwgc3RhdGUpOwoJCQl9CgoJCQlyZXR1cm4gY21kTWFwICYmIHN1Yk1hcAoJCQkJPyBBNChvbkVmZmVjdHMsIHJvdXRlciwgdmFsdWUuaSwgdmFsdWUuaiwgc3RhdGUpCgkJCQk6IEEzKG9uRWZmZWN0cywgcm91dGVyLCBjbWRNYXAgPyB2YWx1ZS5pIDogdmFsdWUuaiwgc3RhdGUpOwoJCX0pKTsKCX0KCglyZXR1cm4gcm91dGVyLmggPSBfU2NoZWR1bGVyX3Jhd1NwYXduKEEyKF9TY2hlZHVsZXJfYW5kVGhlbiwgbG9vcCwgaW5mby5iKSk7Cn0KCgoKLy8gUk9VVElORwoKCnZhciBfUGxhdGZvcm1fc2VuZFRvQXBwID0gRjIoZnVuY3Rpb24ocm91dGVyLCBtc2cpCnsKCXJldHVybiBfU2NoZWR1bGVyX2JpbmRpbmcoZnVuY3Rpb24oY2FsbGJhY2spCgl7CgkJcm91dGVyLmcobXNnKTsKCQljYWxsYmFjayhfU2NoZWR1bGVyX3N1Y2NlZWQoX1V0aWxzX1R1cGxlMCkpOwoJfSk7Cn0pOwoKCnZhciBfUGxhdGZvcm1fc2VuZFRvU2VsZiA9IEYyKGZ1bmN0aW9uKHJvdXRlciwgbXNnKQp7CglyZXR1cm4gQTIoX1NjaGVkdWxlcl9zZW5kLCByb3V0ZXIuaCwgewoJCSQ6IDAsCgkJYTogbXNnCgl9KTsKfSk7CgoKCi8vIEJBR1MKCgpmdW5jdGlvbiBfUGxhdGZvcm1fbGVhZihob21lKQp7CglyZXR1cm4gZnVuY3Rpb24odmFsdWUpCgl7CgkJcmV0dXJuIHsKCQkJJDogMSwKCQkJazogaG9tZSwKCQkJbDogdmFsdWUKCQl9OwoJfTsKfQoKCmZ1bmN0aW9uIF9QbGF0Zm9ybV9iYXRjaChsaXN0KQp7CglyZXR1cm4gewoJCSQ6IDIsCgkJbTogbGlzdAoJfTsKfQoKCnZhciBfUGxhdGZvcm1fbWFwID0gRjIoZnVuY3Rpb24odGFnZ2VyLCBiYWcpCnsKCXJldHVybiB7CgkJJDogMywKCQluOiB0YWdnZXIsCgkJbzogYmFnCgl9Cn0pOwoKCgovLyBQSVBFIEJBR1MgSU5UTyBFRkZFQ1QgTUFOQUdFUlMKCgpmdW5jdGlvbiBfUGxhdGZvcm1fZGlzcGF0Y2hFZmZlY3RzKG1hbmFnZXJzLCBjbWRCYWcsIHN1YkJhZykKewoJdmFyIGVmZmVjdHNEaWN0ID0ge307CglfUGxhdGZvcm1fZ2F0aGVyRWZmZWN0cyh0cnVlLCBjbWRCYWcsIGVmZmVjdHNEaWN0LCBudWxsKTsKCV9QbGF0Zm9ybV9nYXRoZXJFZmZlY3RzKGZhbHNlLCBzdWJCYWcsIGVmZmVjdHNEaWN0LCBudWxsKTsKCglmb3IgKHZhciBob21lIGluIG1hbmFnZXJzKQoJewoJCV9TY2hlZHVsZXJfcmF3U2VuZChtYW5hZ2Vyc1tob21lXSwgewoJCQkkOiAnZngnLAoJCQlhOiBlZmZlY3RzRGljdFtob21lXSB8fCB7IGk6IF9MaXN0X05pbCwgajogX0xpc3RfTmlsIH0KCQl9KTsKCX0KfQoKCmZ1bmN0aW9uIF9QbGF0Zm9ybV9nYXRoZXJFZmZlY3RzKGlzQ21kLCBiYWcsIGVmZmVjdHNEaWN0LCB0YWdnZXJzKQp7Cglzd2l0Y2ggKGJhZy4kKQoJewoJCWNhc2UgMToKCQkJdmFyIGhvbWUgPSBiYWcuazsKCQkJdmFyIGVmZmVjdCA9IF9QbGF0Zm9ybV90b0VmZmVjdChpc0NtZCwgaG9tZSwgdGFnZ2VycywgYmFnLmwpOwoJCQllZmZlY3RzRGljdFtob21lXSA9IF9QbGF0Zm9ybV9pbnNlcnQoaXNDbWQsIGVmZmVjdCwgZWZmZWN0c0RpY3RbaG9tZV0pOwoJCQlyZXR1cm47CgoJCWNhc2UgMjoKCQkJZm9yICh2YXIgbGlzdCA9IGJhZy5tOyBsaXN0LmI7IGxpc3QgPSBsaXN0LmIpIC8vIFdISUxFX0NPTlMKCQkJewoJCQkJX1BsYXRmb3JtX2dhdGhlckVmZmVjdHMoaXNDbWQsIGxpc3QuYSwgZWZmZWN0c0RpY3QsIHRhZ2dlcnMpOwoJCQl9CgkJCXJldHVybjsKCgkJY2FzZSAzOgoJCQlfUGxhdGZvcm1fZ2F0aGVyRWZmZWN0cyhpc0NtZCwgYmFnLm8sIGVmZmVjdHNEaWN0LCB7CgkJCQlwOiBiYWcubiwKCQkJCXE6IHRhZ2dlcnMKCQkJfSk7CgkJCXJldHVybjsKCX0KfQoKCmZ1bmN0aW9uIF9QbGF0Zm9ybV90b0VmZmVjdChpc0NtZCwgaG9tZSwgdGFnZ2VycywgdmFsdWUpCnsKCWZ1bmN0aW9uIGFwcGx5VGFnZ2Vycyh4KQoJewoJCWZvciAodmFyIHRlbXAgPSB0YWdnZXJzOyB0ZW1wOyB0ZW1wID0gdGVtcC5xKQoJCXsKCQkJeCA9IHRlbXAucCh4KTsKCQl9CgkJcmV0dXJuIHg7Cgl9CgoJdmFyIG1hcCA9IGlzQ21kCgkJPyBfUGxhdGZvcm1fZWZmZWN0TWFuYWdlcnNbaG9tZV0uZQoJCTogX1BsYXRmb3JtX2VmZmVjdE1hbmFnZXJzW2hvbWVdLmY7CgoJcmV0dXJuIEEyKG1hcCwgYXBwbHlUYWdnZXJzLCB2YWx1ZSkKfQoKCmZ1bmN0aW9uIF9QbGF0Zm9ybV9pbnNlcnQoaXNDbWQsIG5ld0VmZmVjdCwgZWZmZWN0cykKewoJZWZmZWN0cyA9IGVmZmVjdHMgfHwgeyBpOiBfTGlzdF9OaWwsIGo6IF9MaXN0X05pbCB9OwoKCWlzQ21kCgkJPyAoZWZmZWN0cy5pID0gX0xpc3RfQ29ucyhuZXdFZmZlY3QsIGVmZmVjdHMuaSkpCgkJOiAoZWZmZWN0cy5qID0gX0xpc3RfQ29ucyhuZXdFZmZlY3QsIGVmZmVjdHMuaikpOwoKCXJldHVybiBlZmZlY3RzOwp9CgoKCi8vIFBPUlRTCgoKZnVuY3Rpb24gX1BsYXRmb3JtX2NoZWNrUG9ydE5hbWUobmFtZSkKewoJaWYgKF9QbGF0Zm9ybV9lZmZlY3RNYW5hZ2Vyc1tuYW1lXSkKCXsKCQlfRGVidWdfY3Jhc2goMywgbmFtZSkKCX0KfQoKCgovLyBPVVRHT0lORyBQT1JUUwoKCmZ1bmN0aW9uIF9QbGF0Zm9ybV9vdXRnb2luZ1BvcnQobmFtZSwgY29udmVydGVyKQp7CglfUGxhdGZvcm1fY2hlY2tQb3J0TmFtZShuYW1lKTsKCV9QbGF0Zm9ybV9lZmZlY3RNYW5hZ2Vyc1tuYW1lXSA9IHsKCQllOiBfUGxhdGZvcm1fb3V0Z29pbmdQb3J0TWFwLAoJCXI6IGNvbnZlcnRlciwKCQlhOiBfUGxhdGZvcm1fc2V0dXBPdXRnb2luZ1BvcnQKCX07CglyZXR1cm4gX1BsYXRmb3JtX2xlYWYobmFtZSk7Cn0KCgp2YXIgX1BsYXRmb3JtX291dGdvaW5nUG9ydE1hcCA9IEYyKGZ1bmN0aW9uKHRhZ2dlciwgdmFsdWUpIHsgcmV0dXJuIHZhbHVlOyB9KTsKCgpmdW5jdGlvbiBfUGxhdGZvcm1fc2V0dXBPdXRnb2luZ1BvcnQobmFtZSkKewoJdmFyIHN1YnMgPSBbXTsKCXZhciBjb252ZXJ0ZXIgPSBfUGxhdGZvcm1fZWZmZWN0TWFuYWdlcnNbbmFtZV0ucjsKCgkvLyBDUkVBVEUgTUFOQUdFUgoKCXZhciBpbml0ID0gX1Byb2Nlc3Nfc2xlZXAoMCk7CgoJX1BsYXRmb3JtX2VmZmVjdE1hbmFnZXJzW25hbWVdLmIgPSBpbml0OwoJX1BsYXRmb3JtX2VmZmVjdE1hbmFnZXJzW25hbWVdLmMgPSBGMyhmdW5jdGlvbihyb3V0ZXIsIGNtZExpc3QsIHN0YXRlKQoJewoJCWZvciAoIDsgY21kTGlzdC5iOyBjbWRMaXN0ID0gY21kTGlzdC5iKSAvLyBXSElMRV9DT05TCgkJewoJCQkvLyBncmFiIGEgc2VwYXJhdGUgcmVmZXJlbmNlIHRvIHN1YnMgaW4gY2FzZSB1bnN1YnNjcmliZSBpcyBjYWxsZWQKCQkJdmFyIGN1cnJlbnRTdWJzID0gc3ViczsKCQkJdmFyIHZhbHVlID0gX0pzb25fdW53cmFwKGNvbnZlcnRlcihjbWRMaXN0LmEpKTsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJyZW50U3Vicy5sZW5ndGg7IGkrKykKCQkJewoJCQkJY3VycmVudFN1YnNbaV0odmFsdWUpOwoJCQl9CgkJfQoJCXJldHVybiBpbml0OwoJfSk7CgoJLy8gUFVCTElDIEFQSQoKCWZ1bmN0aW9uIHN1YnNjcmliZShjYWxsYmFjaykKCXsKCQlzdWJzLnB1c2goY2FsbGJhY2spOwoJfQoKCWZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNhbGxiYWNrKQoJewoJCS8vIGNvcHkgc3VicyBpbnRvIGEgbmV3IGFycmF5IGluIGNhc2UgdW5zdWJzY3JpYmUgaXMgY2FsbGVkIHdpdGhpbiBhCgkJLy8gc3Vic2NyaWJlZCBjYWxsYmFjawoJCXN1YnMgPSBzdWJzLnNsaWNlKCk7CgkJdmFyIGluZGV4ID0gc3Vicy5pbmRleE9mKGNhbGxiYWNrKTsKCQlpZiAoaW5kZXggPj0gMCkKCQl7CgkJCXN1YnMuc3BsaWNlKGluZGV4LCAxKTsKCQl9Cgl9CgoJcmV0dXJuIHsKCQlzdWJzY3JpYmU6IHN1YnNjcmliZSwKCQl1bnN1YnNjcmliZTogdW5zdWJzY3JpYmUKCX07Cn0KCgoKLy8gSU5DT01JTkcgUE9SVFMKCgpmdW5jdGlvbiBfUGxhdGZvcm1faW5jb21pbmdQb3J0KG5hbWUsIGNvbnZlcnRlcikKewoJX1BsYXRmb3JtX2NoZWNrUG9ydE5hbWUobmFtZSk7CglfUGxhdGZvcm1fZWZmZWN0TWFuYWdlcnNbbmFtZV0gPSB7CgkJZjogX1BsYXRmb3JtX2luY29taW5nUG9ydE1hcCwKCQlyOiBjb252ZXJ0ZXIsCgkJYTogX1BsYXRmb3JtX3NldHVwSW5jb21pbmdQb3J0Cgl9OwoJcmV0dXJuIF9QbGF0Zm9ybV9sZWFmKG5hbWUpOwp9CgoKdmFyIF9QbGF0Zm9ybV9pbmNvbWluZ1BvcnRNYXAgPSBGMihmdW5jdGlvbih0YWdnZXIsIGZpbmFsVGFnZ2VyKQp7CglyZXR1cm4gZnVuY3Rpb24odmFsdWUpCgl7CgkJcmV0dXJuIHRhZ2dlcihmaW5hbFRhZ2dlcih2YWx1ZSkpOwoJfTsKfSk7CgoKZnVuY3Rpb24gX1BsYXRmb3JtX3NldHVwSW5jb21pbmdQb3J0KG5hbWUsIHNlbmRUb0FwcCkKewoJdmFyIHN1YnMgPSBfTGlzdF9OaWw7Cgl2YXIgY29udmVydGVyID0gX1BsYXRmb3JtX2VmZmVjdE1hbmFnZXJzW25hbWVdLnI7CgoJLy8gQ1JFQVRFIE1BTkFHRVIKCgl2YXIgaW5pdCA9IF9TY2hlZHVsZXJfc3VjY2VlZChudWxsKTsKCglfUGxhdGZvcm1fZWZmZWN0TWFuYWdlcnNbbmFtZV0uYiA9IGluaXQ7CglfUGxhdGZvcm1fZWZmZWN0TWFuYWdlcnNbbmFtZV0uYyA9IEYzKGZ1bmN0aW9uKHJvdXRlciwgc3ViTGlzdCwgc3RhdGUpCgl7CgkJc3VicyA9IHN1Ykxpc3Q7CgkJcmV0dXJuIGluaXQ7Cgl9KTsKCgkvLyBQVUJMSUMgQVBJCgoJZnVuY3Rpb24gc2VuZChpbmNvbWluZ1ZhbHVlKQoJewoJCXZhciByZXN1bHQgPSBBMihfSnNvbl9ydW4sIGNvbnZlcnRlciwgX0pzb25fd3JhcChpbmNvbWluZ1ZhbHVlKSk7CgoJCSRlbG0kY29yZSRSZXN1bHQkaXNPayhyZXN1bHQpIHx8IF9EZWJ1Z19jcmFzaCg0LCBuYW1lLCByZXN1bHQuYSk7CgoJCXZhciB2YWx1ZSA9IHJlc3VsdC5hOwoJCWZvciAodmFyIHRlbXAgPSBzdWJzOyB0ZW1wLmI7IHRlbXAgPSB0ZW1wLmIpIC8vIFdISUxFX0NPTlMKCQl7CgkJCXNlbmRUb0FwcCh0ZW1wLmEodmFsdWUpKTsKCQl9Cgl9CgoJcmV0dXJuIHsgc2VuZDogc2VuZCB9Owp9CgoKCi8vIEVYUE9SVCBFTE0gTU9EVUxFUwovLwovLyBIYXZlIERFQlVHIGFuZCBQUk9EIHZlcnNpb25zIHNvIHRoYXQgd2UgY2FuICgxKSBnaXZlIG5pY2VyIGVycm9ycyBpbgovLyBkZWJ1ZyBtb2RlIGFuZCAoMikgbm90IHBheSBmb3IgdGhlIGJpdHMgbmVlZGVkIGZvciB0aGF0IGluIHByb2QgbW9kZS4KLy8KCgpmdW5jdGlvbiBfUGxhdGZvcm1fZXhwb3J0X1VOVVNFRChleHBvcnRzKQp7CglzY29wZVsnRWxtJ10KCQk/IF9QbGF0Zm9ybV9tZXJnZUV4cG9ydHNQcm9kKHNjb3BlWydFbG0nXSwgZXhwb3J0cykKCQk6IHNjb3BlWydFbG0nXSA9IGV4cG9ydHM7Cn0KCgpmdW5jdGlvbiBfUGxhdGZvcm1fbWVyZ2VFeHBvcnRzUHJvZChvYmosIGV4cG9ydHMpCnsKCWZvciAodmFyIG5hbWUgaW4gZXhwb3J0cykKCXsKCQkobmFtZSBpbiBvYmopCgkJCT8gKG5hbWUgPT0gJ2luaXQnKQoJCQkJPyBfRGVidWdfY3Jhc2goNikKCQkJCTogX1BsYXRmb3JtX21lcmdlRXhwb3J0c1Byb2Qob2JqW25hbWVdLCBleHBvcnRzW25hbWVdKQoJCQk6IChvYmpbbmFtZV0gPSBleHBvcnRzW25hbWVdKTsKCX0KfQoKCmZ1bmN0aW9uIF9QbGF0Zm9ybV9leHBvcnQoZXhwb3J0cykKewoJc2NvcGVbJ0VsbSddCgkJPyBfUGxhdGZvcm1fbWVyZ2VFeHBvcnRzRGVidWcoJ0VsbScsIHNjb3BlWydFbG0nXSwgZXhwb3J0cykKCQk6IHNjb3BlWydFbG0nXSA9IGV4cG9ydHM7Cn0KCgpmdW5jdGlvbiBfUGxhdGZvcm1fbWVyZ2VFeHBvcnRzRGVidWcobW9kdWxlTmFtZSwgb2JqLCBleHBvcnRzKQp7Cglmb3IgKHZhciBuYW1lIGluIGV4cG9ydHMpCgl7CgkJKG5hbWUgaW4gb2JqKQoJCQk/IChuYW1lID09ICdpbml0JykKCQkJCT8gX0RlYnVnX2NyYXNoKDYsIG1vZHVsZU5hbWUpCgkJCQk6IF9QbGF0Zm9ybV9tZXJnZUV4cG9ydHNEZWJ1Zyhtb2R1bGVOYW1lICsgJy4nICsgbmFtZSwgb2JqW25hbWVdLCBleHBvcnRzW25hbWVdKQoJCQk6IChvYmpbbmFtZV0gPSBleHBvcnRzW25hbWVdKTsKCX0KfQoKCgoKLy8gSEVMUEVSUwoKCnZhciBfVmlydHVhbERvbV9kaXZlcnRIcmVmVG9BcHA7Cgp2YXIgX1ZpcnR1YWxEb21fZG9jID0gdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJyA/IGRvY3VtZW50IDoge307CgoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fYXBwZW5kQ2hpbGQocGFyZW50LCBjaGlsZCkKewoJcGFyZW50LmFwcGVuZENoaWxkKGNoaWxkKTsKfQoKdmFyIF9WaXJ0dWFsRG9tX2luaXQgPSBGNChmdW5jdGlvbih2aXJ0dWFsTm9kZSwgZmxhZ0RlY29kZXIsIGRlYnVnTWV0YWRhdGEsIGFyZ3MpCnsKCS8vIE5PVEU6IHRoaXMgZnVuY3Rpb24gbmVlZHMgX1BsYXRmb3JtX2V4cG9ydCBhdmFpbGFibGUgdG8gd29yawoKCS8qKl9VTlVTRUQvCgl2YXIgbm9kZSA9IGFyZ3NbJ25vZGUnXTsKCS8vKi8KCS8qKi8KCXZhciBub2RlID0gYXJncyAmJiBhcmdzWydub2RlJ10gPyBhcmdzWydub2RlJ10gOiBfRGVidWdfY3Jhc2goMCk7CgkvLyovCgoJbm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCgKCQlfVmlydHVhbERvbV9yZW5kZXIodmlydHVhbE5vZGUsIGZ1bmN0aW9uKCkge30pLAoJCW5vZGUKCSk7CgoJcmV0dXJuIHt9Owp9KTsKCgoKLy8gVEVYVAoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX3RleHQoc3RyaW5nKQp7CglyZXR1cm4gewoJCSQ6IDAsCgkJYTogc3RyaW5nCgl9Owp9CgoKCi8vIE5PREUKCgp2YXIgX1ZpcnR1YWxEb21fbm9kZU5TID0gRjIoZnVuY3Rpb24obmFtZXNwYWNlLCB0YWcpCnsKCXJldHVybiBGMihmdW5jdGlvbihmYWN0TGlzdCwga2lkTGlzdCkKCXsKCQlmb3IgKHZhciBraWRzID0gW10sIGRlc2NlbmRhbnRzQ291bnQgPSAwOyBraWRMaXN0LmI7IGtpZExpc3QgPSBraWRMaXN0LmIpIC8vIFdISUxFX0NPTlMKCQl7CgkJCXZhciBraWQgPSBraWRMaXN0LmE7CgkJCWRlc2NlbmRhbnRzQ291bnQgKz0gKGtpZC5iIHx8IDApOwoJCQlraWRzLnB1c2goa2lkKTsKCQl9CgkJZGVzY2VuZGFudHNDb3VudCArPSBraWRzLmxlbmd0aDsKCgkJcmV0dXJuIHsKCQkJJDogMSwKCQkJYzogdGFnLAoJCQlkOiBfVmlydHVhbERvbV9vcmdhbml6ZUZhY3RzKGZhY3RMaXN0KSwKCQkJZToga2lkcywKCQkJZjogbmFtZXNwYWNlLAoJCQliOiBkZXNjZW5kYW50c0NvdW50CgkJfTsKCX0pOwp9KTsKCgp2YXIgX1ZpcnR1YWxEb21fbm9kZSA9IF9WaXJ0dWFsRG9tX25vZGVOUyh1bmRlZmluZWQpOwoKCgovLyBLRVlFRCBOT0RFCgoKdmFyIF9WaXJ0dWFsRG9tX2tleWVkTm9kZU5TID0gRjIoZnVuY3Rpb24obmFtZXNwYWNlLCB0YWcpCnsKCXJldHVybiBGMihmdW5jdGlvbihmYWN0TGlzdCwga2lkTGlzdCkKCXsKCQlmb3IgKHZhciBraWRzID0gW10sIGRlc2NlbmRhbnRzQ291bnQgPSAwOyBraWRMaXN0LmI7IGtpZExpc3QgPSBraWRMaXN0LmIpIC8vIFdISUxFX0NPTlMKCQl7CgkJCXZhciBraWQgPSBraWRMaXN0LmE7CgkJCWRlc2NlbmRhbnRzQ291bnQgKz0gKGtpZC5iLmIgfHwgMCk7CgkJCWtpZHMucHVzaChraWQpOwoJCX0KCQlkZXNjZW5kYW50c0NvdW50ICs9IGtpZHMubGVuZ3RoOwoKCQlyZXR1cm4gewoJCQkkOiAyLAoJCQljOiB0YWcsCgkJCWQ6IF9WaXJ0dWFsRG9tX29yZ2FuaXplRmFjdHMoZmFjdExpc3QpLAoJCQllOiBraWRzLAoJCQlmOiBuYW1lc3BhY2UsCgkJCWI6IGRlc2NlbmRhbnRzQ291bnQKCQl9OwoJfSk7Cn0pOwoKCnZhciBfVmlydHVhbERvbV9rZXllZE5vZGUgPSBfVmlydHVhbERvbV9rZXllZE5vZGVOUyh1bmRlZmluZWQpOwoKCgovLyBDVVNUT00KCgpmdW5jdGlvbiBfVmlydHVhbERvbV9jdXN0b20oZmFjdExpc3QsIG1vZGVsLCByZW5kZXIsIGRpZmYpCnsKCXJldHVybiB7CgkJJDogMywKCQlkOiBfVmlydHVhbERvbV9vcmdhbml6ZUZhY3RzKGZhY3RMaXN0KSwKCQlnOiBtb2RlbCwKCQloOiByZW5kZXIsCgkJaTogZGlmZgoJfTsKfQoKCgovLyBNQVAKCgp2YXIgX1ZpcnR1YWxEb21fbWFwID0gRjIoZnVuY3Rpb24odGFnZ2VyLCBub2RlKQp7CglyZXR1cm4gewoJCSQ6IDQsCgkJajogdGFnZ2VyLAoJCWs6IG5vZGUsCgkJYjogMSArIChub2RlLmIgfHwgMCkKCX07Cn0pOwoKCgovLyBMQVpZCgoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fdGh1bmsocmVmcywgdGh1bmspCnsKCXJldHVybiB7CgkJJDogNSwKCQlsOiByZWZzLAoJCW06IHRodW5rLAoJCWs6IHVuZGVmaW5lZAoJfTsKfQoKdmFyIF9WaXJ0dWFsRG9tX2xhenkgPSBGMihmdW5jdGlvbihmdW5jLCBhKQp7CglyZXR1cm4gX1ZpcnR1YWxEb21fdGh1bmsoW2Z1bmMsIGFdLCBmdW5jdGlvbigpIHsKCQlyZXR1cm4gZnVuYyhhKTsKCX0pOwp9KTsKCnZhciBfVmlydHVhbERvbV9sYXp5MiA9IEYzKGZ1bmN0aW9uKGZ1bmMsIGEsIGIpCnsKCXJldHVybiBfVmlydHVhbERvbV90aHVuayhbZnVuYywgYSwgYl0sIGZ1bmN0aW9uKCkgewoJCXJldHVybiBBMihmdW5jLCBhLCBiKTsKCX0pOwp9KTsKCnZhciBfVmlydHVhbERvbV9sYXp5MyA9IEY0KGZ1bmN0aW9uKGZ1bmMsIGEsIGIsIGMpCnsKCXJldHVybiBfVmlydHVhbERvbV90aHVuayhbZnVuYywgYSwgYiwgY10sIGZ1bmN0aW9uKCkgewoJCXJldHVybiBBMyhmdW5jLCBhLCBiLCBjKTsKCX0pOwp9KTsKCnZhciBfVmlydHVhbERvbV9sYXp5NCA9IEY1KGZ1bmN0aW9uKGZ1bmMsIGEsIGIsIGMsIGQpCnsKCXJldHVybiBfVmlydHVhbERvbV90aHVuayhbZnVuYywgYSwgYiwgYywgZF0sIGZ1bmN0aW9uKCkgewoJCXJldHVybiBBNChmdW5jLCBhLCBiLCBjLCBkKTsKCX0pOwp9KTsKCnZhciBfVmlydHVhbERvbV9sYXp5NSA9IEY2KGZ1bmN0aW9uKGZ1bmMsIGEsIGIsIGMsIGQsIGUpCnsKCXJldHVybiBfVmlydHVhbERvbV90aHVuayhbZnVuYywgYSwgYiwgYywgZCwgZV0sIGZ1bmN0aW9uKCkgewoJCXJldHVybiBBNShmdW5jLCBhLCBiLCBjLCBkLCBlKTsKCX0pOwp9KTsKCnZhciBfVmlydHVhbERvbV9sYXp5NiA9IEY3KGZ1bmN0aW9uKGZ1bmMsIGEsIGIsIGMsIGQsIGUsIGYpCnsKCXJldHVybiBfVmlydHVhbERvbV90aHVuayhbZnVuYywgYSwgYiwgYywgZCwgZSwgZl0sIGZ1bmN0aW9uKCkgewoJCXJldHVybiBBNihmdW5jLCBhLCBiLCBjLCBkLCBlLCBmKTsKCX0pOwp9KTsKCnZhciBfVmlydHVhbERvbV9sYXp5NyA9IEY4KGZ1bmN0aW9uKGZ1bmMsIGEsIGIsIGMsIGQsIGUsIGYsIGcpCnsKCXJldHVybiBfVmlydHVhbERvbV90aHVuayhbZnVuYywgYSwgYiwgYywgZCwgZSwgZiwgZ10sIGZ1bmN0aW9uKCkgewoJCXJldHVybiBBNyhmdW5jLCBhLCBiLCBjLCBkLCBlLCBmLCBnKTsKCX0pOwp9KTsKCnZhciBfVmlydHVhbERvbV9sYXp5OCA9IEY5KGZ1bmN0aW9uKGZ1bmMsIGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpCnsKCXJldHVybiBfVmlydHVhbERvbV90aHVuayhbZnVuYywgYSwgYiwgYywgZCwgZSwgZiwgZywgaF0sIGZ1bmN0aW9uKCkgewoJCXJldHVybiBBOChmdW5jLCBhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKTsKCX0pOwp9KTsKCgoKLy8gRkFDVFMKCgp2YXIgX1ZpcnR1YWxEb21fb24gPSBGMihmdW5jdGlvbihrZXksIGhhbmRsZXIpCnsKCXJldHVybiB7CgkJJDogJ2EwJywKCQluOiBrZXksCgkJbzogaGFuZGxlcgoJfTsKfSk7CnZhciBfVmlydHVhbERvbV9zdHlsZSA9IEYyKGZ1bmN0aW9uKGtleSwgdmFsdWUpCnsKCXJldHVybiB7CgkJJDogJ2ExJywKCQluOiBrZXksCgkJbzogdmFsdWUKCX07Cn0pOwp2YXIgX1ZpcnR1YWxEb21fcHJvcGVydHkgPSBGMihmdW5jdGlvbihrZXksIHZhbHVlKQp7CglyZXR1cm4gewoJCSQ6ICdhMicsCgkJbjoga2V5LAoJCW86IHZhbHVlCgl9Owp9KTsKdmFyIF9WaXJ0dWFsRG9tX2F0dHJpYnV0ZSA9IEYyKGZ1bmN0aW9uKGtleSwgdmFsdWUpCnsKCXJldHVybiB7CgkJJDogJ2EzJywKCQluOiBrZXksCgkJbzogdmFsdWUKCX07Cn0pOwp2YXIgX1ZpcnR1YWxEb21fYXR0cmlidXRlTlMgPSBGMyhmdW5jdGlvbihuYW1lc3BhY2UsIGtleSwgdmFsdWUpCnsKCXJldHVybiB7CgkJJDogJ2E0JywKCQluOiBrZXksCgkJbzogeyBmOiBuYW1lc3BhY2UsIG86IHZhbHVlIH0KCX07Cn0pOwoKCgovLyBYU1MgQVRUQUNLIFZFQ1RPUiBDSEVDS1MKCgpmdW5jdGlvbiBfVmlydHVhbERvbV9ub1NjcmlwdCh0YWcpCnsKCXJldHVybiB0YWcgPT0gJ3NjcmlwdCcgPyAncCcgOiB0YWc7Cn0KCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX25vT25PckZvcm1BY3Rpb24oa2V5KQp7CglyZXR1cm4gL14ob258Zm9ybUFjdGlvbiQpL2kudGVzdChrZXkpID8gJ2RhdGEtJyArIGtleSA6IGtleTsKfQoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fbm9Jbm5lckh0bWxPckZvcm1BY3Rpb24oa2V5KQp7CglyZXR1cm4ga2V5ID09ICdpbm5lckhUTUwnIHx8IGtleSA9PSAnZm9ybUFjdGlvbicgPyAnZGF0YS0nICsga2V5IDoga2V5Owp9CgpmdW5jdGlvbiBfVmlydHVhbERvbV9ub0phdmFTY3JpcHRVcmlfVU5VU0VEKHZhbHVlKQp7CglyZXR1cm4gL15qYXZhc2NyaXB0Oi9pLnRlc3QodmFsdWUucmVwbGFjZSgvXHMvZywnJykpID8gJycgOiB2YWx1ZTsKfQoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fbm9KYXZhU2NyaXB0VXJpKHZhbHVlKQp7CglyZXR1cm4gL15qYXZhc2NyaXB0Oi9pLnRlc3QodmFsdWUucmVwbGFjZSgvXHMvZywnJykpCgkJPyAnamF2YXNjcmlwdDphbGVydCgiVGhpcyBpcyBhbiBYU1MgdmVjdG9yLiBQbGVhc2UgdXNlIHBvcnRzIG9yIHdlYiBjb21wb25lbnRzIGluc3RlYWQuIiknCgkJOiB2YWx1ZTsKfQoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fbm9KYXZhU2NyaXB0T3JIdG1sVXJpX1VOVVNFRCh2YWx1ZSkKewoJcmV0dXJuIC9eXHMqKGphdmFzY3JpcHQ6fGRhdGE6dGV4dFwvaHRtbCkvaS50ZXN0KHZhbHVlKSA/ICcnIDogdmFsdWU7Cn0KCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX25vSmF2YVNjcmlwdE9ySHRtbFVyaSh2YWx1ZSkKewoJcmV0dXJuIC9eXHMqKGphdmFzY3JpcHQ6fGRhdGE6dGV4dFwvaHRtbCkvaS50ZXN0KHZhbHVlKQoJCT8gJ2phdmFzY3JpcHQ6YWxlcnQoIlRoaXMgaXMgYW4gWFNTIHZlY3Rvci4gUGxlYXNlIHVzZSBwb3J0cyBvciB3ZWIgY29tcG9uZW50cyBpbnN0ZWFkLiIpJwoJCTogdmFsdWU7Cn0KCgoKLy8gTUFQIEZBQ1RTCgoKdmFyIF9WaXJ0dWFsRG9tX21hcEF0dHJpYnV0ZSA9IEYyKGZ1bmN0aW9uKGZ1bmMsIGF0dHIpCnsKCXJldHVybiAoYXR0ci4kID09PSAnYTAnKQoJCT8gQTIoX1ZpcnR1YWxEb21fb24sIGF0dHIubiwgX1ZpcnR1YWxEb21fbWFwSGFuZGxlcihmdW5jLCBhdHRyLm8pKQoJCTogYXR0cjsKfSk7CgpmdW5jdGlvbiBfVmlydHVhbERvbV9tYXBIYW5kbGVyKGZ1bmMsIGhhbmRsZXIpCnsKCXZhciB0YWcgPSAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kdG9IYW5kbGVySW50KGhhbmRsZXIpOwoKCS8vIDAgPSBOb3JtYWwKCS8vIDEgPSBNYXlTdG9wUHJvcGFnYXRpb24KCS8vIDIgPSBNYXlQcmV2ZW50RGVmYXVsdAoJLy8gMyA9IEN1c3RvbQoKCXJldHVybiB7CgkJJDogaGFuZGxlci4kLAoJCWE6CgkJCSF0YWcKCQkJCT8gQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJG1hcCwgZnVuYywgaGFuZGxlci5hKQoJCQkJOgoJCQlBMygkZWxtJGpzb24kSnNvbiREZWNvZGUkbWFwMiwKCQkJCXRhZyA8IDMKCQkJCQk/IF9WaXJ0dWFsRG9tX21hcEV2ZW50VHVwbGUKCQkJCQk6IF9WaXJ0dWFsRG9tX21hcEV2ZW50UmVjb3JkLAoJCQkJJGVsbSRqc29uJEpzb24kRGVjb2RlJHN1Y2NlZWQoZnVuYyksCgkJCQloYW5kbGVyLmEKCQkJKQoJfTsKfQoKdmFyIF9WaXJ0dWFsRG9tX21hcEV2ZW50VHVwbGUgPSBGMihmdW5jdGlvbihmdW5jLCB0dXBsZSkKewoJcmV0dXJuIF9VdGlsc19UdXBsZTIoZnVuYyh0dXBsZS5hKSwgdHVwbGUuYik7Cn0pOwoKdmFyIF9WaXJ0dWFsRG9tX21hcEV2ZW50UmVjb3JkID0gRjIoZnVuY3Rpb24oZnVuYywgcmVjb3JkKQp7CglyZXR1cm4gewoJCW1lc3NhZ2U6IGZ1bmMocmVjb3JkLm1lc3NhZ2UpLAoJCXN0b3BQcm9wYWdhdGlvbjogcmVjb3JkLnN0b3BQcm9wYWdhdGlvbiwKCQlwcmV2ZW50RGVmYXVsdDogcmVjb3JkLnByZXZlbnREZWZhdWx0Cgl9Cn0pOwoKCgovLyBPUkdBTklaRSBGQUNUUwoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX29yZ2FuaXplRmFjdHMoZmFjdExpc3QpCnsKCWZvciAodmFyIGZhY3RzID0ge307IGZhY3RMaXN0LmI7IGZhY3RMaXN0ID0gZmFjdExpc3QuYikgLy8gV0hJTEVfQ09OUwoJewoJCXZhciBlbnRyeSA9IGZhY3RMaXN0LmE7CgoJCXZhciB0YWcgPSBlbnRyeS4kOwoJCXZhciBrZXkgPSBlbnRyeS5uOwoJCXZhciB2YWx1ZSA9IGVudHJ5Lm87CgoJCWlmICh0YWcgPT09ICdhMicpCgkJewoJCQkoa2V5ID09PSAnY2xhc3NOYW1lJykKCQkJCT8gX1ZpcnR1YWxEb21fYWRkQ2xhc3MoZmFjdHMsIGtleSwgX0pzb25fdW53cmFwKHZhbHVlKSkKCQkJCTogZmFjdHNba2V5XSA9IF9Kc29uX3Vud3JhcCh2YWx1ZSk7CgoJCQljb250aW51ZTsKCQl9CgoJCXZhciBzdWJGYWN0cyA9IGZhY3RzW3RhZ10gfHwgKGZhY3RzW3RhZ10gPSB7fSk7CgkJKHRhZyA9PT0gJ2EzJyAmJiBrZXkgPT09ICdjbGFzcycpCgkJCT8gX1ZpcnR1YWxEb21fYWRkQ2xhc3Moc3ViRmFjdHMsIGtleSwgdmFsdWUpCgkJCTogc3ViRmFjdHNba2V5XSA9IHZhbHVlOwoJfQoKCXJldHVybiBmYWN0czsKfQoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fYWRkQ2xhc3Mob2JqZWN0LCBrZXksIG5ld0NsYXNzKQp7Cgl2YXIgY2xhc3NlcyA9IG9iamVjdFtrZXldOwoJb2JqZWN0W2tleV0gPSBjbGFzc2VzID8gY2xhc3NlcyArICcgJyArIG5ld0NsYXNzIDogbmV3Q2xhc3M7Cn0KCgoKLy8gUkVOREVSCgoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fcmVuZGVyKHZOb2RlLCBldmVudE5vZGUpCnsKCXZhciB0YWcgPSB2Tm9kZS4kOwoKCWlmICh0YWcgPT09IDUpCgl7CgkJcmV0dXJuIF9WaXJ0dWFsRG9tX3JlbmRlcih2Tm9kZS5rIHx8ICh2Tm9kZS5rID0gdk5vZGUubSgpKSwgZXZlbnROb2RlKTsKCX0KCglpZiAodGFnID09PSAwKQoJewoJCXJldHVybiBfVmlydHVhbERvbV9kb2MuY3JlYXRlVGV4dE5vZGUodk5vZGUuYSk7Cgl9CgoJaWYgKHRhZyA9PT0gNCkKCXsKCQl2YXIgc3ViTm9kZSA9IHZOb2RlLms7CgkJdmFyIHRhZ2dlciA9IHZOb2RlLmo7CgoJCXdoaWxlIChzdWJOb2RlLiQgPT09IDQpCgkJewoJCQl0eXBlb2YgdGFnZ2VyICE9PSAnb2JqZWN0JwoJCQkJPyB0YWdnZXIgPSBbdGFnZ2VyLCBzdWJOb2RlLmpdCgkJCQk6IHRhZ2dlci5wdXNoKHN1Yk5vZGUuaik7CgoJCQlzdWJOb2RlID0gc3ViTm9kZS5rOwoJCX0KCgkJdmFyIHN1YkV2ZW50Um9vdCA9IHsgajogdGFnZ2VyLCBwOiBldmVudE5vZGUgfTsKCQl2YXIgZG9tTm9kZSA9IF9WaXJ0dWFsRG9tX3JlbmRlcihzdWJOb2RlLCBzdWJFdmVudFJvb3QpOwoJCWRvbU5vZGUuZWxtX2V2ZW50X25vZGVfcmVmID0gc3ViRXZlbnRSb290OwoJCXJldHVybiBkb21Ob2RlOwoJfQoKCWlmICh0YWcgPT09IDMpCgl7CgkJdmFyIGRvbU5vZGUgPSB2Tm9kZS5oKHZOb2RlLmcpOwoJCV9WaXJ0dWFsRG9tX2FwcGx5RmFjdHMoZG9tTm9kZSwgZXZlbnROb2RlLCB2Tm9kZS5kKTsKCQlyZXR1cm4gZG9tTm9kZTsKCX0KCgkvLyBhdCB0aGlzIHBvaW50IGB0YWdgIG11c3QgYmUgMSBvciAyCgoJdmFyIGRvbU5vZGUgPSB2Tm9kZS5mCgkJPyBfVmlydHVhbERvbV9kb2MuY3JlYXRlRWxlbWVudE5TKHZOb2RlLmYsIHZOb2RlLmMpCgkJOiBfVmlydHVhbERvbV9kb2MuY3JlYXRlRWxlbWVudCh2Tm9kZS5jKTsKCglpZiAoX1ZpcnR1YWxEb21fZGl2ZXJ0SHJlZlRvQXBwICYmIHZOb2RlLmMgPT0gJ2EnKQoJewoJCWRvbU5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfVmlydHVhbERvbV9kaXZlcnRIcmVmVG9BcHAoZG9tTm9kZSkpOwoJfQoKCV9WaXJ0dWFsRG9tX2FwcGx5RmFjdHMoZG9tTm9kZSwgZXZlbnROb2RlLCB2Tm9kZS5kKTsKCglmb3IgKHZhciBraWRzID0gdk5vZGUuZSwgaSA9IDA7IGkgPCBraWRzLmxlbmd0aDsgaSsrKQoJewoJCV9WaXJ0dWFsRG9tX2FwcGVuZENoaWxkKGRvbU5vZGUsIF9WaXJ0dWFsRG9tX3JlbmRlcih0YWcgPT09IDEgPyBraWRzW2ldIDoga2lkc1tpXS5iLCBldmVudE5vZGUpKTsKCX0KCglyZXR1cm4gZG9tTm9kZTsKfQoKCgovLyBBUFBMWSBGQUNUUwoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2FwcGx5RmFjdHMoZG9tTm9kZSwgZXZlbnROb2RlLCBmYWN0cykKewoJZm9yICh2YXIga2V5IGluIGZhY3RzKQoJewoJCXZhciB2YWx1ZSA9IGZhY3RzW2tleV07CgoJCWtleSA9PT0gJ2ExJwoJCQk/IF9WaXJ0dWFsRG9tX2FwcGx5U3R5bGVzKGRvbU5vZGUsIHZhbHVlKQoJCQk6CgkJa2V5ID09PSAnYTAnCgkJCT8gX1ZpcnR1YWxEb21fYXBwbHlFdmVudHMoZG9tTm9kZSwgZXZlbnROb2RlLCB2YWx1ZSkKCQkJOgoJCWtleSA9PT0gJ2EzJwoJCQk/IF9WaXJ0dWFsRG9tX2FwcGx5QXR0cnMoZG9tTm9kZSwgdmFsdWUpCgkJCToKCQlrZXkgPT09ICdhNCcKCQkJPyBfVmlydHVhbERvbV9hcHBseUF0dHJzTlMoZG9tTm9kZSwgdmFsdWUpCgkJCToKCQkoKGtleSAhPT0gJ3ZhbHVlJyAmJiBrZXkgIT09ICdjaGVja2VkJykgfHwgZG9tTm9kZVtrZXldICE9PSB2YWx1ZSkgJiYgKGRvbU5vZGVba2V5XSA9IHZhbHVlKTsKCX0KfQoKCgovLyBBUFBMWSBTVFlMRVMKCgpmdW5jdGlvbiBfVmlydHVhbERvbV9hcHBseVN0eWxlcyhkb21Ob2RlLCBzdHlsZXMpCnsKCXZhciBkb21Ob2RlU3R5bGUgPSBkb21Ob2RlLnN0eWxlOwoKCWZvciAodmFyIGtleSBpbiBzdHlsZXMpCgl7CgkJZG9tTm9kZVN0eWxlW2tleV0gPSBzdHlsZXNba2V5XTsKCX0KfQoKCgovLyBBUFBMWSBBVFRSUwoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2FwcGx5QXR0cnMoZG9tTm9kZSwgYXR0cnMpCnsKCWZvciAodmFyIGtleSBpbiBhdHRycykKCXsKCQl2YXIgdmFsdWUgPSBhdHRyc1trZXldOwoJCXR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcKCQkJPyBkb21Ob2RlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKQoJCQk6IGRvbU5vZGUucmVtb3ZlQXR0cmlidXRlKGtleSk7Cgl9Cn0KCgoKLy8gQVBQTFkgTkFNRVNQQUNFRCBBVFRSUwoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2FwcGx5QXR0cnNOUyhkb21Ob2RlLCBuc0F0dHJzKQp7Cglmb3IgKHZhciBrZXkgaW4gbnNBdHRycykKCXsKCQl2YXIgcGFpciA9IG5zQXR0cnNba2V5XTsKCQl2YXIgbmFtZXNwYWNlID0gcGFpci5mOwoJCXZhciB2YWx1ZSA9IHBhaXIubzsKCgkJdHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJwoJCQk/IGRvbU5vZGUuc2V0QXR0cmlidXRlTlMobmFtZXNwYWNlLCBrZXksIHZhbHVlKQoJCQk6IGRvbU5vZGUucmVtb3ZlQXR0cmlidXRlTlMobmFtZXNwYWNlLCBrZXkpOwoJfQp9CgoKCi8vIEFQUExZIEVWRU5UUwoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2FwcGx5RXZlbnRzKGRvbU5vZGUsIGV2ZW50Tm9kZSwgZXZlbnRzKQp7Cgl2YXIgYWxsQ2FsbGJhY2tzID0gZG9tTm9kZS5lbG1GcyB8fCAoZG9tTm9kZS5lbG1GcyA9IHt9KTsKCglmb3IgKHZhciBrZXkgaW4gZXZlbnRzKQoJewoJCXZhciBuZXdIYW5kbGVyID0gZXZlbnRzW2tleV07CgkJdmFyIG9sZENhbGxiYWNrID0gYWxsQ2FsbGJhY2tzW2tleV07CgoJCWlmICghbmV3SGFuZGxlcikKCQl7CgkJCWRvbU5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihrZXksIG9sZENhbGxiYWNrKTsKCQkJYWxsQ2FsbGJhY2tzW2tleV0gPSB1bmRlZmluZWQ7CgkJCWNvbnRpbnVlOwoJCX0KCgkJaWYgKG9sZENhbGxiYWNrKQoJCXsKCQkJdmFyIG9sZEhhbmRsZXIgPSBvbGRDYWxsYmFjay5xOwoJCQlpZiAob2xkSGFuZGxlci4kID09PSBuZXdIYW5kbGVyLiQpCgkJCXsKCQkJCW9sZENhbGxiYWNrLnEgPSBuZXdIYW5kbGVyOwoJCQkJY29udGludWU7CgkJCX0KCQkJZG9tTm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKGtleSwgb2xkQ2FsbGJhY2spOwoJCX0KCgkJb2xkQ2FsbGJhY2sgPSBfVmlydHVhbERvbV9tYWtlQ2FsbGJhY2soZXZlbnROb2RlLCBuZXdIYW5kbGVyKTsKCQlkb21Ob2RlLmFkZEV2ZW50TGlzdGVuZXIoa2V5LCBvbGRDYWxsYmFjaywKCQkJX1ZpcnR1YWxEb21fcGFzc2l2ZVN1cHBvcnRlZAoJCQkmJiB7IHBhc3NpdmU6ICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSR0b0hhbmRsZXJJbnQobmV3SGFuZGxlcikgPCAyIH0KCQkpOwoJCWFsbENhbGxiYWNrc1trZXldID0gb2xkQ2FsbGJhY2s7Cgl9Cn0KCgoKLy8gUEFTU0lWRSBFVkVOVFMKCgp2YXIgX1ZpcnR1YWxEb21fcGFzc2l2ZVN1cHBvcnRlZDsKCnRyeQp7Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndCcsIG51bGwsIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgJ3Bhc3NpdmUnLCB7CgkJZ2V0OiBmdW5jdGlvbigpIHsgX1ZpcnR1YWxEb21fcGFzc2l2ZVN1cHBvcnRlZCA9IHRydWU7IH0KCX0pKTsKfQpjYXRjaChlKSB7fQoKCgovLyBFVkVOVCBIQU5ETEVSUwoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX21ha2VDYWxsYmFjayhldmVudE5vZGUsIGluaXRpYWxIYW5kbGVyKQp7CglmdW5jdGlvbiBjYWxsYmFjayhldmVudCkKCXsKCQl2YXIgaGFuZGxlciA9IGNhbGxiYWNrLnE7CgkJdmFyIHJlc3VsdCA9IF9Kc29uX3J1bkhlbHAoaGFuZGxlci5hLCBldmVudCk7CgoJCWlmICghJGVsbSRjb3JlJFJlc3VsdCRpc09rKHJlc3VsdCkpCgkJewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgdGFnID0gJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJHRvSGFuZGxlckludChoYW5kbGVyKTsKCgkJLy8gMCA9IE5vcm1hbAoJCS8vIDEgPSBNYXlTdG9wUHJvcGFnYXRpb24KCQkvLyAyID0gTWF5UHJldmVudERlZmF1bHQKCQkvLyAzID0gQ3VzdG9tCgoJCXZhciB2YWx1ZSA9IHJlc3VsdC5hOwoJCXZhciBtZXNzYWdlID0gIXRhZyA/IHZhbHVlIDogdGFnIDwgMyA/IHZhbHVlLmEgOiB2YWx1ZS5tZXNzYWdlOwoJCXZhciBzdG9wUHJvcGFnYXRpb24gPSB0YWcgPT0gMSA/IHZhbHVlLmIgOiB0YWcgPT0gMyAmJiB2YWx1ZS5zdG9wUHJvcGFnYXRpb247CgkJdmFyIGN1cnJlbnRFdmVudE5vZGUgPSAoCgkJCXN0b3BQcm9wYWdhdGlvbiAmJiBldmVudC5zdG9wUHJvcGFnYXRpb24oKSwKCQkJKHRhZyA9PSAyID8gdmFsdWUuYiA6IHRhZyA9PSAzICYmIHZhbHVlLnByZXZlbnREZWZhdWx0KSAmJiBldmVudC5wcmV2ZW50RGVmYXVsdCgpLAoJCQlldmVudE5vZGUKCQkpOwoJCXZhciB0YWdnZXI7CgkJdmFyIGk7CgkJd2hpbGUgKHRhZ2dlciA9IGN1cnJlbnRFdmVudE5vZGUuaikKCQl7CgkJCWlmICh0eXBlb2YgdGFnZ2VyID09ICdmdW5jdGlvbicpCgkJCXsKCQkJCW1lc3NhZ2UgPSB0YWdnZXIobWVzc2FnZSk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlmb3IgKHZhciBpID0gdGFnZ2VyLmxlbmd0aDsgaS0tOyApCgkJCQl7CgkJCQkJbWVzc2FnZSA9IHRhZ2dlcltpXShtZXNzYWdlKTsKCQkJCX0KCQkJfQoJCQljdXJyZW50RXZlbnROb2RlID0gY3VycmVudEV2ZW50Tm9kZS5wOwoJCX0KCQljdXJyZW50RXZlbnROb2RlKG1lc3NhZ2UsIHN0b3BQcm9wYWdhdGlvbik7IC8vIHN0b3BQcm9wYWdhdGlvbiBpbXBsaWVzIGlzU3luYwoJfQoKCWNhbGxiYWNrLnEgPSBpbml0aWFsSGFuZGxlcjsKCglyZXR1cm4gY2FsbGJhY2s7Cn0KCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2VxdWFsRXZlbnRzKHgsIHkpCnsKCXJldHVybiB4LiQgPT0geS4kICYmIF9Kc29uX2VxdWFsaXR5KHguYSwgeS5hKTsKfQoKCgovLyBESUZGCgoKLy8gVE9ETzogU2hvdWxkIHdlIGRvIHBhdGNoZXMgbGlrZSBpbiBpT1M/Ci8vCi8vIHR5cGUgUGF0Y2gKLy8gICA9IEF0IEludCBQYXRjaAovLyAgIHwgQmF0Y2ggKExpc3QgUGF0Y2gpCi8vICAgfCBDaGFuZ2UgLi4uCi8vCi8vIEhvdyBjb3VsZCBpdCBub3QgYmUgYmV0dGVyPwovLwpmdW5jdGlvbiBfVmlydHVhbERvbV9kaWZmKHgsIHkpCnsKCXZhciBwYXRjaGVzID0gW107CglfVmlydHVhbERvbV9kaWZmSGVscCh4LCB5LCBwYXRjaGVzLCAwKTsKCXJldHVybiBwYXRjaGVzOwp9CgoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fcHVzaFBhdGNoKHBhdGNoZXMsIHR5cGUsIGluZGV4LCBkYXRhKQp7Cgl2YXIgcGF0Y2ggPSB7CgkJJDogdHlwZSwKCQlyOiBpbmRleCwKCQlzOiBkYXRhLAoJCXQ6IHVuZGVmaW5lZCwKCQl1OiB1bmRlZmluZWQKCX07CglwYXRjaGVzLnB1c2gocGF0Y2gpOwoJcmV0dXJuIHBhdGNoOwp9CgoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fZGlmZkhlbHAoeCwgeSwgcGF0Y2hlcywgaW5kZXgpCnsKCWlmICh4ID09PSB5KQoJewoJCXJldHVybjsKCX0KCgl2YXIgeFR5cGUgPSB4LiQ7Cgl2YXIgeVR5cGUgPSB5LiQ7CgoJLy8gQmFpbCBpZiB5b3UgcnVuIGludG8gZGlmZmVyZW50IHR5cGVzIG9mIG5vZGVzLiBJbXBsaWVzIHRoYXQgdGhlCgkvLyBzdHJ1Y3R1cmUgaGFzIGNoYW5nZWQgc2lnbmlmaWNhbnRseSBhbmQgaXQncyBub3Qgd29ydGggYSBkaWZmLgoJaWYgKHhUeXBlICE9PSB5VHlwZSkKCXsKCQlpZiAoeFR5cGUgPT09IDEgJiYgeVR5cGUgPT09IDIpCgkJewoJCQl5ID0gX1ZpcnR1YWxEb21fZGVrZXkoeSk7CgkJCXlUeXBlID0gMTsKCQl9CgkJZWxzZQoJCXsKCQkJX1ZpcnR1YWxEb21fcHVzaFBhdGNoKHBhdGNoZXMsIDAsIGluZGV4LCB5KTsKCQkJcmV0dXJuOwoJCX0KCX0KCgkvLyBOb3cgd2Uga25vdyB0aGF0IGJvdGggbm9kZXMgYXJlIHRoZSBzYW1lICQuCglzd2l0Y2ggKHlUeXBlKQoJewoJCWNhc2UgNToKCQkJdmFyIHhSZWZzID0geC5sOwoJCQl2YXIgeVJlZnMgPSB5Lmw7CgkJCXZhciBpID0geFJlZnMubGVuZ3RoOwoJCQl2YXIgc2FtZSA9IGkgPT09IHlSZWZzLmxlbmd0aDsKCQkJd2hpbGUgKHNhbWUgJiYgaS0tKQoJCQl7CgkJCQlzYW1lID0geFJlZnNbaV0gPT09IHlSZWZzW2ldOwoJCQl9CgkJCWlmIChzYW1lKQoJCQl7CgkJCQl5LmsgPSB4Lms7CgkJCQlyZXR1cm47CgkJCX0KCQkJeS5rID0geS5tKCk7CgkJCXZhciBzdWJQYXRjaGVzID0gW107CgkJCV9WaXJ0dWFsRG9tX2RpZmZIZWxwKHguaywgeS5rLCBzdWJQYXRjaGVzLCAwKTsKCQkJc3ViUGF0Y2hlcy5sZW5ndGggPiAwICYmIF9WaXJ0dWFsRG9tX3B1c2hQYXRjaChwYXRjaGVzLCAxLCBpbmRleCwgc3ViUGF0Y2hlcyk7CgkJCXJldHVybjsKCgkJY2FzZSA0OgoJCQkvLyBnYXRoZXIgbmVzdGVkIHRhZ2dlcnMKCQkJdmFyIHhUYWdnZXJzID0geC5qOwoJCQl2YXIgeVRhZ2dlcnMgPSB5Lmo7CgkJCXZhciBuZXN0aW5nID0gZmFsc2U7CgoJCQl2YXIgeFN1Yk5vZGUgPSB4Lms7CgkJCXdoaWxlICh4U3ViTm9kZS4kID09PSA0KQoJCQl7CgkJCQluZXN0aW5nID0gdHJ1ZTsKCgkJCQl0eXBlb2YgeFRhZ2dlcnMgIT09ICdvYmplY3QnCgkJCQkJPyB4VGFnZ2VycyA9IFt4VGFnZ2VycywgeFN1Yk5vZGUual0KCQkJCQk6IHhUYWdnZXJzLnB1c2goeFN1Yk5vZGUuaik7CgoJCQkJeFN1Yk5vZGUgPSB4U3ViTm9kZS5rOwoJCQl9CgoJCQl2YXIgeVN1Yk5vZGUgPSB5Lms7CgkJCXdoaWxlICh5U3ViTm9kZS4kID09PSA0KQoJCQl7CgkJCQluZXN0aW5nID0gdHJ1ZTsKCgkJCQl0eXBlb2YgeVRhZ2dlcnMgIT09ICdvYmplY3QnCgkJCQkJPyB5VGFnZ2VycyA9IFt5VGFnZ2VycywgeVN1Yk5vZGUual0KCQkJCQk6IHlUYWdnZXJzLnB1c2goeVN1Yk5vZGUuaik7CgoJCQkJeVN1Yk5vZGUgPSB5U3ViTm9kZS5rOwoJCQl9CgoJCQkvLyBKdXN0IGJhaWwgaWYgZGlmZmVyZW50IG51bWJlcnMgb2YgdGFnZ2Vycy4gVGhpcyBpbXBsaWVzIHRoZQoJCQkvLyBzdHJ1Y3R1cmUgb2YgdGhlIHZpcnR1YWwgRE9NIGhhcyBjaGFuZ2VkLgoJCQlpZiAobmVzdGluZyAmJiB4VGFnZ2Vycy5sZW5ndGggIT09IHlUYWdnZXJzLmxlbmd0aCkKCQkJewoJCQkJX1ZpcnR1YWxEb21fcHVzaFBhdGNoKHBhdGNoZXMsIDAsIGluZGV4LCB5KTsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gY2hlY2sgaWYgdGFnZ2VycyBhcmUgInRoZSBzYW1lIgoJCQlpZiAobmVzdGluZyA/ICFfVmlydHVhbERvbV9wYWlyd2lzZVJlZkVxdWFsKHhUYWdnZXJzLCB5VGFnZ2VycykgOiB4VGFnZ2VycyAhPT0geVRhZ2dlcnMpCgkJCXsKCQkJCV9WaXJ0dWFsRG9tX3B1c2hQYXRjaChwYXRjaGVzLCAyLCBpbmRleCwgeVRhZ2dlcnMpOwoJCQl9CgoJCQkvLyBkaWZmIGV2ZXJ5dGhpbmcgYmVsb3cgdGhlIHRhZ2dlcnMKCQkJX1ZpcnR1YWxEb21fZGlmZkhlbHAoeFN1Yk5vZGUsIHlTdWJOb2RlLCBwYXRjaGVzLCBpbmRleCArIDEpOwoJCQlyZXR1cm47CgoJCWNhc2UgMDoKCQkJaWYgKHguYSAhPT0geS5hKQoJCQl7CgkJCQlfVmlydHVhbERvbV9wdXNoUGF0Y2gocGF0Y2hlcywgMywgaW5kZXgsIHkuYSk7CgkJCX0KCQkJcmV0dXJuOwoKCQljYXNlIDE6CgkJCV9WaXJ0dWFsRG9tX2RpZmZOb2Rlcyh4LCB5LCBwYXRjaGVzLCBpbmRleCwgX1ZpcnR1YWxEb21fZGlmZktpZHMpOwoJCQlyZXR1cm47CgoJCWNhc2UgMjoKCQkJX1ZpcnR1YWxEb21fZGlmZk5vZGVzKHgsIHksIHBhdGNoZXMsIGluZGV4LCBfVmlydHVhbERvbV9kaWZmS2V5ZWRLaWRzKTsKCQkJcmV0dXJuOwoKCQljYXNlIDM6CgkJCWlmICh4LmggIT09IHkuaCkKCQkJewoJCQkJX1ZpcnR1YWxEb21fcHVzaFBhdGNoKHBhdGNoZXMsIDAsIGluZGV4LCB5KTsKCQkJCXJldHVybjsKCQkJfQoKCQkJdmFyIGZhY3RzRGlmZiA9IF9WaXJ0dWFsRG9tX2RpZmZGYWN0cyh4LmQsIHkuZCk7CgkJCWZhY3RzRGlmZiAmJiBfVmlydHVhbERvbV9wdXNoUGF0Y2gocGF0Y2hlcywgNCwgaW5kZXgsIGZhY3RzRGlmZik7CgoJCQl2YXIgcGF0Y2ggPSB5LmkoeC5nLCB5LmcpOwoJCQlwYXRjaCAmJiBfVmlydHVhbERvbV9wdXNoUGF0Y2gocGF0Y2hlcywgNSwgaW5kZXgsIHBhdGNoKTsKCgkJCXJldHVybjsKCX0KfQoKLy8gYXNzdW1lcyB0aGUgaW5jb21pbmcgYXJyYXlzIGFyZSB0aGUgc2FtZSBsZW5ndGgKZnVuY3Rpb24gX1ZpcnR1YWxEb21fcGFpcndpc2VSZWZFcXVhbChhcywgYnMpCnsKCWZvciAodmFyIGkgPSAwOyBpIDwgYXMubGVuZ3RoOyBpKyspCgl7CgkJaWYgKGFzW2ldICE9PSBic1tpXSkKCQl7CgkJCXJldHVybiBmYWxzZTsKCQl9Cgl9CgoJcmV0dXJuIHRydWU7Cn0KCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2RpZmZOb2Rlcyh4LCB5LCBwYXRjaGVzLCBpbmRleCwgZGlmZktpZHMpCnsKCS8vIEJhaWwgaWYgb2J2aW91cyBpbmRpY2F0b3JzIGhhdmUgY2hhbmdlZC4gSW1wbGllcyBtb3JlIHNlcmlvdXMKCS8vIHN0cnVjdHVyYWwgY2hhbmdlcyBzdWNoIHRoYXQgaXQncyBub3Qgd29ydGggaXQgdG8gZGlmZi4KCWlmICh4LmMgIT09IHkuYyB8fCB4LmYgIT09IHkuZikKCXsKCQlfVmlydHVhbERvbV9wdXNoUGF0Y2gocGF0Y2hlcywgMCwgaW5kZXgsIHkpOwoJCXJldHVybjsKCX0KCgl2YXIgZmFjdHNEaWZmID0gX1ZpcnR1YWxEb21fZGlmZkZhY3RzKHguZCwgeS5kKTsKCWZhY3RzRGlmZiAmJiBfVmlydHVhbERvbV9wdXNoUGF0Y2gocGF0Y2hlcywgNCwgaW5kZXgsIGZhY3RzRGlmZik7CgoJZGlmZktpZHMoeCwgeSwgcGF0Y2hlcywgaW5kZXgpOwp9CgoKCi8vIERJRkYgRkFDVFMKCgovLyBUT0RPIEluc3RlYWQgb2YgY3JlYXRpbmcgYSBuZXcgZGlmZiBvYmplY3QsIGl0J3MgcG9zc2libGUgdG8ganVzdCB0ZXN0IGlmCi8vIHRoZXJlICppcyogYSBkaWZmLiBEdXJpbmcgdGhlIGFjdHVhbCBwYXRjaCwgZG8gdGhlIGRpZmYgYWdhaW4gYW5kIG1ha2UgdGhlCi8vIG1vZGlmaWNhdGlvbnMgZGlyZWN0bHkuIFRoaXMgd2F5LCB0aGVyZSdzIG5vIG5ldyBhbGxvY2F0aW9ucy4gV29ydGggaXQ/CmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2RpZmZGYWN0cyh4LCB5LCBjYXRlZ29yeSkKewoJdmFyIGRpZmY7CgoJLy8gbG9vayBmb3IgY2hhbmdlcyBhbmQgcmVtb3ZhbHMKCWZvciAodmFyIHhLZXkgaW4geCkKCXsKCQlpZiAoeEtleSA9PT0gJ2ExJyB8fCB4S2V5ID09PSAnYTAnIHx8IHhLZXkgPT09ICdhMycgfHwgeEtleSA9PT0gJ2E0JykKCQl7CgkJCXZhciBzdWJEaWZmID0gX1ZpcnR1YWxEb21fZGlmZkZhY3RzKHhbeEtleV0sIHlbeEtleV0gfHwge30sIHhLZXkpOwoJCQlpZiAoc3ViRGlmZikKCQkJewoJCQkJZGlmZiA9IGRpZmYgfHwge307CgkJCQlkaWZmW3hLZXldID0gc3ViRGlmZjsKCQkJfQoJCQljb250aW51ZTsKCQl9CgoJCS8vIHJlbW92ZSBpZiBub3QgaW4gdGhlIG5ldyBmYWN0cwoJCWlmICghKHhLZXkgaW4geSkpCgkJewoJCQlkaWZmID0gZGlmZiB8fCB7fTsKCQkJZGlmZlt4S2V5XSA9CgkJCQkhY2F0ZWdvcnkKCQkJCQk/ICh0eXBlb2YgeFt4S2V5XSA9PT0gJ3N0cmluZycgPyAnJyA6IG51bGwpCgkJCQkJOgoJCQkJKGNhdGVnb3J5ID09PSAnYTEnKQoJCQkJCT8gJycKCQkJCQk6CgkJCQkoY2F0ZWdvcnkgPT09ICdhMCcgfHwgY2F0ZWdvcnkgPT09ICdhMycpCgkJCQkJPyB1bmRlZmluZWQKCQkJCQk6CgkJCQl7IGY6IHhbeEtleV0uZiwgbzogdW5kZWZpbmVkIH07CgoJCQljb250aW51ZTsKCQl9CgoJCXZhciB4VmFsdWUgPSB4W3hLZXldOwoJCXZhciB5VmFsdWUgPSB5W3hLZXldOwoKCQkvLyByZWZlcmVuY2UgZXF1YWwsIHNvIGRvbid0IHdvcnJ5IGFib3V0IGl0CgkJaWYgKHhWYWx1ZSA9PT0geVZhbHVlICYmIHhLZXkgIT09ICd2YWx1ZScgJiYgeEtleSAhPT0gJ2NoZWNrZWQnCgkJCXx8IGNhdGVnb3J5ID09PSAnYTAnICYmIF9WaXJ0dWFsRG9tX2VxdWFsRXZlbnRzKHhWYWx1ZSwgeVZhbHVlKSkKCQl7CgkJCWNvbnRpbnVlOwoJCX0KCgkJZGlmZiA9IGRpZmYgfHwge307CgkJZGlmZlt4S2V5XSA9IHlWYWx1ZTsKCX0KCgkvLyBhZGQgbmV3IHN0dWZmCglmb3IgKHZhciB5S2V5IGluIHkpCgl7CgkJaWYgKCEoeUtleSBpbiB4KSkKCQl7CgkJCWRpZmYgPSBkaWZmIHx8IHt9OwoJCQlkaWZmW3lLZXldID0geVt5S2V5XTsKCQl9Cgl9CgoJcmV0dXJuIGRpZmY7Cn0KCgoKLy8gRElGRiBLSURTCgoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fZGlmZktpZHMoeFBhcmVudCwgeVBhcmVudCwgcGF0Y2hlcywgaW5kZXgpCnsKCXZhciB4S2lkcyA9IHhQYXJlbnQuZTsKCXZhciB5S2lkcyA9IHlQYXJlbnQuZTsKCgl2YXIgeExlbiA9IHhLaWRzLmxlbmd0aDsKCXZhciB5TGVuID0geUtpZHMubGVuZ3RoOwoKCS8vIEZJR1VSRSBPVVQgSUYgVEhFUkUgQVJFIElOU0VSVFMgT1IgUkVNT1ZBTFMKCglpZiAoeExlbiA+IHlMZW4pCgl7CgkJX1ZpcnR1YWxEb21fcHVzaFBhdGNoKHBhdGNoZXMsIDYsIGluZGV4LCB7CgkJCXY6IHlMZW4sCgkJCWk6IHhMZW4gLSB5TGVuCgkJfSk7Cgl9CgllbHNlIGlmICh4TGVuIDwgeUxlbikKCXsKCQlfVmlydHVhbERvbV9wdXNoUGF0Y2gocGF0Y2hlcywgNywgaW5kZXgsIHsKCQkJdjogeExlbiwKCQkJZTogeUtpZHMKCQl9KTsKCX0KCgkvLyBQQUlSV0lTRSBESUZGIEVWRVJZVEhJTkcgRUxTRQoKCWZvciAodmFyIG1pbkxlbiA9IHhMZW4gPCB5TGVuID8geExlbiA6IHlMZW4sIGkgPSAwOyBpIDwgbWluTGVuOyBpKyspCgl7CgkJdmFyIHhLaWQgPSB4S2lkc1tpXTsKCQlfVmlydHVhbERvbV9kaWZmSGVscCh4S2lkLCB5S2lkc1tpXSwgcGF0Y2hlcywgKytpbmRleCk7CgkJaW5kZXggKz0geEtpZC5iIHx8IDA7Cgl9Cn0KCgoKLy8gS0VZRUQgRElGRgoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2RpZmZLZXllZEtpZHMoeFBhcmVudCwgeVBhcmVudCwgcGF0Y2hlcywgcm9vdEluZGV4KQp7Cgl2YXIgbG9jYWxQYXRjaGVzID0gW107CgoJdmFyIGNoYW5nZXMgPSB7fTsgLy8gRGljdCBTdHJpbmcgRW50cnkKCXZhciBpbnNlcnRzID0gW107IC8vIEFycmF5IHsgaW5kZXggOiBJbnQsIGVudHJ5IDogRW50cnkgfQoJLy8gdHlwZSBFbnRyeSA9IHsgdGFnIDogU3RyaW5nLCB2bm9kZSA6IFZOb2RlLCBpbmRleCA6IEludCwgZGF0YSA6IF8gfQoKCXZhciB4S2lkcyA9IHhQYXJlbnQuZTsKCXZhciB5S2lkcyA9IHlQYXJlbnQuZTsKCXZhciB4TGVuID0geEtpZHMubGVuZ3RoOwoJdmFyIHlMZW4gPSB5S2lkcy5sZW5ndGg7Cgl2YXIgeEluZGV4ID0gMDsKCXZhciB5SW5kZXggPSAwOwoKCXZhciBpbmRleCA9IHJvb3RJbmRleDsKCgl3aGlsZSAoeEluZGV4IDwgeExlbiAmJiB5SW5kZXggPCB5TGVuKQoJewoJCXZhciB4ID0geEtpZHNbeEluZGV4XTsKCQl2YXIgeSA9IHlLaWRzW3lJbmRleF07CgoJCXZhciB4S2V5ID0geC5hOwoJCXZhciB5S2V5ID0geS5hOwoJCXZhciB4Tm9kZSA9IHguYjsKCQl2YXIgeU5vZGUgPSB5LmI7CgoJCXZhciBuZXdNYXRjaCA9IHVuZGVmaW5lZDsKCQl2YXIgb2xkTWF0Y2ggPSB1bmRlZmluZWQ7CgoJCS8vIGNoZWNrIGlmIGtleXMgbWF0Y2gKCgkJaWYgKHhLZXkgPT09IHlLZXkpCgkJewoJCQlpbmRleCsrOwoJCQlfVmlydHVhbERvbV9kaWZmSGVscCh4Tm9kZSwgeU5vZGUsIGxvY2FsUGF0Y2hlcywgaW5kZXgpOwoJCQlpbmRleCArPSB4Tm9kZS5iIHx8IDA7CgoJCQl4SW5kZXgrKzsKCQkJeUluZGV4Kys7CgkJCWNvbnRpbnVlOwoJCX0KCgkJLy8gbG9vayBhaGVhZCAxIHRvIGRldGVjdCBpbnNlcnRpb25zIGFuZCByZW1vdmFscy4KCgkJdmFyIHhOZXh0ID0geEtpZHNbeEluZGV4ICsgMV07CgkJdmFyIHlOZXh0ID0geUtpZHNbeUluZGV4ICsgMV07CgoJCWlmICh4TmV4dCkKCQl7CgkJCXZhciB4TmV4dEtleSA9IHhOZXh0LmE7CgkJCXZhciB4TmV4dE5vZGUgPSB4TmV4dC5iOwoJCQlvbGRNYXRjaCA9IHlLZXkgPT09IHhOZXh0S2V5OwoJCX0KCgkJaWYgKHlOZXh0KQoJCXsKCQkJdmFyIHlOZXh0S2V5ID0geU5leHQuYTsKCQkJdmFyIHlOZXh0Tm9kZSA9IHlOZXh0LmI7CgkJCW5ld01hdGNoID0geEtleSA9PT0geU5leHRLZXk7CgkJfQoKCgkJLy8gc3dhcCB4IGFuZCB5CgkJaWYgKG5ld01hdGNoICYmIG9sZE1hdGNoKQoJCXsKCQkJaW5kZXgrKzsKCQkJX1ZpcnR1YWxEb21fZGlmZkhlbHAoeE5vZGUsIHlOZXh0Tm9kZSwgbG9jYWxQYXRjaGVzLCBpbmRleCk7CgkJCV9WaXJ0dWFsRG9tX2luc2VydE5vZGUoY2hhbmdlcywgbG9jYWxQYXRjaGVzLCB4S2V5LCB5Tm9kZSwgeUluZGV4LCBpbnNlcnRzKTsKCQkJaW5kZXggKz0geE5vZGUuYiB8fCAwOwoKCQkJaW5kZXgrKzsKCQkJX1ZpcnR1YWxEb21fcmVtb3ZlTm9kZShjaGFuZ2VzLCBsb2NhbFBhdGNoZXMsIHhLZXksIHhOZXh0Tm9kZSwgaW5kZXgpOwoJCQlpbmRleCArPSB4TmV4dE5vZGUuYiB8fCAwOwoKCQkJeEluZGV4ICs9IDI7CgkJCXlJbmRleCArPSAyOwoJCQljb250aW51ZTsKCQl9CgoJCS8vIGluc2VydCB5CgkJaWYgKG5ld01hdGNoKQoJCXsKCQkJaW5kZXgrKzsKCQkJX1ZpcnR1YWxEb21faW5zZXJ0Tm9kZShjaGFuZ2VzLCBsb2NhbFBhdGNoZXMsIHlLZXksIHlOb2RlLCB5SW5kZXgsIGluc2VydHMpOwoJCQlfVmlydHVhbERvbV9kaWZmSGVscCh4Tm9kZSwgeU5leHROb2RlLCBsb2NhbFBhdGNoZXMsIGluZGV4KTsKCQkJaW5kZXggKz0geE5vZGUuYiB8fCAwOwoKCQkJeEluZGV4ICs9IDE7CgkJCXlJbmRleCArPSAyOwoJCQljb250aW51ZTsKCQl9CgoJCS8vIHJlbW92ZSB4CgkJaWYgKG9sZE1hdGNoKQoJCXsKCQkJaW5kZXgrKzsKCQkJX1ZpcnR1YWxEb21fcmVtb3ZlTm9kZShjaGFuZ2VzLCBsb2NhbFBhdGNoZXMsIHhLZXksIHhOb2RlLCBpbmRleCk7CgkJCWluZGV4ICs9IHhOb2RlLmIgfHwgMDsKCgkJCWluZGV4Kys7CgkJCV9WaXJ0dWFsRG9tX2RpZmZIZWxwKHhOZXh0Tm9kZSwgeU5vZGUsIGxvY2FsUGF0Y2hlcywgaW5kZXgpOwoJCQlpbmRleCArPSB4TmV4dE5vZGUuYiB8fCAwOwoKCQkJeEluZGV4ICs9IDI7CgkJCXlJbmRleCArPSAxOwoJCQljb250aW51ZTsKCQl9CgoJCS8vIHJlbW92ZSB4LCBpbnNlcnQgeQoJCWlmICh4TmV4dCAmJiB4TmV4dEtleSA9PT0geU5leHRLZXkpCgkJewoJCQlpbmRleCsrOwoJCQlfVmlydHVhbERvbV9yZW1vdmVOb2RlKGNoYW5nZXMsIGxvY2FsUGF0Y2hlcywgeEtleSwgeE5vZGUsIGluZGV4KTsKCQkJX1ZpcnR1YWxEb21faW5zZXJ0Tm9kZShjaGFuZ2VzLCBsb2NhbFBhdGNoZXMsIHlLZXksIHlOb2RlLCB5SW5kZXgsIGluc2VydHMpOwoJCQlpbmRleCArPSB4Tm9kZS5iIHx8IDA7CgoJCQlpbmRleCsrOwoJCQlfVmlydHVhbERvbV9kaWZmSGVscCh4TmV4dE5vZGUsIHlOZXh0Tm9kZSwgbG9jYWxQYXRjaGVzLCBpbmRleCk7CgkJCWluZGV4ICs9IHhOZXh0Tm9kZS5iIHx8IDA7CgoJCQl4SW5kZXggKz0gMjsKCQkJeUluZGV4ICs9IDI7CgkJCWNvbnRpbnVlOwoJCX0KCgkJYnJlYWs7Cgl9CgoJLy8gZWF0IHVwIGFueSByZW1haW5pbmcgbm9kZXMgd2l0aCByZW1vdmVOb2RlIGFuZCBpbnNlcnROb2RlCgoJd2hpbGUgKHhJbmRleCA8IHhMZW4pCgl7CgkJaW5kZXgrKzsKCQl2YXIgeCA9IHhLaWRzW3hJbmRleF07CgkJdmFyIHhOb2RlID0geC5iOwoJCV9WaXJ0dWFsRG9tX3JlbW92ZU5vZGUoY2hhbmdlcywgbG9jYWxQYXRjaGVzLCB4LmEsIHhOb2RlLCBpbmRleCk7CgkJaW5kZXggKz0geE5vZGUuYiB8fCAwOwoJCXhJbmRleCsrOwoJfQoKCXdoaWxlICh5SW5kZXggPCB5TGVuKQoJewoJCXZhciBlbmRJbnNlcnRzID0gZW5kSW5zZXJ0cyB8fCBbXTsKCQl2YXIgeSA9IHlLaWRzW3lJbmRleF07CgkJX1ZpcnR1YWxEb21faW5zZXJ0Tm9kZShjaGFuZ2VzLCBsb2NhbFBhdGNoZXMsIHkuYSwgeS5iLCB1bmRlZmluZWQsIGVuZEluc2VydHMpOwoJCXlJbmRleCsrOwoJfQoKCWlmIChsb2NhbFBhdGNoZXMubGVuZ3RoID4gMCB8fCBpbnNlcnRzLmxlbmd0aCA+IDAgfHwgZW5kSW5zZXJ0cykKCXsKCQlfVmlydHVhbERvbV9wdXNoUGF0Y2gocGF0Y2hlcywgOCwgcm9vdEluZGV4LCB7CgkJCXc6IGxvY2FsUGF0Y2hlcywKCQkJeDogaW5zZXJ0cywKCQkJeTogZW5kSW5zZXJ0cwoJCX0pOwoJfQp9CgoKCi8vIENIQU5HRVMgRlJPTSBLRVlFRCBESUZGCgoKdmFyIF9WaXJ0dWFsRG9tX1BPU1RGSVggPSAnX2VsbVc2QkwnOwoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2luc2VydE5vZGUoY2hhbmdlcywgbG9jYWxQYXRjaGVzLCBrZXksIHZub2RlLCB5SW5kZXgsIGluc2VydHMpCnsKCXZhciBlbnRyeSA9IGNoYW5nZXNba2V5XTsKCgkvLyBuZXZlciBzZWVuIHRoaXMga2V5IGJlZm9yZQoJaWYgKCFlbnRyeSkKCXsKCQllbnRyeSA9IHsKCQkJYzogMCwKCQkJejogdm5vZGUsCgkJCXI6IHlJbmRleCwKCQkJczogdW5kZWZpbmVkCgkJfTsKCgkJaW5zZXJ0cy5wdXNoKHsgcjogeUluZGV4LCBBOiBlbnRyeSB9KTsKCQljaGFuZ2VzW2tleV0gPSBlbnRyeTsKCgkJcmV0dXJuOwoJfQoKCS8vIHRoaXMga2V5IHdhcyByZW1vdmVkIGVhcmxpZXIsIGEgbWF0Y2ghCglpZiAoZW50cnkuYyA9PT0gMSkKCXsKCQlpbnNlcnRzLnB1c2goeyByOiB5SW5kZXgsIEE6IGVudHJ5IH0pOwoKCQllbnRyeS5jID0gMjsKCQl2YXIgc3ViUGF0Y2hlcyA9IFtdOwoJCV9WaXJ0dWFsRG9tX2RpZmZIZWxwKGVudHJ5LnosIHZub2RlLCBzdWJQYXRjaGVzLCBlbnRyeS5yKTsKCQllbnRyeS5yID0geUluZGV4OwoJCWVudHJ5LnMucyA9IHsKCQkJdzogc3ViUGF0Y2hlcywKCQkJQTogZW50cnkKCQl9OwoKCQlyZXR1cm47Cgl9CgoJLy8gdGhpcyBrZXkgaGFzIGFscmVhZHkgYmVlbiBpbnNlcnRlZCBvciBtb3ZlZCwgYSBkdXBsaWNhdGUhCglfVmlydHVhbERvbV9pbnNlcnROb2RlKGNoYW5nZXMsIGxvY2FsUGF0Y2hlcywga2V5ICsgX1ZpcnR1YWxEb21fUE9TVEZJWCwgdm5vZGUsIHlJbmRleCwgaW5zZXJ0cyk7Cn0KCgpmdW5jdGlvbiBfVmlydHVhbERvbV9yZW1vdmVOb2RlKGNoYW5nZXMsIGxvY2FsUGF0Y2hlcywga2V5LCB2bm9kZSwgaW5kZXgpCnsKCXZhciBlbnRyeSA9IGNoYW5nZXNba2V5XTsKCgkvLyBuZXZlciBzZWVuIHRoaXMga2V5IGJlZm9yZQoJaWYgKCFlbnRyeSkKCXsKCQl2YXIgcGF0Y2ggPSBfVmlydHVhbERvbV9wdXNoUGF0Y2gobG9jYWxQYXRjaGVzLCA5LCBpbmRleCwgdW5kZWZpbmVkKTsKCgkJY2hhbmdlc1trZXldID0gewoJCQljOiAxLAoJCQl6OiB2bm9kZSwKCQkJcjogaW5kZXgsCgkJCXM6IHBhdGNoCgkJfTsKCgkJcmV0dXJuOwoJfQoKCS8vIHRoaXMga2V5IHdhcyBpbnNlcnRlZCBlYXJsaWVyLCBhIG1hdGNoIQoJaWYgKGVudHJ5LmMgPT09IDApCgl7CgkJZW50cnkuYyA9IDI7CgkJdmFyIHN1YlBhdGNoZXMgPSBbXTsKCQlfVmlydHVhbERvbV9kaWZmSGVscCh2bm9kZSwgZW50cnkueiwgc3ViUGF0Y2hlcywgaW5kZXgpOwoKCQlfVmlydHVhbERvbV9wdXNoUGF0Y2gobG9jYWxQYXRjaGVzLCA5LCBpbmRleCwgewoJCQl3OiBzdWJQYXRjaGVzLAoJCQlBOiBlbnRyeQoJCX0pOwoKCQlyZXR1cm47Cgl9CgoJLy8gdGhpcyBrZXkgaGFzIGFscmVhZHkgYmVlbiByZW1vdmVkIG9yIG1vdmVkLCBhIGR1cGxpY2F0ZSEKCV9WaXJ0dWFsRG9tX3JlbW92ZU5vZGUoY2hhbmdlcywgbG9jYWxQYXRjaGVzLCBrZXkgKyBfVmlydHVhbERvbV9QT1NURklYLCB2bm9kZSwgaW5kZXgpOwp9CgoKCi8vIEFERCBET00gTk9ERVMKLy8KLy8gRWFjaCBET00gbm9kZSBoYXMgYW4gImluZGV4IiBhc3NpZ25lZCBpbiBvcmRlciBvZiB0cmF2ZXJzYWwuIEl0IGlzIGltcG9ydGFudAovLyB0byBtaW5pbWl6ZSBvdXIgY3Jhd2wgb3ZlciB0aGUgYWN0dWFsIERPTSwgc28gdGhlc2UgaW5kZXhlcyAoYWxvbmcgd2l0aCB0aGUKLy8gZGVzY2VuZGFudHNDb3VudCBvZiB2aXJ0dWFsIG5vZGVzKSBsZXQgdXMgc2tpcCB0b3VjaGluZyBlbnRpcmUgc3VidHJlZXMgb2YKLy8gdGhlIERPTSBpZiB3ZSBrbm93IHRoZXJlIGFyZSBubyBwYXRjaGVzIHRoZXJlLgoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2FkZERvbU5vZGVzKGRvbU5vZGUsIHZOb2RlLCBwYXRjaGVzLCBldmVudE5vZGUpCnsKCV9WaXJ0dWFsRG9tX2FkZERvbU5vZGVzSGVscChkb21Ob2RlLCB2Tm9kZSwgcGF0Y2hlcywgMCwgMCwgdk5vZGUuYiwgZXZlbnROb2RlKTsKfQoKCi8vIGFzc3VtZXMgYHBhdGNoZXNgIGlzIG5vbi1lbXB0eSBhbmQgaW5kZXhlcyBpbmNyZWFzZSBtb25vdG9uaWNhbGx5LgpmdW5jdGlvbiBfVmlydHVhbERvbV9hZGREb21Ob2Rlc0hlbHAoZG9tTm9kZSwgdk5vZGUsIHBhdGNoZXMsIGksIGxvdywgaGlnaCwgZXZlbnROb2RlKQp7Cgl2YXIgcGF0Y2ggPSBwYXRjaGVzW2ldOwoJdmFyIGluZGV4ID0gcGF0Y2gucjsKCgl3aGlsZSAoaW5kZXggPT09IGxvdykKCXsKCQl2YXIgcGF0Y2hUeXBlID0gcGF0Y2guJDsKCgkJaWYgKHBhdGNoVHlwZSA9PT0gMSkKCQl7CgkJCV9WaXJ0dWFsRG9tX2FkZERvbU5vZGVzKGRvbU5vZGUsIHZOb2RlLmssIHBhdGNoLnMsIGV2ZW50Tm9kZSk7CgkJfQoJCWVsc2UgaWYgKHBhdGNoVHlwZSA9PT0gOCkKCQl7CgkJCXBhdGNoLnQgPSBkb21Ob2RlOwoJCQlwYXRjaC51ID0gZXZlbnROb2RlOwoKCQkJdmFyIHN1YlBhdGNoZXMgPSBwYXRjaC5zLnc7CgkJCWlmIChzdWJQYXRjaGVzLmxlbmd0aCA+IDApCgkJCXsKCQkJCV9WaXJ0dWFsRG9tX2FkZERvbU5vZGVzSGVscChkb21Ob2RlLCB2Tm9kZSwgc3ViUGF0Y2hlcywgMCwgbG93LCBoaWdoLCBldmVudE5vZGUpOwoJCQl9CgkJfQoJCWVsc2UgaWYgKHBhdGNoVHlwZSA9PT0gOSkKCQl7CgkJCXBhdGNoLnQgPSBkb21Ob2RlOwoJCQlwYXRjaC51ID0gZXZlbnROb2RlOwoKCQkJdmFyIGRhdGEgPSBwYXRjaC5zOwoJCQlpZiAoZGF0YSkKCQkJewoJCQkJZGF0YS5BLnMgPSBkb21Ob2RlOwoJCQkJdmFyIHN1YlBhdGNoZXMgPSBkYXRhLnc7CgkJCQlpZiAoc3ViUGF0Y2hlcy5sZW5ndGggPiAwKQoJCQkJewoJCQkJCV9WaXJ0dWFsRG9tX2FkZERvbU5vZGVzSGVscChkb21Ob2RlLCB2Tm9kZSwgc3ViUGF0Y2hlcywgMCwgbG93LCBoaWdoLCBldmVudE5vZGUpOwoJCQkJfQoJCQl9CgkJfQoJCWVsc2UKCQl7CgkJCXBhdGNoLnQgPSBkb21Ob2RlOwoJCQlwYXRjaC51ID0gZXZlbnROb2RlOwoJCX0KCgkJaSsrOwoKCQlpZiAoIShwYXRjaCA9IHBhdGNoZXNbaV0pIHx8IChpbmRleCA9IHBhdGNoLnIpID4gaGlnaCkKCQl7CgkJCXJldHVybiBpOwoJCX0KCX0KCgl2YXIgdGFnID0gdk5vZGUuJDsKCglpZiAodGFnID09PSA0KQoJewoJCXZhciBzdWJOb2RlID0gdk5vZGUuazsKCgkJd2hpbGUgKHN1Yk5vZGUuJCA9PT0gNCkKCQl7CgkJCXN1Yk5vZGUgPSBzdWJOb2RlLms7CgkJfQoKCQlyZXR1cm4gX1ZpcnR1YWxEb21fYWRkRG9tTm9kZXNIZWxwKGRvbU5vZGUsIHN1Yk5vZGUsIHBhdGNoZXMsIGksIGxvdyArIDEsIGhpZ2gsIGRvbU5vZGUuZWxtX2V2ZW50X25vZGVfcmVmKTsKCX0KCgkvLyB0YWcgbXVzdCBiZSAxIG9yIDIgYXQgdGhpcyBwb2ludAoKCXZhciB2S2lkcyA9IHZOb2RlLmU7Cgl2YXIgY2hpbGROb2RlcyA9IGRvbU5vZGUuY2hpbGROb2RlczsKCWZvciAodmFyIGogPSAwOyBqIDwgdktpZHMubGVuZ3RoOyBqKyspCgl7CgkJbG93Kys7CgkJdmFyIHZLaWQgPSB0YWcgPT09IDEgPyB2S2lkc1tqXSA6IHZLaWRzW2pdLmI7CgkJdmFyIG5leHRMb3cgPSBsb3cgKyAodktpZC5iIHx8IDApOwoJCWlmIChsb3cgPD0gaW5kZXggJiYgaW5kZXggPD0gbmV4dExvdykKCQl7CgkJCWkgPSBfVmlydHVhbERvbV9hZGREb21Ob2Rlc0hlbHAoY2hpbGROb2Rlc1tqXSwgdktpZCwgcGF0Y2hlcywgaSwgbG93LCBuZXh0TG93LCBldmVudE5vZGUpOwoJCQlpZiAoIShwYXRjaCA9IHBhdGNoZXNbaV0pIHx8IChpbmRleCA9IHBhdGNoLnIpID4gaGlnaCkKCQkJewoJCQkJcmV0dXJuIGk7CgkJCX0KCQl9CgkJbG93ID0gbmV4dExvdzsKCX0KCXJldHVybiBpOwp9CgoKCi8vIEFQUExZIFBBVENIRVMKCgpmdW5jdGlvbiBfVmlydHVhbERvbV9hcHBseVBhdGNoZXMocm9vdERvbU5vZGUsIG9sZFZpcnR1YWxOb2RlLCBwYXRjaGVzLCBldmVudE5vZGUpCnsKCWlmIChwYXRjaGVzLmxlbmd0aCA9PT0gMCkKCXsKCQlyZXR1cm4gcm9vdERvbU5vZGU7Cgl9CgoJX1ZpcnR1YWxEb21fYWRkRG9tTm9kZXMocm9vdERvbU5vZGUsIG9sZFZpcnR1YWxOb2RlLCBwYXRjaGVzLCBldmVudE5vZGUpOwoJcmV0dXJuIF9WaXJ0dWFsRG9tX2FwcGx5UGF0Y2hlc0hlbHAocm9vdERvbU5vZGUsIHBhdGNoZXMpOwp9CgpmdW5jdGlvbiBfVmlydHVhbERvbV9hcHBseVBhdGNoZXNIZWxwKHJvb3REb21Ob2RlLCBwYXRjaGVzKQp7Cglmb3IgKHZhciBpID0gMDsgaSA8IHBhdGNoZXMubGVuZ3RoOyBpKyspCgl7CgkJdmFyIHBhdGNoID0gcGF0Y2hlc1tpXTsKCQl2YXIgbG9jYWxEb21Ob2RlID0gcGF0Y2gudAoJCXZhciBuZXdOb2RlID0gX1ZpcnR1YWxEb21fYXBwbHlQYXRjaChsb2NhbERvbU5vZGUsIHBhdGNoKTsKCQlpZiAobG9jYWxEb21Ob2RlID09PSByb290RG9tTm9kZSkKCQl7CgkJCXJvb3REb21Ob2RlID0gbmV3Tm9kZTsKCQl9Cgl9CglyZXR1cm4gcm9vdERvbU5vZGU7Cn0KCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2FwcGx5UGF0Y2goZG9tTm9kZSwgcGF0Y2gpCnsKCXN3aXRjaCAocGF0Y2guJCkKCXsKCQljYXNlIDA6CgkJCXJldHVybiBfVmlydHVhbERvbV9hcHBseVBhdGNoUmVkcmF3KGRvbU5vZGUsIHBhdGNoLnMsIHBhdGNoLnUpOwoKCQljYXNlIDQ6CgkJCV9WaXJ0dWFsRG9tX2FwcGx5RmFjdHMoZG9tTm9kZSwgcGF0Y2gudSwgcGF0Y2gucyk7CgkJCXJldHVybiBkb21Ob2RlOwoKCQljYXNlIDM6CgkJCWRvbU5vZGUucmVwbGFjZURhdGEoMCwgZG9tTm9kZS5sZW5ndGgsIHBhdGNoLnMpOwoJCQlyZXR1cm4gZG9tTm9kZTsKCgkJY2FzZSAxOgoJCQlyZXR1cm4gX1ZpcnR1YWxEb21fYXBwbHlQYXRjaGVzSGVscChkb21Ob2RlLCBwYXRjaC5zKTsKCgkJY2FzZSAyOgoJCQlpZiAoZG9tTm9kZS5lbG1fZXZlbnRfbm9kZV9yZWYpCgkJCXsKCQkJCWRvbU5vZGUuZWxtX2V2ZW50X25vZGVfcmVmLmogPSBwYXRjaC5zOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJZG9tTm9kZS5lbG1fZXZlbnRfbm9kZV9yZWYgPSB7IGo6IHBhdGNoLnMsIHA6IHBhdGNoLnUgfTsKCQkJfQoJCQlyZXR1cm4gZG9tTm9kZTsKCgkJY2FzZSA2OgoJCQl2YXIgZGF0YSA9IHBhdGNoLnM7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5pOyBpKyspCgkJCXsKCQkJCWRvbU5vZGUucmVtb3ZlQ2hpbGQoZG9tTm9kZS5jaGlsZE5vZGVzW2RhdGEudl0pOwoJCQl9CgkJCXJldHVybiBkb21Ob2RlOwoKCQljYXNlIDc6CgkJCXZhciBkYXRhID0gcGF0Y2guczsKCQkJdmFyIGtpZHMgPSBkYXRhLmU7CgkJCXZhciBpID0gZGF0YS52OwoJCQl2YXIgdGhlRW5kID0gZG9tTm9kZS5jaGlsZE5vZGVzW2ldOwoJCQlmb3IgKDsgaSA8IGtpZHMubGVuZ3RoOyBpKyspCgkJCXsKCQkJCWRvbU5vZGUuaW5zZXJ0QmVmb3JlKF9WaXJ0dWFsRG9tX3JlbmRlcihraWRzW2ldLCBwYXRjaC51KSwgdGhlRW5kKTsKCQkJfQoJCQlyZXR1cm4gZG9tTm9kZTsKCgkJY2FzZSA5OgoJCQl2YXIgZGF0YSA9IHBhdGNoLnM7CgkJCWlmICghZGF0YSkKCQkJewoJCQkJZG9tTm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGRvbU5vZGUpOwoJCQkJcmV0dXJuIGRvbU5vZGU7CgkJCX0KCQkJdmFyIGVudHJ5ID0gZGF0YS5BOwoJCQlpZiAodHlwZW9mIGVudHJ5LnIgIT09ICd1bmRlZmluZWQnKQoJCQl7CgkJCQlkb21Ob2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZG9tTm9kZSk7CgkJCX0KCQkJZW50cnkucyA9IF9WaXJ0dWFsRG9tX2FwcGx5UGF0Y2hlc0hlbHAoZG9tTm9kZSwgZGF0YS53KTsKCQkJcmV0dXJuIGRvbU5vZGU7CgoJCWNhc2UgODoKCQkJcmV0dXJuIF9WaXJ0dWFsRG9tX2FwcGx5UGF0Y2hSZW9yZGVyKGRvbU5vZGUsIHBhdGNoKTsKCgkJY2FzZSA1OgoJCQlyZXR1cm4gcGF0Y2gucyhkb21Ob2RlKTsKCgkJZGVmYXVsdDoKCQkJX0RlYnVnX2NyYXNoKDEwKTsgLy8gJ1JhbiBpbnRvIGFuIHVua25vd24gcGF0Y2ghJwoJfQp9CgoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fYXBwbHlQYXRjaFJlZHJhdyhkb21Ob2RlLCB2Tm9kZSwgZXZlbnROb2RlKQp7Cgl2YXIgcGFyZW50Tm9kZSA9IGRvbU5vZGUucGFyZW50Tm9kZTsKCXZhciBuZXdOb2RlID0gX1ZpcnR1YWxEb21fcmVuZGVyKHZOb2RlLCBldmVudE5vZGUpOwoKCWlmICghbmV3Tm9kZS5lbG1fZXZlbnRfbm9kZV9yZWYpCgl7CgkJbmV3Tm9kZS5lbG1fZXZlbnRfbm9kZV9yZWYgPSBkb21Ob2RlLmVsbV9ldmVudF9ub2RlX3JlZjsKCX0KCglpZiAocGFyZW50Tm9kZSAmJiBuZXdOb2RlICE9PSBkb21Ob2RlKQoJewoJCXBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld05vZGUsIGRvbU5vZGUpOwoJfQoJcmV0dXJuIG5ld05vZGU7Cn0KCgpmdW5jdGlvbiBfVmlydHVhbERvbV9hcHBseVBhdGNoUmVvcmRlcihkb21Ob2RlLCBwYXRjaCkKewoJdmFyIGRhdGEgPSBwYXRjaC5zOwoKCS8vIHJlbW92ZSBlbmQgaW5zZXJ0cwoJdmFyIGZyYWcgPSBfVmlydHVhbERvbV9hcHBseVBhdGNoUmVvcmRlckVuZEluc2VydHNIZWxwKGRhdGEueSwgcGF0Y2gpOwoKCS8vIHJlbW92YWxzCglkb21Ob2RlID0gX1ZpcnR1YWxEb21fYXBwbHlQYXRjaGVzSGVscChkb21Ob2RlLCBkYXRhLncpOwoKCS8vIGluc2VydHMKCXZhciBpbnNlcnRzID0gZGF0YS54OwoJZm9yICh2YXIgaSA9IDA7IGkgPCBpbnNlcnRzLmxlbmd0aDsgaSsrKQoJewoJCXZhciBpbnNlcnQgPSBpbnNlcnRzW2ldOwoJCXZhciBlbnRyeSA9IGluc2VydC5BOwoJCXZhciBub2RlID0gZW50cnkuYyA9PT0gMgoJCQk/IGVudHJ5LnMKCQkJOiBfVmlydHVhbERvbV9yZW5kZXIoZW50cnkueiwgcGF0Y2gudSk7CgkJZG9tTm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgZG9tTm9kZS5jaGlsZE5vZGVzW2luc2VydC5yXSk7Cgl9CgoJLy8gYWRkIGVuZCBpbnNlcnRzCglpZiAoZnJhZykKCXsKCQlfVmlydHVhbERvbV9hcHBlbmRDaGlsZChkb21Ob2RlLCBmcmFnKTsKCX0KCglyZXR1cm4gZG9tTm9kZTsKfQoKCmZ1bmN0aW9uIF9WaXJ0dWFsRG9tX2FwcGx5UGF0Y2hSZW9yZGVyRW5kSW5zZXJ0c0hlbHAoZW5kSW5zZXJ0cywgcGF0Y2gpCnsKCWlmICghZW5kSW5zZXJ0cykKCXsKCQlyZXR1cm47Cgl9CgoJdmFyIGZyYWcgPSBfVmlydHVhbERvbV9kb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoJZm9yICh2YXIgaSA9IDA7IGkgPCBlbmRJbnNlcnRzLmxlbmd0aDsgaSsrKQoJewoJCXZhciBpbnNlcnQgPSBlbmRJbnNlcnRzW2ldOwoJCXZhciBlbnRyeSA9IGluc2VydC5BOwoJCV9WaXJ0dWFsRG9tX2FwcGVuZENoaWxkKGZyYWcsIGVudHJ5LmMgPT09IDIKCQkJPyBlbnRyeS5zCgkJCTogX1ZpcnR1YWxEb21fcmVuZGVyKGVudHJ5LnosIHBhdGNoLnUpCgkJKTsKCX0KCXJldHVybiBmcmFnOwp9CgoKZnVuY3Rpb24gX1ZpcnR1YWxEb21fdmlydHVhbGl6ZShub2RlKQp7CgkvLyBURVhUIE5PREVTCgoJaWYgKG5vZGUubm9kZVR5cGUgPT09IDMpCgl7CgkJcmV0dXJuIF9WaXJ0dWFsRG9tX3RleHQobm9kZS50ZXh0Q29udGVudCk7Cgl9CgoKCS8vIFdFSVJEIE5PREVTCgoJaWYgKG5vZGUubm9kZVR5cGUgIT09IDEpCgl7CgkJcmV0dXJuIF9WaXJ0dWFsRG9tX3RleHQoJycpOwoJfQoKCgkvLyBFTEVNRU5UIE5PREVTCgoJdmFyIGF0dHJMaXN0ID0gX0xpc3RfTmlsOwoJdmFyIGF0dHJzID0gbm9kZS5hdHRyaWJ1dGVzOwoJZm9yICh2YXIgaSA9IGF0dHJzLmxlbmd0aDsgaS0tOyApCgl7CgkJdmFyIGF0dHIgPSBhdHRyc1tpXTsKCQl2YXIgbmFtZSA9IGF0dHIubmFtZTsKCQl2YXIgdmFsdWUgPSBhdHRyLnZhbHVlOwoJCWF0dHJMaXN0ID0gX0xpc3RfQ29ucyggQTIoX1ZpcnR1YWxEb21fYXR0cmlidXRlLCBuYW1lLCB2YWx1ZSksIGF0dHJMaXN0ICk7Cgl9CgoJdmFyIHRhZyA9IG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwoJdmFyIGtpZExpc3QgPSBfTGlzdF9OaWw7Cgl2YXIga2lkcyA9IG5vZGUuY2hpbGROb2RlczsKCglmb3IgKHZhciBpID0ga2lkcy5sZW5ndGg7IGktLTsgKQoJewoJCWtpZExpc3QgPSBfTGlzdF9Db25zKF9WaXJ0dWFsRG9tX3ZpcnR1YWxpemUoa2lkc1tpXSksIGtpZExpc3QpOwoJfQoJcmV0dXJuIEEzKF9WaXJ0dWFsRG9tX25vZGUsIHRhZywgYXR0ckxpc3QsIGtpZExpc3QpOwp9CgpmdW5jdGlvbiBfVmlydHVhbERvbV9kZWtleShrZXllZE5vZGUpCnsKCXZhciBrZXllZEtpZHMgPSBrZXllZE5vZGUuZTsKCXZhciBsZW4gPSBrZXllZEtpZHMubGVuZ3RoOwoJdmFyIGtpZHMgPSBuZXcgQXJyYXkobGVuKTsKCWZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspCgl7CgkJa2lkc1tpXSA9IGtleWVkS2lkc1tpXS5iOwoJfQoKCXJldHVybiB7CgkJJDogMSwKCQljOiBrZXllZE5vZGUuYywKCQlkOiBrZXllZE5vZGUuZCwKCQllOiBraWRzLAoJCWY6IGtleWVkTm9kZS5mLAoJCWI6IGtleWVkTm9kZS5iCgl9Owp9CgoKCnZhciBfQml0d2lzZV9hbmQgPSBGMihmdW5jdGlvbihhLCBiKQp7CglyZXR1cm4gYSAmIGI7Cn0pOwoKdmFyIF9CaXR3aXNlX29yID0gRjIoZnVuY3Rpb24oYSwgYikKewoJcmV0dXJuIGEgfCBiOwp9KTsKCnZhciBfQml0d2lzZV94b3IgPSBGMihmdW5jdGlvbihhLCBiKQp7CglyZXR1cm4gYSBeIGI7Cn0pOwoKZnVuY3Rpb24gX0JpdHdpc2VfY29tcGxlbWVudChhKQp7CglyZXR1cm4gfmE7Cn07Cgp2YXIgX0JpdHdpc2Vfc2hpZnRMZWZ0QnkgPSBGMihmdW5jdGlvbihvZmZzZXQsIGEpCnsKCXJldHVybiBhIDw8IG9mZnNldDsKfSk7Cgp2YXIgX0JpdHdpc2Vfc2hpZnRSaWdodEJ5ID0gRjIoZnVuY3Rpb24ob2Zmc2V0LCBhKQp7CglyZXR1cm4gYSA+PiBvZmZzZXQ7Cn0pOwoKdmFyIF9CaXR3aXNlX3NoaWZ0UmlnaHRaZkJ5ID0gRjIoZnVuY3Rpb24ob2Zmc2V0LCBhKQp7CglyZXR1cm4gYSA+Pj4gb2Zmc2V0Owp9KTsKCgoKCi8vIEhFTFBFUlMKCgpmdW5jdGlvbiBfRGVidWdnZXJfdW5zYWZlQ29lcmNlKHZhbHVlKQp7CglyZXR1cm4gdmFsdWU7Cn0KCgoKLy8gUFJPR1JBTVMKCgp2YXIgX0RlYnVnZ2VyX2VsZW1lbnQgPSBGNChmdW5jdGlvbihpbXBsLCBmbGFnRGVjb2RlciwgZGVidWdNZXRhZGF0YSwgYXJncykKewoJcmV0dXJuIF9QbGF0Zm9ybV9pbml0aWFsaXplKAoJCWZsYWdEZWNvZGVyLAoJCWFyZ3MsCgkJQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kd3JhcEluaXQsIF9Kc29uX3dyYXAoZGVidWdNZXRhZGF0YSksIF9EZWJ1Z2dlcl9wb3BvdXQoKSwgaW1wbC5pbml0KSwKCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR3cmFwVXBkYXRlKGltcGwudXBkYXRlKSwKCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR3cmFwU3VicyhpbXBsLnN1YnNjcmlwdGlvbnMpLAoJCWZ1bmN0aW9uKHNlbmRUb0FwcCwgaW5pdGlhbE1vZGVsKQoJCXsKCQkJdmFyIHZpZXcgPSBpbXBsLnZpZXc7CgkJCXZhciB0aXRsZSA9IF9WaXJ0dWFsRG9tX2RvYy50aXRsZTsKCQkJdmFyIGRvbU5vZGUgPSBhcmdzICYmIGFyZ3NbJ25vZGUnXSA/IGFyZ3NbJ25vZGUnXSA6IF9EZWJ1Z19jcmFzaCgwKTsKCQkJdmFyIGN1cnJOb2RlID0gX1ZpcnR1YWxEb21fdmlydHVhbGl6ZShkb21Ob2RlKTsKCQkJdmFyIGN1cnJCbG9ja2VyID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9CbG9ja2VyVHlwZShpbml0aWFsTW9kZWwpOwoJCQl2YXIgY3VyclBvcG91dDsKCgkJCXZhciBjb3JuZXJOb2RlID0gX1ZpcnR1YWxEb21fZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlkb21Ob2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNvcm5lck5vZGUsIGRvbU5vZGUubmV4dFNpYmxpbmcpOwoJCQl2YXIgY29ybmVyQ3VyciA9IF9WaXJ0dWFsRG9tX3ZpcnR1YWxpemUoY29ybmVyTm9kZSk7CgoJCQlpbml0aWFsTW9kZWwucG9wb3V0LmEgPSBzZW5kVG9BcHA7CgoJCQlyZXR1cm4gX0Jyb3dzZXJfbWFrZUFuaW1hdG9yKGluaXRpYWxNb2RlbCwgZnVuY3Rpb24obW9kZWwpCgkJCXsKCQkJCXZhciBuZXh0Tm9kZSA9IEEyKF9WaXJ0dWFsRG9tX21hcCwgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVXNlck1zZywgdmlldygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRnZXRVc2VyTW9kZWwobW9kZWwpKSk7CgkJCQl2YXIgcGF0Y2hlcyA9IF9WaXJ0dWFsRG9tX2RpZmYoY3Vyck5vZGUsIG5leHROb2RlKTsKCQkJCWRvbU5vZGUgPSBfVmlydHVhbERvbV9hcHBseVBhdGNoZXMoZG9tTm9kZSwgY3Vyck5vZGUsIHBhdGNoZXMsIHNlbmRUb0FwcCk7CgkJCQljdXJyTm9kZSA9IG5leHROb2RlOwoKCQkJCS8vIHVwZGF0ZSBibG9ja2VyCgoJCQkJdmFyIG5leHRCbG9ja2VyID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9CbG9ja2VyVHlwZShtb2RlbCk7CgkJCQlfRGVidWdnZXJfdXBkYXRlQmxvY2tlcihjdXJyQmxvY2tlciwgbmV4dEJsb2NrZXIpOwoJCQkJY3VyckJsb2NrZXIgPSBuZXh0QmxvY2tlcjsKCgkJCQkvLyB2aWV3IGNvcm5lcgoKCQkJCXZhciBjb3JuZXJOZXh0ID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kY29ybmVyVmlldyhtb2RlbCk7CgkJCQl2YXIgY29ybmVyUGF0Y2hlcyA9IF9WaXJ0dWFsRG9tX2RpZmYoY29ybmVyQ3VyciwgY29ybmVyTmV4dCk7CgkJCQljb3JuZXJOb2RlID0gX1ZpcnR1YWxEb21fYXBwbHlQYXRjaGVzKGNvcm5lck5vZGUsIGNvcm5lckN1cnIsIGNvcm5lclBhdGNoZXMsIHNlbmRUb0FwcCk7CgkJCQljb3JuZXJDdXJyID0gY29ybmVyTmV4dDsKCgkJCQlpZiAoIW1vZGVsLnBvcG91dC5iKQoJCQkJewoJCQkJCWN1cnJQb3BvdXQgPSB1bmRlZmluZWQ7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCS8vIHZpZXcgcG9wb3V0CgoJCQkJX1ZpcnR1YWxEb21fZG9jID0gbW9kZWwucG9wb3V0LmI7IC8vIFNXSVRDSCBUTyBQT1BPVVQgRE9DCgkJCQljdXJyUG9wb3V0IHx8IChjdXJyUG9wb3V0ID0gX1ZpcnR1YWxEb21fdmlydHVhbGl6ZShtb2RlbC5wb3BvdXQuYikpOwoJCQkJdmFyIG5leHRQb3BvdXQgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRwb3BvdXRWaWV3KG1vZGVsKTsKCQkJCXZhciBwb3BvdXRQYXRjaGVzID0gX1ZpcnR1YWxEb21fZGlmZihjdXJyUG9wb3V0LCBuZXh0UG9wb3V0KTsKCQkJCV9WaXJ0dWFsRG9tX2FwcGx5UGF0Y2hlcyhtb2RlbC5wb3BvdXQuYi5ib2R5LCBjdXJyUG9wb3V0LCBwb3BvdXRQYXRjaGVzLCBzZW5kVG9BcHApOwoJCQkJY3VyclBvcG91dCA9IG5leHRQb3BvdXQ7CgkJCQlfVmlydHVhbERvbV9kb2MgPSBkb2N1bWVudDsgLy8gU1dJVENIIEJBQ0sgVE8gTk9STUFMIERPQwoJCQl9KTsKCQl9CgkpOwp9KTsKCgp2YXIgX0RlYnVnZ2VyX2RvY3VtZW50ID0gRjQoZnVuY3Rpb24oaW1wbCwgZmxhZ0RlY29kZXIsIGRlYnVnTWV0YWRhdGEsIGFyZ3MpCnsKCXJldHVybiBfUGxhdGZvcm1faW5pdGlhbGl6ZSgKCQlmbGFnRGVjb2RlciwKCQlhcmdzLAoJCUEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHdyYXBJbml0LCBfSnNvbl93cmFwKGRlYnVnTWV0YWRhdGEpLCBfRGVidWdnZXJfcG9wb3V0KCksIGltcGwuaW5pdCksCgkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kd3JhcFVwZGF0ZShpbXBsLnVwZGF0ZSksCgkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kd3JhcFN1YnMoaW1wbC5zdWJzY3JpcHRpb25zKSwKCQlmdW5jdGlvbihzZW5kVG9BcHAsIGluaXRpYWxNb2RlbCkKCQl7CgkJCXZhciBkaXZlcnRIcmVmVG9BcHAgPSBpbXBsLnNldHVwICYmIGltcGwuc2V0dXAoZnVuY3Rpb24oeCkgeyByZXR1cm4gc2VuZFRvQXBwKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFVzZXJNc2coeCkpOyB9KTsKCQkJdmFyIHZpZXcgPSBpbXBsLnZpZXc7CgkJCXZhciB0aXRsZSA9IF9WaXJ0dWFsRG9tX2RvYy50aXRsZTsKCQkJdmFyIGJvZHlOb2RlID0gX1ZpcnR1YWxEb21fZG9jLmJvZHk7CgkJCXZhciBjdXJyTm9kZSA9IF9WaXJ0dWFsRG9tX3ZpcnR1YWxpemUoYm9keU5vZGUpOwoJCQl2YXIgY3VyckJsb2NrZXIgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR0b0Jsb2NrZXJUeXBlKGluaXRpYWxNb2RlbCk7CgkJCXZhciBjdXJyUG9wb3V0OwoKCQkJaW5pdGlhbE1vZGVsLnBvcG91dC5hID0gc2VuZFRvQXBwOwoKCQkJcmV0dXJuIF9Ccm93c2VyX21ha2VBbmltYXRvcihpbml0aWFsTW9kZWwsIGZ1bmN0aW9uKG1vZGVsKQoJCQl7CgkJCQlfVmlydHVhbERvbV9kaXZlcnRIcmVmVG9BcHAgPSBkaXZlcnRIcmVmVG9BcHA7CgkJCQl2YXIgZG9jID0gdmlldygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRnZXRVc2VyTW9kZWwobW9kZWwpKTsKCQkJCXZhciBuZXh0Tm9kZSA9IF9WaXJ0dWFsRG9tX25vZGUoJ2JvZHknKShfTGlzdF9OaWwpKAoJCQkJCV9VdGlsc19hcCgKCQkJCQkJQTIoJGVsbSRjb3JlJExpc3QkbWFwLCBfVmlydHVhbERvbV9tYXAoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVXNlck1zZyksIGRvYy5ib2R5KSwKCQkJCQkJX0xpc3RfQ29ucygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRjb3JuZXJWaWV3KG1vZGVsKSwgX0xpc3RfTmlsKQoJCQkJCSkKCQkJCSk7CgkJCQl2YXIgcGF0Y2hlcyA9IF9WaXJ0dWFsRG9tX2RpZmYoY3Vyck5vZGUsIG5leHROb2RlKTsKCQkJCWJvZHlOb2RlID0gX1ZpcnR1YWxEb21fYXBwbHlQYXRjaGVzKGJvZHlOb2RlLCBjdXJyTm9kZSwgcGF0Y2hlcywgc2VuZFRvQXBwKTsKCQkJCWN1cnJOb2RlID0gbmV4dE5vZGU7CgkJCQlfVmlydHVhbERvbV9kaXZlcnRIcmVmVG9BcHAgPSAwOwoJCQkJKHRpdGxlICE9PSBkb2MudGl0bGUpICYmIChfVmlydHVhbERvbV9kb2MudGl0bGUgPSB0aXRsZSA9IGRvYy50aXRsZSk7CgoJCQkJLy8gdXBkYXRlIGJsb2NrZXIKCgkJCQl2YXIgbmV4dEJsb2NrZXIgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR0b0Jsb2NrZXJUeXBlKG1vZGVsKTsKCQkJCV9EZWJ1Z2dlcl91cGRhdGVCbG9ja2VyKGN1cnJCbG9ja2VyLCBuZXh0QmxvY2tlcik7CgkJCQljdXJyQmxvY2tlciA9IG5leHRCbG9ja2VyOwoKCQkJCS8vIHZpZXcgcG9wb3V0CgoJCQkJaWYgKCFtb2RlbC5wb3BvdXQuYikgeyBjdXJyUG9wb3V0ID0gdW5kZWZpbmVkOyByZXR1cm47IH0KCgkJCQlfVmlydHVhbERvbV9kb2MgPSBtb2RlbC5wb3BvdXQuYjsgLy8gU1dJVENIIFRPIFBPUE9VVCBET0MKCQkJCWN1cnJQb3BvdXQgfHwgKGN1cnJQb3BvdXQgPSBfVmlydHVhbERvbV92aXJ0dWFsaXplKG1vZGVsLnBvcG91dC5iKSk7CgkJCQl2YXIgbmV4dFBvcG91dCA9ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHBvcG91dFZpZXcobW9kZWwpOwoJCQkJdmFyIHBvcG91dFBhdGNoZXMgPSBfVmlydHVhbERvbV9kaWZmKGN1cnJQb3BvdXQsIG5leHRQb3BvdXQpOwoJCQkJX1ZpcnR1YWxEb21fYXBwbHlQYXRjaGVzKG1vZGVsLnBvcG91dC5iLmJvZHksIGN1cnJQb3BvdXQsIHBvcG91dFBhdGNoZXMsIHNlbmRUb0FwcCk7CgkJCQljdXJyUG9wb3V0ID0gbmV4dFBvcG91dDsKCQkJCV9WaXJ0dWFsRG9tX2RvYyA9IGRvY3VtZW50OyAvLyBTV0lUQ0ggQkFDSyBUTyBOT1JNQUwgRE9DCgkJCX0pOwoJCX0KCSk7Cn0pOwoKCmZ1bmN0aW9uIF9EZWJ1Z2dlcl9wb3BvdXQoKQp7CglyZXR1cm4gewoJCWI6IHVuZGVmaW5lZCwKCQlhOiB1bmRlZmluZWQKCX07Cn0KCmZ1bmN0aW9uIF9EZWJ1Z2dlcl9pc09wZW4ocG9wb3V0KQp7CglyZXR1cm4gISFwb3BvdXQuYjsKfQoKZnVuY3Rpb24gX0RlYnVnZ2VyX29wZW4ocG9wb3V0KQp7CglyZXR1cm4gX1NjaGVkdWxlcl9iaW5kaW5nKGZ1bmN0aW9uKGNhbGxiYWNrKQoJewoJCV9EZWJ1Z2dlcl9vcGVuV2luZG93KHBvcG91dCk7CgkJY2FsbGJhY2soX1NjaGVkdWxlcl9zdWNjZWVkKF9VdGlsc19UdXBsZTApKTsKCX0pOwp9CgpmdW5jdGlvbiBfRGVidWdnZXJfb3BlbldpbmRvdyhwb3BvdXQpCnsKCXZhciB3ID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kaW5pdGlhbFdpbmRvd1dpZHRoLAoJCWggPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRpbml0aWFsV2luZG93SGVpZ2h0LAoJIAl4ID0gc2NyZWVuLndpZHRoIC0gdywKCQl5ID0gc2NyZWVuLmhlaWdodCAtIGg7CgoJdmFyIGRlYnVnZ2VyV2luZG93ID0gd2luZG93Lm9wZW4oJycsICcnLCAnd2lkdGg9JyArIHcgKyAnLGhlaWdodD0nICsgaCArICcsbGVmdD0nICsgeCArICcsdG9wPScgKyB5KTsKCXZhciBkb2MgPSBkZWJ1Z2dlcldpbmRvdy5kb2N1bWVudDsKCWRvYy50aXRsZSA9ICdFbG0gRGVidWdnZXInOwoKCS8vIGhhbmRsZSBhcnJvdyBrZXlzCglkb2MuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGV2ZW50KSB7CgkJZXZlbnQubWV0YUtleSAmJiBldmVudC53aGljaCA9PT0gODIgJiYgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwoJCWV2ZW50LmtleSA9PT0gJ0Fycm93VXAnICAgJiYgKHBvcG91dC5hKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFVwICApLCBldmVudC5wcmV2ZW50RGVmYXVsdCgpKTsKCQlldmVudC5rZXkgPT09ICdBcnJvd0Rvd24nICYmIChwb3BvdXQuYSgkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiREb3duKSwgZXZlbnQucHJldmVudERlZmF1bHQoKSk7Cgl9KTsKCgkvLyBoYW5kbGUgd2luZG93IGNsb3NlCgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndW5sb2FkJywgY2xvc2UpOwoJZGVidWdnZXJXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndW5sb2FkJywgZnVuY3Rpb24oKSB7CgkJcG9wb3V0LmIgPSB1bmRlZmluZWQ7CgkJcG9wb3V0LmEoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kTm9PcCk7CgkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3VubG9hZCcsIGNsb3NlKTsKCX0pOwoKCWZ1bmN0aW9uIGNsb3NlKCkgewoJCXBvcG91dC5iID0gdW5kZWZpbmVkOwoJCXBvcG91dC5hKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJE5vT3ApOwoJCWRlYnVnZ2VyV2luZG93LmNsb3NlKCk7Cgl9CgoJLy8gcmVnaXN0ZXIgbmV3IHdpbmRvdwoJcG9wb3V0LmIgPSBkb2M7Cn0KCgoKLy8gU0NST0xMCgoKZnVuY3Rpb24gX0RlYnVnZ2VyX3Njcm9sbChwb3BvdXQpCnsKCXJldHVybiBfU2NoZWR1bGVyX2JpbmRpbmcoZnVuY3Rpb24oY2FsbGJhY2spCgl7CgkJaWYgKHBvcG91dC5iKQoJCXsKCQkJdmFyIG1zZ3MgPSBwb3BvdXQuYi5nZXRFbGVtZW50QnlJZCgnZWxtLWRlYnVnZ2VyLXNpZGViYXInKTsKCQkJaWYgKG1zZ3MgJiYgbXNncy5zY3JvbGxUb3AgIT09IDApCgkJCXsKCQkJCW1zZ3Muc2Nyb2xsVG9wID0gMDsKCQkJfQoJCX0KCQljYWxsYmFjayhfU2NoZWR1bGVyX3N1Y2NlZWQoX1V0aWxzX1R1cGxlMCkpOwoJfSk7Cn0KCgp2YXIgX0RlYnVnZ2VyX3Njcm9sbFRvID0gRjIoZnVuY3Rpb24oaWQsIHBvcG91dCkKewoJcmV0dXJuIF9TY2hlZHVsZXJfYmluZGluZyhmdW5jdGlvbihjYWxsYmFjaykKCXsKCQlpZiAocG9wb3V0LmIpCgkJewoJCQl2YXIgbXNnID0gcG9wb3V0LmIuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJCQlpZiAobXNnKQoJCQl7CgkJCQltc2cuc2Nyb2xsSW50b1ZpZXcoZmFsc2UpOwoJCQl9CgkJfQoJCWNhbGxiYWNrKF9TY2hlZHVsZXJfc3VjY2VlZChfVXRpbHNfVHVwbGUwKSk7Cgl9KTsKfSk7CgoKCi8vIFVQTE9BRAoKCmZ1bmN0aW9uIF9EZWJ1Z2dlcl91cGxvYWQocG9wb3V0KQp7CglyZXR1cm4gX1NjaGVkdWxlcl9iaW5kaW5nKGZ1bmN0aW9uKGNhbGxiYWNrKQoJewoJCXZhciBkb2MgPSBwb3BvdXQuYiB8fCBkb2N1bWVudDsKCQl2YXIgZWxlbWVudCA9IGRvYy5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJCWVsZW1lbnQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2ZpbGUnKTsKCQllbGVtZW50LnNldEF0dHJpYnV0ZSgnYWNjZXB0JywgJ3RleHQvanNvbicpOwoJCWVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQllbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKGV2ZW50KQoJCXsKCQkJdmFyIGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoJCQlmaWxlUmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpCgkJCXsKCQkJCWNhbGxiYWNrKF9TY2hlZHVsZXJfc3VjY2VlZChlLnRhcmdldC5yZXN1bHQpKTsKCQkJfTsKCQkJZmlsZVJlYWRlci5yZWFkQXNUZXh0KGV2ZW50LnRhcmdldC5maWxlc1swXSk7CgkJCWRvYy5ib2R5LnJlbW92ZUNoaWxkKGVsZW1lbnQpOwoJCX0pOwoJCWRvYy5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpOwoJCWVsZW1lbnQuY2xpY2soKTsKCX0pOwp9CgoKCi8vIERPV05MT0FECgoKdmFyIF9EZWJ1Z2dlcl9kb3dubG9hZCA9IEYyKGZ1bmN0aW9uKGhpc3RvcnlMZW5ndGgsIGpzb24pCnsKCXJldHVybiBfU2NoZWR1bGVyX2JpbmRpbmcoZnVuY3Rpb24oY2FsbGJhY2spCgl7CgkJdmFyIGZpbGVOYW1lID0gJ2hpc3RvcnktJyArIGhpc3RvcnlMZW5ndGggKyAnLnR4dCc7CgkJdmFyIGpzb25TdHJpbmcgPSBKU09OLnN0cmluZ2lmeShqc29uKTsKCQl2YXIgbWltZSA9ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgnOwoJCXZhciBkb25lID0gX1NjaGVkdWxlcl9zdWNjZWVkKF9VdGlsc19UdXBsZTApOwoKCQkvLyBmb3IgSUUxMCsKCQlpZiAobmF2aWdhdG9yLm1zU2F2ZUJsb2IpCgkJewoJCQluYXZpZ2F0b3IubXNTYXZlQmxvYihuZXcgQmxvYihbanNvblN0cmluZ10sIHt0eXBlOiBtaW1lfSksIGZpbGVOYW1lKTsKCQkJcmV0dXJuIGNhbGxiYWNrKGRvbmUpOwoJCX0KCgkJLy8gZm9yIEhUTUw1CgkJdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CgkJZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCAnZGF0YTonICsgbWltZSArICcsJyArIGVuY29kZVVSSUNvbXBvbmVudChqc29uU3RyaW5nKSk7CgkJZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgZmlsZU5hbWUpOwoJCWVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpOwoJCWVsZW1lbnQuY2xpY2soKTsKCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW1lbnQpOwoJCWNhbGxiYWNrKGRvbmUpOwoJfSk7Cn0pOwoKCgovLyBQT1BPVVQgQ09OVEVOVAoKCmZ1bmN0aW9uIF9EZWJ1Z2dlcl9tZXNzYWdlVG9TdHJpbmcodmFsdWUpCnsKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykKCXsKCQlyZXR1cm4gdmFsdWUgPyAnVHJ1ZScgOiAnRmFsc2UnOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKQoJewoJCXJldHVybiB2YWx1ZSArICcnOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKQoJewoJCXJldHVybiAnIicgKyBfRGVidWdnZXJfYWRkU2xhc2hlcyh2YWx1ZSwgZmFsc2UpICsgJyInOwoJfQoKCWlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZykKCXsKCQlyZXR1cm4gIiciICsgX0RlYnVnZ2VyX2FkZFNsYXNoZXModmFsdWUsIHRydWUpICsgIiciOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnIHx8IHZhbHVlID09PSBudWxsIHx8ICEoJyQnIGluIHZhbHVlKSkKCXsKCQlyZXR1cm4gJ+KApic7Cgl9CgoJaWYgKHR5cGVvZiB2YWx1ZS4kID09PSAnbnVtYmVyJykKCXsKCQlyZXR1cm4gJ+KApic7Cgl9CgoJdmFyIGNvZGUgPSB2YWx1ZS4kLmNoYXJDb2RlQXQoMCk7CglpZiAoY29kZSA9PT0gMHgyMyAvKiAjICovIHx8IC8qIGEgKi8gMHg2MSA8PSBjb2RlICYmIGNvZGUgPD0gMHg3QSAvKiB6ICovKQoJewoJCXJldHVybiAn4oCmJzsKCX0KCglpZiAoWydBcnJheV9lbG1fYnVpbHRpbicsICdTZXRfZWxtX2J1aWx0aW4nLCAnUkJOb2RlX2VsbV9idWlsdGluJywgJ1JCRW1wdHlfZWxtX2J1aWx0aW4nXS5pbmRleE9mKHZhbHVlLiQpID49IDApCgl7CgkJcmV0dXJuICfigKYnOwoJfQoKCXZhciBrZXlzID0gT2JqZWN0LmtleXModmFsdWUpOwoJc3dpdGNoIChrZXlzLmxlbmd0aCkKCXsKCQljYXNlIDE6CgkJCXJldHVybiB2YWx1ZS4kOwoJCWNhc2UgMjoKCQkJcmV0dXJuIHZhbHVlLiQgKyAnICcgKyBfRGVidWdnZXJfbWVzc2FnZVRvU3RyaW5nKHZhbHVlLmEpOwoJCWRlZmF1bHQ6CgkJCXJldHVybiB2YWx1ZS4kICsgJyDigKYgJyArIF9EZWJ1Z2dlcl9tZXNzYWdlVG9TdHJpbmcodmFsdWVba2V5c1trZXlzLmxlbmd0aCAtIDFdXSk7Cgl9Cn0KCgpmdW5jdGlvbiBfRGVidWdnZXJfaW5pdCh2YWx1ZSkKewoJaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKQoJewoJCXJldHVybiBBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRDb25zdHJ1Y3RvciwgJGVsbSRjb3JlJE1heWJlJEp1c3QodmFsdWUgPyAnVHJ1ZScgOiAnRmFsc2UnKSwgdHJ1ZSwgX0xpc3RfTmlsKTsKCX0KCglpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykKCXsKCQlyZXR1cm4gJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kUHJpbWl0aXZlKHZhbHVlICsgJycpOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKQoJewoJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRTKCciJyArIF9EZWJ1Z2dlcl9hZGRTbGFzaGVzKHZhbHVlLCBmYWxzZSkgKyAnIicpOwoJfQoKCWlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZykKCXsKCQlyZXR1cm4gJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kUygiJyIgKyBfRGVidWdnZXJfYWRkU2xhc2hlcyh2YWx1ZSwgdHJ1ZSkgKyAiJyIpOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmICckJyBpbiB2YWx1ZSkKCXsKCQl2YXIgdGFnID0gdmFsdWUuJDsKCgkJaWYgKHRhZyA9PT0gJzo6JyB8fCB0YWcgPT09ICdbXScpCgkJewoJCQlyZXR1cm4gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kU2VxdWVuY2UsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJExpc3RTZXEsIHRydWUsCgkJCQlBMigkZWxtJGNvcmUkTGlzdCRtYXAsIF9EZWJ1Z2dlcl9pbml0LCB2YWx1ZSkKCQkJKTsKCQl9CgoJCWlmICh0YWcgPT09ICdTZXRfZWxtX2J1aWx0aW4nKQoJCXsKCQkJcmV0dXJuIEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFNlcXVlbmNlLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRTZXRTZXEsIHRydWUsCgkJCQlBMygkZWxtJGNvcmUkU2V0JGZvbGRyLCBfRGVidWdnZXJfaW5pdENvbnMsIF9MaXN0X05pbCwgdmFsdWUpCgkJCSk7CgkJfQoKCQlpZiAodGFnID09PSAnUkJOb2RlX2VsbV9idWlsdGluJyB8fCB0YWcgPT0gJ1JCRW1wdHlfZWxtX2J1aWx0aW4nKQoJCXsKCQkJcmV0dXJuIEEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJERpY3Rpb25hcnksIHRydWUsCgkJCQlBMygkZWxtJGNvcmUkRGljdCRmb2xkciwgX0RlYnVnZ2VyX2luaXRLZXlWYWx1ZUNvbnMsIF9MaXN0X05pbCwgdmFsdWUpCgkJCSk7CgkJfQoKCQlpZiAodGFnID09PSAnQXJyYXlfZWxtX2J1aWx0aW4nKQoJCXsKCQkJcmV0dXJuIEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFNlcXVlbmNlLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRBcnJheVNlcSwgdHJ1ZSwKCQkJCUEzKCRlbG0kY29yZSRBcnJheSRmb2xkciwgX0RlYnVnZ2VyX2luaXRDb25zLCBfTGlzdF9OaWwsIHZhbHVlKQoJCQkpOwoJCX0KCgkJaWYgKHR5cGVvZiB0YWcgPT09ICdudW1iZXInKQoJCXsKCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFByaW1pdGl2ZSgnPGludGVybmFscz4nKTsKCQl9CgoJCXZhciBjaGFyID0gdGFnLmNoYXJDb2RlQXQoMCk7CgkJaWYgKGNoYXIgPT09IDM1IHx8IDY1IDw9IGNoYXIgJiYgY2hhciA8PSA5MCkKCQl7CgkJCXZhciBsaXN0ID0gX0xpc3RfTmlsOwoJCQlmb3IgKHZhciBpIGluIHZhbHVlKQoJCQl7CgkJCQlpZiAoaSA9PT0gJyQnKSBjb250aW51ZTsKCQkJCWxpc3QgPSBfTGlzdF9Db25zKF9EZWJ1Z2dlcl9pbml0KHZhbHVlW2ldKSwgbGlzdCk7CgkJCX0KCQkJcmV0dXJuIEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJENvbnN0cnVjdG9yLCBjaGFyID09PSAzNSA/ICRlbG0kY29yZSRNYXliZSROb3RoaW5nIDogJGVsbSRjb3JlJE1heWJlJEp1c3QodGFnKSwgdHJ1ZSwgJGVsbSRjb3JlJExpc3QkcmV2ZXJzZShsaXN0KSk7CgkJfQoKCQlyZXR1cm4gJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kUHJpbWl0aXZlKCc8aW50ZXJuYWxzPicpOwoJfQoKCWlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKQoJewoJCXZhciBkaWN0ID0gJGVsbSRjb3JlJERpY3QkZW1wdHk7CgkJZm9yICh2YXIgaSBpbiB2YWx1ZSkKCQl7CgkJCWRpY3QgPSBBMygkZWxtJGNvcmUkRGljdCRpbnNlcnQsIGksIF9EZWJ1Z2dlcl9pbml0KHZhbHVlW2ldKSwgZGljdCk7CgkJfQoJCXJldHVybiBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRSZWNvcmQsIHRydWUsIGRpY3QpOwoJfQoKCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRQcmltaXRpdmUoJzxpbnRlcm5hbHM+Jyk7Cn0KCnZhciBfRGVidWdnZXJfaW5pdENvbnMgPSBGMihmdW5jdGlvbiBpbml0Q29uc0hlbHAodmFsdWUsIGxpc3QpCnsKCXJldHVybiBfTGlzdF9Db25zKF9EZWJ1Z2dlcl9pbml0KHZhbHVlKSwgbGlzdCk7Cn0pOwoKdmFyIF9EZWJ1Z2dlcl9pbml0S2V5VmFsdWVDb25zID0gRjMoZnVuY3Rpb24oa2V5LCB2YWx1ZSwgbGlzdCkKewoJcmV0dXJuIF9MaXN0X0NvbnMoCgkJX1V0aWxzX1R1cGxlMihfRGVidWdnZXJfaW5pdChrZXkpLCBfRGVidWdnZXJfaW5pdCh2YWx1ZSkpLAoJCWxpc3QKCSk7Cn0pOwoKZnVuY3Rpb24gX0RlYnVnZ2VyX2FkZFNsYXNoZXMoc3RyLCBpc0NoYXIpCnsKCXZhciBzID0gc3RyCgkJLnJlcGxhY2UoL1xcL2csICdcXFxcJykKCQkucmVwbGFjZSgvXG4vZywgJ1xcbicpCgkJLnJlcGxhY2UoL1x0L2csICdcXHQnKQoJCS5yZXBsYWNlKC9cci9nLCAnXFxyJykKCQkucmVwbGFjZSgvXHYvZywgJ1xcdicpCgkJLnJlcGxhY2UoL1wwL2csICdcXDAnKTsKCWlmIChpc0NoYXIpCgl7CgkJcmV0dXJuIHMucmVwbGFjZSgvXCcvZywgJ1xcXCcnKTsKCX0KCWVsc2UKCXsKCQlyZXR1cm4gcy5yZXBsYWNlKC9cIi9nLCAnXFwiJyk7Cgl9Cn0KCgoKLy8gQkxPQ0sgRVZFTlRTCgoKZnVuY3Rpb24gX0RlYnVnZ2VyX3VwZGF0ZUJsb2NrZXIob2xkQmxvY2tlciwgbmV3QmxvY2tlcikKewoJaWYgKG9sZEJsb2NrZXIgPT09IG5ld0Jsb2NrZXIpIHJldHVybjsKCgl2YXIgb2xkRXZlbnRzID0gX0RlYnVnZ2VyX2Jsb2NrZXJUb0V2ZW50cyhvbGRCbG9ja2VyKTsKCXZhciBuZXdFdmVudHMgPSBfRGVidWdnZXJfYmxvY2tlclRvRXZlbnRzKG5ld0Jsb2NrZXIpOwoKCS8vIHJlbW92ZSBvbGQgYmxvY2tlcnMKCWZvciAodmFyIGkgPSAwOyBpIDwgb2xkRXZlbnRzLmxlbmd0aDsgaSsrKQoJewoJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIob2xkRXZlbnRzW2ldLCBfRGVidWdnZXJfYmxvY2tlciwgdHJ1ZSk7Cgl9CgoJLy8gYWRkIG5ldyBibG9ja2VycwoJZm9yICh2YXIgaSA9IDA7IGkgPCBuZXdFdmVudHMubGVuZ3RoOyBpKyspCgl7CgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihuZXdFdmVudHNbaV0sIF9EZWJ1Z2dlcl9ibG9ja2VyLCB0cnVlKTsKCX0KfQoKCmZ1bmN0aW9uIF9EZWJ1Z2dlcl9ibG9ja2VyKGV2ZW50KQp7CglpZiAoZXZlbnQudHlwZSA9PT0gJ2tleWRvd24nICYmIGV2ZW50Lm1ldGFLZXkgJiYgZXZlbnQud2hpY2ggPT09IDgyKQoJewoJCXJldHVybjsKCX0KCgl2YXIgaXNTY3JvbGwgPSBldmVudC50eXBlID09PSAnc2Nyb2xsJyB8fCBldmVudC50eXBlID09PSAnd2hlZWwnOwoJZm9yICh2YXIgbm9kZSA9IGV2ZW50LnRhcmdldDsgbm9kZTsgbm9kZSA9IG5vZGUucGFyZW50Tm9kZSkKCXsKCQlpZiAoaXNTY3JvbGwgPyBub2RlLmlkID09PSAnZWxtLWRlYnVnZ2VyLWRldGFpbHMnIDogbm9kZS5pZCA9PT0gJ2VsbS1kZWJ1Z2dlci1vdmVybGF5JykKCQl7CgkJCXJldHVybjsKCQl9Cgl9CgoJZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CglldmVudC5wcmV2ZW50RGVmYXVsdCgpOwp9CgpmdW5jdGlvbiBfRGVidWdnZXJfYmxvY2tlclRvRXZlbnRzKGJsb2NrZXIpCnsKCXJldHVybiBibG9ja2VyID09PSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRCbG9ja05vbmUKCQk/IFtdCgkJOiBibG9ja2VyID09PSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRCbG9ja01vc3QKCQkJPyBfRGVidWdnZXJfbW9zdEV2ZW50cwoJCQk6IF9EZWJ1Z2dlcl9hbGxFdmVudHM7Cn0KCnZhciBfRGVidWdnZXJfbW9zdEV2ZW50cyA9IFsKCSdjbGljaycsICdkYmxjbGljaycsICdtb3VzZW1vdmUnLAoJJ21vdXNldXAnLCAnbW91c2Vkb3duJywgJ21vdXNlZW50ZXInLCAnbW91c2VsZWF2ZScsCgkndG91Y2hzdGFydCcsICd0b3VjaGVuZCcsICd0b3VjaGNhbmNlbCcsICd0b3VjaG1vdmUnLAoJJ3BvaW50ZXJkb3duJywgJ3BvaW50ZXJ1cCcsICdwb2ludGVyb3ZlcicsICdwb2ludGVyb3V0JywKCSdwb2ludGVyZW50ZXInLCAncG9pbnRlcmxlYXZlJywgJ3BvaW50ZXJtb3ZlJywgJ3BvaW50ZXJjYW5jZWwnLAoJJ2RyYWdzdGFydCcsICdkcmFnJywgJ2RyYWdlbmQnLCAnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJywKCSdrZXl1cCcsICdrZXlkb3duJywgJ2tleXByZXNzJywKCSdpbnB1dCcsICdjaGFuZ2UnLAoJJ2ZvY3VzJywgJ2JsdXInCl07Cgp2YXIgX0RlYnVnZ2VyX2FsbEV2ZW50cyA9IF9EZWJ1Z2dlcl9tb3N0RXZlbnRzLmNvbmNhdCgnd2hlZWwnLCAnc2Nyb2xsJyk7CgoKCgovLyBFTEVNRU5UCgoKdmFyIF9EZWJ1Z2dlcl9lbGVtZW50OwoKdmFyIF9Ccm93c2VyX2VsZW1lbnQgPSBfRGVidWdnZXJfZWxlbWVudCB8fCBGNChmdW5jdGlvbihpbXBsLCBmbGFnRGVjb2RlciwgZGVidWdNZXRhZGF0YSwgYXJncykKewoJcmV0dXJuIF9QbGF0Zm9ybV9pbml0aWFsaXplKAoJCWZsYWdEZWNvZGVyLAoJCWFyZ3MsCgkJaW1wbC5pbml0LAoJCWltcGwudXBkYXRlLAoJCWltcGwuc3Vic2NyaXB0aW9ucywKCQlmdW5jdGlvbihzZW5kVG9BcHAsIGluaXRpYWxNb2RlbCkgewoJCQl2YXIgdmlldyA9IGltcGwudmlldzsKCQkJLyoqX1VOVVNFRC8KCQkJdmFyIGRvbU5vZGUgPSBhcmdzWydub2RlJ107CgkJCS8vKi8KCQkJLyoqLwoJCQl2YXIgZG9tTm9kZSA9IGFyZ3MgJiYgYXJnc1snbm9kZSddID8gYXJnc1snbm9kZSddIDogX0RlYnVnX2NyYXNoKDApOwoJCQkvLyovCgkJCXZhciBjdXJyTm9kZSA9IF9WaXJ0dWFsRG9tX3ZpcnR1YWxpemUoZG9tTm9kZSk7CgoJCQlyZXR1cm4gX0Jyb3dzZXJfbWFrZUFuaW1hdG9yKGluaXRpYWxNb2RlbCwgZnVuY3Rpb24obW9kZWwpCgkJCXsKCQkJCXZhciBuZXh0Tm9kZSA9IHZpZXcobW9kZWwpOwoJCQkJdmFyIHBhdGNoZXMgPSBfVmlydHVhbERvbV9kaWZmKGN1cnJOb2RlLCBuZXh0Tm9kZSk7CgkJCQlkb21Ob2RlID0gX1ZpcnR1YWxEb21fYXBwbHlQYXRjaGVzKGRvbU5vZGUsIGN1cnJOb2RlLCBwYXRjaGVzLCBzZW5kVG9BcHApOwoJCQkJY3Vyck5vZGUgPSBuZXh0Tm9kZTsKCQkJfSk7CgkJfQoJKTsKfSk7CgoKCi8vIERPQ1VNRU5UCgoKdmFyIF9EZWJ1Z2dlcl9kb2N1bWVudDsKCnZhciBfQnJvd3Nlcl9kb2N1bWVudCA9IF9EZWJ1Z2dlcl9kb2N1bWVudCB8fCBGNChmdW5jdGlvbihpbXBsLCBmbGFnRGVjb2RlciwgZGVidWdNZXRhZGF0YSwgYXJncykKewoJcmV0dXJuIF9QbGF0Zm9ybV9pbml0aWFsaXplKAoJCWZsYWdEZWNvZGVyLAoJCWFyZ3MsCgkJaW1wbC5pbml0LAoJCWltcGwudXBkYXRlLAoJCWltcGwuc3Vic2NyaXB0aW9ucywKCQlmdW5jdGlvbihzZW5kVG9BcHAsIGluaXRpYWxNb2RlbCkgewoJCQl2YXIgZGl2ZXJ0SHJlZlRvQXBwID0gaW1wbC5zZXR1cCAmJiBpbXBsLnNldHVwKHNlbmRUb0FwcCkKCQkJdmFyIHZpZXcgPSBpbXBsLnZpZXc7CgkJCXZhciB0aXRsZSA9IF9WaXJ0dWFsRG9tX2RvYy50aXRsZTsKCQkJdmFyIGJvZHlOb2RlID0gX1ZpcnR1YWxEb21fZG9jLmJvZHk7CgkJCXZhciBjdXJyTm9kZSA9IF9WaXJ0dWFsRG9tX3ZpcnR1YWxpemUoYm9keU5vZGUpOwoJCQlyZXR1cm4gX0Jyb3dzZXJfbWFrZUFuaW1hdG9yKGluaXRpYWxNb2RlbCwgZnVuY3Rpb24obW9kZWwpCgkJCXsKCQkJCV9WaXJ0dWFsRG9tX2RpdmVydEhyZWZUb0FwcCA9IGRpdmVydEhyZWZUb0FwcDsKCQkJCXZhciBkb2MgPSB2aWV3KG1vZGVsKTsKCQkJCXZhciBuZXh0Tm9kZSA9IF9WaXJ0dWFsRG9tX25vZGUoJ2JvZHknKShfTGlzdF9OaWwpKGRvYy5ib2R5KTsKCQkJCXZhciBwYXRjaGVzID0gX1ZpcnR1YWxEb21fZGlmZihjdXJyTm9kZSwgbmV4dE5vZGUpOwoJCQkJYm9keU5vZGUgPSBfVmlydHVhbERvbV9hcHBseVBhdGNoZXMoYm9keU5vZGUsIGN1cnJOb2RlLCBwYXRjaGVzLCBzZW5kVG9BcHApOwoJCQkJY3Vyck5vZGUgPSBuZXh0Tm9kZTsKCQkJCV9WaXJ0dWFsRG9tX2RpdmVydEhyZWZUb0FwcCA9IDA7CgkJCQkodGl0bGUgIT09IGRvYy50aXRsZSkgJiYgKF9WaXJ0dWFsRG9tX2RvYy50aXRsZSA9IHRpdGxlID0gZG9jLnRpdGxlKTsKCQkJfSk7CgkJfQoJKTsKfSk7CgoKCi8vIEFOSU1BVElPTgoKCnZhciBfQnJvd3Nlcl9jYW5jZWxBbmltYXRpb25GcmFtZSA9Cgl0eXBlb2YgY2FuY2VsQW5pbWF0aW9uRnJhbWUgIT09ICd1bmRlZmluZWQnCgkJPyBjYW5jZWxBbmltYXRpb25GcmFtZQoJCTogZnVuY3Rpb24oaWQpIHsgY2xlYXJUaW1lb3V0KGlkKTsgfTsKCnZhciBfQnJvd3Nlcl9yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPQoJdHlwZW9mIHJlcXVlc3RBbmltYXRpb25GcmFtZSAhPT0gJ3VuZGVmaW5lZCcKCQk/IHJlcXVlc3RBbmltYXRpb25GcmFtZQoJCTogZnVuY3Rpb24oY2FsbGJhY2spIHsgcmV0dXJuIHNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyA2MCk7IH07CgoKZnVuY3Rpb24gX0Jyb3dzZXJfbWFrZUFuaW1hdG9yKG1vZGVsLCBkcmF3KQp7CglkcmF3KG1vZGVsKTsKCgl2YXIgc3RhdGUgPSAwOwoKCWZ1bmN0aW9uIHVwZGF0ZUlmTmVlZGVkKCkKCXsKCQlzdGF0ZSA9IHN0YXRlID09PSAxCgkJCT8gMAoJCQk6ICggX0Jyb3dzZXJfcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHVwZGF0ZUlmTmVlZGVkKSwgZHJhdyhtb2RlbCksIDEgKTsKCX0KCglyZXR1cm4gZnVuY3Rpb24obmV4dE1vZGVsLCBpc1N5bmMpCgl7CgkJbW9kZWwgPSBuZXh0TW9kZWw7CgoJCWlzU3luYwoJCQk/ICggZHJhdyhtb2RlbCksCgkJCQlzdGF0ZSA9PT0gMiAmJiAoc3RhdGUgPSAxKQoJCQkJKQoJCQk6ICggc3RhdGUgPT09IDAgJiYgX0Jyb3dzZXJfcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHVwZGF0ZUlmTmVlZGVkKSwKCQkJCXN0YXRlID0gMgoJCQkJKTsKCX07Cn0KCgoKLy8gQVBQTElDQVRJT04KCgpmdW5jdGlvbiBfQnJvd3Nlcl9hcHBsaWNhdGlvbihpbXBsKQp7Cgl2YXIgb25VcmxDaGFuZ2UgPSBpbXBsLm9uVXJsQ2hhbmdlOwoJdmFyIG9uVXJsUmVxdWVzdCA9IGltcGwub25VcmxSZXF1ZXN0OwoJdmFyIGtleSA9IGZ1bmN0aW9uKCkgeyBrZXkuYShvblVybENoYW5nZShfQnJvd3Nlcl9nZXRVcmwoKSkpOyB9OwoKCXJldHVybiBfQnJvd3Nlcl9kb2N1bWVudCh7CgkJc2V0dXA6IGZ1bmN0aW9uKHNlbmRUb0FwcCkKCQl7CgkJCWtleS5hID0gc2VuZFRvQXBwOwoJCQlfQnJvd3Nlcl93aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCBrZXkpOwoJCQlfQnJvd3Nlcl93aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdUcmlkZW50JykgPCAwIHx8IF9Ccm93c2VyX3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywga2V5KTsKCgkJCXJldHVybiBGMihmdW5jdGlvbihkb21Ob2RlLCBldmVudCkKCQkJewoJCQkJaWYgKCFldmVudC5jdHJsS2V5ICYmICFldmVudC5tZXRhS2V5ICYmICFldmVudC5zaGlmdEtleSAmJiBldmVudC5idXR0b24gPCAxICYmICFkb21Ob2RlLnRhcmdldCAmJiAhZG9tTm9kZS5oYXNBdHRyaWJ1dGUoJ2Rvd25sb2FkJykpCgkJCQl7CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQl2YXIgaHJlZiA9IGRvbU5vZGUuaHJlZjsKCQkJCQl2YXIgY3VyciA9IF9Ccm93c2VyX2dldFVybCgpOwoJCQkJCXZhciBuZXh0ID0gJGVsbSR1cmwkVXJsJGZyb21TdHJpbmcoaHJlZikuYTsKCQkJCQlzZW5kVG9BcHAob25VcmxSZXF1ZXN0KAoJCQkJCQkobmV4dAoJCQkJCQkJJiYgY3Vyci5wcm90b2NvbCA9PT0gbmV4dC5wcm90b2NvbAoJCQkJCQkJJiYgY3Vyci5ob3N0ID09PSBuZXh0Lmhvc3QKCQkJCQkJCSYmIGN1cnIucG9ydF8uYSA9PT0gbmV4dC5wb3J0Xy5hCgkJCQkJCSkKCQkJCQkJCT8gJGVsbSRicm93c2VyJEJyb3dzZXIkSW50ZXJuYWwobmV4dCkKCQkJCQkJCTogJGVsbSRicm93c2VyJEJyb3dzZXIkRXh0ZXJuYWwoaHJlZikKCQkJCQkpKTsKCQkJCX0KCQkJfSk7CgkJfSwKCQlpbml0OiBmdW5jdGlvbihmbGFncykKCQl7CgkJCXJldHVybiBBMyhpbXBsLmluaXQsIGZsYWdzLCBfQnJvd3Nlcl9nZXRVcmwoKSwga2V5KTsKCQl9LAoJCXZpZXc6IGltcGwudmlldywKCQl1cGRhdGU6IGltcGwudXBkYXRlLAoJCXN1YnNjcmlwdGlvbnM6IGltcGwuc3Vic2NyaXB0aW9ucwoJfSk7Cn0KCmZ1bmN0aW9uIF9Ccm93c2VyX2dldFVybCgpCnsKCXJldHVybiAkZWxtJHVybCRVcmwkZnJvbVN0cmluZyhfVmlydHVhbERvbV9kb2MubG9jYXRpb24uaHJlZikuYSB8fCBfRGVidWdfY3Jhc2goMSk7Cn0KCnZhciBfQnJvd3Nlcl9nbyA9IEYyKGZ1bmN0aW9uKGtleSwgbikKewoJcmV0dXJuIEEyKCRlbG0kY29yZSRUYXNrJHBlcmZvcm0sICRlbG0kY29yZSRCYXNpY3MkbmV2ZXIsIF9TY2hlZHVsZXJfYmluZGluZyhmdW5jdGlvbigpIHsKCQluICYmIGhpc3RvcnkuZ28obik7CgkJa2V5KCk7Cgl9KSk7Cn0pOwoKdmFyIF9Ccm93c2VyX3B1c2hVcmwgPSBGMihmdW5jdGlvbihrZXksIHVybCkKewoJcmV0dXJuIEEyKCRlbG0kY29yZSRUYXNrJHBlcmZvcm0sICRlbG0kY29yZSRCYXNpY3MkbmV2ZXIsIF9TY2hlZHVsZXJfYmluZGluZyhmdW5jdGlvbigpIHsKCQloaXN0b3J5LnB1c2hTdGF0ZSh7fSwgJycsIHVybCk7CgkJa2V5KCk7Cgl9KSk7Cn0pOwoKdmFyIF9Ccm93c2VyX3JlcGxhY2VVcmwgPSBGMihmdW5jdGlvbihrZXksIHVybCkKewoJcmV0dXJuIEEyKCRlbG0kY29yZSRUYXNrJHBlcmZvcm0sICRlbG0kY29yZSRCYXNpY3MkbmV2ZXIsIF9TY2hlZHVsZXJfYmluZGluZyhmdW5jdGlvbigpIHsKCQloaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgJycsIHVybCk7CgkJa2V5KCk7Cgl9KSk7Cn0pOwoKCgovLyBHTE9CQUwgRVZFTlRTCgoKdmFyIF9Ccm93c2VyX2Zha2VOb2RlID0geyBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbigpIHt9LCByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbigpIHt9IH07CnZhciBfQnJvd3Nlcl9kb2MgPSB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnID8gZG9jdW1lbnQgOiBfQnJvd3Nlcl9mYWtlTm9kZTsKdmFyIF9Ccm93c2VyX3dpbmRvdyA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogX0Jyb3dzZXJfZmFrZU5vZGU7Cgp2YXIgX0Jyb3dzZXJfb24gPSBGMyhmdW5jdGlvbihub2RlLCBldmVudE5hbWUsIHNlbmRUb1NlbGYpCnsKCXJldHVybiBfU2NoZWR1bGVyX3NwYXduKF9TY2hlZHVsZXJfYmluZGluZyhmdW5jdGlvbihjYWxsYmFjaykKCXsKCQlmdW5jdGlvbiBoYW5kbGVyKGV2ZW50KQl7IF9TY2hlZHVsZXJfcmF3U3Bhd24oc2VuZFRvU2VsZihldmVudCkpOyB9CgkJbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlciwgX1ZpcnR1YWxEb21fcGFzc2l2ZVN1cHBvcnRlZCAmJiB7IHBhc3NpdmU6IHRydWUgfSk7CgkJcmV0dXJuIGZ1bmN0aW9uKCkgeyBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoYW5kbGVyKTsgfTsKCX0pKTsKfSk7Cgp2YXIgX0Jyb3dzZXJfZGVjb2RlRXZlbnQgPSBGMihmdW5jdGlvbihkZWNvZGVyLCBldmVudCkKewoJdmFyIHJlc3VsdCA9IF9Kc29uX3J1bkhlbHAoZGVjb2RlciwgZXZlbnQpOwoJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkaXNPayhyZXN1bHQpID8gJGVsbSRjb3JlJE1heWJlJEp1c3QocmVzdWx0LmEpIDogJGVsbSRjb3JlJE1heWJlJE5vdGhpbmc7Cn0pOwoKCgovLyBQQUdFIFZJU0lCSUxJVFkKCgpmdW5jdGlvbiBfQnJvd3Nlcl92aXNpYmlsaXR5SW5mbygpCnsKCXJldHVybiAodHlwZW9mIF9WaXJ0dWFsRG9tX2RvYy5oaWRkZW4gIT09ICd1bmRlZmluZWQnKQoJCT8geyBoaWRkZW46ICdoaWRkZW4nLCBjaGFuZ2U6ICd2aXNpYmlsaXR5Y2hhbmdlJyB9CgkJOgoJKHR5cGVvZiBfVmlydHVhbERvbV9kb2MubW96SGlkZGVuICE9PSAndW5kZWZpbmVkJykKCQk/IHsgaGlkZGVuOiAnbW96SGlkZGVuJywgY2hhbmdlOiAnbW96dmlzaWJpbGl0eWNoYW5nZScgfQoJCToKCSh0eXBlb2YgX1ZpcnR1YWxEb21fZG9jLm1zSGlkZGVuICE9PSAndW5kZWZpbmVkJykKCQk/IHsgaGlkZGVuOiAnbXNIaWRkZW4nLCBjaGFuZ2U6ICdtc3Zpc2liaWxpdHljaGFuZ2UnIH0KCQk6CgkodHlwZW9mIF9WaXJ0dWFsRG9tX2RvYy53ZWJraXRIaWRkZW4gIT09ICd1bmRlZmluZWQnKQoJCT8geyBoaWRkZW46ICd3ZWJraXRIaWRkZW4nLCBjaGFuZ2U6ICd3ZWJraXR2aXNpYmlsaXR5Y2hhbmdlJyB9CgkJOiB7IGhpZGRlbjogJ2hpZGRlbicsIGNoYW5nZTogJ3Zpc2liaWxpdHljaGFuZ2UnIH07Cn0KCgoKLy8gQU5JTUFUSU9OIEZSQU1FUwoKCmZ1bmN0aW9uIF9Ccm93c2VyX3JBRigpCnsKCXJldHVybiBfU2NoZWR1bGVyX2JpbmRpbmcoZnVuY3Rpb24oY2FsbGJhY2spCgl7CgkJdmFyIGlkID0gX0Jyb3dzZXJfcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uKCkgewoJCQljYWxsYmFjayhfU2NoZWR1bGVyX3N1Y2NlZWQoRGF0ZS5ub3coKSkpOwoJCX0pOwoKCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCV9Ccm93c2VyX2NhbmNlbEFuaW1hdGlvbkZyYW1lKGlkKTsKCQl9OwoJfSk7Cn0KCgpmdW5jdGlvbiBfQnJvd3Nlcl9ub3coKQp7CglyZXR1cm4gX1NjaGVkdWxlcl9iaW5kaW5nKGZ1bmN0aW9uKGNhbGxiYWNrKQoJewoJCWNhbGxiYWNrKF9TY2hlZHVsZXJfc3VjY2VlZChEYXRlLm5vdygpKSk7Cgl9KTsKfQoKCgovLyBET00gU1RVRkYKCgpmdW5jdGlvbiBfQnJvd3Nlcl93aXRoTm9kZShpZCwgZG9TdHVmZikKewoJcmV0dXJuIF9TY2hlZHVsZXJfYmluZGluZyhmdW5jdGlvbihjYWxsYmFjaykKCXsKCQlfQnJvd3Nlcl9yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7CgkJCXZhciBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwoJCQljYWxsYmFjayhub2RlCgkJCQk/IF9TY2hlZHVsZXJfc3VjY2VlZChkb1N0dWZmKG5vZGUpKQoJCQkJOiBfU2NoZWR1bGVyX2ZhaWwoJGVsbSRicm93c2VyJEJyb3dzZXIkRG9tJE5vdEZvdW5kKGlkKSkKCQkJKTsKCQl9KTsKCX0pOwp9CgoKZnVuY3Rpb24gX0Jyb3dzZXJfd2l0aFdpbmRvdyhkb1N0dWZmKQp7CglyZXR1cm4gX1NjaGVkdWxlcl9iaW5kaW5nKGZ1bmN0aW9uKGNhbGxiYWNrKQoJewoJCV9Ccm93c2VyX3JlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHsKCQkJY2FsbGJhY2soX1NjaGVkdWxlcl9zdWNjZWVkKGRvU3R1ZmYoKSkpOwoJCX0pOwoJfSk7Cn0KCgovLyBGT0NVUyBhbmQgQkxVUgoKCnZhciBfQnJvd3Nlcl9jYWxsID0gRjIoZnVuY3Rpb24oZnVuY3Rpb25OYW1lLCBpZCkKewoJcmV0dXJuIF9Ccm93c2VyX3dpdGhOb2RlKGlkLCBmdW5jdGlvbihub2RlKSB7CgkJbm9kZVtmdW5jdGlvbk5hbWVdKCk7CgkJcmV0dXJuIF9VdGlsc19UdXBsZTA7Cgl9KTsKfSk7CgoKCi8vIFdJTkRPVyBWSUVXUE9SVAoKCmZ1bmN0aW9uIF9Ccm93c2VyX2dldFZpZXdwb3J0KCkKewoJcmV0dXJuIHsKCQlzY2VuZTogX0Jyb3dzZXJfZ2V0U2NlbmUoKSwKCQl2aWV3cG9ydDogewoJCQl4OiBfQnJvd3Nlcl93aW5kb3cucGFnZVhPZmZzZXQsCgkJCXk6IF9Ccm93c2VyX3dpbmRvdy5wYWdlWU9mZnNldCwKCQkJd2lkdGg6IF9Ccm93c2VyX2RvYy5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsCgkJCWhlaWdodDogX0Jyb3dzZXJfZG9jLmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQKCQl9Cgl9Owp9CgpmdW5jdGlvbiBfQnJvd3Nlcl9nZXRTY2VuZSgpCnsKCXZhciBib2R5ID0gX0Jyb3dzZXJfZG9jLmJvZHk7Cgl2YXIgZWxlbSA9IF9Ccm93c2VyX2RvYy5kb2N1bWVudEVsZW1lbnQ7CglyZXR1cm4gewoJCXdpZHRoOiBNYXRoLm1heChib2R5LnNjcm9sbFdpZHRoLCBib2R5Lm9mZnNldFdpZHRoLCBlbGVtLnNjcm9sbFdpZHRoLCBlbGVtLm9mZnNldFdpZHRoLCBlbGVtLmNsaWVudFdpZHRoKSwKCQloZWlnaHQ6IE1hdGgubWF4KGJvZHkuc2Nyb2xsSGVpZ2h0LCBib2R5Lm9mZnNldEhlaWdodCwgZWxlbS5zY3JvbGxIZWlnaHQsIGVsZW0ub2Zmc2V0SGVpZ2h0LCBlbGVtLmNsaWVudEhlaWdodCkKCX07Cn0KCnZhciBfQnJvd3Nlcl9zZXRWaWV3cG9ydCA9IEYyKGZ1bmN0aW9uKHgsIHkpCnsKCXJldHVybiBfQnJvd3Nlcl93aXRoV2luZG93KGZ1bmN0aW9uKCkKCXsKCQlfQnJvd3Nlcl93aW5kb3cuc2Nyb2xsKHgsIHkpOwoJCXJldHVybiBfVXRpbHNfVHVwbGUwOwoJfSk7Cn0pOwoKCgovLyBFTEVNRU5UIFZJRVdQT1JUCgoKZnVuY3Rpb24gX0Jyb3dzZXJfZ2V0Vmlld3BvcnRPZihpZCkKewoJcmV0dXJuIF9Ccm93c2VyX3dpdGhOb2RlKGlkLCBmdW5jdGlvbihub2RlKQoJewoJCXJldHVybiB7CgkJCXNjZW5lOiB7CgkJCQl3aWR0aDogbm9kZS5zY3JvbGxXaWR0aCwKCQkJCWhlaWdodDogbm9kZS5zY3JvbGxIZWlnaHQKCQkJfSwKCQkJdmlld3BvcnQ6IHsKCQkJCXg6IG5vZGUuc2Nyb2xsTGVmdCwKCQkJCXk6IG5vZGUuc2Nyb2xsVG9wLAoJCQkJd2lkdGg6IG5vZGUuY2xpZW50V2lkdGgsCgkJCQloZWlnaHQ6IG5vZGUuY2xpZW50SGVpZ2h0CgkJCX0KCQl9OwoJfSk7Cn0KCgp2YXIgX0Jyb3dzZXJfc2V0Vmlld3BvcnRPZiA9IEYzKGZ1bmN0aW9uKGlkLCB4LCB5KQp7CglyZXR1cm4gX0Jyb3dzZXJfd2l0aE5vZGUoaWQsIGZ1bmN0aW9uKG5vZGUpCgl7CgkJbm9kZS5zY3JvbGxMZWZ0ID0geDsKCQlub2RlLnNjcm9sbFRvcCA9IHk7CgkJcmV0dXJuIF9VdGlsc19UdXBsZTA7Cgl9KTsKfSk7CgoKCi8vIEVMRU1FTlQKCgpmdW5jdGlvbiBfQnJvd3Nlcl9nZXRFbGVtZW50KGlkKQp7CglyZXR1cm4gX0Jyb3dzZXJfd2l0aE5vZGUoaWQsIGZ1bmN0aW9uKG5vZGUpCgl7CgkJdmFyIHJlY3QgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJCXZhciB4ID0gX0Jyb3dzZXJfd2luZG93LnBhZ2VYT2Zmc2V0OwoJCXZhciB5ID0gX0Jyb3dzZXJfd2luZG93LnBhZ2VZT2Zmc2V0OwoJCXJldHVybiB7CgkJCXNjZW5lOiBfQnJvd3Nlcl9nZXRTY2VuZSgpLAoJCQl2aWV3cG9ydDogewoJCQkJeDogeCwKCQkJCXk6IHksCgkJCQl3aWR0aDogX0Jyb3dzZXJfZG9jLmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwKCQkJCWhlaWdodDogX0Jyb3dzZXJfZG9jLmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQKCQkJfSwKCQkJZWxlbWVudDogewoJCQkJeDogeCArIHJlY3QubGVmdCwKCQkJCXk6IHkgKyByZWN0LnRvcCwKCQkJCXdpZHRoOiByZWN0LndpZHRoLAoJCQkJaGVpZ2h0OiByZWN0LmhlaWdodAoJCQl9CgkJfTsKCX0pOwp9CgoKCi8vIExPQUQgYW5kIFJFTE9BRAoKCmZ1bmN0aW9uIF9Ccm93c2VyX3JlbG9hZChza2lwQ2FjaGUpCnsKCXJldHVybiBBMigkZWxtJGNvcmUkVGFzayRwZXJmb3JtLCAkZWxtJGNvcmUkQmFzaWNzJG5ldmVyLCBfU2NoZWR1bGVyX2JpbmRpbmcoZnVuY3Rpb24oY2FsbGJhY2spCgl7CgkJX1ZpcnR1YWxEb21fZG9jLmxvY2F0aW9uLnJlbG9hZChza2lwQ2FjaGUpOwoJfSkpOwp9CgpmdW5jdGlvbiBfQnJvd3Nlcl9sb2FkKHVybCkKewoJcmV0dXJuIEEyKCRlbG0kY29yZSRUYXNrJHBlcmZvcm0sICRlbG0kY29yZSRCYXNpY3MkbmV2ZXIsIF9TY2hlZHVsZXJfYmluZGluZyhmdW5jdGlvbihjYWxsYmFjaykKCXsKCQl0cnkKCQl7CgkJCV9Ccm93c2VyX3dpbmRvdy5sb2NhdGlvbiA9IHVybDsKCQl9CgkJY2F0Y2goZXJyKQoJCXsKCQkJLy8gT25seSBGaXJlZm94IGNhbiB0aHJvdyBhIE5TX0VSUk9SX01BTEZPUk1FRF9VUkkgZXhjZXB0aW9uIGhlcmUuCgkJCS8vIE90aGVyIGJyb3dzZXJzIHJlbG9hZCB0aGUgcGFnZSwgc28gbGV0J3MgYmUgY29uc2lzdGVudCBhYm91dCB0aGF0LgoJCQlfVmlydHVhbERvbV9kb2MubG9jYXRpb24ucmVsb2FkKGZhbHNlKTsKCQl9Cgl9KSk7Cn0KCgoKLy8gU0VORCBSRVFVRVNUCgp2YXIgX0h0dHBfdG9UYXNrID0gRjMoZnVuY3Rpb24ocm91dGVyLCB0b1Rhc2ssIHJlcXVlc3QpCnsKCXJldHVybiBfU2NoZWR1bGVyX2JpbmRpbmcoZnVuY3Rpb24oY2FsbGJhY2spCgl7CgkJZnVuY3Rpb24gZG9uZShyZXNwb25zZSkgewoJCQljYWxsYmFjayh0b1Rhc2socmVxdWVzdC5leHBlY3QuYShyZXNwb25zZSkpKTsKCQl9CgoJCXZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQl4aHIuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbigpIHsgZG9uZSgkZWxtJGh0dHAkSHR0cCROZXR3b3JrRXJyb3JfKTsgfSk7CgkJeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWVvdXQnLCBmdW5jdGlvbigpIHsgZG9uZSgkZWxtJGh0dHAkSHR0cCRUaW1lb3V0Xyk7IH0pOwoJCXhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7IGRvbmUoX0h0dHBfdG9SZXNwb25zZShyZXF1ZXN0LmV4cGVjdC5iLCB4aHIpKTsgfSk7CgkJJGVsbSRjb3JlJE1heWJlJGlzSnVzdChyZXF1ZXN0LnRyYWNrZXIpICYmIF9IdHRwX3RyYWNrKHJvdXRlciwgeGhyLCByZXF1ZXN0LnRyYWNrZXIuYSk7CgoJCXRyeSB7CgkJCXhoci5vcGVuKHJlcXVlc3QubWV0aG9kLCByZXF1ZXN0LnVybCwgdHJ1ZSk7CgkJfSBjYXRjaCAoZSkgewoJCQlyZXR1cm4gZG9uZSgkZWxtJGh0dHAkSHR0cCRCYWRVcmxfKHJlcXVlc3QudXJsKSk7CgkJfQoKCQlfSHR0cF9jb25maWd1cmVSZXF1ZXN0KHhociwgcmVxdWVzdCk7CgoJCXJlcXVlc3QuYm9keS5hICYmIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCByZXF1ZXN0LmJvZHkuYSk7CgkJeGhyLnNlbmQocmVxdWVzdC5ib2R5LmIpOwoKCQlyZXR1cm4gZnVuY3Rpb24oKSB7IHhoci5jID0gdHJ1ZTsgeGhyLmFib3J0KCk7IH07Cgl9KTsKfSk7CgoKLy8gQ09ORklHVVJFCgpmdW5jdGlvbiBfSHR0cF9jb25maWd1cmVSZXF1ZXN0KHhociwgcmVxdWVzdCkKewoJZm9yICh2YXIgaGVhZGVycyA9IHJlcXVlc3QuaGVhZGVyczsgaGVhZGVycy5iOyBoZWFkZXJzID0gaGVhZGVycy5iKSAvLyBXSElMRV9DT05TCgl7CgkJeGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVycy5hLmEsIGhlYWRlcnMuYS5iKTsKCX0KCXhoci50aW1lb3V0ID0gcmVxdWVzdC50aW1lb3V0LmEgfHwgMDsKCXhoci5yZXNwb25zZVR5cGUgPSByZXF1ZXN0LmV4cGVjdC5kOwoJeGhyLndpdGhDcmVkZW50aWFscyA9IHJlcXVlc3QuYWxsb3dDb29raWVzRnJvbU90aGVyRG9tYWluczsKfQoKCi8vIFJFU1BPTlNFUwoKZnVuY3Rpb24gX0h0dHBfdG9SZXNwb25zZSh0b0JvZHksIHhocikKewoJcmV0dXJuIEEyKAoJCTIwMCA8PSB4aHIuc3RhdHVzICYmIHhoci5zdGF0dXMgPCAzMDAgPyAkZWxtJGh0dHAkSHR0cCRHb29kU3RhdHVzXyA6ICRlbG0kaHR0cCRIdHRwJEJhZFN0YXR1c18sCgkJX0h0dHBfdG9NZXRhZGF0YSh4aHIpLAoJCXRvQm9keSh4aHIucmVzcG9uc2UpCgkpOwp9CgoKLy8gTUVUQURBVEEKCmZ1bmN0aW9uIF9IdHRwX3RvTWV0YWRhdGEoeGhyKQp7CglyZXR1cm4gewoJCXVybDogeGhyLnJlc3BvbnNlVVJMLAoJCXN0YXR1c0NvZGU6IHhoci5zdGF0dXMsCgkJc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHQsCgkJaGVhZGVyczogX0h0dHBfcGFyc2VIZWFkZXJzKHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSkKCX07Cn0KCgovLyBIRUFERVJTCgpmdW5jdGlvbiBfSHR0cF9wYXJzZUhlYWRlcnMocmF3SGVhZGVycykKewoJaWYgKCFyYXdIZWFkZXJzKQoJewoJCXJldHVybiAkZWxtJGNvcmUkRGljdCRlbXB0eTsKCX0KCgl2YXIgaGVhZGVycyA9ICRlbG0kY29yZSREaWN0JGVtcHR5OwoJdmFyIGhlYWRlclBhaXJzID0gcmF3SGVhZGVycy5zcGxpdCgnXHJcbicpOwoJZm9yICh2YXIgaSA9IGhlYWRlclBhaXJzLmxlbmd0aDsgaS0tOyApCgl7CgkJdmFyIGhlYWRlclBhaXIgPSBoZWFkZXJQYWlyc1tpXTsKCQl2YXIgaW5kZXggPSBoZWFkZXJQYWlyLmluZGV4T2YoJzogJyk7CgkJaWYgKGluZGV4ID4gMCkKCQl7CgkJCXZhciBrZXkgPSBoZWFkZXJQYWlyLnN1YnN0cmluZygwLCBpbmRleCk7CgkJCXZhciB2YWx1ZSA9IGhlYWRlclBhaXIuc3Vic3RyaW5nKGluZGV4ICsgMik7CgoJCQloZWFkZXJzID0gQTMoJGVsbSRjb3JlJERpY3QkdXBkYXRlLCBrZXksIGZ1bmN0aW9uKG9sZFZhbHVlKSB7CgkJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJEp1c3QoJGVsbSRjb3JlJE1heWJlJGlzSnVzdChvbGRWYWx1ZSkKCQkJCQk/IHZhbHVlICsgJywgJyArIG9sZFZhbHVlLmEKCQkJCQk6IHZhbHVlCgkJCQkpOwoJCQl9LCBoZWFkZXJzKTsKCQl9Cgl9CglyZXR1cm4gaGVhZGVyczsKfQoKCi8vIEVYUEVDVAoKdmFyIF9IdHRwX2V4cGVjdCA9IEYzKGZ1bmN0aW9uKHR5cGUsIHRvQm9keSwgdG9WYWx1ZSkKewoJcmV0dXJuIHsKCQkkOiAwLAoJCWQ6IHR5cGUsCgkJYjogdG9Cb2R5LAoJCWE6IHRvVmFsdWUKCX07Cn0pOwoKdmFyIF9IdHRwX21hcEV4cGVjdCA9IEYyKGZ1bmN0aW9uKGZ1bmMsIGV4cGVjdCkKewoJcmV0dXJuIHsKCQkkOiAwLAoJCWQ6IGV4cGVjdC5kLAoJCWI6IGV4cGVjdC5iLAoJCWE6IGZ1bmN0aW9uKHgpIHsgcmV0dXJuIGZ1bmMoZXhwZWN0LmEoeCkpOyB9Cgl9Owp9KTsKCmZ1bmN0aW9uIF9IdHRwX3RvRGF0YVZpZXcoYXJyYXlCdWZmZXIpCnsKCXJldHVybiBuZXcgRGF0YVZpZXcoYXJyYXlCdWZmZXIpOwp9CgoKLy8gQk9EWSBhbmQgUEFSVFMKCnZhciBfSHR0cF9lbXB0eUJvZHkgPSB7ICQ6IDAgfTsKdmFyIF9IdHRwX3BhaXIgPSBGMihmdW5jdGlvbihhLCBiKSB7IHJldHVybiB7ICQ6IDAsIGE6IGEsIGI6IGIgfTsgfSk7CgpmdW5jdGlvbiBfSHR0cF90b0Zvcm1EYXRhKHBhcnRzKQp7Cglmb3IgKHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOyBwYXJ0cy5iOyBwYXJ0cyA9IHBhcnRzLmIpIC8vIFdISUxFX0NPTlMKCXsKCQl2YXIgcGFydCA9IHBhcnRzLmE7CgkJZm9ybURhdGEuYXBwZW5kKHBhcnQuYSwgcGFydC5iKTsKCX0KCXJldHVybiBmb3JtRGF0YTsKfQoKdmFyIF9IdHRwX2J5dGVzVG9CbG9iID0gRjIoZnVuY3Rpb24obWltZSwgYnl0ZXMpCnsKCXJldHVybiBuZXcgQmxvYihbYnl0ZXNdLCB7IHR5cGU6IG1pbWUgfSk7Cn0pOwoKCi8vIFBST0dSRVNTCgpmdW5jdGlvbiBfSHR0cF90cmFjayhyb3V0ZXIsIHhociwgdHJhY2tlcikKewoJLy8gVE9ETyBjaGVjayBvdXQgbGVuZ3RoQ29tcHV0YWJsZSBvbiBsb2Fkc3RhcnQgZXZlbnQKCgl4aHIudXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgZnVuY3Rpb24oZXZlbnQpIHsKCQlpZiAoeGhyLmMpIHsgcmV0dXJuOyB9CgkJX1NjaGVkdWxlcl9yYXdTcGF3bihBMigkZWxtJGNvcmUkUGxhdGZvcm0kc2VuZFRvU2VsZiwgcm91dGVyLCBfVXRpbHNfVHVwbGUyKHRyYWNrZXIsICRlbG0kaHR0cCRIdHRwJFNlbmRpbmcoewoJCQlzZW50OiBldmVudC5sb2FkZWQsCgkJCXNpemU6IGV2ZW50LnRvdGFsCgkJfSkpKSk7Cgl9KTsKCXhoci5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIGZ1bmN0aW9uKGV2ZW50KSB7CgkJaWYgKHhoci5jKSB7IHJldHVybjsgfQoJCV9TY2hlZHVsZXJfcmF3U3Bhd24oQTIoJGVsbSRjb3JlJFBsYXRmb3JtJHNlbmRUb1NlbGYsIHJvdXRlciwgX1V0aWxzX1R1cGxlMih0cmFja2VyLCAkZWxtJGh0dHAkSHR0cCRSZWNlaXZpbmcoewoJCQlyZWNlaXZlZDogZXZlbnQubG9hZGVkLAoJCQlzaXplOiBldmVudC5sZW5ndGhDb21wdXRhYmxlID8gJGVsbSRjb3JlJE1heWJlJEp1c3QoZXZlbnQudG90YWwpIDogJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcKCQl9KSkpKTsKCX0pOwp9CgoKCi8vIFNUUklOR1MKCgp2YXIgX1BhcnNlcl9pc1N1YlN0cmluZyA9IEY1KGZ1bmN0aW9uKHNtYWxsU3RyaW5nLCBvZmZzZXQsIHJvdywgY29sLCBiaWdTdHJpbmcpCnsKCXZhciBzbWFsbExlbmd0aCA9IHNtYWxsU3RyaW5nLmxlbmd0aDsKCXZhciBpc0dvb2QgPSBvZmZzZXQgKyBzbWFsbExlbmd0aCA8PSBiaWdTdHJpbmcubGVuZ3RoOwoKCWZvciAodmFyIGkgPSAwOyBpc0dvb2QgJiYgaSA8IHNtYWxsTGVuZ3RoOyApCgl7CgkJdmFyIGNvZGUgPSBiaWdTdHJpbmcuY2hhckNvZGVBdChvZmZzZXQpOwoJCWlzR29vZCA9CgkJCXNtYWxsU3RyaW5nW2krK10gPT09IGJpZ1N0cmluZ1tvZmZzZXQrK10KCQkJJiYgKAoJCQkJY29kZSA9PT0gMHgwMDBBIC8qIFxuICovCgkJCQkJPyAoIHJvdysrLCBjb2w9MSApCgkJCQkJOiAoIGNvbCsrLCAoY29kZSAmIDB4RjgwMCkgPT09IDB4RDgwMCA/IHNtYWxsU3RyaW5nW2krK10gPT09IGJpZ1N0cmluZ1tvZmZzZXQrK10gOiAxICkKCQkJKQoJfQoKCXJldHVybiBfVXRpbHNfVHVwbGUzKGlzR29vZCA/IG9mZnNldCA6IC0xLCByb3csIGNvbCk7Cn0pOwoKCgovLyBDSEFSUwoKCnZhciBfUGFyc2VyX2lzU3ViQ2hhciA9IEYzKGZ1bmN0aW9uKHByZWRpY2F0ZSwgb2Zmc2V0LCBzdHJpbmcpCnsKCXJldHVybiAoCgkJc3RyaW5nLmxlbmd0aCA8PSBvZmZzZXQKCQkJPyAtMQoJCQk6CgkJKHN0cmluZy5jaGFyQ29kZUF0KG9mZnNldCkgJiAweEY4MDApID09PSAweEQ4MDAKCQkJPyAocHJlZGljYXRlKF9VdGlsc19jaHIoc3RyaW5nLnN1YnN0cihvZmZzZXQsIDIpKSkgPyBvZmZzZXQgKyAyIDogLTEpCgkJCToKCQkocHJlZGljYXRlKF9VdGlsc19jaHIoc3RyaW5nW29mZnNldF0pKQoJCQk/ICgoc3RyaW5nW29mZnNldF0gPT09ICdcbicpID8gLTIgOiAob2Zmc2V0ICsgMSkpCgkJCTogLTEKCQkpCgkpOwp9KTsKCgp2YXIgX1BhcnNlcl9pc0FzY2lpQ29kZSA9IEYzKGZ1bmN0aW9uKGNvZGUsIG9mZnNldCwgc3RyaW5nKQp7CglyZXR1cm4gc3RyaW5nLmNoYXJDb2RlQXQob2Zmc2V0KSA9PT0gY29kZTsKfSk7CgoKCi8vIE5VTUJFUlMKCgp2YXIgX1BhcnNlcl9jaG9tcEJhc2UxMCA9IEYyKGZ1bmN0aW9uKG9mZnNldCwgc3RyaW5nKQp7Cglmb3IgKDsgb2Zmc2V0IDwgc3RyaW5nLmxlbmd0aDsgb2Zmc2V0KyspCgl7CgkJdmFyIGNvZGUgPSBzdHJpbmcuY2hhckNvZGVBdChvZmZzZXQpOwoJCWlmIChjb2RlIDwgMHgzMCB8fCAweDM5IDwgY29kZSkKCQl7CgkJCXJldHVybiBvZmZzZXQ7CgkJfQoJfQoJcmV0dXJuIG9mZnNldDsKfSk7CgoKdmFyIF9QYXJzZXJfY29uc3VtZUJhc2UgPSBGMyhmdW5jdGlvbihiYXNlLCBvZmZzZXQsIHN0cmluZykKewoJZm9yICh2YXIgdG90YWwgPSAwOyBvZmZzZXQgPCBzdHJpbmcubGVuZ3RoOyBvZmZzZXQrKykKCXsKCQl2YXIgZGlnaXQgPSBzdHJpbmcuY2hhckNvZGVBdChvZmZzZXQpIC0gMHgzMDsKCQlpZiAoZGlnaXQgPCAwIHx8IGJhc2UgPD0gZGlnaXQpIGJyZWFrOwoJCXRvdGFsID0gYmFzZSAqIHRvdGFsICsgZGlnaXQ7Cgl9CglyZXR1cm4gX1V0aWxzX1R1cGxlMihvZmZzZXQsIHRvdGFsKTsKfSk7CgoKdmFyIF9QYXJzZXJfY29uc3VtZUJhc2UxNiA9IEYyKGZ1bmN0aW9uKG9mZnNldCwgc3RyaW5nKQp7Cglmb3IgKHZhciB0b3RhbCA9IDA7IG9mZnNldCA8IHN0cmluZy5sZW5ndGg7IG9mZnNldCsrKQoJewoJCXZhciBjb2RlID0gc3RyaW5nLmNoYXJDb2RlQXQob2Zmc2V0KTsKCQlpZiAoMHgzMCA8PSBjb2RlICYmIGNvZGUgPD0gMHgzOSkKCQl7CgkJCXRvdGFsID0gMTYgKiB0b3RhbCArIGNvZGUgLSAweDMwOwoJCX0KCQllbHNlIGlmICgweDQxIDw9IGNvZGUgJiYgY29kZSA8PSAweDQ2KQoJCXsKCQkJdG90YWwgPSAxNiAqIHRvdGFsICsgY29kZSAtIDU1OwoJCX0KCQllbHNlIGlmICgweDYxIDw9IGNvZGUgJiYgY29kZSA8PSAweDY2KQoJCXsKCQkJdG90YWwgPSAxNiAqIHRvdGFsICsgY29kZSAtIDg3OwoJCX0KCQllbHNlCgkJewoJCQlicmVhazsKCQl9Cgl9CglyZXR1cm4gX1V0aWxzX1R1cGxlMihvZmZzZXQsIHRvdGFsKTsKfSk7CgoKCi8vIEZJTkQgU1RSSU5HCgoKdmFyIF9QYXJzZXJfZmluZFN1YlN0cmluZyA9IEY1KGZ1bmN0aW9uKHNtYWxsU3RyaW5nLCBvZmZzZXQsIHJvdywgY29sLCBiaWdTdHJpbmcpCnsKCXZhciBuZXdPZmZzZXQgPSBiaWdTdHJpbmcuaW5kZXhPZihzbWFsbFN0cmluZywgb2Zmc2V0KTsKCXZhciB0YXJnZXQgPSBuZXdPZmZzZXQgPCAwID8gYmlnU3RyaW5nLmxlbmd0aCA6IG5ld09mZnNldCArIHNtYWxsU3RyaW5nLmxlbmd0aDsKCgl3aGlsZSAob2Zmc2V0IDwgdGFyZ2V0KQoJewoJCXZhciBjb2RlID0gYmlnU3RyaW5nLmNoYXJDb2RlQXQob2Zmc2V0KyspOwoJCWNvZGUgPT09IDB4MDAwQSAvKiBcbiAqLwoJCQk/ICggY29sPTEsIHJvdysrICkKCQkJOiAoIGNvbCsrLCAoY29kZSAmIDB4RjgwMCkgPT09IDB4RDgwMCAmJiBvZmZzZXQrKyApCgl9CgoJcmV0dXJuIF9VdGlsc19UdXBsZTMobmV3T2Zmc2V0LCByb3csIGNvbCk7Cn0pOwp2YXIgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kVXJsQ2hhbmdlID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ1VybENoYW5nZScsIGE6IGF9Owp9Owp2YXIgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kVXJsUmVxdWVzdCA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdVcmxSZXF1ZXN0JywgYTogYX07Cn07CnZhciAkZWxtJGNvcmUkQmFzaWNzJGFsd2F5cyA9IEYyKAoJZnVuY3Rpb24gKGEsIF92MCkgewoJCXJldHVybiBhOwoJfSk7CnZhciAkZWxtJGNvcmUkQmFzaWNzJEVRID0geyQ6ICdFUSd9Owp2YXIgJGVsbSRjb3JlJEJhc2ljcyRHVCA9IHskOiAnR1QnfTsKdmFyICRlbG0kY29yZSRCYXNpY3MkTFQgPSB7JDogJ0xUJ307CnZhciAkZWxtJGNvcmUkTGlzdCRjb25zID0gX0xpc3RfY29uczsKdmFyICRlbG0kY29yZSREaWN0JGZvbGRyID0gRjMoCglmdW5jdGlvbiAoZnVuYywgYWNjLCB0KSB7CgkJZm9sZHI6CgkJd2hpbGUgKHRydWUpIHsKCQkJaWYgKHQuJCA9PT0gJ1JCRW1wdHlfZWxtX2J1aWx0aW4nKSB7CgkJCQlyZXR1cm4gYWNjOwoJCQl9IGVsc2UgewoJCQkJdmFyIGtleSA9IHQuYjsKCQkJCXZhciB2YWx1ZSA9IHQuYzsKCQkJCXZhciBsZWZ0ID0gdC5kOwoJCQkJdmFyIHJpZ2h0ID0gdC5lOwoJCQkJdmFyICR0ZW1wJGZ1bmMgPSBmdW5jLAoJCQkJCSR0ZW1wJGFjYyA9IEEzKAoJCQkJCWZ1bmMsCgkJCQkJa2V5LAoJCQkJCXZhbHVlLAoJCQkJCUEzKCRlbG0kY29yZSREaWN0JGZvbGRyLCBmdW5jLCBhY2MsIHJpZ2h0KSksCgkJCQkJJHRlbXAkdCA9IGxlZnQ7CgkJCQlmdW5jID0gJHRlbXAkZnVuYzsKCQkJCWFjYyA9ICR0ZW1wJGFjYzsKCQkJCXQgPSAkdGVtcCR0OwoJCQkJY29udGludWUgZm9sZHI7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSREaWN0JHRvTGlzdCA9IGZ1bmN0aW9uIChkaWN0KSB7CglyZXR1cm4gQTMoCgkJJGVsbSRjb3JlJERpY3QkZm9sZHIsCgkJRjMoCgkJCWZ1bmN0aW9uIChrZXksIHZhbHVlLCBsaXN0KSB7CgkJCQlyZXR1cm4gQTIoCgkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQlfVXRpbHNfVHVwbGUyKGtleSwgdmFsdWUpLAoJCQkJCWxpc3QpOwoJCQl9KSwKCQlfTGlzdF9OaWwsCgkJZGljdCk7Cn07CnZhciAkZWxtJGNvcmUkRGljdCRrZXlzID0gZnVuY3Rpb24gKGRpY3QpIHsKCXJldHVybiBBMygKCQkkZWxtJGNvcmUkRGljdCRmb2xkciwKCQlGMygKCQkJZnVuY3Rpb24gKGtleSwgdmFsdWUsIGtleUxpc3QpIHsKCQkJCXJldHVybiBBMigkZWxtJGNvcmUkTGlzdCRjb25zLCBrZXksIGtleUxpc3QpOwoJCQl9KSwKCQlfTGlzdF9OaWwsCgkJZGljdCk7Cn07CnZhciAkZWxtJGNvcmUkU2V0JHRvTGlzdCA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciBkaWN0ID0gX3YwLmE7CglyZXR1cm4gJGVsbSRjb3JlJERpY3Qka2V5cyhkaWN0KTsKfTsKdmFyICRlbG0kY29yZSRFbG0kSnNBcnJheSRmb2xkciA9IF9Kc0FycmF5X2ZvbGRyOwp2YXIgJGVsbSRjb3JlJEFycmF5JGZvbGRyID0gRjMoCglmdW5jdGlvbiAoZnVuYywgYmFzZUNhc2UsIF92MCkgewoJCXZhciB0cmVlID0gX3YwLmM7CgkJdmFyIHRhaWwgPSBfdjAuZDsKCQl2YXIgaGVscGVyID0gRjIoCgkJCWZ1bmN0aW9uIChub2RlLCBhY2MpIHsKCQkJCWlmIChub2RlLiQgPT09ICdTdWJUcmVlJykgewoJCQkJCXZhciBzdWJUcmVlID0gbm9kZS5hOwoJCQkJCXJldHVybiBBMygkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZm9sZHIsIGhlbHBlciwgYWNjLCBzdWJUcmVlKTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIHZhbHVlcyA9IG5vZGUuYTsKCQkJCQlyZXR1cm4gQTMoJGVsbSRjb3JlJEVsbSRKc0FycmF5JGZvbGRyLCBmdW5jLCBhY2MsIHZhbHVlcyk7CgkJCQl9CgkJCX0pOwoJCXJldHVybiBBMygKCQkJJGVsbSRjb3JlJEVsbSRKc0FycmF5JGZvbGRyLAoJCQloZWxwZXIsCgkJCUEzKCRlbG0kY29yZSRFbG0kSnNBcnJheSRmb2xkciwgZnVuYywgYmFzZUNhc2UsIHRhaWwpLAoJCQl0cmVlKTsKCX0pOwp2YXIgJGVsbSRjb3JlJEFycmF5JHRvTGlzdCA9IGZ1bmN0aW9uIChhcnJheSkgewoJcmV0dXJuIEEzKCRlbG0kY29yZSRBcnJheSRmb2xkciwgJGVsbSRjb3JlJExpc3QkY29ucywgX0xpc3RfTmlsLCBhcnJheSk7Cn07CnZhciAkZWxtJGNvcmUkUmVzdWx0JEVyciA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdFcnInLCBhOiBhfTsKfTsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRGYWlsdXJlID0gRjIoCglmdW5jdGlvbiAoYSwgYikgewoJCXJldHVybiB7JDogJ0ZhaWx1cmUnLCBhOiBhLCBiOiBifTsKCX0pOwp2YXIgJGVsbSRqc29uJEpzb24kRGVjb2RlJEZpZWxkID0gRjIoCglmdW5jdGlvbiAoYSwgYikgewoJCXJldHVybiB7JDogJ0ZpZWxkJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRJbmRleCA9IEYyKAoJZnVuY3Rpb24gKGEsIGIpIHsKCQlyZXR1cm4geyQ6ICdJbmRleCcsIGE6IGEsIGI6IGJ9OwoJfSk7CnZhciAkZWxtJGNvcmUkUmVzdWx0JE9rID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ09rJywgYTogYX07Cn07CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkT25lT2YgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnT25lT2YnLCBhOiBhfTsKfTsKdmFyICRlbG0kY29yZSRCYXNpY3MkRmFsc2UgPSB7JDogJ0ZhbHNlJ307CnZhciAkZWxtJGNvcmUkQmFzaWNzJGFkZCA9IF9CYXNpY3NfYWRkOwp2YXIgJGVsbSRjb3JlJE1heWJlJEp1c3QgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnSnVzdCcsIGE6IGF9Owp9Owp2YXIgJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcgPSB7JDogJ05vdGhpbmcnfTsKdmFyICRlbG0kY29yZSRTdHJpbmckYWxsID0gX1N0cmluZ19hbGw7CnZhciAkZWxtJGNvcmUkQmFzaWNzJGFuZCA9IF9CYXNpY3NfYW5kOwp2YXIgJGVsbSRjb3JlJEJhc2ljcyRhcHBlbmQgPSBfVXRpbHNfYXBwZW5kOwp2YXIgJGVsbSRqc29uJEpzb24kRW5jb2RlJGVuY29kZSA9IF9Kc29uX2VuY29kZTsKdmFyICRlbG0kY29yZSRTdHJpbmckZnJvbUludCA9IF9TdHJpbmdfZnJvbU51bWJlcjsKdmFyICRlbG0kY29yZSRTdHJpbmckam9pbiA9IEYyKAoJZnVuY3Rpb24gKHNlcCwgY2h1bmtzKSB7CgkJcmV0dXJuIEEyKAoJCQlfU3RyaW5nX2pvaW4sCgkJCXNlcCwKCQkJX0xpc3RfdG9BcnJheShjaHVua3MpKTsKCX0pOwp2YXIgJGVsbSRjb3JlJFN0cmluZyRzcGxpdCA9IEYyKAoJZnVuY3Rpb24gKHNlcCwgc3RyaW5nKSB7CgkJcmV0dXJuIF9MaXN0X2Zyb21BcnJheSgKCQkJQTIoX1N0cmluZ19zcGxpdCwgc2VwLCBzdHJpbmcpKTsKCX0pOwp2YXIgJGVsbSRqc29uJEpzb24kRGVjb2RlJGluZGVudCA9IGZ1bmN0aW9uIChzdHIpIHsKCXJldHVybiBBMigKCQkkZWxtJGNvcmUkU3RyaW5nJGpvaW4sCgkJJ1xuICAgICcsCgkJQTIoJGVsbSRjb3JlJFN0cmluZyRzcGxpdCwgJ1xuJywgc3RyKSk7Cn07CnZhciAkZWxtJGNvcmUkTGlzdCRmb2xkbCA9IEYzKAoJZnVuY3Rpb24gKGZ1bmMsIGFjYywgbGlzdCkgewoJCWZvbGRsOgoJCXdoaWxlICh0cnVlKSB7CgkJCWlmICghbGlzdC5iKSB7CgkJCQlyZXR1cm4gYWNjOwoJCQl9IGVsc2UgewoJCQkJdmFyIHggPSBsaXN0LmE7CgkJCQl2YXIgeHMgPSBsaXN0LmI7CgkJCQl2YXIgJHRlbXAkZnVuYyA9IGZ1bmMsCgkJCQkJJHRlbXAkYWNjID0gQTIoZnVuYywgeCwgYWNjKSwKCQkJCQkkdGVtcCRsaXN0ID0geHM7CgkJCQlmdW5jID0gJHRlbXAkZnVuYzsKCQkJCWFjYyA9ICR0ZW1wJGFjYzsKCQkJCWxpc3QgPSAkdGVtcCRsaXN0OwoJCQkJY29udGludWUgZm9sZGw7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRMaXN0JGxlbmd0aCA9IGZ1bmN0aW9uICh4cykgewoJcmV0dXJuIEEzKAoJCSRlbG0kY29yZSRMaXN0JGZvbGRsLAoJCUYyKAoJCQlmdW5jdGlvbiAoX3YwLCBpKSB7CgkJCQlyZXR1cm4gaSArIDE7CgkJCX0pLAoJCTAsCgkJeHMpOwp9Owp2YXIgJGVsbSRjb3JlJExpc3QkbWFwMiA9IF9MaXN0X21hcDI7CnZhciAkZWxtJGNvcmUkQmFzaWNzJGxlID0gX1V0aWxzX2xlOwp2YXIgJGVsbSRjb3JlJEJhc2ljcyRzdWIgPSBfQmFzaWNzX3N1YjsKdmFyICRlbG0kY29yZSRMaXN0JHJhbmdlSGVscCA9IEYzKAoJZnVuY3Rpb24gKGxvLCBoaSwgbGlzdCkgewoJCXJhbmdlSGVscDoKCQl3aGlsZSAodHJ1ZSkgewoJCQlpZiAoX1V0aWxzX2NtcChsbywgaGkpIDwgMSkgewoJCQkJdmFyICR0ZW1wJGxvID0gbG8sCgkJCQkJJHRlbXAkaGkgPSBoaSAtIDEsCgkJCQkJJHRlbXAkbGlzdCA9IEEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIGhpLCBsaXN0KTsKCQkJCWxvID0gJHRlbXAkbG87CgkJCQloaSA9ICR0ZW1wJGhpOwoJCQkJbGlzdCA9ICR0ZW1wJGxpc3Q7CgkJCQljb250aW51ZSByYW5nZUhlbHA7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gbGlzdDsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJExpc3QkcmFuZ2UgPSBGMigKCWZ1bmN0aW9uIChsbywgaGkpIHsKCQlyZXR1cm4gQTMoJGVsbSRjb3JlJExpc3QkcmFuZ2VIZWxwLCBsbywgaGksIF9MaXN0X05pbCk7Cgl9KTsKdmFyICRlbG0kY29yZSRMaXN0JGluZGV4ZWRNYXAgPSBGMigKCWZ1bmN0aW9uIChmLCB4cykgewoJCXJldHVybiBBMygKCQkJJGVsbSRjb3JlJExpc3QkbWFwMiwKCQkJZiwKCQkJQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRyYW5nZSwKCQkJCTAsCgkJCQkkZWxtJGNvcmUkTGlzdCRsZW5ndGgoeHMpIC0gMSksCgkJCXhzKTsKCX0pOwp2YXIgJGVsbSRjb3JlJENoYXIkdG9Db2RlID0gX0NoYXJfdG9Db2RlOwp2YXIgJGVsbSRjb3JlJENoYXIkaXNMb3dlciA9IGZ1bmN0aW9uIChfY2hhcikgewoJdmFyIGNvZGUgPSAkZWxtJGNvcmUkQ2hhciR0b0NvZGUoX2NoYXIpOwoJcmV0dXJuICg5NyA8PSBjb2RlKSAmJiAoY29kZSA8PSAxMjIpOwp9Owp2YXIgJGVsbSRjb3JlJENoYXIkaXNVcHBlciA9IGZ1bmN0aW9uIChfY2hhcikgewoJdmFyIGNvZGUgPSAkZWxtJGNvcmUkQ2hhciR0b0NvZGUoX2NoYXIpOwoJcmV0dXJuIChjb2RlIDw9IDkwKSAmJiAoNjUgPD0gY29kZSk7Cn07CnZhciAkZWxtJGNvcmUkQmFzaWNzJG9yID0gX0Jhc2ljc19vcjsKdmFyICRlbG0kY29yZSRDaGFyJGlzQWxwaGEgPSBmdW5jdGlvbiAoX2NoYXIpIHsKCXJldHVybiAkZWxtJGNvcmUkQ2hhciRpc0xvd2VyKF9jaGFyKSB8fCAkZWxtJGNvcmUkQ2hhciRpc1VwcGVyKF9jaGFyKTsKfTsKdmFyICRlbG0kY29yZSRDaGFyJGlzRGlnaXQgPSBmdW5jdGlvbiAoX2NoYXIpIHsKCXZhciBjb2RlID0gJGVsbSRjb3JlJENoYXIkdG9Db2RlKF9jaGFyKTsKCXJldHVybiAoY29kZSA8PSA1NykgJiYgKDQ4IDw9IGNvZGUpOwp9Owp2YXIgJGVsbSRjb3JlJENoYXIkaXNBbHBoYU51bSA9IGZ1bmN0aW9uIChfY2hhcikgewoJcmV0dXJuICRlbG0kY29yZSRDaGFyJGlzTG93ZXIoX2NoYXIpIHx8ICgkZWxtJGNvcmUkQ2hhciRpc1VwcGVyKF9jaGFyKSB8fCAkZWxtJGNvcmUkQ2hhciRpc0RpZ2l0KF9jaGFyKSk7Cn07CnZhciAkZWxtJGNvcmUkTGlzdCRyZXZlcnNlID0gZnVuY3Rpb24gKGxpc3QpIHsKCXJldHVybiBBMygkZWxtJGNvcmUkTGlzdCRmb2xkbCwgJGVsbSRjb3JlJExpc3QkY29ucywgX0xpc3RfTmlsLCBsaXN0KTsKfTsKdmFyICRlbG0kY29yZSRTdHJpbmckdW5jb25zID0gX1N0cmluZ191bmNvbnM7CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkZXJyb3JPbmVPZiA9IEYyKAoJZnVuY3Rpb24gKGksIGVycm9yKSB7CgkJcmV0dXJuICdcblxuKCcgKyAoJGVsbSRjb3JlJFN0cmluZyRmcm9tSW50KGkgKyAxKSArICgnKSAnICsgJGVsbSRqc29uJEpzb24kRGVjb2RlJGluZGVudCgKCQkJJGVsbSRqc29uJEpzb24kRGVjb2RlJGVycm9yVG9TdHJpbmcoZXJyb3IpKSkpOwoJfSk7CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkZXJyb3JUb1N0cmluZyA9IGZ1bmN0aW9uIChlcnJvcikgewoJcmV0dXJuIEEyKCRlbG0kanNvbiRKc29uJERlY29kZSRlcnJvclRvU3RyaW5nSGVscCwgZXJyb3IsIF9MaXN0X05pbCk7Cn07CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkZXJyb3JUb1N0cmluZ0hlbHAgPSBGMigKCWZ1bmN0aW9uIChlcnJvciwgY29udGV4dCkgewoJCWVycm9yVG9TdHJpbmdIZWxwOgoJCXdoaWxlICh0cnVlKSB7CgkJCXN3aXRjaCAoZXJyb3IuJCkgewoJCQkJY2FzZSAnRmllbGQnOgoJCQkJCXZhciBmID0gZXJyb3IuYTsKCQkJCQl2YXIgZXJyID0gZXJyb3IuYjsKCQkJCQl2YXIgaXNTaW1wbGUgPSBmdW5jdGlvbiAoKSB7CgkJCQkJCXZhciBfdjEgPSAkZWxtJGNvcmUkU3RyaW5nJHVuY29ucyhmKTsKCQkJCQkJaWYgKF92MS4kID09PSAnTm90aGluZycpIHsKCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXZhciBfdjIgPSBfdjEuYTsKCQkJCQkJCXZhciBfY2hhciA9IF92Mi5hOwoJCQkJCQkJdmFyIHJlc3QgPSBfdjIuYjsKCQkJCQkJCXJldHVybiAkZWxtJGNvcmUkQ2hhciRpc0FscGhhKF9jaGFyKSAmJiBBMigkZWxtJGNvcmUkU3RyaW5nJGFsbCwgJGVsbSRjb3JlJENoYXIkaXNBbHBoYU51bSwgcmVzdCk7CgkJCQkJCX0KCQkJCQl9KCk7CgkJCQkJdmFyIGZpZWxkTmFtZSA9IGlzU2ltcGxlID8gKCcuJyArIGYpIDogKCdbXCcnICsgKGYgKyAnXCddJykpOwoJCQkJCXZhciAkdGVtcCRlcnJvciA9IGVyciwKCQkJCQkJJHRlbXAkY29udGV4dCA9IEEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIGZpZWxkTmFtZSwgY29udGV4dCk7CgkJCQkJZXJyb3IgPSAkdGVtcCRlcnJvcjsKCQkJCQljb250ZXh0ID0gJHRlbXAkY29udGV4dDsKCQkJCQljb250aW51ZSBlcnJvclRvU3RyaW5nSGVscDsKCQkJCWNhc2UgJ0luZGV4JzoKCQkJCQl2YXIgaSA9IGVycm9yLmE7CgkJCQkJdmFyIGVyciA9IGVycm9yLmI7CgkJCQkJdmFyIGluZGV4TmFtZSA9ICdbJyArICgkZWxtJGNvcmUkU3RyaW5nJGZyb21JbnQoaSkgKyAnXScpOwoJCQkJCXZhciAkdGVtcCRlcnJvciA9IGVyciwKCQkJCQkJJHRlbXAkY29udGV4dCA9IEEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIGluZGV4TmFtZSwgY29udGV4dCk7CgkJCQkJZXJyb3IgPSAkdGVtcCRlcnJvcjsKCQkJCQljb250ZXh0ID0gJHRlbXAkY29udGV4dDsKCQkJCQljb250aW51ZSBlcnJvclRvU3RyaW5nSGVscDsKCQkJCWNhc2UgJ09uZU9mJzoKCQkJCQl2YXIgZXJyb3JzID0gZXJyb3IuYTsKCQkJCQlpZiAoIWVycm9ycy5iKSB7CgkJCQkJCXJldHVybiAnUmFuIGludG8gYSBKc29uLkRlY29kZS5vbmVPZiB3aXRoIG5vIHBvc3NpYmlsaXRpZXMnICsgZnVuY3Rpb24gKCkgewoJCQkJCQkJaWYgKCFjb250ZXh0LmIpIHsKCQkJCQkJCQlyZXR1cm4gJyEnOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlyZXR1cm4gJyBhdCBqc29uJyArIEEyKAoJCQkJCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGpvaW4sCgkJCQkJCQkJCScnLAoJCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRyZXZlcnNlKGNvbnRleHQpKTsKCQkJCQkJCX0KCQkJCQkJfSgpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWlmICghZXJyb3JzLmIuYikgewoJCQkJCQkJdmFyIGVyciA9IGVycm9ycy5hOwoJCQkJCQkJdmFyICR0ZW1wJGVycm9yID0gZXJyLAoJCQkJCQkJCSR0ZW1wJGNvbnRleHQgPSBjb250ZXh0OwoJCQkJCQkJZXJyb3IgPSAkdGVtcCRlcnJvcjsKCQkJCQkJCWNvbnRleHQgPSAkdGVtcCRjb250ZXh0OwoJCQkJCQkJY29udGludWUgZXJyb3JUb1N0cmluZ0hlbHA7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2YXIgc3RhcnRlciA9IGZ1bmN0aW9uICgpIHsKCQkJCQkJCQlpZiAoIWNvbnRleHQuYikgewoJCQkJCQkJCQlyZXR1cm4gJ0pzb24uRGVjb2RlLm9uZU9mJzsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlyZXR1cm4gJ1RoZSBKc29uLkRlY29kZS5vbmVPZiBhdCBqc29uJyArIEEyKAoJCQkJCQkJCQkJJGVsbSRjb3JlJFN0cmluZyRqb2luLAoJCQkJCQkJCQkJJycsCgkJCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRyZXZlcnNlKGNvbnRleHQpKTsKCQkJCQkJCQl9CgkJCQkJCQl9KCk7CgkJCQkJCQl2YXIgaW50cm9kdWN0aW9uID0gc3RhcnRlciArICgnIGZhaWxlZCBpbiB0aGUgZm9sbG93aW5nICcgKyAoJGVsbSRjb3JlJFN0cmluZyRmcm9tSW50KAoJCQkJCQkJCSRlbG0kY29yZSRMaXN0JGxlbmd0aChlcnJvcnMpKSArICcgd2F5czonKSk7CgkJCQkJCQlyZXR1cm4gQTIoCgkJCQkJCQkJJGVsbSRjb3JlJFN0cmluZyRqb2luLAoJCQkJCQkJCSdcblxuJywKCQkJCQkJCQlBMigKCQkJCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJCQkJaW50cm9kdWN0aW9uLAoJCQkJCQkJCQlBMigkZWxtJGNvcmUkTGlzdCRpbmRleGVkTWFwLCAkZWxtJGpzb24kSnNvbiREZWNvZGUkZXJyb3JPbmVPZiwgZXJyb3JzKSkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJZGVmYXVsdDoKCQkJCQl2YXIgbXNnID0gZXJyb3IuYTsKCQkJCQl2YXIganNvbiA9IGVycm9yLmI7CgkJCQkJdmFyIGludHJvZHVjdGlvbiA9IGZ1bmN0aW9uICgpIHsKCQkJCQkJaWYgKCFjb250ZXh0LmIpIHsKCQkJCQkJCXJldHVybiAnUHJvYmxlbSB3aXRoIHRoZSBnaXZlbiB2YWx1ZTpcblxuJzsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXJldHVybiAnUHJvYmxlbSB3aXRoIHRoZSB2YWx1ZSBhdCBqc29uJyArIChBMigKCQkJCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGpvaW4sCgkJCQkJCQkJJycsCgkJCQkJCQkJJGVsbSRjb3JlJExpc3QkcmV2ZXJzZShjb250ZXh0KSkgKyAnOlxuXG4gICAgJyk7CgkJCQkJCX0KCQkJCQl9KCk7CgkJCQkJcmV0dXJuIGludHJvZHVjdGlvbiArICgkZWxtJGpzb24kSnNvbiREZWNvZGUkaW5kZW50KAoJCQkJCQlBMigkZWxtJGpzb24kSnNvbiRFbmNvZGUkZW5jb2RlLCA0LCBqc29uKSkgKyAoJ1xuXG4nICsgbXNnKSk7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRBcnJheSRicmFuY2hGYWN0b3IgPSAzMjsKdmFyICRlbG0kY29yZSRBcnJheSRBcnJheV9lbG1fYnVpbHRpbiA9IEY0KAoJZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKCQlyZXR1cm4geyQ6ICdBcnJheV9lbG1fYnVpbHRpbicsIGE6IGEsIGI6IGIsIGM6IGMsIGQ6IGR9OwoJfSk7CnZhciAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZW1wdHkgPSBfSnNBcnJheV9lbXB0eTsKdmFyICRlbG0kY29yZSRCYXNpY3MkY2VpbGluZyA9IF9CYXNpY3NfY2VpbGluZzsKdmFyICRlbG0kY29yZSRCYXNpY3MkZmRpdiA9IF9CYXNpY3NfZmRpdjsKdmFyICRlbG0kY29yZSRCYXNpY3MkbG9nQmFzZSA9IEYyKAoJZnVuY3Rpb24gKGJhc2UsIG51bWJlcikgewoJCXJldHVybiBfQmFzaWNzX2xvZyhudW1iZXIpIC8gX0Jhc2ljc19sb2coYmFzZSk7Cgl9KTsKdmFyICRlbG0kY29yZSRCYXNpY3MkdG9GbG9hdCA9IF9CYXNpY3NfdG9GbG9hdDsKdmFyICRlbG0kY29yZSRBcnJheSRzaGlmdFN0ZXAgPSAkZWxtJGNvcmUkQmFzaWNzJGNlaWxpbmcoCglBMigkZWxtJGNvcmUkQmFzaWNzJGxvZ0Jhc2UsIDIsICRlbG0kY29yZSRBcnJheSRicmFuY2hGYWN0b3IpKTsKdmFyICRlbG0kY29yZSRBcnJheSRlbXB0eSA9IEE0KCRlbG0kY29yZSRBcnJheSRBcnJheV9lbG1fYnVpbHRpbiwgMCwgJGVsbSRjb3JlJEFycmF5JHNoaWZ0U3RlcCwgJGVsbSRjb3JlJEVsbSRKc0FycmF5JGVtcHR5LCAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZW1wdHkpOwp2YXIgJGVsbSRjb3JlJEVsbSRKc0FycmF5JGluaXRpYWxpemUgPSBfSnNBcnJheV9pbml0aWFsaXplOwp2YXIgJGVsbSRjb3JlJEFycmF5JExlYWYgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnTGVhZicsIGE6IGF9Owp9Owp2YXIgJGVsbSRjb3JlJEJhc2ljcyRhcEwgPSBGMigKCWZ1bmN0aW9uIChmLCB4KSB7CgkJcmV0dXJuIGYoeCk7Cgl9KTsKdmFyICRlbG0kY29yZSRCYXNpY3MkYXBSID0gRjIoCglmdW5jdGlvbiAoeCwgZikgewoJCXJldHVybiBmKHgpOwoJfSk7CnZhciAkZWxtJGNvcmUkQmFzaWNzJGVxID0gX1V0aWxzX2VxdWFsOwp2YXIgJGVsbSRjb3JlJEJhc2ljcyRmbG9vciA9IF9CYXNpY3NfZmxvb3I7CnZhciAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkbGVuZ3RoID0gX0pzQXJyYXlfbGVuZ3RoOwp2YXIgJGVsbSRjb3JlJEJhc2ljcyRndCA9IF9VdGlsc19ndDsKdmFyICRlbG0kY29yZSRCYXNpY3MkbWF4ID0gRjIoCglmdW5jdGlvbiAoeCwgeSkgewoJCXJldHVybiAoX1V0aWxzX2NtcCh4LCB5KSA+IDApID8geCA6IHk7Cgl9KTsKdmFyICRlbG0kY29yZSRCYXNpY3MkbXVsID0gX0Jhc2ljc19tdWw7CnZhciAkZWxtJGNvcmUkQXJyYXkkU3ViVHJlZSA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdTdWJUcmVlJywgYTogYX07Cn07CnZhciAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkaW5pdGlhbGl6ZUZyb21MaXN0ID0gX0pzQXJyYXlfaW5pdGlhbGl6ZUZyb21MaXN0Owp2YXIgJGVsbSRjb3JlJEFycmF5JGNvbXByZXNzTm9kZXMgPSBGMigKCWZ1bmN0aW9uIChub2RlcywgYWNjKSB7CgkJY29tcHJlc3NOb2RlczoKCQl3aGlsZSAodHJ1ZSkgewoJCQl2YXIgX3YwID0gQTIoJGVsbSRjb3JlJEVsbSRKc0FycmF5JGluaXRpYWxpemVGcm9tTGlzdCwgJGVsbSRjb3JlJEFycmF5JGJyYW5jaEZhY3Rvciwgbm9kZXMpOwoJCQl2YXIgbm9kZSA9IF92MC5hOwoJCQl2YXIgcmVtYWluaW5nTm9kZXMgPSBfdjAuYjsKCQkJdmFyIG5ld0FjYyA9IEEyKAoJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCSRlbG0kY29yZSRBcnJheSRTdWJUcmVlKG5vZGUpLAoJCQkJYWNjKTsKCQkJaWYgKCFyZW1haW5pbmdOb2Rlcy5iKSB7CgkJCQlyZXR1cm4gJGVsbSRjb3JlJExpc3QkcmV2ZXJzZShuZXdBY2MpOwoJCQl9IGVsc2UgewoJCQkJdmFyICR0ZW1wJG5vZGVzID0gcmVtYWluaW5nTm9kZXMsCgkJCQkJJHRlbXAkYWNjID0gbmV3QWNjOwoJCQkJbm9kZXMgPSAkdGVtcCRub2RlczsKCQkJCWFjYyA9ICR0ZW1wJGFjYzsKCQkJCWNvbnRpbnVlIGNvbXByZXNzTm9kZXM7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRUdXBsZSRmaXJzdCA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciB4ID0gX3YwLmE7CglyZXR1cm4geDsKfTsKdmFyICRlbG0kY29yZSRBcnJheSR0cmVlRnJvbUJ1aWxkZXIgPSBGMigKCWZ1bmN0aW9uIChub2RlTGlzdCwgbm9kZUxpc3RTaXplKSB7CgkJdHJlZUZyb21CdWlsZGVyOgoJCXdoaWxlICh0cnVlKSB7CgkJCXZhciBuZXdOb2RlU2l6ZSA9ICRlbG0kY29yZSRCYXNpY3MkY2VpbGluZyhub2RlTGlzdFNpemUgLyAkZWxtJGNvcmUkQXJyYXkkYnJhbmNoRmFjdG9yKTsKCQkJaWYgKG5ld05vZGVTaXplID09PSAxKSB7CgkJCQlyZXR1cm4gQTIoJGVsbSRjb3JlJEVsbSRKc0FycmF5JGluaXRpYWxpemVGcm9tTGlzdCwgJGVsbSRjb3JlJEFycmF5JGJyYW5jaEZhY3Rvciwgbm9kZUxpc3QpLmE7CgkJCX0gZWxzZSB7CgkJCQl2YXIgJHRlbXAkbm9kZUxpc3QgPSBBMigkZWxtJGNvcmUkQXJyYXkkY29tcHJlc3NOb2Rlcywgbm9kZUxpc3QsIF9MaXN0X05pbCksCgkJCQkJJHRlbXAkbm9kZUxpc3RTaXplID0gbmV3Tm9kZVNpemU7CgkJCQlub2RlTGlzdCA9ICR0ZW1wJG5vZGVMaXN0OwoJCQkJbm9kZUxpc3RTaXplID0gJHRlbXAkbm9kZUxpc3RTaXplOwoJCQkJY29udGludWUgdHJlZUZyb21CdWlsZGVyOwoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkQXJyYXkkYnVpbGRlclRvQXJyYXkgPSBGMigKCWZ1bmN0aW9uIChyZXZlcnNlTm9kZUxpc3QsIGJ1aWxkZXIpIHsKCQlpZiAoIWJ1aWxkZXIubm9kZUxpc3RTaXplKSB7CgkJCXJldHVybiBBNCgKCQkJCSRlbG0kY29yZSRBcnJheSRBcnJheV9lbG1fYnVpbHRpbiwKCQkJCSRlbG0kY29yZSRFbG0kSnNBcnJheSRsZW5ndGgoYnVpbGRlci50YWlsKSwKCQkJCSRlbG0kY29yZSRBcnJheSRzaGlmdFN0ZXAsCgkJCQkkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZW1wdHksCgkJCQlidWlsZGVyLnRhaWwpOwoJCX0gZWxzZSB7CgkJCXZhciB0cmVlTGVuID0gYnVpbGRlci5ub2RlTGlzdFNpemUgKiAkZWxtJGNvcmUkQXJyYXkkYnJhbmNoRmFjdG9yOwoJCQl2YXIgZGVwdGggPSAkZWxtJGNvcmUkQmFzaWNzJGZsb29yKAoJCQkJQTIoJGVsbSRjb3JlJEJhc2ljcyRsb2dCYXNlLCAkZWxtJGNvcmUkQXJyYXkkYnJhbmNoRmFjdG9yLCB0cmVlTGVuIC0gMSkpOwoJCQl2YXIgY29ycmVjdE5vZGVMaXN0ID0gcmV2ZXJzZU5vZGVMaXN0ID8gJGVsbSRjb3JlJExpc3QkcmV2ZXJzZShidWlsZGVyLm5vZGVMaXN0KSA6IGJ1aWxkZXIubm9kZUxpc3Q7CgkJCXZhciB0cmVlID0gQTIoJGVsbSRjb3JlJEFycmF5JHRyZWVGcm9tQnVpbGRlciwgY29ycmVjdE5vZGVMaXN0LCBidWlsZGVyLm5vZGVMaXN0U2l6ZSk7CgkJCXJldHVybiBBNCgKCQkJCSRlbG0kY29yZSRBcnJheSRBcnJheV9lbG1fYnVpbHRpbiwKCQkJCSRlbG0kY29yZSRFbG0kSnNBcnJheSRsZW5ndGgoYnVpbGRlci50YWlsKSArIHRyZWVMZW4sCgkJCQlBMigkZWxtJGNvcmUkQmFzaWNzJG1heCwgNSwgZGVwdGggKiAkZWxtJGNvcmUkQXJyYXkkc2hpZnRTdGVwKSwKCQkJCXRyZWUsCgkJCQlidWlsZGVyLnRhaWwpOwoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJEJhc2ljcyRpZGl2ID0gX0Jhc2ljc19pZGl2Owp2YXIgJGVsbSRjb3JlJEJhc2ljcyRsdCA9IF9VdGlsc19sdDsKdmFyICRlbG0kY29yZSRBcnJheSRpbml0aWFsaXplSGVscCA9IEY1KAoJZnVuY3Rpb24gKGZuLCBmcm9tSW5kZXgsIGxlbiwgbm9kZUxpc3QsIHRhaWwpIHsKCQlpbml0aWFsaXplSGVscDoKCQl3aGlsZSAodHJ1ZSkgewoJCQlpZiAoZnJvbUluZGV4IDwgMCkgewoJCQkJcmV0dXJuIEEyKAoJCQkJCSRlbG0kY29yZSRBcnJheSRidWlsZGVyVG9BcnJheSwKCQkJCQlmYWxzZSwKCQkJCQl7bm9kZUxpc3Q6IG5vZGVMaXN0LCBub2RlTGlzdFNpemU6IChsZW4gLyAkZWxtJGNvcmUkQXJyYXkkYnJhbmNoRmFjdG9yKSB8IDAsIHRhaWw6IHRhaWx9KTsKCQkJfSBlbHNlIHsKCQkJCXZhciBsZWFmID0gJGVsbSRjb3JlJEFycmF5JExlYWYoCgkJCQkJQTMoJGVsbSRjb3JlJEVsbSRKc0FycmF5JGluaXRpYWxpemUsICRlbG0kY29yZSRBcnJheSRicmFuY2hGYWN0b3IsIGZyb21JbmRleCwgZm4pKTsKCQkJCXZhciAkdGVtcCRmbiA9IGZuLAoJCQkJCSR0ZW1wJGZyb21JbmRleCA9IGZyb21JbmRleCAtICRlbG0kY29yZSRBcnJheSRicmFuY2hGYWN0b3IsCgkJCQkJJHRlbXAkbGVuID0gbGVuLAoJCQkJCSR0ZW1wJG5vZGVMaXN0ID0gQTIoJGVsbSRjb3JlJExpc3QkY29ucywgbGVhZiwgbm9kZUxpc3QpLAoJCQkJCSR0ZW1wJHRhaWwgPSB0YWlsOwoJCQkJZm4gPSAkdGVtcCRmbjsKCQkJCWZyb21JbmRleCA9ICR0ZW1wJGZyb21JbmRleDsKCQkJCWxlbiA9ICR0ZW1wJGxlbjsKCQkJCW5vZGVMaXN0ID0gJHRlbXAkbm9kZUxpc3Q7CgkJCQl0YWlsID0gJHRlbXAkdGFpbDsKCQkJCWNvbnRpbnVlIGluaXRpYWxpemVIZWxwOwoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkQmFzaWNzJHJlbWFpbmRlckJ5ID0gX0Jhc2ljc19yZW1haW5kZXJCeTsKdmFyICRlbG0kY29yZSRBcnJheSRpbml0aWFsaXplID0gRjIoCglmdW5jdGlvbiAobGVuLCBmbikgewoJCWlmIChsZW4gPD0gMCkgewoJCQlyZXR1cm4gJGVsbSRjb3JlJEFycmF5JGVtcHR5OwoJCX0gZWxzZSB7CgkJCXZhciB0YWlsTGVuID0gbGVuICUgJGVsbSRjb3JlJEFycmF5JGJyYW5jaEZhY3RvcjsKCQkJdmFyIHRhaWwgPSBBMygkZWxtJGNvcmUkRWxtJEpzQXJyYXkkaW5pdGlhbGl6ZSwgdGFpbExlbiwgbGVuIC0gdGFpbExlbiwgZm4pOwoJCQl2YXIgaW5pdGlhbEZyb21JbmRleCA9IChsZW4gLSB0YWlsTGVuKSAtICRlbG0kY29yZSRBcnJheSRicmFuY2hGYWN0b3I7CgkJCXJldHVybiBBNSgkZWxtJGNvcmUkQXJyYXkkaW5pdGlhbGl6ZUhlbHAsIGZuLCBpbml0aWFsRnJvbUluZGV4LCBsZW4sIF9MaXN0X05pbCwgdGFpbCk7CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkQmFzaWNzJFRydWUgPSB7JDogJ1RydWUnfTsKdmFyICRlbG0kY29yZSRSZXN1bHQkaXNPayA9IGZ1bmN0aW9uIChyZXN1bHQpIHsKCWlmIChyZXN1bHQuJCA9PT0gJ09rJykgewoJCXJldHVybiB0cnVlOwoJfSBlbHNlIHsKCQlyZXR1cm4gZmFsc2U7Cgl9Cn07CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkbWFwID0gX0pzb25fbWFwMTsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRtYXAyID0gX0pzb25fbWFwMjsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRzdWNjZWVkID0gX0pzb25fc3VjY2VlZDsKdmFyICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSR0b0hhbmRsZXJJbnQgPSBmdW5jdGlvbiAoaGFuZGxlcikgewoJc3dpdGNoIChoYW5kbGVyLiQpIHsKCQljYXNlICdOb3JtYWwnOgoJCQlyZXR1cm4gMDsKCQljYXNlICdNYXlTdG9wUHJvcGFnYXRpb24nOgoJCQlyZXR1cm4gMTsKCQljYXNlICdNYXlQcmV2ZW50RGVmYXVsdCc6CgkJCXJldHVybiAyOwoJCWRlZmF1bHQ6CgkJCXJldHVybiAzOwoJfQp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kQXJyYXlTZXEgPSB7JDogJ0FycmF5U2VxJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRCbG9ja01vc3QgPSB7JDogJ0Jsb2NrTW9zdCd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQmxvY2tOb25lID0geyQ6ICdCbG9ja05vbmUnfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJENvbnN0cnVjdG9yID0gRjMoCglmdW5jdGlvbiAoYSwgYiwgYykgewoJCXJldHVybiB7JDogJ0NvbnN0cnVjdG9yJywgYTogYSwgYjogYiwgYzogY307Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJERpY3Rpb25hcnkgPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnRGljdGlvbmFyeScsIGE6IGEsIGI6IGJ9OwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiREb3duID0geyQ6ICdEb3duJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRMaXN0U2VxID0geyQ6ICdMaXN0U2VxJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiROb09wID0geyQ6ICdOb09wJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRQcmltaXRpdmUgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnUHJpbWl0aXZlJywgYTogYX07Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRSZWNvcmQgPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnUmVjb3JkJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFMgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnUycsIGE6IGF9Owp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kU2VxdWVuY2UgPSBGMygKCWZ1bmN0aW9uIChhLCBiLCBjKSB7CgkJcmV0dXJuIHskOiAnU2VxdWVuY2UnLCBhOiBhLCBiOiBiLCBjOiBjfTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kU2V0U2VxID0geyQ6ICdTZXRTZXEnfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFVwID0geyQ6ICdVcCd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVXNlck1zZyA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdVc2VyTXNnJywgYTogYX07Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRFeHBvcnQgPSB7JDogJ0V4cG9ydCd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kSW1wb3J0ID0geyQ6ICdJbXBvcnQnfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJE9wZW4gPSB7JDogJ09wZW4nfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJE92ZXJsYXlNc2cgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnT3ZlcmxheU1zZycsIGE6IGF9Owp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kUmVzdW1lID0geyQ6ICdSZXN1bWUnfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGlzUGF1c2VkID0gZnVuY3Rpb24gKHN0YXRlKSB7CglpZiAoc3RhdGUuJCA9PT0gJ1J1bm5pbmcnKSB7CgkJcmV0dXJuIGZhbHNlOwoJfSBlbHNlIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHNpemUgPSBmdW5jdGlvbiAoaGlzdG9yeSkgewoJcmV0dXJuIGhpc3RvcnkubnVtTWVzc2FnZXM7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRBY2NlcHQgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnQWNjZXB0JywgYTogYX07Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRDaG9vc2UgPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnQ2hvb3NlJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kaHRtbCRIdG1sJGRpdiA9IF9WaXJ0dWFsRG9tX25vZGUoJ2RpdicpOwp2YXIgJGVsbSRqc29uJEpzb24kRW5jb2RlJHN0cmluZyA9IF9Kc29uX3dyYXA7CnZhciAkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0cmluZ1Byb3BlcnR5ID0gRjIoCglmdW5jdGlvbiAoa2V5LCBzdHJpbmcpIHsKCQlyZXR1cm4gQTIoCgkJCV9WaXJ0dWFsRG9tX3Byb3BlcnR5LAoJCQlrZXksCgkJCSRlbG0kanNvbiRKc29uJEVuY29kZSRzdHJpbmcoc3RyaW5nKSk7Cgl9KTsKdmFyICRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkaWQgPSAkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0cmluZ1Byb3BlcnR5KCdpZCcpOwp2YXIgJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJE5vcm1hbCA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdOb3JtYWwnLCBhOiBhfTsKfTsKdmFyICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRvbiA9IF9WaXJ0dWFsRG9tX29uOwp2YXIgJGVsbSRodG1sJEh0bWwkRXZlbnRzJG9uID0gRjIoCglmdW5jdGlvbiAoZXZlbnQsIGRlY29kZXIpIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRvbiwKCQkJZXZlbnQsCgkJCSRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSROb3JtYWwoZGVjb2RlcikpOwoJfSk7CnZhciAkZWxtJGh0bWwkSHRtbCRFdmVudHMkb25DbGljayA9IGZ1bmN0aW9uIChtc2cpIHsKCXJldHVybiBBMigKCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb24sCgkJJ2NsaWNrJywKCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkc3VjY2VlZChtc2cpKTsKfTsKdmFyICRlbG0kaHRtbCRIdG1sJHNwYW4gPSBfVmlydHVhbERvbV9ub2RlKCdzcGFuJyk7CnZhciAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kc3R5bGUgPSBfVmlydHVhbERvbV9zdHlsZTsKdmFyICRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUgPSAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kc3R5bGU7CnZhciAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kdGV4dCA9IF9WaXJ0dWFsRG9tX3RleHQ7CnZhciAkZWxtJGh0bWwkSHRtbCR0ZXh0ID0gJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJHRleHQ7CnZhciAkZWxtJGh0bWwkSHRtbCRhID0gX1ZpcnR1YWxEb21fbm9kZSgnYScpOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkZ29vZE5ld3MxID0gJ1xuVGhlIGdvb2QgbmV3cyBpcyB0aGF0IGhhdmluZyB2YWx1ZXMgbGlrZSB0aGlzIGluIHlvdXIgbWVzc2FnZSB0eXBlIGlzIG5vdFxuc28gZ3JlYXQgaW4gdGhlIGxvbmcgcnVuLiBZb3UgYXJlIGJldHRlciBvZmYgdXNpbmcgc2ltcGxlciBkYXRhLCBsaWtlXG4nOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkZ29vZE5ld3MyID0gJ1xuZnVuY3Rpb24gY2FuIHBhdHRlcm4gbWF0Y2ggb24gdGhhdCBkYXRhIGFuZCBjYWxsIHdoYXRldmVyIGZ1bmN0aW9ucywgSlNPTlxuZGVjb2RlcnMsIGV0Yy4geW91IG5lZWQuIFRoaXMgbWFrZXMgdGhlIGNvZGUgbXVjaCBtb3JlIGV4cGxpY2l0IGFuZCBlYXN5IHRvXG5mb2xsb3cgZm9yIG90aGVyIHJlYWRlcnMgKG9yIHlvdSBpbiBhIGZldyBtb250aHMhKVxuJzsKdmFyICRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkaHJlZiA9IGZ1bmN0aW9uICh1cmwpIHsKCXJldHVybiBBMigKCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0cmluZ1Byb3BlcnR5LAoJCSdocmVmJywKCQlfVmlydHVhbERvbV9ub0phdmFTY3JpcHRVcmkodXJsKSk7Cn07CnZhciAkZWxtJGNvcmUkTGlzdCRmb2xkckhlbHBlciA9IEY0KAoJZnVuY3Rpb24gKGZuLCBhY2MsIGN0ciwgbHMpIHsKCQlpZiAoIWxzLmIpIHsKCQkJcmV0dXJuIGFjYzsKCQl9IGVsc2UgewoJCQl2YXIgYSA9IGxzLmE7CgkJCXZhciByMSA9IGxzLmI7CgkJCWlmICghcjEuYikgewoJCQkJcmV0dXJuIEEyKGZuLCBhLCBhY2MpOwoJCQl9IGVsc2UgewoJCQkJdmFyIGIgPSByMS5hOwoJCQkJdmFyIHIyID0gcjEuYjsKCQkJCWlmICghcjIuYikgewoJCQkJCXJldHVybiBBMigKCQkJCQkJZm4sCgkJCQkJCWEsCgkJCQkJCUEyKGZuLCBiLCBhY2MpKTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIGMgPSByMi5hOwoJCQkJCXZhciByMyA9IHIyLmI7CgkJCQkJaWYgKCFyMy5iKSB7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCWZuLAoJCQkJCQkJYSwKCQkJCQkJCUEyKAoJCQkJCQkJCWZuLAoJCQkJCQkJCWIsCgkJCQkJCQkJQTIoZm4sIGMsIGFjYykpKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl2YXIgZCA9IHIzLmE7CgkJCQkJCXZhciByNCA9IHIzLmI7CgkJCQkJCXZhciByZXMgPSAoY3RyID4gNTAwKSA/IEEzKAoJCQkJCQkJJGVsbSRjb3JlJExpc3QkZm9sZGwsCgkJCQkJCQlmbiwKCQkJCQkJCWFjYywKCQkJCQkJCSRlbG0kY29yZSRMaXN0JHJldmVyc2UocjQpKSA6IEE0KCRlbG0kY29yZSRMaXN0JGZvbGRySGVscGVyLCBmbiwgYWNjLCBjdHIgKyAxLCByNCk7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCWZuLAoJCQkJCQkJYSwKCQkJCQkJCUEyKAoJCQkJCQkJCWZuLAoJCQkJCQkJCWIsCgkJCQkJCQkJQTIoCgkJCQkJCQkJCWZuLAoJCQkJCQkJCQljLAoJCQkJCQkJCQlBMihmbiwgZCwgcmVzKSkpKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRMaXN0JGZvbGRyID0gRjMoCglmdW5jdGlvbiAoZm4sIGFjYywgbHMpIHsKCQlyZXR1cm4gQTQoJGVsbSRjb3JlJExpc3QkZm9sZHJIZWxwZXIsIGZuLCBhY2MsIDAsIGxzKTsKCX0pOwp2YXIgJGVsbSRjb3JlJExpc3QkbWFwID0gRjIoCglmdW5jdGlvbiAoZiwgeHMpIHsKCQlyZXR1cm4gQTMoCgkJCSRlbG0kY29yZSRMaXN0JGZvbGRyLAoJCQlGMigKCQkJCWZ1bmN0aW9uICh4LCBhY2MpIHsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCWYoeCksCgkJCQkJCWFjYyk7CgkJCQl9KSwKCQkJX0xpc3RfTmlsLAoJCQl4cyk7Cgl9KTsKdmFyICRlbG0kaHRtbCRIdG1sJHAgPSBfVmlydHVhbERvbV9ub2RlKCdwJyk7CnZhciAkZWxtJGh0bWwkSHRtbCR1bCA9IF9WaXJ0dWFsRG9tX25vZGUoJ3VsJyk7CnZhciAkZWxtJGh0bWwkSHRtbCRjb2RlID0gX1ZpcnR1YWxEb21fbm9kZSgnY29kZScpOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld0NvZGUgPSBmdW5jdGlvbiAobmFtZSkgewoJcmV0dXJuIEEyKAoJCSRlbG0kaHRtbCRIdG1sJGNvZGUsCgkJX0xpc3RfTmlsLAoJCV9MaXN0X2Zyb21BcnJheSgKCQkJWwoJCQkJJGVsbSRodG1sJEh0bWwkdGV4dChuYW1lKQoJCQldKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRhZGRDb21tYXMgPSBmdW5jdGlvbiAoaXRlbXMpIHsKCWlmICghaXRlbXMuYikgewoJCXJldHVybiAnJzsKCX0gZWxzZSB7CgkJaWYgKCFpdGVtcy5iLmIpIHsKCQkJdmFyIGl0ZW0gPSBpdGVtcy5hOwoJCQlyZXR1cm4gaXRlbTsKCQl9IGVsc2UgewoJCQlpZiAoIWl0ZW1zLmIuYi5iKSB7CgkJCQl2YXIgaXRlbTEgPSBpdGVtcy5hOwoJCQkJdmFyIF92MSA9IGl0ZW1zLmI7CgkJCQl2YXIgaXRlbTIgPSBfdjEuYTsKCQkJCXJldHVybiBpdGVtMSArICgnIGFuZCAnICsgaXRlbTIpOwoJCQl9IGVsc2UgewoJCQkJdmFyIGxhc3RJdGVtID0gaXRlbXMuYTsKCQkJCXZhciBvdGhlckl0ZW1zID0gaXRlbXMuYjsKCQkJCXJldHVybiBBMigKCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGpvaW4sCgkJCQkJJywgJywKCQkJCQlfVXRpbHNfYXAoCgkJCQkJCW90aGVySXRlbXMsCgkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCVsnIGFuZCAnICsgbGFzdEl0ZW1dKSkpOwoJCQl9CgkJfQoJfQp9Owp2YXIgJGVsbSRodG1sJEh0bWwkbGkgPSBfVmlydHVhbERvbV9ub2RlKCdsaScpOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkcHJvYmxlbVRvU3RyaW5nID0gZnVuY3Rpb24gKHByb2JsZW0pIHsKCXN3aXRjaCAocHJvYmxlbS4kKSB7CgkJY2FzZSAnRnVuY3Rpb24nOgoJCQlyZXR1cm4gJ2Z1bmN0aW9ucyc7CgkJY2FzZSAnRGVjb2Rlcic6CgkJCXJldHVybiAnSlNPTiBkZWNvZGVycyc7CgkJY2FzZSAnVGFzayc6CgkJCXJldHVybiAndGFza3MnOwoJCWNhc2UgJ1Byb2Nlc3MnOgoJCQlyZXR1cm4gJ3Byb2Nlc3Nlcyc7CgkJY2FzZSAnU29ja2V0JzoKCQkJcmV0dXJuICd3ZWIgc29ja2V0cyc7CgkJY2FzZSAnUmVxdWVzdCc6CgkJCXJldHVybiAnSFRUUCByZXF1ZXN0cyc7CgkJY2FzZSAnUHJvZ3JhbSc6CgkJCXJldHVybiAncHJvZ3JhbXMnOwoJCWRlZmF1bHQ6CgkJCXJldHVybiAndmlydHVhbCBET00gdmFsdWVzJzsKCX0KfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdQcm9ibGVtVHlwZSA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciBuYW1lID0gX3YwLm5hbWU7Cgl2YXIgcHJvYmxlbXMgPSBfdjAucHJvYmxlbXM7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkbGksCgkJX0xpc3RfTmlsLAoJCV9MaXN0X2Zyb21BcnJheSgKCQkJWwoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld0NvZGUobmFtZSksCgkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KAoJCQkJJyBjYW4gY29udGFpbiAnICsgKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JGFkZENvbW1hcygKCQkJCQlBMigkZWxtJGNvcmUkTGlzdCRtYXAsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHByb2JsZW1Ub1N0cmluZywgcHJvYmxlbXMpKSArICcuJykpCgkJCV0pKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdCYWRNZXRhZGF0YSA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciBtZXNzYWdlID0gX3YwLm1lc3NhZ2U7Cgl2YXIgcHJvYmxlbXMgPSBfdjAucHJvYmxlbXM7CglyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCVsKCQkJQTIoCgkJCSRlbG0kaHRtbCRIdG1sJHAsCgkJCV9MaXN0X05pbCwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJ1RoZSAnKSwKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3Q29kZShtZXNzYWdlKSwKCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCcgdHlwZSBvZiB5b3VyIHByb2dyYW0gY2Fubm90IGJlIHJlbGlhYmx5IHNlcmlhbGl6ZWQgZm9yIGhpc3RvcnkgZmlsZXMuJykKCQkJCV0pKSwKCQkJQTIoCgkJCSRlbG0kaHRtbCRIdG1sJHAsCgkJCV9MaXN0X05pbCwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJ0Z1bmN0aW9ucyBjYW5ub3QgYmUgc2VyaWFsaXplZCwgbm9yIGNhbiB2YWx1ZXMgdGhhdCBjb250YWluIGZ1bmN0aW9ucy4gVGhpcyBpcyBhIHByb2JsZW0gaW4gdGhlc2UgcGxhY2VzOicpCgkJCQldKSksCgkJCUEyKAoJCQkkZWxtJGh0bWwkSHRtbCR1bCwKCQkJX0xpc3RfTmlsLAoJCQlBMigkZWxtJGNvcmUkTGlzdCRtYXAsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdQcm9ibGVtVHlwZSwgcHJvYmxlbXMpKSwKCQkJQTIoCgkJCSRlbG0kaHRtbCRIdG1sJHAsCgkJCV9MaXN0X05pbCwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkZ29vZE5ld3MxKSwKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRhLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRocmVmKCdodHRwczovL2d1aWRlLmVsbS1sYW5nLm9yZy90eXBlcy9jdXN0b21fdHlwZXMuaHRtbCcpCgkJCQkJCV0pLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgnY3VzdG9tIHR5cGVzJykKCQkJCQkJXSkpLAoJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJywgaW4geW91ciBtZXNzYWdlcy4gRnJvbSB0aGVyZSwgeW91ciAnKSwKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3Q29kZSgndXBkYXRlJyksCgkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRnb29kTmV3czIpCgkJCQldKSkKCQldKTsKfTsKdmFyICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRtYXAgPSBfVmlydHVhbERvbV9tYXA7CnZhciAkZWxtJGh0bWwkSHRtbCRtYXAgPSAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kbWFwOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQ2FuY2VsID0geyQ6ICdDYW5jZWwnfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JFByb2NlZWQgPSB7JDogJ1Byb2NlZWQnfTsKdmFyICRlbG0kaHRtbCRIdG1sJGJ1dHRvbiA9IF9WaXJ0dWFsRG9tX25vZGUoJ2J1dHRvbicpOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld0J1dHRvbnMgPSBmdW5jdGlvbiAoYnV0dG9ucykgewoJdmFyIGJ0biA9IEYyKAoJCWZ1bmN0aW9uIChtc2csIHN0cmluZykgewoJCQlyZXR1cm4gQTIoCgkJCQkkZWxtJGh0bWwkSHRtbCRidXR0b24sCgkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnbWFyZ2luLXJpZ2h0JywgJzIwcHgnKSwKCQkJCQkJJGVsbSRodG1sJEh0bWwkRXZlbnRzJG9uQ2xpY2sobXNnKQoJCQkJCV0pLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dChzdHJpbmcpCgkJCQkJXSkpOwoJCX0pOwoJdmFyIGJ1dHRvbk5vZGVzID0gZnVuY3Rpb24gKCkgewoJCWlmIChidXR0b25zLiQgPT09ICdBY2NlcHQnKSB7CgkJCXZhciBwcm9jZWVkID0gYnV0dG9ucy5hOwoJCQlyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKGJ0biwgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkUHJvY2VlZCwgcHJvY2VlZCkKCQkJCV0pOwoJCX0gZWxzZSB7CgkJCXZhciBjYW5jZWwgPSBidXR0b25zLmE7CgkJCXZhciBwcm9jZWVkID0gYnV0dG9ucy5iOwoJCQlyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKGJ0biwgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQ2FuY2VsLCBjYW5jZWwpLAoJCQkJCUEyKGJ0biwgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkUHJvY2VlZCwgcHJvY2VlZCkKCQkJCV0pOwoJCX0KCX0oKTsKCXJldHVybiBBMigKCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnaGVpZ2h0JywgJzYwcHgnKSwKCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdsaW5lLWhlaWdodCcsICc2MHB4JyksCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAndGV4dC1hbGlnbicsICdyaWdodCcpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2JhY2tncm91bmQtY29sb3InLCAncmdiKDUwLCA1MCwgNTApJykKCQkJXSksCgkJYnV0dG9uTm9kZXMpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld01lc3NhZ2UgPSBGNCgKCWZ1bmN0aW9uIChjb25maWcsIHRpdGxlLCBkZXRhaWxzLCBidXR0b25zKSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJGlkKCdlbG0tZGVidWdnZXItb3ZlcmxheScpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb3NpdGlvbicsICdmaXhlZCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd0b3AnLCAnMCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdsZWZ0JywgJzAnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnd2lkdGgnLCAnMTAwdncnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnaGVpZ2h0JywgJzEwMHZoJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2NvbG9yJywgJ3doaXRlJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3BvaW50ZXItZXZlbnRzJywgJ25vbmUnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnZm9udC1mYW1pbHknLCAnXCdUcmVidWNoZXQgTVNcJywgXCdMdWNpZGEgR3JhbmRlXCcsIFwnQml0c3RyZWFtIFZlcmEgU2Fuc1wnLCBcJ0hlbHZldGljYSBOZXVlXCcsIHNhbnMtc2VyaWYnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnei1pbmRleCcsICcyMTQ3NDgzNjQ3JykKCQkJCV0pLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJyksCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnd2lkdGgnLCAnNjAwcHgnKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdoZWlnaHQnLCAnMTAwdmgnKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwYWRkaW5nLWxlZnQnLCAnY2FsYyg1MCUgLSAzMDBweCknKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwYWRkaW5nLXJpZ2h0JywgJ2NhbGMoNTAlIC0gMzAwcHgpJyksCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnYmFja2dyb3VuZC1jb2xvcicsICdyZ2JhKDIwMCwgMjAwLCAyMDAsIDAuNyknKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb2ludGVyLWV2ZW50cycsICdhdXRvJykKCQkJCQkJXSksCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQlBMigKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCQlbCgkJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdmb250LXNpemUnLCAnMzZweCcpLAoJCQkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnaGVpZ2h0JywgJzgwcHgnKSwKCQkJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2JhY2tncm91bmQtY29sb3InLCAncmdiKDUwLCA1MCwgNTApJyksCgkJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwYWRkaW5nLWxlZnQnLCAnMjJweCcpLAoJCQkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAndmVydGljYWwtYWxpZ24nLCAnbWlkZGxlJyksCgkJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdsaW5lLWhlaWdodCcsICc4MHB4JykKCQkJCQkJCQldKSwKCQkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCQlbCgkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQodGl0bGUpCgkJCQkJCQkJXSkpLAoJCQkJCQkJQTIoCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQkJWwoJCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJGlkKCdlbG0tZGVidWdnZXItZGV0YWlscycpLAoJCQkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAncGFkZGluZycsICcgOHB4IDIwcHgnKSwKCQkJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ292ZXJmbG93LXknLCAnYXV0bycpLAoJCQkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnbWF4LWhlaWdodCcsICdjYWxjKDEwMHZoIC0gMTU2cHgpJyksCgkJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdiYWNrZ3JvdW5kLWNvbG9yJywgJ3JnYig2MSwgNjEsIDYxKScpCgkJCQkJCQkJXSksCgkJCQkJCQlkZXRhaWxzKSwKCQkJCQkJCUEyKAoJCQkJCQkJJGVsbSRodG1sJEh0bWwkbWFwLAoJCQkJCQkJY29uZmlnLndyYXAsCgkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3QnV0dG9ucyhidXR0b25zKSkKCQkJCQkJXSkpCgkJCQldKSk7Cgl9KTsKdmFyICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRhdHRyaWJ1dGUgPSBGMigKCWZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CgkJcmV0dXJuIEEyKAoJCQlfVmlydHVhbERvbV9hdHRyaWJ1dGUsCgkJCV9WaXJ0dWFsRG9tX25vT25PckZvcm1BY3Rpb24oa2V5KSwKCQkJX1ZpcnR1YWxEb21fbm9KYXZhU2NyaXB0T3JIdG1sVXJpKHZhbHVlKSk7Cgl9KTsKdmFyICRlbG0kY29yZSRCYXNpY3MkbmVnYXRlID0gZnVuY3Rpb24gKG4pIHsKCXJldHVybiAtbjsKfTsKdmFyICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRub2RlTlMgPSBmdW5jdGlvbiAodGFnKSB7CglyZXR1cm4gX1ZpcnR1YWxEb21fbm9kZU5TKAoJCV9WaXJ0dWFsRG9tX25vU2NyaXB0KHRhZykpOwp9Owp2YXIgJGVsbSRjb3JlJFN0cmluZyRmcm9tRmxvYXQgPSBfU3RyaW5nX2Zyb21OdW1iZXI7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3U2hhcGUgPSBGNCgKCWZ1bmN0aW9uICh4LCB5LCBhbmdsZSwgY29vcmRpbmF0ZXMpIHsKCQlyZXR1cm4gQTQoCgkJCSRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRub2RlTlMsCgkJCSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsCgkJCSdwb2x5Z29uJywKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKCRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRhdHRyaWJ1dGUsICdwb2ludHMnLCBjb29yZGluYXRlcyksCgkJCQkJQTIoCgkJCQkJJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJGF0dHJpYnV0ZSwKCQkJCQkndHJhbnNmb3JtJywKCQkJCQkndHJhbnNsYXRlKCcgKyAoJGVsbSRjb3JlJFN0cmluZyRmcm9tRmxvYXQoeCkgKyAoJyAnICsgKCRlbG0kY29yZSRTdHJpbmckZnJvbUZsb2F0KHkpICsgKCcpIHJvdGF0ZSgnICsgKCRlbG0kY29yZSRTdHJpbmckZnJvbUZsb2F0KC1hbmdsZSkgKyAnKScpKSkpKSkKCQkJCV0pLAoJCQlfTGlzdF9OaWwpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRlbG1Mb2dvID0gQTQoCgkkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kbm9kZU5TLAoJJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywKCSdzdmcnLAoJX0xpc3RfZnJvbUFycmF5KAoJCVsKCQkJQTIoJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJGF0dHJpYnV0ZSwgJ3ZpZXdCb3gnLCAnLTMwMCAtMzAwIDYwMCA2MDAnKSwKCQkJQTIoJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJGF0dHJpYnV0ZSwgJ3htbG5zJywgJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyksCgkJCUEyKCRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRhdHRyaWJ1dGUsICdmaWxsJywgJ2N1cnJlbnRDb2xvcicpLAoJCQlBMigkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kYXR0cmlidXRlLCAnd2lkdGgnLCAnMjRweCcpLAoJCQlBMigkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kYXR0cmlidXRlLCAnaGVpZ2h0JywgJzI0cHgnKQoJCV0pLAoJX0xpc3RfZnJvbUFycmF5KAoJCVsKCQkJQTQoCgkJCSRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRub2RlTlMsCgkJCSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsCgkJCSdnJywKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKCRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRhdHRyaWJ1dGUsICd0cmFuc2Zvcm0nLCAnc2NhbGUoMSAtMSknKQoJCQkJXSksCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQlBNCgkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3U2hhcGUsIDAsIC0yMTAsIDAsICctMjgwLC05MCAwLDE5MCAyODAsLTkwJyksCgkJCQkJQTQoJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld1NoYXBlLCAtMjEwLCAwLCA5MCwgJy0yODAsLTkwIDAsMTkwIDI4MCwtOTAnKSwKCQkJCQlBNCgkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3U2hhcGUsIDIwNywgMjA3LCA0NSwgJy0xOTgsLTY2IDAsMTMyIDE5OCwtNjYnKSwKCQkJCQlBNCgkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3U2hhcGUsIDE1MCwgMCwgMCwgJy0xMzAsMCAwLC0xMzAgMTMwLDAgMCwxMzAnKSwKCQkJCQlBNCgkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3U2hhcGUsIC04OSwgMjM5LCAwLCAnLTE5MSw2MSA2OSw2MSAxOTEsLTYxIC02OSwtNjEnKSwKCQkJCQlBNCgkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3U2hhcGUsIDAsIDEwNiwgMTgwLCAnLTEzMCwtNDQgMCw4NiAgMTMwLC00NCcpLAoJCQkJCUE0KCRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdTaGFwZSwgMjU2LCAtMTUwLCAyNzAsICctMTMwLC00NCAwLDg2ICAxMzAsLTQ0JykKCQkJCV0pKQoJCV0pKTsKdmFyICRlbG0kY29yZSRTdHJpbmckbGVuZ3RoID0gX1N0cmluZ19sZW5ndGg7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3TWluaUNvbnRyb2xzID0gRjIoCglmdW5jdGlvbiAoY29uZmlnLCBudW1Nc2dzKSB7CgkJdmFyIHN0cmluZyA9ICRlbG0kY29yZSRTdHJpbmckZnJvbUludChudW1Nc2dzKTsKCQl2YXIgd2lkdGggPSAkZWxtJGNvcmUkU3RyaW5nJGZyb21JbnQoCgkJCTIgKyAkZWxtJGNvcmUkU3RyaW5nJGxlbmd0aChzdHJpbmcpKTsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb3NpdGlvbicsICdmaXhlZCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdib3R0b20nLCAnMmVtJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3JpZ2h0JywgJzJlbScpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd3aWR0aCcsICdjYWxjKDQycHggKyAnICsgKHdpZHRoICsgJ2NoKScpKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnaGVpZ2h0JywgJzM2cHgnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnYmFja2dyb3VuZC1jb2xvcicsICcjMTI5M0Q4JyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2NvbG9yJywgJ3doaXRlJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2ZvbnQtZmFtaWx5JywgJ21vbm9zcGFjZScpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb2ludGVyLWV2ZW50cycsICdhdXRvJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3otaW5kZXgnLCAnMjE0NzQ4MzY0NycpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdkaXNwbGF5JywgJ2ZsZXgnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnanVzdGlmeS1jb250ZW50JywgJ2NlbnRlcicpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdhbGlnbi1pdGVtcycsICdjZW50ZXInKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnY3Vyc29yJywgJ3BvaW50ZXInKSwKCQkJCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb25DbGljayhjb25maWcub3BlbikKCQkJCV0pLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkZWxtTG9nbywKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRzcGFuLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3BhZGRpbmctbGVmdCcsICdjYWxjKDFjaCArIDZweCknKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwYWRkaW5nLXJpZ2h0JywgJzFjaCcpCgkJCQkJCV0pLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dChzdHJpbmcpCgkJCQkJCV0pKQoJCQkJXSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRleHBsYW5hdGlvbkJhZCA9ICdcblRoZSBtZXNzYWdlcyBpbiB0aGlzIGhpc3RvcnkgZG8gbm90IG1hdGNoIHRoZSBtZXNzYWdlcyBoYW5kbGVkIGJ5IHlvdXJcbnByb2dyYW0uIEkgbm90aWNlZCBjaGFuZ2VzIGluIHRoZSBmb2xsb3dpbmcgdHlwZXM6XG4nOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkZXhwbGFuYXRpb25SaXNreSA9ICdcblRoaXMgaGlzdG9yeSBzZWVtcyBvbGQuIEl0IHdpbGwgd29yayB3aXRoIHRoaXMgcHJvZ3JhbSwgYnV0IHNvbWVcbm1lc3NhZ2VzIGhhdmUgYmVlbiBhZGRlZCBzaW5jZSB0aGUgaGlzdG9yeSB3YXMgY3JlYXRlZDpcbic7CnZhciAkZWxtJGNvcmUkTGlzdCRpbnRlcnNwZXJzZSA9IEYyKAoJZnVuY3Rpb24gKHNlcCwgeHMpIHsKCQlpZiAoIXhzLmIpIHsKCQkJcmV0dXJuIF9MaXN0X05pbDsKCQl9IGVsc2UgewoJCQl2YXIgaGQgPSB4cy5hOwoJCQl2YXIgdGwgPSB4cy5iOwoJCQl2YXIgc3RlcCA9IEYyKAoJCQkJZnVuY3Rpb24gKHgsIHJlc3QpIHsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCXNlcCwKCQkJCQkJQTIoJGVsbSRjb3JlJExpc3QkY29ucywgeCwgcmVzdCkpOwoJCQkJfSk7CgkJCXZhciBzcGVyc2VkID0gQTMoJGVsbSRjb3JlJExpc3QkZm9sZHIsIHN0ZXAsIF9MaXN0X05pbCwgdGwpOwoJCQlyZXR1cm4gQTIoJGVsbSRjb3JlJExpc3QkY29ucywgaGQsIHNwZXJzZWQpOwoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld01lbnRpb24gPSBGMigKCWZ1bmN0aW9uICh0YWdzLCB2ZXJiZWQpIHsKCQl2YXIgX3YwID0gQTIoCgkJCSRlbG0kY29yZSRMaXN0JG1hcCwKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld0NvZGUsCgkJCSRlbG0kY29yZSRMaXN0JHJldmVyc2UodGFncykpOwoJCWlmICghX3YwLmIpIHsKCQkJcmV0dXJuICRlbG0kaHRtbCRIdG1sJHRleHQoJycpOwoJCX0gZWxzZSB7CgkJCWlmICghX3YwLmIuYikgewoJCQkJdmFyIHRhZyA9IF92MC5hOwoJCQkJcmV0dXJuIEEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJGxpLAoJCQkJCV9MaXN0X05pbCwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQodmVyYmVkKSwKCQkJCQkJCXRhZywKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJy4nKQoJCQkJCQldKSk7CgkJCX0gZWxzZSB7CgkJCQlpZiAoIV92MC5iLmIuYikgewoJCQkJCXZhciB0YWcyID0gX3YwLmE7CgkJCQkJdmFyIF92MSA9IF92MC5iOwoJCQkJCXZhciB0YWcxID0gX3YxLmE7CgkJCQkJcmV0dXJuIEEyKAoJCQkJCQkkZWxtJGh0bWwkSHRtbCRsaSwKCQkJCQkJX0xpc3RfTmlsLAoJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQlbCgkJCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCh2ZXJiZWQpLAoJCQkJCQkJCXRhZzEsCgkJCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgnIGFuZCAnKSwKCQkJCQkJCQl0YWcyLAoJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJy4nKQoJCQkJCQkJXSkpOwoJCQkJfSBlbHNlIHsKCQkJCQl2YXIgbGFzdFRhZyA9IF92MC5hOwoJCQkJCXZhciBvdGhlclRhZ3MgPSBfdjAuYjsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kaHRtbCRIdG1sJGxpLAoJCQkJCQlfTGlzdF9OaWwsCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQodmVyYmVkKSwKCQkJCQkJCV9VdGlsc19hcCgKCQkJCQkJCQlBMigKCQkJCQkJCQkJJGVsbSRjb3JlJExpc3QkaW50ZXJzcGVyc2UsCgkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJywgJyksCgkJCQkJCQkJCSRlbG0kY29yZSRMaXN0JHJldmVyc2Uob3RoZXJUYWdzKSksCgkJCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJCQlbCgkJCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCcsIGFuZCAnKSwKCQkJCQkJCQkJCWxhc3RUYWcsCgkJCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCcuJykKCQkJCQkJCQkJXSkpKSk7CgkJCQl9CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdDaGFuZ2UgPSBmdW5jdGlvbiAoY2hhbmdlKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkbGksCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnbWFyZ2luJywgJzhweCAwJykKCQkJXSksCgkJZnVuY3Rpb24gKCkgewoJCQlpZiAoY2hhbmdlLiQgPT09ICdBbGlhc0NoYW5nZScpIHsKCQkJCXZhciBuYW1lID0gY2hhbmdlLmE7CgkJCQlyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJQTIoCgkJCQkJCSRlbG0kaHRtbCRIdG1sJHNwYW4sCgkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCVsKCQkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnZm9udC1zaXplJywgJzEuNWVtJykKCQkJCQkJCV0pLAoJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQlbCgkJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld0NvZGUobmFtZSkKCQkJCQkJCV0pKQoJCQkJCV0pOwoJCQl9IGVsc2UgewoJCQkJdmFyIG5hbWUgPSBjaGFuZ2UuYTsKCQkJCXZhciByZW1vdmVkID0gY2hhbmdlLmIucmVtb3ZlZDsKCQkJCXZhciBjaGFuZ2VkID0gY2hhbmdlLmIuY2hhbmdlZDsKCQkJCXZhciBhZGRlZCA9IGNoYW5nZS5iLmFkZGVkOwoJCQkJdmFyIGFyZ3NNYXRjaCA9IGNoYW5nZS5iLmFyZ3NNYXRjaDsKCQkJCXJldHVybiBfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQlBMigKCQkJCQkJJGVsbSRodG1sJEh0bWwkc3BhbiwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWwoJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdmb250LXNpemUnLCAnMS41ZW0nKQoJCQkJCQkJXSksCgkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCVsKCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3Q29kZShuYW1lKQoJCQkJCQkJXSkpLAoJCQkJCQlBMigKCQkJCQkJJGVsbSRodG1sJEh0bWwkdWwsCgkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCVsKCQkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnbGlzdC1zdHlsZS10eXBlJywgJ2Rpc2MnKSwKCQkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAncGFkZGluZy1sZWZ0JywgJzJlbScpCgkJCQkJCQldKSwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWwoJCQkJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdNZW50aW9uLCByZW1vdmVkLCAnUmVtb3ZlZCAnKSwKCQkJCQkJCQlBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3TWVudGlvbiwgY2hhbmdlZCwgJ0NoYW5nZWQgJyksCgkJCQkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld01lbnRpb24sIGFkZGVkLCAnQWRkZWQgJykKCQkJCQkJCV0pKSwKCQkJCQkJYXJnc01hdGNoID8gJGVsbSRodG1sJEh0bWwkdGV4dCgnJykgOiAkZWxtJGh0bWwkSHRtbCR0ZXh0KCdUaGlzIG1heSBiZSBkdWUgdG8gdGhlIGZhY3QgdGhhdCB0aGUgdHlwZSB2YXJpYWJsZSBuYW1lcyBjaGFuZ2VkLicpCgkJCQkJXSk7CgkJCX0KCQl9KCkpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld1JlcG9ydCA9IEYyKAoJZnVuY3Rpb24gKGlzQmFkLCByZXBvcnQpIHsKCQlzd2l0Y2ggKHJlcG9ydC4kKSB7CgkJCWNhc2UgJ0NvcnJ1cHRIaXN0b3J5JzoKCQkJCXJldHVybiBfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCdMb29rcyBsaWtlIHRoaXMgaGlzdG9yeSBmaWxlIGlzIGNvcnJ1cHQuIEkgY2Fubm90IHVuZGVyc3RhbmQgaXQuJykKCQkJCQldKTsKCQkJY2FzZSAnVmVyc2lvbkNoYW5nZWQnOgoJCQkJdmFyIG9sZCA9IHJlcG9ydC5hOwoJCQkJdmFyIF9uZXcgPSByZXBvcnQuYjsKCQkJCXJldHVybiBfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCdUaGlzIGhpc3Rvcnkgd2FzIGNyZWF0ZWQgd2l0aCBFbG0gJyArIChvbGQgKyAoJywgYnV0IHlvdSBhcmUgdXNpbmcgRWxtICcgKyAoX25ldyArICcgcmlnaHQgbm93LicpKSkpCgkJCQkJXSk7CgkJCWNhc2UgJ01lc3NhZ2VDaGFuZ2VkJzoKCQkJCXZhciBvbGQgPSByZXBvcnQuYTsKCQkJCXZhciBfbmV3ID0gcmVwb3J0LmI7CgkJCQlyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgnVG8gaW1wb3J0IHNvbWUgb3RoZXIgaGlzdG9yeSwgdGhlIG92ZXJhbGwgbWVzc2FnZSB0eXBlIG11c3QnICsgJyBiZSB0aGUgc2FtZS4gVGhlIG9sZCBoaXN0b3J5IGhhcyAnKSwKCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld0NvZGUob2xkKSwKCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgnIG1lc3NhZ2VzLCBidXQgdGhlIG5ldyBwcm9ncmFtIHdvcmtzIHdpdGggJyksCgkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdDb2RlKF9uZXcpLAoJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCcgbWVzc2FnZXMuJykKCQkJCQldKTsKCQkJZGVmYXVsdDoKCQkJCXZhciBjaGFuZ2VzID0gcmVwb3J0LmE7CgkJCQlyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJQTIoCgkJCQkJCSRlbG0kaHRtbCRIdG1sJHAsCgkJCQkJCV9MaXN0X05pbCwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWwoJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoCgkJCQkJCQkJaXNCYWQgPyAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRleHBsYW5hdGlvbkJhZCA6ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JGV4cGxhbmF0aW9uUmlza3kpCgkJCQkJCQldKSksCgkJCQkJCUEyKAoJCQkJCQkkZWxtJGh0bWwkSHRtbCR1bCwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWwoJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdsaXN0LXN0eWxlLXR5cGUnLCAnbm9uZScpLAoJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwYWRkaW5nLWxlZnQnLCAnMjBweCcpCgkJCQkJCQldKSwKCQkJCQkJQTIoJGVsbSRjb3JlJExpc3QkbWFwLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3Q2hhbmdlLCBjaGFuZ2VzKSkKCQkJCQldKTsKCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXcgPSBGNSgKCWZ1bmN0aW9uIChjb25maWcsIGlzUGF1c2VkLCBpc09wZW4sIG51bU1zZ3MsIHN0YXRlKSB7CgkJc3dpdGNoIChzdGF0ZS4kKSB7CgkJCWNhc2UgJ05vbmUnOgoJCQkJcmV0dXJuIGlzT3BlbiA/ICRlbG0kaHRtbCRIdG1sJHRleHQoJycpIDogKGlzUGF1c2VkID8gQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRpZCgnZWxtLWRlYnVnZ2VyLW92ZXJsYXknKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb3NpdGlvbicsICdmaXhlZCcpLAoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3RvcCcsICcwJyksCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnbGVmdCcsICcwJyksCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnd2lkdGgnLCAnMTAwdncnKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdoZWlnaHQnLCAnMTAwdmgnKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdjdXJzb3InLCAncG9pbnRlcicpLAoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2Rpc3BsYXknLCAnZmxleCcpLAoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2FsaWduLWl0ZW1zJywgJ2NlbnRlcicpLAoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2p1c3RpZnktY29udGVudCcsICdjZW50ZXInKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb2ludGVyLWV2ZW50cycsICdhdXRvJyksCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnYmFja2dyb3VuZC1jb2xvcicsICdyZ2JhKDIwMCwgMjAwLCAyMDAsIDAuNyknKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdjb2xvcicsICd3aGl0ZScpLAoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2ZvbnQtZmFtaWx5JywgJ1wnVHJlYnVjaGV0IE1TXCcsIFwnTHVjaWRhIEdyYW5kZVwnLCBcJ0JpdHN0cmVhbSBWZXJhIFNhbnNcJywgXCdIZWx2ZXRpY2EgTmV1ZVwnLCBzYW5zLXNlcmlmJyksCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnei1pbmRleCcsICcyMTQ3NDgzNjQ2JyksCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb25DbGljayhjb25maWcucmVzdW1lKQoJCQkJCQldKSwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCUEyKAoJCQkJCQkJJGVsbSRodG1sJEh0bWwkc3BhbiwKCQkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCQlbCgkJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdmb250LXNpemUnLCAnODBweCcpCgkJCQkJCQkJXSksCgkJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQkJWwoJCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCdDbGljayB0byBSZXN1bWUnKQoJCQkJCQkJCV0pKSwKCQkJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdNaW5pQ29udHJvbHMsIGNvbmZpZywgbnVtTXNncykKCQkJCQkJXSkpIDogQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld01pbmlDb250cm9scywgY29uZmlnLCBudW1Nc2dzKSk7CgkJCWNhc2UgJ0JhZE1ldGFkYXRhJzoKCQkJCXZhciBiYWRNZXRhZGF0YV8gPSBzdGF0ZS5hOwoJCQkJcmV0dXJuIEE0KAoJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdNZXNzYWdlLAoJCQkJCWNvbmZpZywKCQkJCQknQ2Fubm90IHVzZSBJbXBvcnQgb3IgRXhwb3J0JywKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR2aWV3QmFkTWV0YWRhdGEoYmFkTWV0YWRhdGFfKSwKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRBY2NlcHQoJ09rJykpOwoJCQljYXNlICdCYWRJbXBvcnQnOgoJCQkJdmFyIHJlcG9ydCA9IHN0YXRlLmE7CgkJCQlyZXR1cm4gQTQoCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld01lc3NhZ2UsCgkJCQkJY29uZmlnLAoJCQkJCSdDYW5ub3QgSW1wb3J0IEhpc3RvcnknLAoJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdSZXBvcnQsIHRydWUsIHJlcG9ydCksCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQWNjZXB0KCdPaycpKTsKCQkJZGVmYXVsdDoKCQkJCXZhciByZXBvcnQgPSBzdGF0ZS5hOwoJCQkJcmV0dXJuIEE0KAoJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JHZpZXdNZXNzYWdlLAoJCQkJCWNvbmZpZywKCQkJCQknV2FybmluZycsCgkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlld1JlcG9ydCwgZmFsc2UsIHJlcG9ydCksCgkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQ2hvb3NlLCAnQ2FuY2VsJywgJ0ltcG9ydCBBbnl3YXknKSk7CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRjb3JuZXJWaWV3ID0gZnVuY3Rpb24gKG1vZGVsKSB7CglyZXR1cm4gQTUoCgkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdmlldywKCQl7ZXhwb3J0SGlzdG9yeTogJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kRXhwb3J0LCBpbXBvcnRIaXN0b3J5OiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRJbXBvcnQsIG9wZW46ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJE9wZW4sIHJlc3VtZTogJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kUmVzdW1lLCB3cmFwOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRPdmVybGF5TXNnfSwKCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRpc1BhdXNlZChtb2RlbC5zdGF0ZSksCgkJX0RlYnVnZ2VyX2lzT3Blbihtb2RlbC5wb3BvdXQpLAoJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHNpemUobW9kZWwuaGlzdG9yeSksCgkJbW9kZWwub3ZlcmxheSk7Cn07CnZhciAkZWxtJGNvcmUkRGljdCRSQkVtcHR5X2VsbV9idWlsdGluID0geyQ6ICdSQkVtcHR5X2VsbV9idWlsdGluJ307CnZhciAkZWxtJGNvcmUkRGljdCRlbXB0eSA9ICRlbG0kY29yZSREaWN0JFJCRW1wdHlfZWxtX2J1aWx0aW47CnZhciAkZWxtJGNvcmUkU2V0JGZvbGRyID0gRjMoCglmdW5jdGlvbiAoZnVuYywgaW5pdGlhbFN0YXRlLCBfdjApIHsKCQl2YXIgZGljdCA9IF92MC5hOwoJCXJldHVybiBBMygKCQkJJGVsbSRjb3JlJERpY3QkZm9sZHIsCgkJCUYzKAoJCQkJZnVuY3Rpb24gKGtleSwgX3YxLCBzdGF0ZSkgewoJCQkJCXJldHVybiBBMihmdW5jLCBrZXksIHN0YXRlKTsKCQkJCX0pLAoJCQlpbml0aWFsU3RhdGUsCgkJCWRpY3QpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRnZXRDdXJyZW50TW9kZWwgPSBmdW5jdGlvbiAoc3RhdGUpIHsKCWlmIChzdGF0ZS4kID09PSAnUnVubmluZycpIHsKCQl2YXIgbW9kZWwgPSBzdGF0ZS5hOwoJCXJldHVybiBtb2RlbDsKCX0gZWxzZSB7CgkJdmFyIG1vZGVsID0gc3RhdGUuYjsKCQlyZXR1cm4gbW9kZWw7Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRnZXRVc2VyTW9kZWwgPSBmdW5jdGlvbiAobW9kZWwpIHsKCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRnZXRDdXJyZW50TW9kZWwobW9kZWwuc3RhdGUpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kaW5pdGlhbFdpbmRvd0hlaWdodCA9IDQyMDsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGluaXRpYWxXaW5kb3dXaWR0aCA9IDkwMDsKdmFyICRlbG0kY29yZSREaWN0JEJsYWNrID0geyQ6ICdCbGFjayd9Owp2YXIgJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluID0gRjUoCglmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewoJCXJldHVybiB7JDogJ1JCTm9kZV9lbG1fYnVpbHRpbicsIGE6IGEsIGI6IGIsIGM6IGMsIGQ6IGQsIGU6IGV9OwoJfSk7CnZhciAkZWxtJGNvcmUkRGljdCRSZWQgPSB7JDogJ1JlZCd9Owp2YXIgJGVsbSRjb3JlJERpY3QkYmFsYW5jZSA9IEY1KAoJZnVuY3Rpb24gKGNvbG9yLCBrZXksIHZhbHVlLCBsZWZ0LCByaWdodCkgewoJCWlmICgocmlnaHQuJCA9PT0gJ1JCTm9kZV9lbG1fYnVpbHRpbicpICYmIChyaWdodC5hLiQgPT09ICdSZWQnKSkgewoJCQl2YXIgX3YxID0gcmlnaHQuYTsKCQkJdmFyIHJLID0gcmlnaHQuYjsKCQkJdmFyIHJWID0gcmlnaHQuYzsKCQkJdmFyIHJMZWZ0ID0gcmlnaHQuZDsKCQkJdmFyIHJSaWdodCA9IHJpZ2h0LmU7CgkJCWlmICgobGVmdC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykgJiYgKGxlZnQuYS4kID09PSAnUmVkJykpIHsKCQkJCXZhciBfdjMgPSBsZWZ0LmE7CgkJCQl2YXIgbEsgPSBsZWZ0LmI7CgkJCQl2YXIgbFYgPSBsZWZ0LmM7CgkJCQl2YXIgbExlZnQgPSBsZWZ0LmQ7CgkJCQl2YXIgbFJpZ2h0ID0gbGVmdC5lOwoJCQkJcmV0dXJuIEE1KAoJCQkJCSRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwKCQkJCQkkZWxtJGNvcmUkRGljdCRSZWQsCgkJCQkJa2V5LAoJCQkJCXZhbHVlLAoJCQkJCUE1KCRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkQmxhY2ssIGxLLCBsViwgbExlZnQsIGxSaWdodCksCgkJCQkJQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCAkZWxtJGNvcmUkRGljdCRCbGFjaywgckssIHJWLCByTGVmdCwgclJpZ2h0KSk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gQTUoCgkJCQkJJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLAoJCQkJCWNvbG9yLAoJCQkJCXJLLAoJCQkJCXJWLAoJCQkJCUE1KCRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkUmVkLCBrZXksIHZhbHVlLCBsZWZ0LCByTGVmdCksCgkJCQkJclJpZ2h0KTsKCQkJfQoJCX0gZWxzZSB7CgkJCWlmICgoKChsZWZ0LiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSAmJiAobGVmdC5hLiQgPT09ICdSZWQnKSkgJiYgKGxlZnQuZC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykpICYmIChsZWZ0LmQuYS4kID09PSAnUmVkJykpIHsKCQkJCXZhciBfdjUgPSBsZWZ0LmE7CgkJCQl2YXIgbEsgPSBsZWZ0LmI7CgkJCQl2YXIgbFYgPSBsZWZ0LmM7CgkJCQl2YXIgX3Y2ID0gbGVmdC5kOwoJCQkJdmFyIF92NyA9IF92Ni5hOwoJCQkJdmFyIGxsSyA9IF92Ni5iOwoJCQkJdmFyIGxsViA9IF92Ni5jOwoJCQkJdmFyIGxsTGVmdCA9IF92Ni5kOwoJCQkJdmFyIGxsUmlnaHQgPSBfdjYuZTsKCQkJCXZhciBsUmlnaHQgPSBsZWZ0LmU7CgkJCQlyZXR1cm4gQTUoCgkJCQkJJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLAoJCQkJCSRlbG0kY29yZSREaWN0JFJlZCwKCQkJCQlsSywKCQkJCQlsViwKCQkJCQlBNSgkZWxtJGNvcmUkRGljdCRSQk5vZGVfZWxtX2J1aWx0aW4sICRlbG0kY29yZSREaWN0JEJsYWNrLCBsbEssIGxsViwgbGxMZWZ0LCBsbFJpZ2h0KSwKCQkJCQlBNSgkZWxtJGNvcmUkRGljdCRSQk5vZGVfZWxtX2J1aWx0aW4sICRlbG0kY29yZSREaWN0JEJsYWNrLCBrZXksIHZhbHVlLCBsUmlnaHQsIHJpZ2h0KSk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCBjb2xvciwga2V5LCB2YWx1ZSwgbGVmdCwgcmlnaHQpOwoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkQmFzaWNzJGNvbXBhcmUgPSBfVXRpbHNfY29tcGFyZTsKdmFyICRlbG0kY29yZSREaWN0JGluc2VydEhlbHAgPSBGMygKCWZ1bmN0aW9uIChrZXksIHZhbHVlLCBkaWN0KSB7CgkJaWYgKGRpY3QuJCA9PT0gJ1JCRW1wdHlfZWxtX2J1aWx0aW4nKSB7CgkJCXJldHVybiBBNSgkZWxtJGNvcmUkRGljdCRSQk5vZGVfZWxtX2J1aWx0aW4sICRlbG0kY29yZSREaWN0JFJlZCwga2V5LCB2YWx1ZSwgJGVsbSRjb3JlJERpY3QkUkJFbXB0eV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkUkJFbXB0eV9lbG1fYnVpbHRpbik7CgkJfSBlbHNlIHsKCQkJdmFyIG5Db2xvciA9IGRpY3QuYTsKCQkJdmFyIG5LZXkgPSBkaWN0LmI7CgkJCXZhciBuVmFsdWUgPSBkaWN0LmM7CgkJCXZhciBuTGVmdCA9IGRpY3QuZDsKCQkJdmFyIG5SaWdodCA9IGRpY3QuZTsKCQkJdmFyIF92MSA9IEEyKCRlbG0kY29yZSRCYXNpY3MkY29tcGFyZSwga2V5LCBuS2V5KTsKCQkJc3dpdGNoIChfdjEuJCkgewoJCQkJY2FzZSAnTFQnOgoJCQkJCXJldHVybiBBNSgKCQkJCQkJJGVsbSRjb3JlJERpY3QkYmFsYW5jZSwKCQkJCQkJbkNvbG9yLAoJCQkJCQluS2V5LAoJCQkJCQluVmFsdWUsCgkJCQkJCUEzKCRlbG0kY29yZSREaWN0JGluc2VydEhlbHAsIGtleSwgdmFsdWUsIG5MZWZ0KSwKCQkJCQkJblJpZ2h0KTsKCQkJCWNhc2UgJ0VRJzoKCQkJCQlyZXR1cm4gQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCBuQ29sb3IsIG5LZXksIHZhbHVlLCBuTGVmdCwgblJpZ2h0KTsKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuIEE1KAoJCQkJCQkkZWxtJGNvcmUkRGljdCRiYWxhbmNlLAoJCQkJCQluQ29sb3IsCgkJCQkJCW5LZXksCgkJCQkJCW5WYWx1ZSwKCQkJCQkJbkxlZnQsCgkJCQkJCUEzKCRlbG0kY29yZSREaWN0JGluc2VydEhlbHAsIGtleSwgdmFsdWUsIG5SaWdodCkpOwoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkRGljdCRpbnNlcnQgPSBGMygKCWZ1bmN0aW9uIChrZXksIHZhbHVlLCBkaWN0KSB7CgkJdmFyIF92MCA9IEEzKCRlbG0kY29yZSREaWN0JGluc2VydEhlbHAsIGtleSwgdmFsdWUsIGRpY3QpOwoJCWlmICgoX3YwLiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSAmJiAoX3YwLmEuJCA9PT0gJ1JlZCcpKSB7CgkJCXZhciBfdjEgPSBfdjAuYTsKCQkJdmFyIGsgPSBfdjAuYjsKCQkJdmFyIHYgPSBfdjAuYzsKCQkJdmFyIGwgPSBfdjAuZDsKCQkJdmFyIHIgPSBfdjAuZTsKCQkJcmV0dXJuIEE1KCRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkQmxhY2ssIGssIHYsIGwsIHIpOwoJCX0gZWxzZSB7CgkJCXZhciB4ID0gX3YwOwoJCQlyZXR1cm4geDsKCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGNhY2hlZEhpc3RvcnkgPSBmdW5jdGlvbiAobW9kZWwpIHsKCXZhciBfdjAgPSBtb2RlbC5zdGF0ZTsKCWlmIChfdjAuJCA9PT0gJ1J1bm5pbmcnKSB7CgkJcmV0dXJuIG1vZGVsLmhpc3Rvcnk7Cgl9IGVsc2UgewoJCXZhciBoaXN0b3J5ID0gX3YwLmU7CgkJcmV0dXJuIGhpc3Rvcnk7Cgl9Cn07CnZhciAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kbm9kZSA9IGZ1bmN0aW9uICh0YWcpIHsKCXJldHVybiBfVmlydHVhbERvbV9ub2RlKAoJCV9WaXJ0dWFsRG9tX25vU2NyaXB0KHRhZykpOwp9Owp2YXIgJGVsbSRodG1sJEh0bWwkbm9kZSA9ICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRub2RlOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kRHJhZ0VuZCA9IHskOiAnRHJhZ0VuZCd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kZ2V0RHJhZ1N0YXR1cyA9IGZ1bmN0aW9uIChsYXlvdXQpIHsKCWlmIChsYXlvdXQuJCA9PT0gJ0hvcml6b250YWwnKSB7CgkJdmFyIHN0YXR1cyA9IGxheW91dC5hOwoJCXJldHVybiBzdGF0dXM7Cgl9IGVsc2UgewoJCXZhciBzdGF0dXMgPSBsYXlvdXQuYTsKCQlyZXR1cm4gc3RhdHVzOwoJfQp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kRHJhZyA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdEcmFnJywgYTogYX07Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiREcmFnSW5mbyA9IEY1KAoJZnVuY3Rpb24gKHgsIHksIGRvd24sIHdpZHRoLCBoZWlnaHQpIHsKCQlyZXR1cm4ge2Rvd246IGRvd24sIGhlaWdodDogaGVpZ2h0LCB3aWR0aDogd2lkdGgsIHg6IHgsIHk6IHl9OwoJfSk7CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkZmllbGQgPSBfSnNvbl9kZWNvZGVGaWVsZDsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRhdCA9IEYyKAoJZnVuY3Rpb24gKGZpZWxkcywgZGVjb2RlcikgewoJCXJldHVybiBBMygkZWxtJGNvcmUkTGlzdCRmb2xkciwgJGVsbSRqc29uJEpzb24kRGVjb2RlJGZpZWxkLCBkZWNvZGVyLCBmaWVsZHMpOwoJfSk7CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkZmxvYXQgPSBfSnNvbl9kZWNvZGVGbG9hdDsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGRlY29kZURpbWVuc2lvbiA9IGZ1bmN0aW9uIChmaWVsZCkgewoJcmV0dXJuIEEyKAoJCSRlbG0kanNvbiRKc29uJERlY29kZSRhdCwKCQlfTGlzdF9mcm9tQXJyYXkoCgkJCVsnY3VycmVudFRhcmdldCcsICdvd25lckRvY3VtZW50JywgJ2RlZmF1bHRWaWV3JywgZmllbGRdKSwKCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkZmxvYXQpOwp9Owp2YXIgJGVsbSRqc29uJEpzb24kRGVjb2RlJGludCA9IF9Kc29uX2RlY29kZUludDsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRtYXA1ID0gX0pzb25fbWFwNTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJG9uTW91c2VNb3ZlID0gQTIoCgkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb24sCgknbW91c2Vtb3ZlJywKCUEyKAoJCSRlbG0kanNvbiRKc29uJERlY29kZSRtYXAsCgkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kRHJhZywKCQlBNigKCQkJJGVsbSRqc29uJEpzb24kRGVjb2RlJG1hcDUsCgkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJERyYWdJbmZvLAoJCQlBMigkZWxtJGpzb24kSnNvbiREZWNvZGUkZmllbGQsICdwYWdlWCcsICRlbG0kanNvbiRKc29uJERlY29kZSRmbG9hdCksCgkJCUEyKCRlbG0kanNvbiRKc29uJERlY29kZSRmaWVsZCwgJ3BhZ2VZJywgJGVsbSRqc29uJEpzb24kRGVjb2RlJGZsb2F0KSwKCQkJQTIoCgkJCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkZmllbGQsCgkJCQknYnV0dG9ucycsCgkJCQlBMigKCQkJCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkbWFwLAoJCQkJCWZ1bmN0aW9uICh2KSB7CgkJCQkJCXJldHVybiB2ID09PSAxOwoJCQkJCX0sCgkJCQkJJGVsbSRqc29uJEpzb24kRGVjb2RlJGludCkpLAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRkZWNvZGVEaW1lbnNpb24oJ2lubmVyV2lkdGgnKSwKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kZGVjb2RlRGltZW5zaW9uKCdpbm5lckhlaWdodCcpKSkpOwp2YXIgJGVsbSRodG1sJEh0bWwkRXZlbnRzJG9uTW91c2VVcCA9IGZ1bmN0aW9uIChtc2cpIHsKCXJldHVybiBBMigKCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb24sCgkJJ21vdXNldXAnLAoJCSRlbG0kanNvbiRKc29uJERlY29kZSRzdWNjZWVkKG1zZykpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9EcmFnTGlzdGVuZXJzID0gZnVuY3Rpb24gKGxheW91dCkgewoJdmFyIF92MCA9ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGdldERyYWdTdGF0dXMobGF5b3V0KTsKCWlmIChfdjAuJCA9PT0gJ1N0YXRpYycpIHsKCQlyZXR1cm4gX0xpc3RfTmlsOwoJfSBlbHNlIHsKCQlyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRvbk1vdXNlTW92ZSwKCQkJCSRlbG0kaHRtbCRIdG1sJEV2ZW50cyRvbk1vdXNlVXAoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kRHJhZ0VuZCkKCQkJXSk7Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR0b0ZsZXhEaXJlY3Rpb24gPSBmdW5jdGlvbiAobGF5b3V0KSB7CglpZiAobGF5b3V0LiQgPT09ICdIb3Jpem9udGFsJykgewoJCXJldHVybiAncm93JzsKCX0gZWxzZSB7CgkJcmV0dXJuICdjb2x1bW4tcmV2ZXJzZSc7Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiREcmFnU3RhcnQgPSB7JDogJ0RyYWdTdGFydCd9Owp2YXIgJGVsbSRodG1sJEh0bWwkRXZlbnRzJG9uTW91c2VEb3duID0gZnVuY3Rpb24gKG1zZykgewoJcmV0dXJuIEEyKAoJCSRlbG0kaHRtbCRIdG1sJEV2ZW50cyRvbiwKCQknbW91c2Vkb3duJywKCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkc3VjY2VlZChtc2cpKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHRvUGVyY2VudCA9IGZ1bmN0aW9uIChmcmFjdGlvbikgewoJcmV0dXJuICRlbG0kY29yZSRTdHJpbmckZnJvbUZsb2F0KDEwMCAqIGZyYWN0aW9uKSArICclJzsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHZpZXdEcmFnWm9uZSA9IGZ1bmN0aW9uIChsYXlvdXQpIHsKCWlmIChsYXlvdXQuJCA9PT0gJ0hvcml6b250YWwnKSB7CgkJdmFyIHggPSBsYXlvdXQuYjsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb3NpdGlvbicsICdhYnNvbHV0ZScpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd0b3AnLCAnMCcpLAoJCQkJCUEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsCgkJCQkJJ2xlZnQnLAoJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHRvUGVyY2VudCh4KSksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ21hcmdpbi1sZWZ0JywgJy01cHgnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnd2lkdGgnLCAnMTBweCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdoZWlnaHQnLCAnMTAwJScpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdjdXJzb3InLCAnY29sLXJlc2l6ZScpLAoJCQkJCSRlbG0kaHRtbCRIdG1sJEV2ZW50cyRvbk1vdXNlRG93bigkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiREcmFnU3RhcnQpCgkJCQldKSwKCQkJX0xpc3RfTmlsKTsKCX0gZWxzZSB7CgkJdmFyIHkgPSBsYXlvdXQuYzsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb3NpdGlvbicsICdhYnNvbHV0ZScpLAoJCQkJCUEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsCgkJCQkJJ3RvcCcsCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9QZXJjZW50KHkpKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnbGVmdCcsICcwJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ21hcmdpbi10b3AnLCAnLTVweCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd3aWR0aCcsICcxMDAlJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2hlaWdodCcsICcxMHB4JyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2N1cnNvcicsICdyb3ctcmVzaXplJyksCgkJCQkJJGVsbSRodG1sJEh0bWwkRXZlbnRzJG9uTW91c2VEb3duKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJERyYWdTdGFydCkKCQkJCV0pLAoJCQlfTGlzdF9OaWwpOwoJfQp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVHdlYWtFeHBhbmRvTW9kZWwgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnVHdlYWtFeHBhbmRvTW9kZWwnLCBhOiBhfTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFR3ZWFrRXhwYW5kb01zZyA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdUd2Vha0V4cGFuZG9Nc2cnLCBhOiBhfTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHRvRXhwYW5kb1BlcmNlbnRzID0gZnVuY3Rpb24gKGxheW91dCkgewoJaWYgKGxheW91dC4kID09PSAnSG9yaXpvbnRhbCcpIHsKCQl2YXIgeCA9IGxheW91dC5iOwoJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR0b1BlcmNlbnQoMSAtIHgpLAoJCQknMTAwJScpOwoJfSBlbHNlIHsKCQl2YXIgeSA9IGxheW91dC5jOwoJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQknMTAwJScsCgkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHRvUGVyY2VudCh5KSk7Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR0b01vdXNlQmxvY2tlciA9IGZ1bmN0aW9uIChsYXlvdXQpIHsKCXZhciBfdjAgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRnZXREcmFnU3RhdHVzKGxheW91dCk7CglpZiAoX3YwLiQgPT09ICdTdGF0aWMnKSB7CgkJcmV0dXJuICdhdXRvJzsKCX0gZWxzZSB7CgkJcmV0dXJuICdub25lJzsKCX0KfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJEZpZWxkID0gRjIoCglmdW5jdGlvbiAoYSwgYikgewoJCXJldHVybiB7JDogJ0ZpZWxkJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJEluZGV4ID0gRjMoCglmdW5jdGlvbiAoYSwgYiwgYykgewoJCXJldHVybiB7JDogJ0luZGV4JywgYTogYSwgYjogYiwgYzogY307Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJEtleSA9IHskOiAnS2V5J307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyROb25lID0geyQ6ICdOb25lJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRUb2dnbGUgPSB7JDogJ1RvZ2dsZSd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kVmFsdWUgPSB7JDogJ1ZhbHVlJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRibHVlID0gQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2NvbG9yJywgJ3JnYigyOCwgMCwgMjA3KScpOwp2YXIgJGVsbSRjb3JlJEJhc2ljcyRjb21wb3NlTCA9IEYzKAoJZnVuY3Rpb24gKGcsIGYsIHgpIHsKCQlyZXR1cm4gZygKCQkJZih4KSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGxlZnRQYWQgPSBmdW5jdGlvbiAobWF5YmVLZXkpIHsKCWlmIChtYXliZUtleS4kID09PSAnTm90aGluZycpIHsKCQlyZXR1cm4gX0xpc3RfTmlsOwoJfSBlbHNlIHsKCQlyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAncGFkZGluZy1sZWZ0JywgJzRjaCcpCgkJCV0pOwoJfQp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbWFrZUFycm93ID0gZnVuY3Rpb24gKGFycm93KSB7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkc3BhbiwKCQlfTGlzdF9mcm9tQXJyYXkoCgkJCVsKCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdjb2xvcicsICcjNzc3JyksCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAncGFkZGluZy1sZWZ0JywgJzJjaCcpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3dpZHRoJywgJzJjaCcpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJykKCQkJXSksCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KGFycm93KQoJCQldKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRwdXJwbGUgPSBBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnY29sb3InLCAncmdiKDEzNiwgMTksIDE0NSknKTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGxpbmVTdGFydGVyID0gRjMoCglmdW5jdGlvbiAobWF5YmVLZXksIG1heWJlSXNDbG9zZWQsIGRlc2NyaXB0aW9uKSB7CgkJdmFyIGFycm93ID0gZnVuY3Rpb24gKCkgewoJCQlpZiAobWF5YmVJc0Nsb3NlZC4kID09PSAnTm90aGluZycpIHsKCQkJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtYWtlQXJyb3coJycpOwoJCQl9IGVsc2UgewoJCQkJaWYgKG1heWJlSXNDbG9zZWQuYSkgewoJCQkJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtYWtlQXJyb3coJ+KWuCcpOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbWFrZUFycm93KCfilr4nKTsKCQkJCX0KCQkJfQoJCX0oKTsKCQlpZiAobWF5YmVLZXkuJCA9PT0gJ05vdGhpbmcnKSB7CgkJCXJldHVybiBBMigkZWxtJGNvcmUkTGlzdCRjb25zLCBhcnJvdywgZGVzY3JpcHRpb24pOwoJCX0gZWxzZSB7CgkJCXZhciBrZXkgPSBtYXliZUtleS5hOwoJCQlyZXR1cm4gQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJYXJyb3csCgkJCQlBMigKCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCUEyKAoJCQkJCQkkZWxtJGh0bWwkSHRtbCRzcGFuLAoJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQlbJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kcHVycGxlXSksCgkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCVsKCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KGtleSkKCQkJCQkJCV0pKSwKCQkJCQlBMigKCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgnID0gJyksCgkJCQkJCWRlc2NyaXB0aW9uKSkpOwoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kcmVkID0gQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2NvbG9yJywgJ3JnYigxOTYsIDI2LCAyMiknKTsKdmFyICRlbG0kY29yZSRUdXBsZSRzZWNvbmQgPSBmdW5jdGlvbiAoX3YwKSB7Cgl2YXIgeSA9IF92MC5iOwoJcmV0dXJuIHk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRzZXFUeXBlVG9TdHJpbmcgPSBGMigKCWZ1bmN0aW9uIChuLCBzZXFUeXBlKSB7CgkJc3dpdGNoIChzZXFUeXBlLiQpIHsKCQkJY2FzZSAnTGlzdFNlcSc6CgkJCQlyZXR1cm4gJ0xpc3QoJyArICgkZWxtJGNvcmUkU3RyaW5nJGZyb21JbnQobikgKyAnKScpOwoJCQljYXNlICdTZXRTZXEnOgoJCQkJcmV0dXJuICdTZXQoJyArICgkZWxtJGNvcmUkU3RyaW5nJGZyb21JbnQobikgKyAnKScpOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICdBcnJheSgnICsgKCRlbG0kY29yZSRTdHJpbmckZnJvbUludChuKSArICcpJyk7CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkU3RyaW5nJHNsaWNlID0gX1N0cmluZ19zbGljZTsKdmFyICRlbG0kY29yZSRTdHJpbmckbGVmdCA9IEYyKAoJZnVuY3Rpb24gKG4sIHN0cmluZykgewoJCXJldHVybiAobiA8IDEpID8gJycgOiBBMygkZWxtJGNvcmUkU3RyaW5nJHNsaWNlLCAwLCBuLCBzdHJpbmcpOwoJfSk7CnZhciAkZWxtJGNvcmUkU3RyaW5nJHJpZ2h0ID0gRjIoCglmdW5jdGlvbiAobiwgc3RyaW5nKSB7CgkJcmV0dXJuIChuIDwgMSkgPyAnJyA6IEEzKAoJCQkkZWxtJGNvcmUkU3RyaW5nJHNsaWNlLAoJCQktbiwKCQkJJGVsbSRjb3JlJFN0cmluZyRsZW5ndGgoc3RyaW5nKSwKCQkJc3RyaW5nKTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kZWxpZGVNaWRkbGUgPSBmdW5jdGlvbiAoc3RyKSB7CglyZXR1cm4gKCRlbG0kY29yZSRTdHJpbmckbGVuZ3RoKHN0cikgPD0gMTgpID8gc3RyIDogKEEyKCRlbG0kY29yZSRTdHJpbmckbGVmdCwgOCwgc3RyKSArICgnLi4uJyArIEEyKCRlbG0kY29yZSRTdHJpbmckcmlnaHQsIDgsIHN0cikpKTsKfTsKdmFyICRlbG0kY29yZSREaWN0JGlzRW1wdHkgPSBmdW5jdGlvbiAoZGljdCkgewoJaWYgKGRpY3QuJCA9PT0gJ1JCRW1wdHlfZWxtX2J1aWx0aW4nKSB7CgkJcmV0dXJuIHRydWU7Cgl9IGVsc2UgewoJCXJldHVybiBmYWxzZTsKCX0KfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdFeHRyYVRpbnlSZWNvcmQgPSBGMygKCWZ1bmN0aW9uIChsZW5ndGgsIHN0YXJ0ZXIsIGVudHJpZXMpIHsKCQlpZiAoIWVudHJpZXMuYikgewoJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCWxlbmd0aCArIDEsCgkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCd9JykKCQkJCQldKSk7CgkJfSBlbHNlIHsKCQkJdmFyIGZpZWxkID0gZW50cmllcy5hOwoJCQl2YXIgcmVzdCA9IGVudHJpZXMuYjsKCQkJdmFyIG5leHRMZW5ndGggPSAobGVuZ3RoICsgJGVsbSRjb3JlJFN0cmluZyRsZW5ndGgoZmllbGQpKSArIDE7CgkJCWlmIChuZXh0TGVuZ3RoID4gMTgpIHsKCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCWxlbmd0aCArIDIsCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCfigKZ9JykKCQkJCQkJXSkpOwoJCQl9IGVsc2UgewoJCQkJdmFyIF92MSA9IEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdFeHRyYVRpbnlSZWNvcmQsIG5leHRMZW5ndGgsICcsJywgcmVzdCk7CgkJCQl2YXIgZmluYWxMZW5ndGggPSBfdjEuYTsKCQkJCXZhciBvdGhlckh0bWxzID0gX3YxLmI7CgkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQlmaW5hbExlbmd0aCwKCQkJCQlBMigKCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dChzdGFydGVyKSwKCQkJCQkJQTIoCgkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRodG1sJEh0bWwkc3BhbiwKCQkJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQkJCVskZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRwdXJwbGVdKSwKCQkJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQkJCVsKCQkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoZmllbGQpCgkJCQkJCQkJCV0pKSwKCQkJCQkJCW90aGVySHRtbHMpKSk7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdUaW55SGVscCA9IGZ1bmN0aW9uIChzdHIpIHsKCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCSRlbG0kY29yZSRTdHJpbmckbGVuZ3RoKHN0ciksCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KHN0cikKCQkJXSkpOwp9Owp2YXIgJGVsbSRjb3JlJE1heWJlJHdpdGhEZWZhdWx0ID0gRjIoCglmdW5jdGlvbiAoX2RlZmF1bHQsIG1heWJlKSB7CgkJaWYgKG1heWJlLiQgPT09ICdKdXN0JykgewoJCQl2YXIgdmFsdWUgPSBtYXliZS5hOwoJCQlyZXR1cm4gdmFsdWU7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIF9kZWZhdWx0OwoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld0V4dHJhVGlueSA9IGZ1bmN0aW9uICh2YWx1ZSkgewoJaWYgKHZhbHVlLiQgPT09ICdSZWNvcmQnKSB7CgkJdmFyIHJlY29yZCA9IHZhbHVlLmI7CgkJcmV0dXJuIEEzKAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3RXh0cmFUaW55UmVjb3JkLAoJCQkwLAoJCQkneycsCgkJCSRlbG0kY29yZSREaWN0JGtleXMocmVjb3JkKSk7Cgl9IGVsc2UgewoJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3VGlueSh2YWx1ZSk7Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3VGlueSA9IGZ1bmN0aW9uICh2YWx1ZSkgewoJc3dpdGNoICh2YWx1ZS4kKSB7CgkJY2FzZSAnUyc6CgkJCXZhciBzdHJpbmdSZXAgPSB2YWx1ZS5hOwoJCQl2YXIgc3RyID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kZWxpZGVNaWRkbGUoc3RyaW5nUmVwKTsKCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkkZWxtJGNvcmUkU3RyaW5nJGxlbmd0aChzdHIpLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJQTIoCgkJCQkJCSRlbG0kaHRtbCRIdG1sJHNwYW4sCgkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCVskZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRyZWRdKSwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWwoJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoc3RyKQoJCQkJCQkJXSkpCgkJCQkJXSkpOwoJCWNhc2UgJ1ByaW1pdGl2ZSc6CgkJCXZhciBzdHJpbmdSZXAgPSB2YWx1ZS5hOwoJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCSRlbG0kY29yZSRTdHJpbmckbGVuZ3RoKHN0cmluZ1JlcCksCgkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQlBMigKCQkJCQkJJGVsbSRodG1sJEh0bWwkc3BhbiwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWyRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGJsdWVdKSwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWwoJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoc3RyaW5nUmVwKQoJCQkJCQkJXSkpCgkJCQkJXSkpOwoJCWNhc2UgJ1NlcXVlbmNlJzoKCQkJdmFyIHNlcVR5cGUgPSB2YWx1ZS5hOwoJCQl2YXIgdmFsdWVMaXN0ID0gdmFsdWUuYzsKCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdUaW55SGVscCgKCQkJCUEyKAoJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHNlcVR5cGVUb1N0cmluZywKCQkJCQkkZWxtJGNvcmUkTGlzdCRsZW5ndGgodmFsdWVMaXN0KSwKCQkJCQlzZXFUeXBlKSk7CgkJY2FzZSAnRGljdGlvbmFyeSc6CgkJCXZhciBrZXlWYWx1ZVBhaXJzID0gdmFsdWUuYjsKCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdUaW55SGVscCgKCQkJCSdEaWN0KCcgKyAoJGVsbSRjb3JlJFN0cmluZyRmcm9tSW50KAoJCQkJCSRlbG0kY29yZSRMaXN0JGxlbmd0aChrZXlWYWx1ZVBhaXJzKSkgKyAnKScpKTsKCQljYXNlICdSZWNvcmQnOgoJCQl2YXIgcmVjb3JkID0gdmFsdWUuYjsKCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdUaW55UmVjb3JkKHJlY29yZCk7CgkJZGVmYXVsdDoKCQkJaWYgKCF2YWx1ZS5jLmIpIHsKCQkJCXZhciBtYXliZU5hbWUgPSB2YWx1ZS5hOwoJCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdUaW55SGVscCgKCQkJCQlBMigkZWxtJGNvcmUkTWF5YmUkd2l0aERlZmF1bHQsICdVbml0JywgbWF5YmVOYW1lKSk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgbWF5YmVOYW1lID0gdmFsdWUuYTsKCQkJCXZhciB2YWx1ZUxpc3QgPSB2YWx1ZS5jOwoJCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdUaW55SGVscCgKCQkJCQlmdW5jdGlvbiAoKSB7CgkJCQkJCWlmIChtYXliZU5hbWUuJCA9PT0gJ05vdGhpbmcnKSB7CgkJCQkJCQlyZXR1cm4gJ1R1cGxlKCcgKyAoJGVsbSRjb3JlJFN0cmluZyRmcm9tSW50KAoJCQkJCQkJCSRlbG0kY29yZSRMaXN0JGxlbmd0aCh2YWx1ZUxpc3QpKSArICcpJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2YXIgbmFtZSA9IG1heWJlTmFtZS5hOwoJCQkJCQkJcmV0dXJuIG5hbWUgKyAnIOKApic7CgkJCQkJCX0KCQkJCQl9KCkpOwoJCQl9Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3VGlueVJlY29yZCA9IGZ1bmN0aW9uIChyZWNvcmQpIHsKCXJldHVybiAkZWxtJGNvcmUkRGljdCRpc0VtcHR5KHJlY29yZCkgPyBfVXRpbHNfVHVwbGUyKAoJCTIsCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCd7fScpCgkJCV0pKSA6IEEzKAoJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdUaW55UmVjb3JkSGVscCwKCQkwLAoJCSd7ICcsCgkJJGVsbSRjb3JlJERpY3QkdG9MaXN0KHJlY29yZCkpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld1RpbnlSZWNvcmRIZWxwID0gRjMoCglmdW5jdGlvbiAobGVuZ3RoLCBzdGFydGVyLCBlbnRyaWVzKSB7CgkJaWYgKCFlbnRyaWVzLmIpIHsKCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQlsZW5ndGggKyAyLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgnIH0nKQoJCQkJCV0pKTsKCQl9IGVsc2UgewoJCQl2YXIgX3YxID0gZW50cmllcy5hOwoJCQl2YXIgZmllbGQgPSBfdjEuYTsKCQkJdmFyIHZhbHVlID0gX3YxLmI7CgkJCXZhciByZXN0ID0gZW50cmllcy5iOwoJCQl2YXIgZmllbGRMZW4gPSAkZWxtJGNvcmUkU3RyaW5nJGxlbmd0aChmaWVsZCk7CgkJCXZhciBfdjIgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3RXh0cmFUaW55KHZhbHVlKTsKCQkJdmFyIHZhbHVlTGVuID0gX3YyLmE7CgkJCXZhciB2YWx1ZUh0bWxzID0gX3YyLmI7CgkJCXZhciBuZXdMZW5ndGggPSAoKGxlbmd0aCArIGZpZWxkTGVuKSArIHZhbHVlTGVuKSArIDU7CgkJCWlmIChuZXdMZW5ndGggPiA2MCkgewoJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJbGVuZ3RoICsgNCwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJywg4oCmIH0nKQoJCQkJCQldKSk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgX3YzID0gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld1RpbnlSZWNvcmRIZWxwLCBuZXdMZW5ndGgsICcsICcsIHJlc3QpOwoJCQkJdmFyIGZpbmFsTGVuZ3RoID0gX3YzLmE7CgkJCQl2YXIgb3RoZXJIdG1scyA9IF92My5iOwoJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJZmluYWxMZW5ndGgsCgkJCQkJQTIoCgkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoc3RhcnRlciksCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHNwYW4sCgkJCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJCQlbJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kcHVycGxlXSksCgkJCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJCQlbCgkJCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KGZpZWxkKQoJCQkJCQkJCQldKSksCgkJCQkJCQlBMigKCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJyA9ICcpLAoJCQkJCQkJCUEyKAoJCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRzcGFuLCBfTGlzdF9OaWwsIHZhbHVlSHRtbHMpLAoJCQkJCQkJCQlvdGhlckh0bWxzKSkpKSk7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXcgPSBGMigKCWZ1bmN0aW9uIChtYXliZUtleSwgZXhwYW5kbykgewoJCXN3aXRjaCAoZXhwYW5kby4kKSB7CgkJCWNhc2UgJ1MnOgoJCQkJdmFyIHN0cmluZ1JlcCA9IGV4cGFuZG8uYTsKCQkJCXJldHVybiBBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbGVmdFBhZChtYXliZUtleSksCgkJCQkJQTMoCgkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGxpbmVTdGFydGVyLAoJCQkJCQltYXliZUtleSwKCQkJCQkJJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcsCgkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCVsKCQkJCQkJCQlBMigKCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCRzcGFuLAoJCQkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCQkJWyRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHJlZF0pLAoJCQkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCQkJWwoJCQkJCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dChzdHJpbmdSZXApCgkJCQkJCQkJCV0pKQoJCQkJCQkJXSkpKTsKCQkJY2FzZSAnUHJpbWl0aXZlJzoKCQkJCXZhciBzdHJpbmdSZXAgPSBleHBhbmRvLmE7CgkJCQlyZXR1cm4gQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGxlZnRQYWQobWF5YmVLZXkpLAoJCQkJCUEzKAoJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRsaW5lU3RhcnRlciwKCQkJCQkJbWF5YmVLZXksCgkJCQkJCSRlbG0kY29yZSRNYXliZSROb3RoaW5nLAoJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQlbCgkJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRodG1sJEh0bWwkc3BhbiwKCQkJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQkJCVskZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRibHVlXSksCgkJCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJCQlbCgkJCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KHN0cmluZ1JlcCkKCQkJCQkJCQkJXSkpCgkJCQkJCQldKSkpOwoJCQljYXNlICdTZXF1ZW5jZSc6CgkJCQl2YXIgc2VxVHlwZSA9IGV4cGFuZG8uYTsKCQkJCXZhciBpc0Nsb3NlZCA9IGV4cGFuZG8uYjsKCQkJCXZhciB2YWx1ZUxpc3QgPSBleHBhbmRvLmM7CgkJCQlyZXR1cm4gQTQoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld1NlcXVlbmNlLCBtYXliZUtleSwgc2VxVHlwZSwgaXNDbG9zZWQsIHZhbHVlTGlzdCk7CgkJCWNhc2UgJ0RpY3Rpb25hcnknOgoJCQkJdmFyIGlzQ2xvc2VkID0gZXhwYW5kby5hOwoJCQkJdmFyIGtleVZhbHVlUGFpcnMgPSBleHBhbmRvLmI7CgkJCQlyZXR1cm4gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld0RpY3Rpb25hcnksIG1heWJlS2V5LCBpc0Nsb3NlZCwga2V5VmFsdWVQYWlycyk7CgkJCWNhc2UgJ1JlY29yZCc6CgkJCQl2YXIgaXNDbG9zZWQgPSBleHBhbmRvLmE7CgkJCQl2YXIgdmFsdWVEaWN0ID0gZXhwYW5kby5iOwoJCQkJcmV0dXJuIEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdSZWNvcmQsIG1heWJlS2V5LCBpc0Nsb3NlZCwgdmFsdWVEaWN0KTsKCQkJZGVmYXVsdDoKCQkJCXZhciBtYXliZU5hbWUgPSBleHBhbmRvLmE7CgkJCQl2YXIgaXNDbG9zZWQgPSBleHBhbmRvLmI7CgkJCQl2YXIgdmFsdWVMaXN0ID0gZXhwYW5kby5jOwoJCQkJcmV0dXJuIEE0KCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdDb25zdHJ1Y3RvciwgbWF5YmVLZXksIG1heWJlTmFtZSwgaXNDbG9zZWQsIHZhbHVlTGlzdCk7CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3Q29uc3RydWN0b3IgPSBGNCgKCWZ1bmN0aW9uIChtYXliZUtleSwgbWF5YmVOYW1lLCBpc0Nsb3NlZCwgdmFsdWVMaXN0KSB7CgkJdmFyIHRpbnlBcmdzID0gQTIoCgkJCSRlbG0kY29yZSRMaXN0JG1hcCwKCQkJQTIoJGVsbSRjb3JlJEJhc2ljcyRjb21wb3NlTCwgJGVsbSRjb3JlJFR1cGxlJHNlY29uZCwgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld0V4dHJhVGlueSksCgkJCXZhbHVlTGlzdCk7CgkJdmFyIGRlc2NyaXB0aW9uID0gZnVuY3Rpb24gKCkgewoJCQl2YXIgX3Y3ID0gX1V0aWxzX1R1cGxlMihtYXliZU5hbWUsIHRpbnlBcmdzKTsKCQkJaWYgKF92Ny5hLiQgPT09ICdOb3RoaW5nJykgewoJCQkJaWYgKCFfdjcuYi5iKSB7CgkJCQkJdmFyIF92OCA9IF92Ny5hOwoJCQkJCXJldHVybiBfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJygpJykKCQkJCQkJXSk7CgkJCQl9IGVsc2UgewoJCQkJCXZhciBfdjkgPSBfdjcuYTsKCQkJCQl2YXIgX3YxMCA9IF92Ny5iOwoJCQkJCXZhciB4ID0gX3YxMC5hOwoJCQkJCXZhciB4cyA9IF92MTAuYjsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJyggJyksCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJHNwYW4sIF9MaXN0X05pbCwgeCksCgkJCQkJCQlBMygKCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRmb2xkciwKCQkJCQkJCQlGMigKCQkJCQkJCQkJZnVuY3Rpb24gKGFyZ3MsIHJlc3QpIHsKCQkJCQkJCQkJCXJldHVybiBBMigKCQkJCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJywgJyksCgkJCQkJCQkJCQkJQTIoCgkJCQkJCQkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJHNwYW4sIF9MaXN0X05pbCwgYXJncyksCgkJCQkJCQkJCQkJCXJlc3QpKTsKCQkJCQkJCQkJfSksCgkJCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJCQlbCgkJCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCcgKScpCgkJCQkJCQkJCV0pLAoJCQkJCQkJCXhzKSkpOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJaWYgKCFfdjcuYi5iKSB7CgkJCQkJdmFyIG5hbWUgPSBfdjcuYS5hOwoJCQkJCXJldHVybiBfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQobmFtZSkKCQkJCQkJXSk7CgkJCQl9IGVsc2UgewoJCQkJCXZhciBuYW1lID0gX3Y3LmEuYTsKCQkJCQl2YXIgX3YxMSA9IF92Ny5iOwoJCQkJCXZhciB4ID0gX3YxMS5hOwoJCQkJCXZhciB4cyA9IF92MTEuYjsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQobmFtZSArICcgJyksCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJHNwYW4sIF9MaXN0X05pbCwgeCksCgkJCQkJCQlBMygKCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRmb2xkciwKCQkJCQkJCQlGMigKCQkJCQkJCQkJZnVuY3Rpb24gKGFyZ3MsIHJlc3QpIHsKCQkJCQkJCQkJCXJldHVybiBBMigKCQkJCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJyAnKSwKCQkJCQkJCQkJCQlBMigKCQkJCQkJCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkc3BhbiwgX0xpc3RfTmlsLCBhcmdzKSwKCQkJCQkJCQkJCQkJcmVzdCkpOwoJCQkJCQkJCQl9KSwKCQkJCQkJCQlfTGlzdF9OaWwsCgkJCQkJCQkJeHMpKSk7CgkJCQl9CgkJCX0KCQl9KCk7CgkJdmFyIF92NCA9IGZ1bmN0aW9uICgpIHsKCQkJaWYgKCF2YWx1ZUxpc3QuYikgewoJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcsCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkZGl2LCBfTGlzdF9OaWwsIF9MaXN0X05pbCkpOwoJCQl9IGVsc2UgewoJCQkJaWYgKCF2YWx1ZUxpc3QuYi5iKSB7CgkJCQkJdmFyIGVudHJ5ID0gdmFsdWVMaXN0LmE7CgkJCQkJc3dpdGNoIChlbnRyeS4kKSB7CgkJCQkJCWNhc2UgJ1MnOgoJCQkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCQkJJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcsCgkJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkZGl2LCBfTGlzdF9OaWwsIF9MaXN0X05pbCkpOwoJCQkJCQljYXNlICdQcmltaXRpdmUnOgoJCQkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCQkJJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcsCgkJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkZGl2LCBfTGlzdF9OaWwsIF9MaXN0X05pbCkpOwoJCQkJCQljYXNlICdTZXF1ZW5jZSc6CgkJCQkJCQl2YXIgc3ViVmFsdWVMaXN0ID0gZW50cnkuYzsKCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KGlzQ2xvc2VkKSwKCQkJCQkJCQlpc0Nsb3NlZCA/IEEyKCRlbG0kaHRtbCRIdG1sJGRpdiwgX0xpc3RfTmlsLCBfTGlzdF9OaWwpIDogQTIoCgkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJCQkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kSW5kZXgsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJE5vbmUsIDApLAoJCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3U2VxdWVuY2VPcGVuKHN1YlZhbHVlTGlzdCkpKTsKCQkJCQkJY2FzZSAnRGljdGlvbmFyeSc6CgkJCQkJCQl2YXIga2V5VmFsdWVQYWlycyA9IGVudHJ5LmI7CgkJCQkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQkJCQkkZWxtJGNvcmUkTWF5YmUkSnVzdChpc0Nsb3NlZCksCgkJCQkJCQkJaXNDbG9zZWQgPyBBMigkZWxtJGh0bWwkSHRtbCRkaXYsIF9MaXN0X05pbCwgX0xpc3RfTmlsKSA6IEEyKAoJCQkJCQkJCQkkZWxtJGh0bWwkSHRtbCRtYXAsCgkJCQkJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJEluZGV4LCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyROb25lLCAwKSwKCQkJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld0RpY3Rpb25hcnlPcGVuKGtleVZhbHVlUGFpcnMpKSk7CgkJCQkJCWNhc2UgJ1JlY29yZCc6CgkJCQkJCQl2YXIgcmVjb3JkID0gZW50cnkuYjsKCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KGlzQ2xvc2VkKSwKCQkJCQkJCQlpc0Nsb3NlZCA/IEEyKCRlbG0kaHRtbCRIdG1sJGRpdiwgX0xpc3RfTmlsLCBfTGlzdF9OaWwpIDogQTIoCgkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJCQkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kSW5kZXgsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJE5vbmUsIDApLAoJCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3UmVjb3JkT3BlbihyZWNvcmQpKSk7CgkJCQkJCWRlZmF1bHQ6CgkJCQkJCQl2YXIgc3ViVmFsdWVMaXN0ID0gZW50cnkuYzsKCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KGlzQ2xvc2VkKSwKCQkJCQkJCQlpc0Nsb3NlZCA/IEEyKCRlbG0kaHRtbCRIdG1sJGRpdiwgX0xpc3RfTmlsLCBfTGlzdF9OaWwpIDogQTIoCgkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJCQkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kSW5kZXgsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJE5vbmUsIDApLAoJCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3Q29uc3RydWN0b3JPcGVuKHN1YlZhbHVlTGlzdCkpKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkkZWxtJGNvcmUkTWF5YmUkSnVzdChpc0Nsb3NlZCksCgkJCQkJCWlzQ2xvc2VkID8gQTIoJGVsbSRodG1sJEh0bWwkZGl2LCBfTGlzdF9OaWwsIF9MaXN0X05pbCkgOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3Q29uc3RydWN0b3JPcGVuKHZhbHVlTGlzdCkpOwoJCQkJfQoJCQl9CgkJfSgpOwoJCXZhciBtYXliZUlzQ2xvc2VkID0gX3Y0LmE7CgkJdmFyIG9wZW5IdG1sID0gX3Y0LmI7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGxlZnRQYWQobWF5YmVLZXkpLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJJGVsbSRodG1sJEh0bWwkRXZlbnRzJG9uQ2xpY2soJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kVG9nZ2xlKQoJCQkJCQldKSwKCQkJCQlBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRsaW5lU3RhcnRlciwgbWF5YmVLZXksIG1heWJlSXNDbG9zZWQsIGRlc2NyaXB0aW9uKSksCgkJCQkJb3Blbkh0bWwKCQkJCV0pKTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld0NvbnN0cnVjdG9yRW50cnkgPSBGMigKCWZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kSW5kZXgsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJE5vbmUsIGluZGV4KSwKCQkJQTIoCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3LAoJCQkJJGVsbSRjb3JlJE1heWJlJEp1c3QoCgkJCQkJJGVsbSRjb3JlJFN0cmluZyRmcm9tSW50KGluZGV4KSksCgkJCQl2YWx1ZSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3Q29uc3RydWN0b3JPcGVuID0gZnVuY3Rpb24gKHZhbHVlTGlzdCkgewoJcmV0dXJuIEEyKAoJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQlfTGlzdF9OaWwsCgkJQTIoJGVsbSRjb3JlJExpc3QkaW5kZXhlZE1hcCwgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld0NvbnN0cnVjdG9yRW50cnksIHZhbHVlTGlzdCkpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld0RpY3Rpb25hcnkgPSBGMygKCWZ1bmN0aW9uIChtYXliZUtleSwgaXNDbG9zZWQsIGtleVZhbHVlUGFpcnMpIHsKCQl2YXIgc3RhcnRlciA9ICdEaWN0KCcgKyAoJGVsbSRjb3JlJFN0cmluZyRmcm9tSW50KAoJCQkkZWxtJGNvcmUkTGlzdCRsZW5ndGgoa2V5VmFsdWVQYWlycykpICsgJyknKTsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbGVmdFBhZChtYXliZUtleSksCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb25DbGljaygkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRUb2dnbGUpCgkJCQkJCV0pLAoJCQkJCUEzKAoJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRsaW5lU3RhcnRlciwKCQkJCQkJbWF5YmVLZXksCgkJCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KGlzQ2xvc2VkKSwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWwoJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoc3RhcnRlcikKCQkJCQkJCV0pKSksCgkJCQkJaXNDbG9zZWQgPyAkZWxtJGh0bWwkSHRtbCR0ZXh0KCcnKSA6ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdEaWN0aW9uYXJ5T3BlbihrZXlWYWx1ZVBhaXJzKQoJCQkJXSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3RGljdGlvbmFyeUVudHJ5ID0gRjIoCglmdW5jdGlvbiAoaW5kZXgsIF92MikgewoJCXZhciBrZXkgPSBfdjIuYTsKCQl2YXIgdmFsdWUgPSBfdjIuYjsKCQlzd2l0Y2ggKGtleS4kKSB7CgkJCWNhc2UgJ1MnOgoJCQkJdmFyIHN0cmluZ1JlcCA9IGtleS5hOwoJCQkJcmV0dXJuIEEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJCQlBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRJbmRleCwgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kVmFsdWUsIGluZGV4KSwKCQkJCQlBMigKCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlldywKCQkJCQkJJGVsbSRjb3JlJE1heWJlJEp1c3Qoc3RyaW5nUmVwKSwKCQkJCQkJdmFsdWUpKTsKCQkJY2FzZSAnUHJpbWl0aXZlJzoKCQkJCXZhciBzdHJpbmdSZXAgPSBrZXkuYTsKCQkJCXJldHVybiBBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRtYXAsCgkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kSW5kZXgsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFZhbHVlLCBpbmRleCksCgkJCQkJQTIoCgkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXcsCgkJCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KHN0cmluZ1JlcCksCgkJCQkJCXZhbHVlKSk7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCQkJCV9MaXN0X05pbCwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCUEyKAoJCQkJCQkJJGVsbSRodG1sJEh0bWwkbWFwLAoJCQkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kSW5kZXgsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJEtleSwgaW5kZXgpLAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlldywKCQkJCQkJCQkkZWxtJGNvcmUkTWF5YmUkSnVzdCgna2V5JyksCgkJCQkJCQkJa2V5KSksCgkJCQkJCQlBMigKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJEluZGV4LCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRWYWx1ZSwgaW5kZXgpLAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlldywKCQkJCQkJCQkkZWxtJGNvcmUkTWF5YmUkSnVzdCgndmFsdWUnKSwKCQkJCQkJCQl2YWx1ZSkpCgkJCQkJCV0pKTsKCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdEaWN0aW9uYXJ5T3BlbiA9IGZ1bmN0aW9uIChrZXlWYWx1ZVBhaXJzKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCV9MaXN0X05pbCwKCQlBMigkZWxtJGNvcmUkTGlzdCRpbmRleGVkTWFwLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3RGljdGlvbmFyeUVudHJ5LCBrZXlWYWx1ZVBhaXJzKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3UmVjb3JkID0gRjMoCglmdW5jdGlvbiAobWF5YmVLZXksIGlzQ2xvc2VkLCByZWNvcmQpIHsKCQl2YXIgX3YxID0gaXNDbG9zZWQgPyBfVXRpbHNfVHVwbGUzKAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3VGlueVJlY29yZChyZWNvcmQpLmIsCgkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJycpLAoJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCcnKSkgOiBfVXRpbHNfVHVwbGUzKAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgneycpCgkJCQldKSwKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld1JlY29yZE9wZW4ocmVjb3JkKSwKCQkJQTIoCgkJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRsZWZ0UGFkKAoJCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KF9VdGlsc19UdXBsZTApKSwKCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQlbCgkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJ30nKQoJCQkJCV0pKSk7CgkJdmFyIHN0YXJ0ID0gX3YxLmE7CgkJdmFyIG1pZGRsZSA9IF92MS5iOwoJCXZhciBlbmQgPSBfdjEuYzsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbGVmdFBhZChtYXliZUtleSksCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb25DbGljaygkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRUb2dnbGUpCgkJCQkJCV0pLAoJCQkJCUEzKAoJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRsaW5lU3RhcnRlciwKCQkJCQkJbWF5YmVLZXksCgkJCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KGlzQ2xvc2VkKSwKCQkJCQkJc3RhcnQpKSwKCQkJCQltaWRkbGUsCgkJCQkJZW5kCgkJCQldKSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdSZWNvcmRFbnRyeSA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciBmaWVsZCA9IF92MC5hOwoJdmFyIHZhbHVlID0gX3YwLmI7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkbWFwLAoJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJEZpZWxkKGZpZWxkKSwKCQlBMigKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlldywKCQkJJGVsbSRjb3JlJE1heWJlJEp1c3QoZmllbGQpLAoJCQl2YWx1ZSkpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld1JlY29yZE9wZW4gPSBmdW5jdGlvbiAocmVjb3JkKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCV9MaXN0X05pbCwKCQlBMigKCQkJJGVsbSRjb3JlJExpc3QkbWFwLAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3UmVjb3JkRW50cnksCgkJCSRlbG0kY29yZSREaWN0JHRvTGlzdChyZWNvcmQpKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3U2VxdWVuY2UgPSBGNCgKCWZ1bmN0aW9uIChtYXliZUtleSwgc2VxVHlwZSwgaXNDbG9zZWQsIHZhbHVlTGlzdCkgewoJCXZhciBzdGFydGVyID0gQTIoCgkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHNlcVR5cGVUb1N0cmluZywKCQkJJGVsbSRjb3JlJExpc3QkbGVuZ3RoKHZhbHVlTGlzdCksCgkJCXNlcVR5cGUpOwoJCXJldHVybiBBMigKCQkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRsZWZ0UGFkKG1heWJlS2V5KSwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJEV2ZW50cyRvbkNsaWNrKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFRvZ2dsZSkKCQkJCQkJXSksCgkJCQkJQTMoCgkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGxpbmVTdGFydGVyLAoJCQkJCQltYXliZUtleSwKCQkJCQkJJGVsbSRjb3JlJE1heWJlJEp1c3QoaXNDbG9zZWQpLAoJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQlbCgkJCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dChzdGFydGVyKQoJCQkJCQkJXSkpKSwKCQkJCQlpc0Nsb3NlZCA/ICRlbG0kaHRtbCRIdG1sJHRleHQoJycpIDogJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlld1NlcXVlbmNlT3Blbih2YWx1ZUxpc3QpCgkJCQldKSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHZpZXdTZXF1ZW5jZU9wZW4gPSBmdW5jdGlvbiAodmFsdWVzKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCV9MaXN0X05pbCwKCQlBMigkZWxtJGNvcmUkTGlzdCRpbmRleGVkTWFwLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3Q29uc3RydWN0b3JFbnRyeSwgdmFsdWVzKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR2aWV3RXhwYW5kbyA9IEYzKAoJZnVuY3Rpb24gKGV4cGFuZG9Nc2csIGV4cGFuZG9Nb2RlbCwgbGF5b3V0KSB7CgkJdmFyIGJsb2NrID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9Nb3VzZUJsb2NrZXIobGF5b3V0KTsKCQl2YXIgX3YwID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9FeHBhbmRvUGVyY2VudHMobGF5b3V0KTsKCQl2YXIgdyA9IF92MC5hOwoJCXZhciBoID0gX3YwLmI7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnZGlzcGxheScsICdibG9jaycpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd3aWR0aCcsICdjYWxjKCcgKyAodyArICcgLSA0ZW0pJykpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdoZWlnaHQnLCAnY2FsYygnICsgKGggKyAnIC0gNGVtKScpKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAncGFkZGluZycsICcyZW0nKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnbWFyZ2luJywgJzAnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnb3ZlcmZsb3cnLCAnYXV0bycpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb2ludGVyLWV2ZW50cycsIGJsb2NrKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnLXdlYmtpdC11c2VyLXNlbGVjdCcsIGJsb2NrKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnLW1vei11c2VyLXNlbGVjdCcsIGJsb2NrKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnLW1zLXVzZXItc2VsZWN0JywgYmxvY2spLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd1c2VyLXNlbGVjdCcsIGJsb2NrKQoJCQkJXSksCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnY29sb3InLCAnI2NjYycpLAoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3BhZGRpbmcnLCAnMCAwIDFlbSAwJykKCQkJCQkJXSksCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KCctLSBNRVNTQUdFJykKCQkJCQkJXSkpLAoJCQkJCUEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRUd2Vha0V4cGFuZG9Nc2csCgkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdmlldywgJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcsIGV4cGFuZG9Nc2cpKSwKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnY29sb3InLCAnI2NjYycpLAoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3BhZGRpbmcnLCAnMWVtIDAnKQoJCQkJCQldKSwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJy0tIE1PREVMJykKCQkJCQkJXSkpLAoJCQkJCUEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRUd2Vha0V4cGFuZG9Nb2RlbCwKCQkJCQlBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR2aWV3LCAkZWxtJGNvcmUkTWF5YmUkTm90aGluZywgZXhwYW5kb01vZGVsKSkKCQkJCV0pKTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kSnVtcCA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdKdW1wJywgYTogYX07Cn07CnZhciAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kbGF6eSA9IF9WaXJ0dWFsRG9tX2xhenk7CnZhciAkZWxtJGh0bWwkSHRtbCRMYXp5JGxhenkgPSAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kbGF6eTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHRvSGlzdG9yeVBlcmNlbnRzID0gZnVuY3Rpb24gKGxheW91dCkgewoJaWYgKGxheW91dC4kID09PSAnSG9yaXpvbnRhbCcpIHsKCQl2YXIgeCA9IGxheW91dC5iOwoJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR0b1BlcmNlbnQoeCksCgkJCScxMDAlJyk7Cgl9IGVsc2UgewoJCXZhciB5ID0gbGF5b3V0LmM7CgkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCScxMDAlJywKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9QZXJjZW50KDEgLSB5KSk7Cgl9Cn07CnZhciAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kbGF6eTMgPSBfVmlydHVhbERvbV9sYXp5MzsKdmFyICRlbG0kaHRtbCRIdG1sJExhenkkbGF6eTMgPSAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kbGF6eTM7CnZhciAkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJGNsYXNzID0gJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHJpbmdQcm9wZXJ0eSgnY2xhc3NOYW1lJyk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRpZEZvck1lc3NhZ2VJbmRleCA9IGZ1bmN0aW9uIChpbmRleCkgewoJcmV0dXJuICdtc2ctJyArICRlbG0kY29yZSRTdHJpbmckZnJvbUludChpbmRleCk7Cn07CnZhciAkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHRpdGxlID0gJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHJpbmdQcm9wZXJ0eSgndGl0bGUnKTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHZpZXdNZXNzYWdlID0gRjMoCglmdW5jdGlvbiAoY3VycmVudEluZGV4LCBpbmRleCwgbXNnKSB7CgkJdmFyIG1lc3NhZ2VOYW1lID0gX0RlYnVnZ2VyX21lc3NhZ2VUb1N0cmluZyhtc2cpOwoJCXZhciBjbGFzc05hbWUgPSBfVXRpbHNfZXEoY3VycmVudEluZGV4LCBpbmRleCkgPyAnZWxtLWRlYnVnZ2VyLWVudHJ5IGVsbS1kZWJ1Z2dlci1lbnRyeS1zZWxlY3RlZCcgOiAnZWxtLWRlYnVnZ2VyLWVudHJ5JzsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCSRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkaWQoCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkaWRGb3JNZXNzYWdlSW5kZXgoaW5kZXgpKSwKCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJGNsYXNzKGNsYXNzTmFtZSksCgkJCQkJJGVsbSRodG1sJEh0bWwkRXZlbnRzJG9uQ2xpY2soaW5kZXgpCgkJCQldKSwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJHNwYW4sCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHRpdGxlKG1lc3NhZ2VOYW1lKSwKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkY2xhc3MoJ2VsbS1kZWJ1Z2dlci1lbnRyeS1jb250ZW50JykKCQkJCQkJXSksCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KG1lc3NhZ2VOYW1lKQoJCQkJCQldKSksCgkJCQkJQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkc3BhbiwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkY2xhc3MoJ2VsbS1kZWJ1Z2dlci1lbnRyeS1pbmRleCcpCgkJCQkJCV0pLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgKCQkJCQkJCSRlbG0kY29yZSRTdHJpbmckZnJvbUludChpbmRleCkpCgkJCQkJCV0pKQoJCQkJXSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRjb25zTXNnID0gRjMoCglmdW5jdGlvbiAoY3VycmVudEluZGV4LCBtc2csIF92MCkgewoJCXZhciBpbmRleCA9IF92MC5hOwoJCXZhciByZXN0ID0gX3YwLmI7CgkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCWluZGV4ICsgMSwKCQkJQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJX1V0aWxzX1R1cGxlMigKCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGZyb21JbnQoaW5kZXgpLAoJCQkJCUE0KCRlbG0kaHRtbCRIdG1sJExhenkkbGF6eTMsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHZpZXdNZXNzYWdlLCBjdXJyZW50SW5kZXgsIGluZGV4LCBtc2cpKSwKCQkJCXJlc3QpKTsKCX0pOwp2YXIgJGVsbSRjb3JlJEFycmF5JGxlbmd0aCA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciBsZW4gPSBfdjAuYTsKCXJldHVybiBsZW47Cn07CnZhciAkZWxtJGNvcmUkQmFzaWNzJG5lcSA9IF9VdGlsc19ub3RFcXVhbDsKdmFyICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRrZXllZE5vZGUgPSBmdW5jdGlvbiAodGFnKSB7CglyZXR1cm4gX1ZpcnR1YWxEb21fa2V5ZWROb2RlKAoJCV9WaXJ0dWFsRG9tX25vU2NyaXB0KHRhZykpOwp9Owp2YXIgJGVsbSRodG1sJEh0bWwkS2V5ZWQkbm9kZSA9ICRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRrZXllZE5vZGU7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRtYXhTbmFwc2hvdFNpemUgPSAzMTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHNob3dNb3JlQnV0dG9uID0gZnVuY3Rpb24gKG51bU1lc3NhZ2VzKSB7Cgl2YXIgbmV4dEluZGV4ID0gKG51bU1lc3NhZ2VzIC0gMSkgLSAoJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkbWF4U25hcHNob3RTaXplICogMik7Cgl2YXIgbGFiZWxUZXh0ID0gJ1ZpZXcgbW9yZSBtZXNzYWdlcyc7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCV9MaXN0X2Zyb21BcnJheSgKCQkJWwoJCQkJJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRjbGFzcygnZWxtLWRlYnVnZ2VyLWVudHJ5JyksCgkJCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb25DbGljayhuZXh0SW5kZXgpCgkJCV0pLAoJCV9MaXN0X2Zyb21BcnJheSgKCQkJWwoJCQkJQTIoCgkJCQkkZWxtJGh0bWwkSHRtbCRzcGFuLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyR0aXRsZShsYWJlbFRleHQpLAoJCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJGNsYXNzKCdlbG0tZGVidWdnZXItZW50cnktY29udGVudCcpCgkJCQkJXSksCgkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KGxhYmVsVGV4dCkKCQkJCQldKSksCgkJCQlBMigKCQkJCSRlbG0kaHRtbCRIdG1sJHNwYW4sCgkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJGNsYXNzKCdlbG0tZGVidWdnZXItZW50cnktaW5kZXgnKQoJCQkJCV0pLAoJCQkJX0xpc3RfTmlsKQoJCQldKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRzdHlsZXMgPSBBMygKCSRlbG0kaHRtbCRIdG1sJG5vZGUsCgknc3R5bGUnLAoJX0xpc3RfTmlsLAoJX0xpc3RfZnJvbUFycmF5KAoJCVsKCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgnXG5cbi5lbG0tZGVidWdnZXItZW50cnkge1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIHdpZHRoOiAxMDAlO1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBwYWRkaW5nOiA4cHg7XG59XG5cbi5lbG0tZGVidWdnZXItZW50cnk6aG92ZXIge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoNDEsIDQxLCA0MSk7XG59XG5cbi5lbG0tZGVidWdnZXItZW50cnktc2VsZWN0ZWQsIC5lbG0tZGVidWdnZXItZW50cnktc2VsZWN0ZWQ6aG92ZXIge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMTAsIDEwLCAxMCk7XG59XG5cbi5lbG0tZGVidWdnZXItZW50cnktY29udGVudCB7XG4gIHdpZHRoOiBjYWxjKDEwMCUgLSA0MHB4KTtcbiAgcGFkZGluZzogMCA1cHg7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xuICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG59XG5cbi5lbG0tZGVidWdnZXItZW50cnktaW5kZXgge1xuICBjb2xvcjogIzY2NjtcbiAgd2lkdGg6IDQwcHg7XG4gIHRleHQtYWxpZ246IHJpZ2h0O1xuICBkaXNwbGF5OiBibG9jaztcbiAgZmxvYXQ6IHJpZ2h0O1xufVxuXG4nKQoJCV0pKTsKdmFyICRlbG0kY29yZSRCYXNpY3MkZ2UgPSBfVXRpbHNfZ2U7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSR2aWV3U25hcHNob3QgPSBGMygKCWZ1bmN0aW9uIChzZWxlY3RlZEluZGV4LCBpbmRleCwgX3YwKSB7CgkJdmFyIG1lc3NhZ2VzID0gX3YwLm1lc3NhZ2VzOwoJCXJldHVybiBBMygKCQkJJGVsbSRodG1sJEh0bWwkS2V5ZWQkbm9kZSwKCQkJJ2RpdicsCgkJCV9MaXN0X05pbCwKCQkJQTMoCgkJCQkkZWxtJGNvcmUkQXJyYXkkZm9sZHIsCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRjb25zTXNnKHNlbGVjdGVkSW5kZXgpLAoJCQkJX1V0aWxzX1R1cGxlMihpbmRleCwgX0xpc3RfTmlsKSwKCQkJCW1lc3NhZ2VzKS5iKTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkY29uc1NuYXBzaG90ID0gRjMoCglmdW5jdGlvbiAoc2VsZWN0ZWRJbmRleCwgc25hcHNob3QsIF92MCkgewoJCXZhciBpbmRleCA9IF92MC5hOwoJCXZhciByZXN0ID0gX3YwLmI7CgkJdmFyIG5leHRJbmRleCA9IGluZGV4ICsgJGVsbSRjb3JlJEFycmF5JGxlbmd0aChzbmFwc2hvdC5tZXNzYWdlcyk7CgkJdmFyIHNlbGVjdGVkSW5kZXhIZWxwID0gKChfVXRpbHNfY21wKG5leHRJbmRleCwgc2VsZWN0ZWRJbmRleCkgPiAwKSAmJiAoX1V0aWxzX2NtcChzZWxlY3RlZEluZGV4LCBpbmRleCkgPiAtMSkpID8gc2VsZWN0ZWRJbmRleCA6ICgtMSk7CgkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCW5leHRJbmRleCwKCQkJQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJQTQoJGVsbSRodG1sJEh0bWwkTGF6eSRsYXp5MywgJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3Rvcnkkdmlld1NuYXBzaG90LCBzZWxlY3RlZEluZGV4SGVscCwgaW5kZXgsIHNuYXBzaG90KSwKCQkJCXJlc3QpKTsKCX0pOwp2YXIgJGVsbSRjb3JlJEVsbSRKc0FycmF5JGZvbGRsID0gX0pzQXJyYXlfZm9sZGw7CnZhciAkZWxtJGNvcmUkQXJyYXkkZm9sZGwgPSBGMygKCWZ1bmN0aW9uIChmdW5jLCBiYXNlQ2FzZSwgX3YwKSB7CgkJdmFyIHRyZWUgPSBfdjAuYzsKCQl2YXIgdGFpbCA9IF92MC5kOwoJCXZhciBoZWxwZXIgPSBGMigKCQkJZnVuY3Rpb24gKG5vZGUsIGFjYykgewoJCQkJaWYgKG5vZGUuJCA9PT0gJ1N1YlRyZWUnKSB7CgkJCQkJdmFyIHN1YlRyZWUgPSBub2RlLmE7CgkJCQkJcmV0dXJuIEEzKCRlbG0kY29yZSRFbG0kSnNBcnJheSRmb2xkbCwgaGVscGVyLCBhY2MsIHN1YlRyZWUpOwoJCQkJfSBlbHNlIHsKCQkJCQl2YXIgdmFsdWVzID0gbm9kZS5hOwoJCQkJCXJldHVybiBBMygkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZm9sZGwsIGZ1bmMsIGFjYywgdmFsdWVzKTsKCQkJCX0KCQkJfSk7CgkJcmV0dXJuIEEzKAoJCQkkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZm9sZGwsCgkJCWZ1bmMsCgkJCUEzKCRlbG0kY29yZSRFbG0kSnNBcnJheSRmb2xkbCwgaGVscGVyLCBiYXNlQ2FzZSwgdHJlZSksCgkJCXRhaWwpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSR2aWV3QWxsU25hcHNob3RzID0gRjMoCglmdW5jdGlvbiAoc2VsZWN0ZWRJbmRleCwgc3RhcnRJbmRleCwgc25hcHNob3RzKSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCV9MaXN0X05pbCwKCQkJQTMoCgkJCQkkZWxtJGNvcmUkQXJyYXkkZm9sZGwsCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRjb25zU25hcHNob3Qoc2VsZWN0ZWRJbmRleCksCgkJCQlfVXRpbHNfVHVwbGUyKHN0YXJ0SW5kZXgsIF9MaXN0X05pbCksCgkJCQlzbmFwc2hvdHMpLmIpOwoJfSk7CnZhciAkZWxtJGNvcmUkQXJyYXkkZnJvbUxpc3RIZWxwID0gRjMoCglmdW5jdGlvbiAobGlzdCwgbm9kZUxpc3QsIG5vZGVMaXN0U2l6ZSkgewoJCWZyb21MaXN0SGVscDoKCQl3aGlsZSAodHJ1ZSkgewoJCQl2YXIgX3YwID0gQTIoJGVsbSRjb3JlJEVsbSRKc0FycmF5JGluaXRpYWxpemVGcm9tTGlzdCwgJGVsbSRjb3JlJEFycmF5JGJyYW5jaEZhY3RvciwgbGlzdCk7CgkJCXZhciBqc0FycmF5ID0gX3YwLmE7CgkJCXZhciByZW1haW5pbmdJdGVtcyA9IF92MC5iOwoJCQlpZiAoX1V0aWxzX2NtcCgKCQkJCSRlbG0kY29yZSRFbG0kSnNBcnJheSRsZW5ndGgoanNBcnJheSksCgkJCQkkZWxtJGNvcmUkQXJyYXkkYnJhbmNoRmFjdG9yKSA8IDApIHsKCQkJCXJldHVybiBBMigKCQkJCQkkZWxtJGNvcmUkQXJyYXkkYnVpbGRlclRvQXJyYXksCgkJCQkJdHJ1ZSwKCQkJCQl7bm9kZUxpc3Q6IG5vZGVMaXN0LCBub2RlTGlzdFNpemU6IG5vZGVMaXN0U2l6ZSwgdGFpbDoganNBcnJheX0pOwoJCQl9IGVsc2UgewoJCQkJdmFyICR0ZW1wJGxpc3QgPSByZW1haW5pbmdJdGVtcywKCQkJCQkkdGVtcCRub2RlTGlzdCA9IEEyKAoJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJJGVsbSRjb3JlJEFycmF5JExlYWYoanNBcnJheSksCgkJCQkJbm9kZUxpc3QpLAoJCQkJCSR0ZW1wJG5vZGVMaXN0U2l6ZSA9IG5vZGVMaXN0U2l6ZSArIDE7CgkJCQlsaXN0ID0gJHRlbXAkbGlzdDsKCQkJCW5vZGVMaXN0ID0gJHRlbXAkbm9kZUxpc3Q7CgkJCQlub2RlTGlzdFNpemUgPSAkdGVtcCRub2RlTGlzdFNpemU7CgkJCQljb250aW51ZSBmcm9tTGlzdEhlbHA7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRBcnJheSRmcm9tTGlzdCA9IGZ1bmN0aW9uIChsaXN0KSB7CglpZiAoIWxpc3QuYikgewoJCXJldHVybiAkZWxtJGNvcmUkQXJyYXkkZW1wdHk7Cgl9IGVsc2UgewoJCXJldHVybiBBMygkZWxtJGNvcmUkQXJyYXkkZnJvbUxpc3RIZWxwLCBsaXN0LCBfTGlzdF9OaWwsIDApOwoJfQp9Owp2YXIgJGVsbSRjb3JlJEJpdHdpc2UkYW5kID0gX0JpdHdpc2VfYW5kOwp2YXIgJGVsbSRjb3JlJEJpdHdpc2Ukc2hpZnRSaWdodFpmQnkgPSBfQml0d2lzZV9zaGlmdFJpZ2h0WmZCeTsKdmFyICRlbG0kY29yZSRBcnJheSRiaXRNYXNrID0gNDI5NDk2NzI5NSA+Pj4gKDMyIC0gJGVsbSRjb3JlJEFycmF5JHNoaWZ0U3RlcCk7CnZhciAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkdW5zYWZlR2V0ID0gX0pzQXJyYXlfdW5zYWZlR2V0Owp2YXIgJGVsbSRjb3JlJEFycmF5JGdldEhlbHAgPSBGMygKCWZ1bmN0aW9uIChzaGlmdCwgaW5kZXgsIHRyZWUpIHsKCQlnZXRIZWxwOgoJCXdoaWxlICh0cnVlKSB7CgkJCXZhciBwb3MgPSAkZWxtJGNvcmUkQXJyYXkkYml0TWFzayAmIChpbmRleCA+Pj4gc2hpZnQpOwoJCQl2YXIgX3YwID0gQTIoJGVsbSRjb3JlJEVsbSRKc0FycmF5JHVuc2FmZUdldCwgcG9zLCB0cmVlKTsKCQkJaWYgKF92MC4kID09PSAnU3ViVHJlZScpIHsKCQkJCXZhciBzdWJUcmVlID0gX3YwLmE7CgkJCQl2YXIgJHRlbXAkc2hpZnQgPSBzaGlmdCAtICRlbG0kY29yZSRBcnJheSRzaGlmdFN0ZXAsCgkJCQkJJHRlbXAkaW5kZXggPSBpbmRleCwKCQkJCQkkdGVtcCR0cmVlID0gc3ViVHJlZTsKCQkJCXNoaWZ0ID0gJHRlbXAkc2hpZnQ7CgkJCQlpbmRleCA9ICR0ZW1wJGluZGV4OwoJCQkJdHJlZSA9ICR0ZW1wJHRyZWU7CgkJCQljb250aW51ZSBnZXRIZWxwOwoJCQl9IGVsc2UgewoJCQkJdmFyIHZhbHVlcyA9IF92MC5hOwoJCQkJcmV0dXJuIEEyKCRlbG0kY29yZSRFbG0kSnNBcnJheSR1bnNhZmVHZXQsICRlbG0kY29yZSRBcnJheSRiaXRNYXNrICYgaW5kZXgsIHZhbHVlcyk7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRCaXR3aXNlJHNoaWZ0TGVmdEJ5ID0gX0JpdHdpc2Vfc2hpZnRMZWZ0Qnk7CnZhciAkZWxtJGNvcmUkQXJyYXkkdGFpbEluZGV4ID0gZnVuY3Rpb24gKGxlbikgewoJcmV0dXJuIChsZW4gPj4+IDUpIDw8IDU7Cn07CnZhciAkZWxtJGNvcmUkQXJyYXkkZ2V0ID0gRjIoCglmdW5jdGlvbiAoaW5kZXgsIF92MCkgewoJCXZhciBsZW4gPSBfdjAuYTsKCQl2YXIgc3RhcnRTaGlmdCA9IF92MC5iOwoJCXZhciB0cmVlID0gX3YwLmM7CgkJdmFyIHRhaWwgPSBfdjAuZDsKCQlyZXR1cm4gKChpbmRleCA8IDApIHx8IChfVXRpbHNfY21wKGluZGV4LCBsZW4pID4gLTEpKSA/ICRlbG0kY29yZSRNYXliZSROb3RoaW5nIDogKChfVXRpbHNfY21wKAoJCQlpbmRleCwKCQkJJGVsbSRjb3JlJEFycmF5JHRhaWxJbmRleChsZW4pKSA+IC0xKSA/ICRlbG0kY29yZSRNYXliZSRKdXN0KAoJCQlBMigkZWxtJGNvcmUkRWxtJEpzQXJyYXkkdW5zYWZlR2V0LCAkZWxtJGNvcmUkQXJyYXkkYml0TWFzayAmIGluZGV4LCB0YWlsKSkgOiAkZWxtJGNvcmUkTWF5YmUkSnVzdCgKCQkJQTMoJGVsbSRjb3JlJEFycmF5JGdldEhlbHAsIHN0YXJ0U2hpZnQsIGluZGV4LCB0cmVlKSkpOwoJfSk7CnZhciAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkYXBwZW5kTiA9IF9Kc0FycmF5X2FwcGVuZE47CnZhciAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkc2xpY2UgPSBfSnNBcnJheV9zbGljZTsKdmFyICRlbG0kY29yZSRBcnJheSRhcHBlbmRIZWxwQnVpbGRlciA9IEYyKAoJZnVuY3Rpb24gKHRhaWwsIGJ1aWxkZXIpIHsKCQl2YXIgdGFpbExlbiA9ICRlbG0kY29yZSRFbG0kSnNBcnJheSRsZW5ndGgodGFpbCk7CgkJdmFyIG5vdEFwcGVuZGVkID0gKCRlbG0kY29yZSRBcnJheSRicmFuY2hGYWN0b3IgLSAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkbGVuZ3RoKGJ1aWxkZXIudGFpbCkpIC0gdGFpbExlbjsKCQl2YXIgYXBwZW5kZWQgPSBBMygkZWxtJGNvcmUkRWxtJEpzQXJyYXkkYXBwZW5kTiwgJGVsbSRjb3JlJEFycmF5JGJyYW5jaEZhY3RvciwgYnVpbGRlci50YWlsLCB0YWlsKTsKCQlyZXR1cm4gKG5vdEFwcGVuZGVkIDwgMCkgPyB7CgkJCW5vZGVMaXN0OiBBMigKCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkkZWxtJGNvcmUkQXJyYXkkTGVhZihhcHBlbmRlZCksCgkJCQlidWlsZGVyLm5vZGVMaXN0KSwKCQkJbm9kZUxpc3RTaXplOiBidWlsZGVyLm5vZGVMaXN0U2l6ZSArIDEsCgkJCXRhaWw6IEEzKCRlbG0kY29yZSRFbG0kSnNBcnJheSRzbGljZSwgbm90QXBwZW5kZWQsIHRhaWxMZW4sIHRhaWwpCgkJfSA6ICgoIW5vdEFwcGVuZGVkKSA/IHsKCQkJbm9kZUxpc3Q6IEEyKAoJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCSRlbG0kY29yZSRBcnJheSRMZWFmKGFwcGVuZGVkKSwKCQkJCWJ1aWxkZXIubm9kZUxpc3QpLAoJCQlub2RlTGlzdFNpemU6IGJ1aWxkZXIubm9kZUxpc3RTaXplICsgMSwKCQkJdGFpbDogJGVsbSRjb3JlJEVsbSRKc0FycmF5JGVtcHR5CgkJfSA6IHtub2RlTGlzdDogYnVpbGRlci5ub2RlTGlzdCwgbm9kZUxpc3RTaXplOiBidWlsZGVyLm5vZGVMaXN0U2l6ZSwgdGFpbDogYXBwZW5kZWR9KTsKCX0pOwp2YXIgJGVsbSRjb3JlJExpc3QkZHJvcCA9IEYyKAoJZnVuY3Rpb24gKG4sIGxpc3QpIHsKCQlkcm9wOgoJCXdoaWxlICh0cnVlKSB7CgkJCWlmIChuIDw9IDApIHsKCQkJCXJldHVybiBsaXN0OwoJCQl9IGVsc2UgewoJCQkJaWYgKCFsaXN0LmIpIHsKCQkJCQlyZXR1cm4gbGlzdDsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIHggPSBsaXN0LmE7CgkJCQkJdmFyIHhzID0gbGlzdC5iOwoJCQkJCXZhciAkdGVtcCRuID0gbiAtIDEsCgkJCQkJCSR0ZW1wJGxpc3QgPSB4czsKCQkJCQluID0gJHRlbXAkbjsKCQkJCQlsaXN0ID0gJHRlbXAkbGlzdDsKCQkJCQljb250aW51ZSBkcm9wOwoJCQkJfQoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkQXJyYXkkc2xpY2VMZWZ0ID0gRjIoCglmdW5jdGlvbiAoZnJvbSwgYXJyYXkpIHsKCQl2YXIgbGVuID0gYXJyYXkuYTsKCQl2YXIgdHJlZSA9IGFycmF5LmM7CgkJdmFyIHRhaWwgPSBhcnJheS5kOwoJCWlmICghZnJvbSkgewoJCQlyZXR1cm4gYXJyYXk7CgkJfSBlbHNlIHsKCQkJaWYgKF9VdGlsc19jbXAoCgkJCQlmcm9tLAoJCQkJJGVsbSRjb3JlJEFycmF5JHRhaWxJbmRleChsZW4pKSA+IC0xKSB7CgkJCQlyZXR1cm4gQTQoCgkJCQkJJGVsbSRjb3JlJEFycmF5JEFycmF5X2VsbV9idWlsdGluLAoJCQkJCWxlbiAtIGZyb20sCgkJCQkJJGVsbSRjb3JlJEFycmF5JHNoaWZ0U3RlcCwKCQkJCQkkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZW1wdHksCgkJCQkJQTMoCgkJCQkJCSRlbG0kY29yZSRFbG0kSnNBcnJheSRzbGljZSwKCQkJCQkJZnJvbSAtICRlbG0kY29yZSRBcnJheSR0YWlsSW5kZXgobGVuKSwKCQkJCQkJJGVsbSRjb3JlJEVsbSRKc0FycmF5JGxlbmd0aCh0YWlsKSwKCQkJCQkJdGFpbCkpOwoJCQl9IGVsc2UgewoJCQkJdmFyIHNraXBOb2RlcyA9IChmcm9tIC8gJGVsbSRjb3JlJEFycmF5JGJyYW5jaEZhY3RvcikgfCAwOwoJCQkJdmFyIGhlbHBlciA9IEYyKAoJCQkJCWZ1bmN0aW9uIChub2RlLCBhY2MpIHsKCQkJCQkJaWYgKG5vZGUuJCA9PT0gJ1N1YlRyZWUnKSB7CgkJCQkJCQl2YXIgc3ViVHJlZSA9IG5vZGUuYTsKCQkJCQkJCXJldHVybiBBMygkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZm9sZHIsIGhlbHBlciwgYWNjLCBzdWJUcmVlKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXZhciBsZWFmID0gbm9kZS5hOwoJCQkJCQkJcmV0dXJuIEEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIGxlYWYsIGFjYyk7CgkJCQkJCX0KCQkJCQl9KTsKCQkJCXZhciBsZWFmTm9kZXMgPSBBMygKCQkJCQkkZWxtJGNvcmUkRWxtJEpzQXJyYXkkZm9sZHIsCgkJCQkJaGVscGVyLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJW3RhaWxdKSwKCQkJCQl0cmVlKTsKCQkJCXZhciBub2Rlc1RvSW5zZXJ0ID0gQTIoJGVsbSRjb3JlJExpc3QkZHJvcCwgc2tpcE5vZGVzLCBsZWFmTm9kZXMpOwoJCQkJaWYgKCFub2Rlc1RvSW5zZXJ0LmIpIHsKCQkJCQlyZXR1cm4gJGVsbSRjb3JlJEFycmF5JGVtcHR5OwoJCQkJfSBlbHNlIHsKCQkJCQl2YXIgaGVhZCA9IG5vZGVzVG9JbnNlcnQuYTsKCQkJCQl2YXIgcmVzdCA9IG5vZGVzVG9JbnNlcnQuYjsKCQkJCQl2YXIgZmlyc3RTbGljZSA9IGZyb20gLSAoc2tpcE5vZGVzICogJGVsbSRjb3JlJEFycmF5JGJyYW5jaEZhY3Rvcik7CgkJCQkJdmFyIGluaXRpYWxCdWlsZGVyID0gewoJCQkJCQlub2RlTGlzdDogX0xpc3RfTmlsLAoJCQkJCQlub2RlTGlzdFNpemU6IDAsCgkJCQkJCXRhaWw6IEEzKAoJCQkJCQkJJGVsbSRjb3JlJEVsbSRKc0FycmF5JHNsaWNlLAoJCQkJCQkJZmlyc3RTbGljZSwKCQkJCQkJCSRlbG0kY29yZSRFbG0kSnNBcnJheSRsZW5ndGgoaGVhZCksCgkJCQkJCQloZWFkKQoJCQkJCX07CgkJCQkJcmV0dXJuIEEyKAoJCQkJCQkkZWxtJGNvcmUkQXJyYXkkYnVpbGRlclRvQXJyYXksCgkJCQkJCXRydWUsCgkJCQkJCUEzKCRlbG0kY29yZSRMaXN0JGZvbGRsLCAkZWxtJGNvcmUkQXJyYXkkYXBwZW5kSGVscEJ1aWxkZXIsIGluaXRpYWxCdWlsZGVyLCByZXN0KSk7CgkJCQl9CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRBcnJheSRmZXRjaE5ld1RhaWwgPSBGNCgKCWZ1bmN0aW9uIChzaGlmdCwgZW5kLCB0cmVlRW5kLCB0cmVlKSB7CgkJZmV0Y2hOZXdUYWlsOgoJCXdoaWxlICh0cnVlKSB7CgkJCXZhciBwb3MgPSAkZWxtJGNvcmUkQXJyYXkkYml0TWFzayAmICh0cmVlRW5kID4+PiBzaGlmdCk7CgkJCXZhciBfdjAgPSBBMigkZWxtJGNvcmUkRWxtJEpzQXJyYXkkdW5zYWZlR2V0LCBwb3MsIHRyZWUpOwoJCQlpZiAoX3YwLiQgPT09ICdTdWJUcmVlJykgewoJCQkJdmFyIHN1YiA9IF92MC5hOwoJCQkJdmFyICR0ZW1wJHNoaWZ0ID0gc2hpZnQgLSAkZWxtJGNvcmUkQXJyYXkkc2hpZnRTdGVwLAoJCQkJCSR0ZW1wJGVuZCA9IGVuZCwKCQkJCQkkdGVtcCR0cmVlRW5kID0gdHJlZUVuZCwKCQkJCQkkdGVtcCR0cmVlID0gc3ViOwoJCQkJc2hpZnQgPSAkdGVtcCRzaGlmdDsKCQkJCWVuZCA9ICR0ZW1wJGVuZDsKCQkJCXRyZWVFbmQgPSAkdGVtcCR0cmVlRW5kOwoJCQkJdHJlZSA9ICR0ZW1wJHRyZWU7CgkJCQljb250aW51ZSBmZXRjaE5ld1RhaWw7CgkJCX0gZWxzZSB7CgkJCQl2YXIgdmFsdWVzID0gX3YwLmE7CgkJCQlyZXR1cm4gQTMoJGVsbSRjb3JlJEVsbSRKc0FycmF5JHNsaWNlLCAwLCAkZWxtJGNvcmUkQXJyYXkkYml0TWFzayAmIGVuZCwgdmFsdWVzKTsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJEFycmF5JGhvaXN0VHJlZSA9IEYzKAoJZnVuY3Rpb24gKG9sZFNoaWZ0LCBuZXdTaGlmdCwgdHJlZSkgewoJCWhvaXN0VHJlZToKCQl3aGlsZSAodHJ1ZSkgewoJCQlpZiAoKF9VdGlsc19jbXAob2xkU2hpZnQsIG5ld1NoaWZ0KSA8IDEpIHx8ICghJGVsbSRjb3JlJEVsbSRKc0FycmF5JGxlbmd0aCh0cmVlKSkpIHsKCQkJCXJldHVybiB0cmVlOwoJCQl9IGVsc2UgewoJCQkJdmFyIF92MCA9IEEyKCRlbG0kY29yZSRFbG0kSnNBcnJheSR1bnNhZmVHZXQsIDAsIHRyZWUpOwoJCQkJaWYgKF92MC4kID09PSAnU3ViVHJlZScpIHsKCQkJCQl2YXIgc3ViID0gX3YwLmE7CgkJCQkJdmFyICR0ZW1wJG9sZFNoaWZ0ID0gb2xkU2hpZnQgLSAkZWxtJGNvcmUkQXJyYXkkc2hpZnRTdGVwLAoJCQkJCQkkdGVtcCRuZXdTaGlmdCA9IG5ld1NoaWZ0LAoJCQkJCQkkdGVtcCR0cmVlID0gc3ViOwoJCQkJCW9sZFNoaWZ0ID0gJHRlbXAkb2xkU2hpZnQ7CgkJCQkJbmV3U2hpZnQgPSAkdGVtcCRuZXdTaGlmdDsKCQkJCQl0cmVlID0gJHRlbXAkdHJlZTsKCQkJCQljb250aW51ZSBob2lzdFRyZWU7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiB0cmVlOwoJCQkJfQoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkRWxtJEpzQXJyYXkkdW5zYWZlU2V0ID0gX0pzQXJyYXlfdW5zYWZlU2V0Owp2YXIgJGVsbSRjb3JlJEFycmF5JHNsaWNlVHJlZSA9IEYzKAoJZnVuY3Rpb24gKHNoaWZ0LCBlbmRJZHgsIHRyZWUpIHsKCQl2YXIgbGFzdFBvcyA9ICRlbG0kY29yZSRBcnJheSRiaXRNYXNrICYgKGVuZElkeCA+Pj4gc2hpZnQpOwoJCXZhciBfdjAgPSBBMigkZWxtJGNvcmUkRWxtJEpzQXJyYXkkdW5zYWZlR2V0LCBsYXN0UG9zLCB0cmVlKTsKCQlpZiAoX3YwLiQgPT09ICdTdWJUcmVlJykgewoJCQl2YXIgc3ViID0gX3YwLmE7CgkJCXZhciBuZXdTdWIgPSBBMygkZWxtJGNvcmUkQXJyYXkkc2xpY2VUcmVlLCBzaGlmdCAtICRlbG0kY29yZSRBcnJheSRzaGlmdFN0ZXAsIGVuZElkeCwgc3ViKTsKCQkJcmV0dXJuICghJGVsbSRjb3JlJEVsbSRKc0FycmF5JGxlbmd0aChuZXdTdWIpKSA/IEEzKCRlbG0kY29yZSRFbG0kSnNBcnJheSRzbGljZSwgMCwgbGFzdFBvcywgdHJlZSkgOiBBMygKCQkJCSRlbG0kY29yZSRFbG0kSnNBcnJheSR1bnNhZmVTZXQsCgkJCQlsYXN0UG9zLAoJCQkJJGVsbSRjb3JlJEFycmF5JFN1YlRyZWUobmV3U3ViKSwKCQkJCUEzKCRlbG0kY29yZSRFbG0kSnNBcnJheSRzbGljZSwgMCwgbGFzdFBvcyArIDEsIHRyZWUpKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gQTMoJGVsbSRjb3JlJEVsbSRKc0FycmF5JHNsaWNlLCAwLCBsYXN0UG9zLCB0cmVlKTsKCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRBcnJheSRzbGljZVJpZ2h0ID0gRjIoCglmdW5jdGlvbiAoZW5kLCBhcnJheSkgewoJCXZhciBsZW4gPSBhcnJheS5hOwoJCXZhciBzdGFydFNoaWZ0ID0gYXJyYXkuYjsKCQl2YXIgdHJlZSA9IGFycmF5LmM7CgkJdmFyIHRhaWwgPSBhcnJheS5kOwoJCWlmIChfVXRpbHNfZXEoZW5kLCBsZW4pKSB7CgkJCXJldHVybiBhcnJheTsKCQl9IGVsc2UgewoJCQlpZiAoX1V0aWxzX2NtcCgKCQkJCWVuZCwKCQkJCSRlbG0kY29yZSRBcnJheSR0YWlsSW5kZXgobGVuKSkgPiAtMSkgewoJCQkJcmV0dXJuIEE0KAoJCQkJCSRlbG0kY29yZSRBcnJheSRBcnJheV9lbG1fYnVpbHRpbiwKCQkJCQllbmQsCgkJCQkJc3RhcnRTaGlmdCwKCQkJCQl0cmVlLAoJCQkJCUEzKCRlbG0kY29yZSRFbG0kSnNBcnJheSRzbGljZSwgMCwgJGVsbSRjb3JlJEFycmF5JGJpdE1hc2sgJiBlbmQsIHRhaWwpKTsKCQkJfSBlbHNlIHsKCQkJCXZhciBlbmRJZHggPSAkZWxtJGNvcmUkQXJyYXkkdGFpbEluZGV4KGVuZCk7CgkJCQl2YXIgZGVwdGggPSAkZWxtJGNvcmUkQmFzaWNzJGZsb29yKAoJCQkJCUEyKAoJCQkJCQkkZWxtJGNvcmUkQmFzaWNzJGxvZ0Jhc2UsCgkJCQkJCSRlbG0kY29yZSRBcnJheSRicmFuY2hGYWN0b3IsCgkJCQkJCUEyKCRlbG0kY29yZSRCYXNpY3MkbWF4LCAxLCBlbmRJZHggLSAxKSkpOwoJCQkJdmFyIG5ld1NoaWZ0ID0gQTIoJGVsbSRjb3JlJEJhc2ljcyRtYXgsIDUsIGRlcHRoICogJGVsbSRjb3JlJEFycmF5JHNoaWZ0U3RlcCk7CgkJCQlyZXR1cm4gQTQoCgkJCQkJJGVsbSRjb3JlJEFycmF5JEFycmF5X2VsbV9idWlsdGluLAoJCQkJCWVuZCwKCQkJCQluZXdTaGlmdCwKCQkJCQlBMygKCQkJCQkJJGVsbSRjb3JlJEFycmF5JGhvaXN0VHJlZSwKCQkJCQkJc3RhcnRTaGlmdCwKCQkJCQkJbmV3U2hpZnQsCgkJCQkJCUEzKCRlbG0kY29yZSRBcnJheSRzbGljZVRyZWUsIHN0YXJ0U2hpZnQsIGVuZElkeCwgdHJlZSkpLAoJCQkJCUE0KCRlbG0kY29yZSRBcnJheSRmZXRjaE5ld1RhaWwsIHN0YXJ0U2hpZnQsIGVuZCwgZW5kSWR4LCB0cmVlKSk7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRBcnJheSR0cmFuc2xhdGVJbmRleCA9IEYyKAoJZnVuY3Rpb24gKGluZGV4LCBfdjApIHsKCQl2YXIgbGVuID0gX3YwLmE7CgkJdmFyIHBvc0luZGV4ID0gKGluZGV4IDwgMCkgPyAobGVuICsgaW5kZXgpIDogaW5kZXg7CgkJcmV0dXJuIChwb3NJbmRleCA8IDApID8gMCA6ICgoX1V0aWxzX2NtcChwb3NJbmRleCwgbGVuKSA+IDApID8gbGVuIDogcG9zSW5kZXgpOwoJfSk7CnZhciAkZWxtJGNvcmUkQXJyYXkkc2xpY2UgPSBGMygKCWZ1bmN0aW9uIChmcm9tLCB0bywgYXJyYXkpIHsKCQl2YXIgY29ycmVjdFRvID0gQTIoJGVsbSRjb3JlJEFycmF5JHRyYW5zbGF0ZUluZGV4LCB0bywgYXJyYXkpOwoJCXZhciBjb3JyZWN0RnJvbSA9IEEyKCRlbG0kY29yZSRBcnJheSR0cmFuc2xhdGVJbmRleCwgZnJvbSwgYXJyYXkpOwoJCXJldHVybiAoX1V0aWxzX2NtcChjb3JyZWN0RnJvbSwgY29ycmVjdFRvKSA+IDApID8gJGVsbSRjb3JlJEFycmF5JGVtcHR5IDogQTIoCgkJCSRlbG0kY29yZSRBcnJheSRzbGljZUxlZnQsCgkJCWNvcnJlY3RGcm9tLAoJCQlBMigkZWxtJGNvcmUkQXJyYXkkc2xpY2VSaWdodCwgY29ycmVjdFRvLCBhcnJheSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSR2aWV3UmVjZW50U25hcHNob3RzID0gRjMoCglmdW5jdGlvbiAoc2VsZWN0ZWRJbmRleCwgcmVjZW50TWVzc2FnZXNOdW0sIHNuYXBzaG90cykgewoJCXZhciBtZXNzYWdlc1RvRmlsbCA9ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JG1heFNuYXBzaG90U2l6ZSAtIHJlY2VudE1lc3NhZ2VzTnVtOwoJCXZhciBhcnJheUxlbmd0aCA9ICRlbG0kY29yZSRBcnJheSRsZW5ndGgoc25hcHNob3RzKTsKCQl2YXIgc25hcHNob3RzVG9SZW5kZXIgPSBmdW5jdGlvbiAoKSB7CgkJCXZhciBfdjAgPSBfVXRpbHNfVHVwbGUyKAoJCQkJQTIoJGVsbSRjb3JlJEFycmF5JGdldCwgYXJyYXlMZW5ndGggLSAyLCBzbmFwc2hvdHMpLAoJCQkJQTIoJGVsbSRjb3JlJEFycmF5JGdldCwgYXJyYXlMZW5ndGggLSAxLCBzbmFwc2hvdHMpKTsKCQkJaWYgKChfdjAuYS4kID09PSAnSnVzdCcpICYmIChfdjAuYi4kID09PSAnSnVzdCcpKSB7CgkJCQl2YXIgZmlsbGVyU25hcHNob3QgPSBfdjAuYS5hOwoJCQkJdmFyIHJlY2VudFNuYXBzaG90ID0gX3YwLmIuYTsKCQkJCXJldHVybiAkZWxtJGNvcmUkQXJyYXkkZnJvbUxpc3QoCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQl7CgkJCQkJCQltZXNzYWdlczogQTMoJGVsbSRjb3JlJEFycmF5JHNsaWNlLCAwLCBtZXNzYWdlc1RvRmlsbCwgZmlsbGVyU25hcHNob3QubWVzc2FnZXMpLAoJCQkJCQkJbW9kZWw6IGZpbGxlclNuYXBzaG90Lm1vZGVsCgkJCQkJCX0sCgkJCQkJCQlyZWNlbnRTbmFwc2hvdAoJCQkJCQldKSk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gc25hcHNob3RzOwoJCQl9CgkJfSgpOwoJCXZhciBzdGFydGluZ0luZGV4ID0gKChhcnJheUxlbmd0aCAqICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JG1heFNuYXBzaG90U2l6ZSkgLSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRtYXhTbmFwc2hvdFNpemUpIC0gbWVzc2FnZXNUb0ZpbGw7CgkJcmV0dXJuIEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHZpZXdBbGxTbmFwc2hvdHMsIHNlbGVjdGVkSW5kZXgsIHN0YXJ0aW5nSW5kZXgsIHNuYXBzaG90c1RvUmVuZGVyKTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkdmlldyA9IEYyKAoJZnVuY3Rpb24gKG1heWJlSW5kZXgsIF92MCkgewoJCXZhciBzbmFwc2hvdHMgPSBfdjAuc25hcHNob3RzOwoJCXZhciByZWNlbnQgPSBfdjAucmVjZW50OwoJCXZhciBudW1NZXNzYWdlcyA9IF92MC5udW1NZXNzYWdlczsKCQl2YXIgcmVjZW50TWVzc2FnZVN0YXJ0SW5kZXggPSBudW1NZXNzYWdlcyAtIHJlY2VudC5udW1NZXNzYWdlczsKCQl2YXIgaW5kZXggPSBBMigkZWxtJGNvcmUkTWF5YmUkd2l0aERlZmF1bHQsIC0xLCBtYXliZUluZGV4KTsKCQl2YXIgbmV3U3R1ZmYgPSBBMygKCQkJJGVsbSRodG1sJEh0bWwkS2V5ZWQkbm9kZSwKCQkJJ2RpdicsCgkJCV9MaXN0X05pbCwKCQkJQTMoCgkJCQkkZWxtJGNvcmUkTGlzdCRmb2xkciwKCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGNvbnNNc2coaW5kZXgpLAoJCQkJX1V0aWxzX1R1cGxlMihyZWNlbnRNZXNzYWdlU3RhcnRJbmRleCwgX0xpc3RfTmlsKSwKCQkJCXJlY2VudC5tZXNzYWdlcykuYik7CgkJdmFyIG9ubHlSZW5kZXJSZWNlbnRNZXNzYWdlcyA9ICghX1V0aWxzX2VxKGluZGV4LCAtMSkpIHx8ICgkZWxtJGNvcmUkQXJyYXkkbGVuZ3RoKHNuYXBzaG90cykgPCAyKTsKCQl2YXIgb2xkU3R1ZmYgPSBvbmx5UmVuZGVyUmVjZW50TWVzc2FnZXMgPyBBNCgkZWxtJGh0bWwkSHRtbCRMYXp5JGxhenkzLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSR2aWV3QWxsU25hcHNob3RzLCBpbmRleCwgMCwgc25hcHNob3RzKSA6IEE0KCRlbG0kaHRtbCRIdG1sJExhenkkbGF6eTMsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHZpZXdSZWNlbnRTbmFwc2hvdHMsIGluZGV4LCByZWNlbnQubnVtTWVzc2FnZXMsIHNuYXBzaG90cyk7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJGlkKCdlbG0tZGVidWdnZXItc2lkZWJhcicpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd3aWR0aCcsICcxMDAlJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ292ZXJmbG93LXknLCAnYXV0bycpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdoZWlnaHQnLCAnY2FsYygxMDAlIC0gNzJweCknKQoJCQkJXSksCgkJCUEyKAoJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHN0eWxlcywKCQkJCUEyKAoJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJbmV3U3R1ZmYsCgkJCQkJQTIoCgkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCW9sZFN0dWZmLAoJCQkJCQlvbmx5UmVuZGVyUmVjZW50TWVzc2FnZXMgPyBfTGlzdF9OaWwgOiBfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQlbCgkJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3Rvcnkkc2hvd01vcmVCdXR0b24obnVtTWVzc2FnZXMpCgkJCQkJCQldKSkpKSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFN3YXBMYXlvdXQgPSB7JDogJ1N3YXBMYXlvdXQnfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHRvSGlzdG9yeUljb24gPSBmdW5jdGlvbiAobGF5b3V0KSB7CglpZiAobGF5b3V0LiQgPT09ICdIb3Jpem9udGFsJykgewoJCXJldHVybiAnTTEzIDFhMyAzIDAgMCAxIDMgM3Y4YTMgMyAwIDAgMS0zIDNoLTEwYTMgMyAwIDAgMS0zLTN2LThhMyAzIDAgMCAxIDMtM3ogTTEzIDNoLTEwYTEgMSAwIDAgMC0xIDF2NWgxMnYtNWExIDEgMCAwIDAtMS0xeiBNMTQgMTBoLTEydjJhMSAxIDAgMCAwIDEgMWgxMGExIDEgMCAwIDAgMS0xeic7Cgl9IGVsc2UgewoJCXJldHVybiAnTTAgNGEzIDMgMCAwIDEgMy0zaDEwYTMgMyAwIDAgMSAzIDN2OGEzIDMgMCAwIDEtMyAzaC0xMGEzIDMgMCAwIDEtMy0zeiBNMiA0djhhMSAxIDAgMCAwIDEgMWgydi0xMGgtMmExIDEgMCAwIDAtMSAxeiBNNiAzdjEwaDdhMSAxIDAgMCAwIDEtMXYtOGExIDEgMCAwIDAtMS0xeic7Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRpY29uID0gZnVuY3Rpb24gKHBhdGgpIHsKCXJldHVybiBBNCgKCQkkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kbm9kZU5TLAoJCSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsCgkJJ3N2ZycsCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBMigkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kYXR0cmlidXRlLCAndmlld0JveCcsICcwIDAgMTYgMTYnKSwKCQkJCUEyKCRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRhdHRyaWJ1dGUsICd4bWxucycsICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycpLAoJCQkJQTIoJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJGF0dHJpYnV0ZSwgJ2ZpbGwnLCAnY3VycmVudENvbG9yJyksCgkJCQlBMigkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kYXR0cmlidXRlLCAnd2lkdGgnLCAnMTZweCcpLAoJCQkJQTIoJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJGF0dHJpYnV0ZSwgJ2hlaWdodCcsICcxNnB4JykKCQkJXSksCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBNCgKCQkJCSRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRub2RlTlMsCgkJCQknaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLAoJCQkJJ3BhdGgnLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJQTIoJGVsbSR2aXJ0dWFsX2RvbSRWaXJ0dWFsRG9tJGF0dHJpYnV0ZSwgJ2QnLCBwYXRoKQoJCQkJCV0pLAoJCQkJX0xpc3RfTmlsKQoJCQldKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR2aWV3SGlzdG9yeUJ1dHRvbiA9IEYzKAoJZnVuY3Rpb24gKGxhYmVsLCBtc2csIHBhdGgpIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGJ1dHRvbiwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdkaXNwbGF5JywgJ2ZsZXgnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnZmxleC1kaXJlY3Rpb24nLCAncm93JyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2FsaWduLWl0ZW1zJywgJ2NlbnRlcicpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdiYWNrZ3JvdW5kJywgJ25vbmUnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnYm9yZGVyJywgJ25vbmUnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnY29sb3InLCAnaW5oZXJpdCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdjdXJzb3InLCAncG9pbnRlcicpLAoJCQkJCSRlbG0kaHRtbCRIdG1sJEV2ZW50cyRvbkNsaWNrKG1zZykKCQkJCV0pLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kaWNvbihwYXRoKSwKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRzcGFuLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3BhZGRpbmctbGVmdCcsICc2cHgnKQoJCQkJCQldKSwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQobGFiZWwpCgkJCQkJCV0pKQoJCQkJXSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR2aWV3SGlzdG9yeU9wdGlvbnMgPSBmdW5jdGlvbiAobGF5b3V0KSB7CglyZXR1cm4gQTIoCgkJJGVsbSRodG1sJEh0bWwkZGl2LAoJCV9MaXN0X2Zyb21BcnJheSgKCQkJWwoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3dpZHRoJywgJzEwMCUnKSwKCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdoZWlnaHQnLCAnMzZweCcpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2Rpc3BsYXknLCAnZmxleCcpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2ZsZXgtZGlyZWN0aW9uJywgJ3JvdycpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2FsaWduLWl0ZW1zJywgJ2NlbnRlcicpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2p1c3RpZnktY29udGVudCcsICdzcGFjZS1iZXR3ZWVuJyksCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnYmFja2dyb3VuZC1jb2xvcicsICdyZ2IoNTAsIDUwLCA1MCknKQoJCQldKSwKCQlfTGlzdF9mcm9tQXJyYXkoCgkJCVsKCQkJCUEzKAoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdmlld0hpc3RvcnlCdXR0b24sCgkJCQknU3dhcCBMYXlvdXQnLAoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kU3dhcExheW91dCwKCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHRvSGlzdG9yeUljb24obGF5b3V0KSksCgkJCQlBMigKCQkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQlbCgkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdkaXNwbGF5JywgJ2ZsZXgnKSwKCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2ZsZXgtZGlyZWN0aW9uJywgJ3JvdycpLAoJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnYWxpZ24taXRlbXMnLCAnY2VudGVyJyksCgkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdqdXN0aWZ5LWNvbnRlbnQnLCAnc3BhY2UtYmV0d2VlbicpCgkJCQkJXSksCgkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQlBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR2aWV3SGlzdG9yeUJ1dHRvbiwgJ0ltcG9ydCcsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJEltcG9ydCwgJ001IDFhMSAxIDAgMCAxIDAgMmgtMmExIDEgMCAwIDAtMSAxdjhhMSAxIDAgMCAwIDEgMWgxMGExIDEgMCAwIDAgMS0xYTEgMSAwIDAgMSAyIDBhMyAzIDAgMCAxLTMgM2gtMTBhMyAzIDAgMCAxLTMtM3YtOGEzIDMgMCAwIDEgMy0zeiBNMTAgMmExIDEgMCAwIDAgLTIgMHY2YTEgMSAwIDAgMCAxIDFoNmExIDEgMCAwIDAgMC0yaC0zLjU4Nmw0LjI5My00LjI5M2ExIDEgMCAwIDAtMS40MTQtMS40MTRsLTQuMjkzIDQuMjkzeicpLAoJCQkJCQlBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR2aWV3SGlzdG9yeUJ1dHRvbiwgJ0V4cG9ydCcsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJEV4cG9ydCwgJ001IDFhMSAxIDAgMCAxIDAgMmgtMmExIDEgMCAwIDAtMSAxdjhhMSAxIDAgMCAwIDEgMWgxMGExIDEgMCAwIDAgMS0xIGExIDEgMCAwIDEgMiAwYTMgMyAwIDAgMS0zIDNoLTEwYTMgMyAwIDAgMS0zLTN2LThhMyAzIDAgMCAxIDMtM3ogTTkgM2ExIDEgMCAxIDEgMC0yaDZhMSAxIDAgMCAxIDEgMXY2YTEgMSAwIDEgMS0yIDB2LTMuNTg2bC01LjI5MyA1LjI5MyBhMSAxIDAgMCAxLTEuNDE0LTEuNDE0bDUuMjkzIC01LjI5M3onKQoJCQkJCV0pKQoJCQldKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRTbGlkZXJKdW1wID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ1NsaWRlckp1bXAnLCBhOiBhfTsKfTsKdmFyICRlbG0kY29yZSRCYXNpY3MkY29tcG9zZVIgPSBGMygKCWZ1bmN0aW9uIChmLCBnLCB4KSB7CgkJcmV0dXJuIGcoCgkJCWYoeCkpOwoJfSk7CnZhciAkZWxtJGh0bWwkSHRtbCRpbnB1dCA9IF9WaXJ0dWFsRG9tX25vZGUoJ2lucHV0Jyk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRpc1BsYXlpbmcgPSBmdW5jdGlvbiAobWF5YmVJbmRleCkgewoJaWYgKG1heWJlSW5kZXguJCA9PT0gJ05vdGhpbmcnKSB7CgkJcmV0dXJuIHRydWU7Cgl9IGVsc2UgewoJCXJldHVybiBmYWxzZTsKCX0KfTsKdmFyICRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkbWF4ID0gJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHJpbmdQcm9wZXJ0eSgnbWF4Jyk7CnZhciAkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJG1pbiA9ICRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3RyaW5nUHJvcGVydHkoJ21pbicpOwp2YXIgJGVsbSRodG1sJEh0bWwkRXZlbnRzJGFsd2F5c1N0b3AgPSBmdW5jdGlvbiAoeCkgewoJcmV0dXJuIF9VdGlsc19UdXBsZTIoeCwgdHJ1ZSk7Cn07CnZhciAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kTWF5U3RvcFByb3BhZ2F0aW9uID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ01heVN0b3BQcm9wYWdhdGlvbicsIGE6IGF9Owp9Owp2YXIgJGVsbSRodG1sJEh0bWwkRXZlbnRzJHN0b3BQcm9wYWdhdGlvbk9uID0gRjIoCglmdW5jdGlvbiAoZXZlbnQsIGRlY29kZXIpIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRvbiwKCQkJZXZlbnQsCgkJCSRlbG0kdmlydHVhbF9kb20kVmlydHVhbERvbSRNYXlTdG9wUHJvcGFnYXRpb24oZGVjb2RlcikpOwoJfSk7CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkc3RyaW5nID0gX0pzb25fZGVjb2RlU3RyaW5nOwp2YXIgJGVsbSRodG1sJEh0bWwkRXZlbnRzJHRhcmdldFZhbHVlID0gQTIoCgkkZWxtJGpzb24kSnNvbiREZWNvZGUkYXQsCglfTGlzdF9mcm9tQXJyYXkoCgkJWyd0YXJnZXQnLCAndmFsdWUnXSksCgkkZWxtJGpzb24kSnNvbiREZWNvZGUkc3RyaW5nKTsKdmFyICRlbG0kaHRtbCRIdG1sJEV2ZW50cyRvbklucHV0ID0gZnVuY3Rpb24gKHRhZ2dlcikgewoJcmV0dXJuIEEyKAoJCSRlbG0kaHRtbCRIdG1sJEV2ZW50cyRzdG9wUHJvcGFnYXRpb25PbiwKCQknaW5wdXQnLAoJCUEyKAoJCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkbWFwLAoJCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkYWx3YXlzU3RvcCwKCQkJQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJG1hcCwgdGFnZ2VyLCAkZWxtJGh0bWwkSHRtbCRFdmVudHMkdGFyZ2V0VmFsdWUpKSk7Cn07CnZhciAkZWxtJGNvcmUkU3RyaW5nJHRvSW50ID0gX1N0cmluZ190b0ludDsKdmFyICRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkdHlwZV8gPSAkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0cmluZ1Byb3BlcnR5KCd0eXBlJyk7CnZhciAkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHZhbHVlID0gJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHJpbmdQcm9wZXJ0eSgndmFsdWUnKTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHZpZXdQbGF5QnV0dG9uID0gZnVuY3Rpb24gKHBsYXlpbmcpIHsKCXJldHVybiBBMigKCQkkZWxtJGh0bWwkSHRtbCRidXR0b24sCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnYmFja2dyb3VuZCcsICcjMTI5M0Q4JyksCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnYm9yZGVyJywgJ25vbmUnKSwKCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdjb2xvcicsICd3aGl0ZScpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2N1cnNvcicsICdwb2ludGVyJyksCgkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnd2lkdGgnLCAnMzZweCcpLAoJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2hlaWdodCcsICczNnB4JyksCgkJCQkkZWxtJGh0bWwkSHRtbCRFdmVudHMkb25DbGljaygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRSZXN1bWUpCgkJCV0pLAoJCV9MaXN0X2Zyb21BcnJheSgKCQkJWwoJCQkJcGxheWluZyA/ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGljb24oJ00yIDJoNHYxMmgtNHYtMTJ6IE0xMCAyaDR2MTJoLTR2LTEyeicpIDogJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kaWNvbignTTIgMmwxMiA3bC0xMiA3eicpCgkJCV0pKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHZpZXdIaXN0b3J5U2xpZGVyID0gRjIoCglmdW5jdGlvbiAoaGlzdG9yeSwgbWF5YmVJbmRleCkgewoJCXZhciBsYXN0SW5kZXggPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRzaXplKGhpc3RvcnkpIC0gMTsKCQl2YXIgc2VsZWN0ZWRJbmRleCA9IEEyKCRlbG0kY29yZSRNYXliZSR3aXRoRGVmYXVsdCwgbGFzdEluZGV4LCBtYXliZUluZGV4KTsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGRpdiwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdkaXNwbGF5JywgJ2ZsZXgnKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnZmxleC1kaXJlY3Rpb24nLCAncm93JyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2FsaWduLWl0ZW1zJywgJ2NlbnRlcicpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd3aWR0aCcsICcxMDAlJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2hlaWdodCcsICczNnB4JyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2JhY2tncm91bmQtY29sb3InLCAncmdiKDUwLCA1MCwgNTApJykKCQkJCV0pLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkTGF6eSRsYXp5LAoJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHZpZXdQbGF5QnV0dG9uLAoJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGlzUGxheWluZyhtYXliZUluZGV4KSksCgkJCQkJQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkaW5wdXQsCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHR5cGVfKCdyYW5nZScpLAoJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3dpZHRoJywgJ2NhbGMoMTAwJSAtIDU2cHgpJyksCgkJCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnaGVpZ2h0JywgJzM2cHgnKSwKCQkJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdtYXJnaW4nLCAnMCAxMHB4JyksCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJG1pbignMCcpLAoJCQkJCQkJJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRtYXgoCgkJCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGZyb21JbnQobGFzdEluZGV4KSksCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHZhbHVlKAoJCQkJCQkJJGVsbSRjb3JlJFN0cmluZyRmcm9tSW50KHNlbGVjdGVkSW5kZXgpKSwKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJEV2ZW50cyRvbklucHV0KAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRjb3JlJEJhc2ljcyRjb21wb3NlUiwKCQkJCQkJCQkkZWxtJGNvcmUkU3RyaW5nJHRvSW50LAoJCQkJCQkJCUEyKAoJCQkJCQkJCQkkZWxtJGNvcmUkQmFzaWNzJGNvbXBvc2VSLAoJCQkJCQkJCQkkZWxtJGNvcmUkTWF5YmUkd2l0aERlZmF1bHQobGFzdEluZGV4KSwKCQkJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kU2xpZGVySnVtcCkpKQoJCQkJCQldKSwKCQkJCQlfTGlzdF9OaWwpCgkJCQldKSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHZpZXdIaXN0b3J5ID0gRjMoCglmdW5jdGlvbiAobWF5YmVJbmRleCwgaGlzdG9yeSwgbGF5b3V0KSB7CgkJdmFyIGJsb2NrID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9Nb3VzZUJsb2NrZXIobGF5b3V0KTsKCQl2YXIgX3YwID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9IaXN0b3J5UGVyY2VudHMobGF5b3V0KTsKCQl2YXIgdyA9IF92MC5hOwoJCXZhciBoID0gX3YwLmI7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnd2lkdGgnLCB3KSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnaGVpZ2h0JywgaCksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2Rpc3BsYXknLCAnZmxleCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdmbGV4LWRpcmVjdGlvbicsICdjb2x1bW4nKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAnY29sb3InLCAnI0RERERERCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdiYWNrZ3JvdW5kLWNvbG9yJywgJ3JnYig2MSwgNjEsIDYxKScpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdwb2ludGVyLWV2ZW50cycsIGJsb2NrKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLCAndXNlci1zZWxlY3QnLCBibG9jaykKCQkJCV0pLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdmlld0hpc3RvcnlTbGlkZXIsIGhpc3RvcnksIG1heWJlSW5kZXgpLAoJCQkJCUEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJG1hcCwKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRKdW1wLAoJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JHZpZXcsIG1heWJlSW5kZXgsIGhpc3RvcnkpKSwKCQkJCQlBMigkZWxtJGh0bWwkSHRtbCRMYXp5JGxhenksICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHZpZXdIaXN0b3J5T3B0aW9ucywgbGF5b3V0KQoJCQkJXSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRwb3BvdXRWaWV3ID0gZnVuY3Rpb24gKG1vZGVsKSB7Cgl2YXIgbWF5YmVJbmRleCA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgX3YwID0gbW9kZWwuc3RhdGU7CgkJaWYgKF92MC4kID09PSAnUnVubmluZycpIHsKCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJCX0gZWxzZSB7CgkJCXZhciBpbmRleCA9IF92MC5hOwoJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJEp1c3QoaW5kZXgpOwoJCX0KCX0oKTsKCXZhciBoaXN0b3J5VG9SZW5kZXIgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRjYWNoZWRIaXN0b3J5KG1vZGVsKTsKCXJldHVybiBBMygKCQkkZWxtJGh0bWwkSHRtbCRub2RlLAoJCSdib2R5JywKCQlfVXRpbHNfYXAoCgkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHRvRHJhZ0xpc3RlbmVycyhtb2RlbC5sYXlvdXQpLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ21hcmdpbicsICcwJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3BhZGRpbmcnLCAnMCcpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICd3aWR0aCcsICcxMDAlJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2hlaWdodCcsICcxMDAlJyksCgkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ2ZvbnQtZmFtaWx5JywgJ21vbm9zcGFjZScpLAoJCQkJCUEyKCRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3R5bGUsICdkaXNwbGF5JywgJ2ZsZXgnKSwKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJHN0eWxlLAoJCQkJCSdmbGV4LWRpcmVjdGlvbicsCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdG9GbGV4RGlyZWN0aW9uKG1vZGVsLmxheW91dCkpCgkJCQldKSksCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR2aWV3SGlzdG9yeSwgbWF5YmVJbmRleCwgaGlzdG9yeVRvUmVuZGVyLCBtb2RlbC5sYXlvdXQpLAoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdmlld0RyYWdab25lKG1vZGVsLmxheW91dCksCgkJCQlBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR2aWV3RXhwYW5kbywgbW9kZWwuZXhwYW5kb01zZywgbW9kZWwuZXhwYW5kb01vZGVsLCBtb2RlbC5sYXlvdXQpCgkJCV0pKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JEJsb2NrQWxsID0geyQ6ICdCbG9ja0FsbCd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdG9CbG9ja2VyVHlwZSA9IEYyKAoJZnVuY3Rpb24gKGlzUGF1c2VkLCBzdGF0ZSkgewoJCXN3aXRjaCAoc3RhdGUuJCkgewoJCQljYXNlICdOb25lJzoKCQkJCXJldHVybiBpc1BhdXNlZCA/ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JEJsb2NrQWxsIDogJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQmxvY2tOb25lOwoJCQljYXNlICdCYWRNZXRhZGF0YSc6CgkJCQlyZXR1cm4gJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQmxvY2tNb3N0OwoJCQljYXNlICdCYWRJbXBvcnQnOgoJCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JEJsb2NrTW9zdDsKCQkJZGVmYXVsdDoKCQkJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRCbG9ja01vc3Q7CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR0b0Jsb2NrZXJUeXBlID0gZnVuY3Rpb24gKG1vZGVsKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkdG9CbG9ja2VyVHlwZSwKCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRpc1BhdXNlZChtb2RlbC5zdGF0ZSksCgkJbW9kZWwub3ZlcmxheSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRIb3Jpem9udGFsID0gRjMoCglmdW5jdGlvbiAoYSwgYiwgYykgewoJCXJldHVybiB7JDogJ0hvcml6b250YWwnLCBhOiBhLCBiOiBiLCBjOiBjfTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kUnVubmluZyA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdSdW5uaW5nJywgYTogYX07Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRTdGF0aWMgPSB7JDogJ1N0YXRpYyd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJEVycm9yID0gRjIoCglmdW5jdGlvbiAobWVzc2FnZSwgcHJvYmxlbXMpIHsKCQlyZXR1cm4ge21lc3NhZ2U6IG1lc3NhZ2UsIHByb2JsZW1zOiBwcm9ibGVtc307Cgl9KTsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRkZWNvZGVWYWx1ZSA9IF9Kc29uX3J1bjsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRNZXRhZGF0YSA9IEYyKAoJZnVuY3Rpb24gKHZlcnNpb25zLCB0eXBlcykgewoJCXJldHVybiB7dHlwZXM6IHR5cGVzLCB2ZXJzaW9uczogdmVyc2lvbnN9OwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkVHlwZXMgPSBGMygKCWZ1bmN0aW9uIChtZXNzYWdlLCBhbGlhc2VzLCB1bmlvbnMpIHsKCQlyZXR1cm4ge2FsaWFzZXM6IGFsaWFzZXMsIG1lc3NhZ2U6IG1lc3NhZ2UsIHVuaW9uczogdW5pb25zfTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJEFsaWFzID0gRjIoCglmdW5jdGlvbiAoYXJncywgdGlwZSkgewoJCXJldHVybiB7YXJnczogYXJncywgdGlwZTogdGlwZX07Cgl9KTsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRsaXN0ID0gX0pzb25fZGVjb2RlTGlzdDsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRkZWNvZGVBbGlhcyA9IEEzKAoJJGVsbSRqc29uJEpzb24kRGVjb2RlJG1hcDIsCgkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkQWxpYXMsCglBMigKCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkZmllbGQsCgkJJ2FyZ3MnLAoJCSRlbG0kanNvbiRKc29uJERlY29kZSRsaXN0KCRlbG0kanNvbiRKc29uJERlY29kZSRzdHJpbmcpKSwKCUEyKCRlbG0kanNvbiRKc29uJERlY29kZSRmaWVsZCwgJ3R5cGUnLCAkZWxtJGpzb24kSnNvbiREZWNvZGUkc3RyaW5nKSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkVW5pb24gPSBGMigKCWZ1bmN0aW9uIChhcmdzLCB0YWdzKSB7CgkJcmV0dXJuIHthcmdzOiBhcmdzLCB0YWdzOiB0YWdzfTsKCX0pOwp2YXIgJGVsbSRjb3JlJERpY3QkZnJvbUxpc3QgPSBmdW5jdGlvbiAoYXNzb2NzKSB7CglyZXR1cm4gQTMoCgkJJGVsbSRjb3JlJExpc3QkZm9sZGwsCgkJRjIoCgkJCWZ1bmN0aW9uIChfdjAsIGRpY3QpIHsKCQkJCXZhciBrZXkgPSBfdjAuYTsKCQkJCXZhciB2YWx1ZSA9IF92MC5iOwoJCQkJcmV0dXJuIEEzKCRlbG0kY29yZSREaWN0JGluc2VydCwga2V5LCB2YWx1ZSwgZGljdCk7CgkJCX0pLAoJCSRlbG0kY29yZSREaWN0JGVtcHR5LAoJCWFzc29jcyk7Cn07CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUka2V5VmFsdWVQYWlycyA9IF9Kc29uX2RlY29kZUtleVZhbHVlUGFpcnM7CnZhciAkZWxtJGpzb24kSnNvbiREZWNvZGUkZGljdCA9IGZ1bmN0aW9uIChkZWNvZGVyKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRqc29uJEpzb24kRGVjb2RlJG1hcCwKCQkkZWxtJGNvcmUkRGljdCRmcm9tTGlzdCwKCQkkZWxtJGpzb24kSnNvbiREZWNvZGUka2V5VmFsdWVQYWlycyhkZWNvZGVyKSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZGVjb2RlVW5pb24gPSBBMygKCSRlbG0kanNvbiRKc29uJERlY29kZSRtYXAyLAoJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFVuaW9uLAoJQTIoCgkJJGVsbSRqc29uJEpzb24kRGVjb2RlJGZpZWxkLAoJCSdhcmdzJywKCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkbGlzdCgkZWxtJGpzb24kSnNvbiREZWNvZGUkc3RyaW5nKSksCglBMigKCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkZmllbGQsCgkJJ3RhZ3MnLAoJCSRlbG0kanNvbiRKc29uJERlY29kZSRkaWN0KAoJCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkbGlzdCgkZWxtJGpzb24kSnNvbiREZWNvZGUkc3RyaW5nKSkpKTsKdmFyICRlbG0kanNvbiRKc29uJERlY29kZSRtYXAzID0gX0pzb25fbWFwMzsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRkZWNvZGVUeXBlcyA9IEE0KAoJJGVsbSRqc29uJEpzb24kRGVjb2RlJG1hcDMsCgkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkVHlwZXMsCglBMigkZWxtJGpzb24kSnNvbiREZWNvZGUkZmllbGQsICdtZXNzYWdlJywgJGVsbSRqc29uJEpzb24kRGVjb2RlJHN0cmluZyksCglBMigKCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkZmllbGQsCgkJJ2FsaWFzZXMnLAoJCSRlbG0kanNvbiRKc29uJERlY29kZSRkaWN0KCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRkZWNvZGVBbGlhcykpLAoJQTIoCgkJJGVsbSRqc29uJEpzb24kRGVjb2RlJGZpZWxkLAoJCSd1bmlvbnMnLAoJCSRlbG0kanNvbiRKc29uJERlY29kZSRkaWN0KCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRkZWNvZGVVbmlvbikpKTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRWZXJzaW9ucyA9IGZ1bmN0aW9uIChlbG0pIHsKCXJldHVybiB7ZWxtOiBlbG19Owp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGRlY29kZVZlcnNpb25zID0gQTIoCgkkZWxtJGpzb24kSnNvbiREZWNvZGUkbWFwLAoJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFZlcnNpb25zLAoJQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJGZpZWxkLCAnZWxtJywgJGVsbSRqc29uJEpzb24kRGVjb2RlJHN0cmluZykpOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGRlY29kZXIgPSBBMygKCSRlbG0kanNvbiRKc29uJERlY29kZSRtYXAyLAoJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJE1ldGFkYXRhLAoJQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJGZpZWxkLCAndmVyc2lvbnMnLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZGVjb2RlVmVyc2lvbnMpLAoJQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJGZpZWxkLCAndHlwZXMnLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZGVjb2RlVHlwZXMpKTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRQcm9ibGVtVHlwZSA9IEYyKAoJZnVuY3Rpb24gKG5hbWUsIHByb2JsZW1zKSB7CgkJcmV0dXJuIHtuYW1lOiBuYW1lLCBwcm9ibGVtczogcHJvYmxlbXN9OwoJfSk7CnZhciAkZWxtJGNvcmUkTGlzdCRtYXliZUNvbnMgPSBGMygKCWZ1bmN0aW9uIChmLCBteCwgeHMpIHsKCQl2YXIgX3YwID0gZihteCk7CgkJaWYgKF92MC4kID09PSAnSnVzdCcpIHsKCQkJdmFyIHggPSBfdjAuYTsKCQkJcmV0dXJuIEEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIHgsIHhzKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4geHM7CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkTGlzdCRmaWx0ZXJNYXAgPSBGMigKCWZ1bmN0aW9uIChmLCB4cykgewoJCXJldHVybiBBMygKCQkJJGVsbSRjb3JlJExpc3QkZm9sZHIsCgkJCSRlbG0kY29yZSRMaXN0JG1heWJlQ29ucyhmKSwKCQkJX0xpc3RfTmlsLAoJCQl4cyk7Cgl9KTsKdmFyICRlbG0kY29yZSRTdHJpbmckY29udGFpbnMgPSBfU3RyaW5nX2NvbnRhaW5zOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGhhc1Byb2JsZW0gPSBGMigKCWZ1bmN0aW9uICh0aXBlLCBfdjApIHsKCQl2YXIgcHJvYmxlbSA9IF92MC5hOwoJCXZhciB0b2tlbiA9IF92MC5iOwoJCXJldHVybiBBMigkZWxtJGNvcmUkU3RyaW5nJGNvbnRhaW5zLCB0b2tlbiwgdGlwZSkgPyAkZWxtJGNvcmUkTWF5YmUkSnVzdChwcm9ibGVtKSA6ICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkRGVjb2RlciA9IHskOiAnRGVjb2Rlcid9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJEZ1bmN0aW9uID0geyQ6ICdGdW5jdGlvbid9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFByb2Nlc3MgPSB7JDogJ1Byb2Nlc3MnfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRQcm9ncmFtID0geyQ6ICdQcm9ncmFtJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkUmVxdWVzdCA9IHskOiAnUmVxdWVzdCd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFNvY2tldCA9IHskOiAnU29ja2V0J307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkVGFzayA9IHskOiAnVGFzayd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFZpcnR1YWxEb20gPSB7JDogJ1ZpcnR1YWxEb20nfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRwcm9ibGVtVGFibGUgPSBfTGlzdF9mcm9tQXJyYXkoCglbCgkJX1V0aWxzX1R1cGxlMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkRnVuY3Rpb24sICctPicpLAoJCV9VdGlsc19UdXBsZTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJERlY29kZXIsICdKc29uLkRlY29kZS5EZWNvZGVyJyksCgkJX1V0aWxzX1R1cGxlMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkVGFzaywgJ1Rhc2suVGFzaycpLAoJCV9VdGlsc19UdXBsZTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFByb2Nlc3MsICdQcm9jZXNzLklkJyksCgkJX1V0aWxzX1R1cGxlMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkU29ja2V0LCAnV2ViU29ja2V0Lkxvd0xldmVsLldlYlNvY2tldCcpLAoJCV9VdGlsc19UdXBsZTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFJlcXVlc3QsICdIdHRwLlJlcXVlc3QnKSwKCQlfVXRpbHNfVHVwbGUyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRQcm9ncmFtLCAnUGxhdGZvcm0uUHJvZ3JhbScpLAoJCV9VdGlsc19UdXBsZTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFZpcnR1YWxEb20sICdWaXJ0dWFsRG9tLk5vZGUnKSwKCQlfVXRpbHNfVHVwbGUyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRWaXJ0dWFsRG9tLCAnVmlydHVhbERvbS5BdHRyaWJ1dGUnKQoJXSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZmluZFByb2JsZW1zID0gZnVuY3Rpb24gKHRpcGUpIHsKCXJldHVybiBBMigKCQkkZWxtJGNvcmUkTGlzdCRmaWx0ZXJNYXAsCgkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGhhc1Byb2JsZW0odGlwZSksCgkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJHByb2JsZW1UYWJsZSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkY29sbGVjdEJhZEFsaWFzZXMgPSBGMygKCWZ1bmN0aW9uIChuYW1lLCBfdjAsIGxpc3QpIHsKCQl2YXIgdGlwZSA9IF92MC50aXBlOwoJCXZhciBfdjEgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZmluZFByb2JsZW1zKHRpcGUpOwoJCWlmICghX3YxLmIpIHsKCQkJcmV0dXJuIGxpc3Q7CgkJfSBlbHNlIHsKCQkJdmFyIHByb2JsZW1zID0gX3YxOwoJCQlyZXR1cm4gQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJFByb2JsZW1UeXBlLCBuYW1lLCBwcm9ibGVtcyksCgkJCQlsaXN0KTsKCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRMaXN0JGFwcGVuZCA9IEYyKAoJZnVuY3Rpb24gKHhzLCB5cykgewoJCWlmICgheXMuYikgewoJCQlyZXR1cm4geHM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIEEzKCRlbG0kY29yZSRMaXN0JGZvbGRyLCAkZWxtJGNvcmUkTGlzdCRjb25zLCB5cywgeHMpOwoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJExpc3QkY29uY2F0ID0gZnVuY3Rpb24gKGxpc3RzKSB7CglyZXR1cm4gQTMoJGVsbSRjb3JlJExpc3QkZm9sZHIsICRlbG0kY29yZSRMaXN0JGFwcGVuZCwgX0xpc3RfTmlsLCBsaXN0cyk7Cn07CnZhciAkZWxtJGNvcmUkTGlzdCRjb25jYXRNYXAgPSBGMigKCWZ1bmN0aW9uIChmLCBsaXN0KSB7CgkJcmV0dXJuICRlbG0kY29yZSRMaXN0JGNvbmNhdCgKCQkJQTIoJGVsbSRjb3JlJExpc3QkbWFwLCBmLCBsaXN0KSk7Cgl9KTsKdmFyICRlbG0kY29yZSREaWN0JHZhbHVlcyA9IGZ1bmN0aW9uIChkaWN0KSB7CglyZXR1cm4gQTMoCgkJJGVsbSRjb3JlJERpY3QkZm9sZHIsCgkJRjMoCgkJCWZ1bmN0aW9uIChrZXksIHZhbHVlLCB2YWx1ZUxpc3QpIHsKCQkJCXJldHVybiBBMigkZWxtJGNvcmUkTGlzdCRjb25zLCB2YWx1ZSwgdmFsdWVMaXN0KTsKCQkJfSksCgkJX0xpc3RfTmlsLAoJCWRpY3QpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGNvbGxlY3RCYWRVbmlvbnMgPSBGMygKCWZ1bmN0aW9uIChuYW1lLCBfdjAsIGxpc3QpIHsKCQl2YXIgdGFncyA9IF92MC50YWdzOwoJCXZhciBfdjEgPSBBMigKCQkJJGVsbSRjb3JlJExpc3QkY29uY2F0TWFwLAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZmluZFByb2JsZW1zLAoJCQkkZWxtJGNvcmUkTGlzdCRjb25jYXQoCgkJCQkkZWxtJGNvcmUkRGljdCR2YWx1ZXModGFncykpKTsKCQlpZiAoIV92MS5iKSB7CgkJCXJldHVybiBsaXN0OwoJCX0gZWxzZSB7CgkJCXZhciBwcm9ibGVtcyA9IF92MTsKCQkJcmV0dXJuIEEyKAoJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRQcm9ibGVtVHlwZSwgbmFtZSwgcHJvYmxlbXMpLAoJCQkJbGlzdCk7CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkRGljdCRmb2xkbCA9IEYzKAoJZnVuY3Rpb24gKGZ1bmMsIGFjYywgZGljdCkgewoJCWZvbGRsOgoJCXdoaWxlICh0cnVlKSB7CgkJCWlmIChkaWN0LiQgPT09ICdSQkVtcHR5X2VsbV9idWlsdGluJykgewoJCQkJcmV0dXJuIGFjYzsKCQkJfSBlbHNlIHsKCQkJCXZhciBrZXkgPSBkaWN0LmI7CgkJCQl2YXIgdmFsdWUgPSBkaWN0LmM7CgkJCQl2YXIgbGVmdCA9IGRpY3QuZDsKCQkJCXZhciByaWdodCA9IGRpY3QuZTsKCQkJCXZhciAkdGVtcCRmdW5jID0gZnVuYywKCQkJCQkkdGVtcCRhY2MgPSBBMygKCQkJCQlmdW5jLAoJCQkJCWtleSwKCQkJCQl2YWx1ZSwKCQkJCQlBMygkZWxtJGNvcmUkRGljdCRmb2xkbCwgZnVuYywgYWNjLCBsZWZ0KSksCgkJCQkJJHRlbXAkZGljdCA9IHJpZ2h0OwoJCQkJZnVuYyA9ICR0ZW1wJGZ1bmM7CgkJCQlhY2MgPSAkdGVtcCRhY2M7CgkJCQlkaWN0ID0gJHRlbXAkZGljdDsKCQkJCWNvbnRpbnVlIGZvbGRsOwoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkaXNQb3J0YWJsZSA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciB0eXBlcyA9IF92MC50eXBlczsKCXZhciBiYWRBbGlhc2VzID0gQTMoJGVsbSRjb3JlJERpY3QkZm9sZGwsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRjb2xsZWN0QmFkQWxpYXNlcywgX0xpc3RfTmlsLCB0eXBlcy5hbGlhc2VzKTsKCXZhciBfdjEgPSBBMygkZWxtJGNvcmUkRGljdCRmb2xkbCwgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGNvbGxlY3RCYWRVbmlvbnMsIGJhZEFsaWFzZXMsIHR5cGVzLnVuaW9ucyk7CglpZiAoIV92MS5iKSB7CgkJcmV0dXJuICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJfSBlbHNlIHsKCQl2YXIgcHJvYmxlbXMgPSBfdjE7CgkJcmV0dXJuICRlbG0kY29yZSRNYXliZSRKdXN0KAoJCQlBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkRXJyb3IsIHR5cGVzLm1lc3NhZ2UsIHByb2JsZW1zKSk7Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZGVjb2RlID0gZnVuY3Rpb24gKHZhbHVlKSB7Cgl2YXIgX3YwID0gQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJGRlY29kZVZhbHVlLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZGVjb2RlciwgdmFsdWUpOwoJaWYgKF92MC4kID09PSAnRXJyJykgewoJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycigKCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJEVycm9yLCAnVGhlIGNvbXBpbGVyIGlzIGdlbmVyYXRpbmcgYmFkIG1ldGFkYXRhLiBUaGlzIGlzIGEgY29tcGlsZXIgYnVnIScsIF9MaXN0X05pbCkpOwoJfSBlbHNlIHsKCQl2YXIgbWV0YWRhdGEgPSBfdjAuYTsKCQl2YXIgX3YxID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGlzUG9ydGFibGUobWV0YWRhdGEpOwoJCWlmIChfdjEuJCA9PT0gJ05vdGhpbmcnKSB7CgkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JE9rKG1ldGFkYXRhKTsKCQl9IGVsc2UgewoJCQl2YXIgZXJyb3IgPSBfdjEuYTsKCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKGVycm9yKTsKCQl9Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRIaXN0b3J5ID0gRjMoCglmdW5jdGlvbiAoc25hcHNob3RzLCByZWNlbnQsIG51bU1lc3NhZ2VzKSB7CgkJcmV0dXJuIHtudW1NZXNzYWdlczogbnVtTWVzc2FnZXMsIHJlY2VudDogcmVjZW50LCBzbmFwc2hvdHM6IHNuYXBzaG90c307Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JFJlY2VudEhpc3RvcnkgPSBGMygKCWZ1bmN0aW9uIChtb2RlbCwgbWVzc2FnZXMsIG51bU1lc3NhZ2VzKSB7CgkJcmV0dXJuIHttZXNzYWdlczogbWVzc2FnZXMsIG1vZGVsOiBtb2RlbCwgbnVtTWVzc2FnZXM6IG51bU1lc3NhZ2VzfTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZW1wdHkgPSBmdW5jdGlvbiAobW9kZWwpIHsKCXJldHVybiBBMygKCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRIaXN0b3J5LAoJCSRlbG0kY29yZSRBcnJheSRlbXB0eSwKCQlBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRSZWNlbnRIaXN0b3J5LCBtb2RlbCwgX0xpc3RfTmlsLCAwKSwKCQkwKTsKfTsKdmFyICRlbG0kY29yZSREaWN0JG1hcCA9IEYyKAoJZnVuY3Rpb24gKGZ1bmMsIGRpY3QpIHsKCQlpZiAoZGljdC4kID09PSAnUkJFbXB0eV9lbG1fYnVpbHRpbicpIHsKCQkJcmV0dXJuICRlbG0kY29yZSREaWN0JFJCRW1wdHlfZWxtX2J1aWx0aW47CgkJfSBlbHNlIHsKCQkJdmFyIGNvbG9yID0gZGljdC5hOwoJCQl2YXIga2V5ID0gZGljdC5iOwoJCQl2YXIgdmFsdWUgPSBkaWN0LmM7CgkJCXZhciBsZWZ0ID0gZGljdC5kOwoJCQl2YXIgcmlnaHQgPSBkaWN0LmU7CgkJCXJldHVybiBBNSgKCQkJCSRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwKCQkJCWNvbG9yLAoJCQkJa2V5LAoJCQkJQTIoZnVuYywga2V5LCB2YWx1ZSksCgkJCQlBMigkZWxtJGNvcmUkRGljdCRtYXAsIGZ1bmMsIGxlZnQpLAoJCQkJQTIoJGVsbSRjb3JlJERpY3QkbWFwLCBmdW5jLCByaWdodCkpOwoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJERpY3Qkc2l6ZUhlbHAgPSBGMigKCWZ1bmN0aW9uIChuLCBkaWN0KSB7CgkJc2l6ZUhlbHA6CgkJd2hpbGUgKHRydWUpIHsKCQkJaWYgKGRpY3QuJCA9PT0gJ1JCRW1wdHlfZWxtX2J1aWx0aW4nKSB7CgkJCQlyZXR1cm4gbjsKCQkJfSBlbHNlIHsKCQkJCXZhciBsZWZ0ID0gZGljdC5kOwoJCQkJdmFyIHJpZ2h0ID0gZGljdC5lOwoJCQkJdmFyICR0ZW1wJG4gPSBBMigkZWxtJGNvcmUkRGljdCRzaXplSGVscCwgbiArIDEsIHJpZ2h0KSwKCQkJCQkkdGVtcCRkaWN0ID0gbGVmdDsKCQkJCW4gPSAkdGVtcCRuOwoJCQkJZGljdCA9ICR0ZW1wJGRpY3Q7CgkJCQljb250aW51ZSBzaXplSGVscDsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJERpY3Qkc2l6ZSA9IGZ1bmN0aW9uIChkaWN0KSB7CglyZXR1cm4gQTIoJGVsbSRjb3JlJERpY3Qkc2l6ZUhlbHAsIDAsIGRpY3QpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kaW5pdEhlbHAgPSBGMigKCWZ1bmN0aW9uIChpc091dGVyLCBleHBhbmRvKSB7CgkJc3dpdGNoIChleHBhbmRvLiQpIHsKCQkJY2FzZSAnUyc6CgkJCQlyZXR1cm4gZXhwYW5kbzsKCQkJY2FzZSAnUHJpbWl0aXZlJzoKCQkJCXJldHVybiBleHBhbmRvOwoJCQljYXNlICdTZXF1ZW5jZSc6CgkJCQl2YXIgc2VxVHlwZSA9IGV4cGFuZG8uYTsKCQkJCXZhciBpc0Nsb3NlZCA9IGV4cGFuZG8uYjsKCQkJCXZhciBpdGVtcyA9IGV4cGFuZG8uYzsKCQkJCXJldHVybiBpc091dGVyID8gQTMoCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kU2VxdWVuY2UsCgkJCQkJc2VxVHlwZSwKCQkJCQlmYWxzZSwKCQkJCQlBMigKCQkJCQkJJGVsbSRjb3JlJExpc3QkbWFwLAoJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRpbml0SGVscChmYWxzZSksCgkJCQkJCWl0ZW1zKSkgOiAoKCRlbG0kY29yZSRMaXN0JGxlbmd0aChpdGVtcykgPD0gOCkgPyBBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRTZXF1ZW5jZSwgc2VxVHlwZSwgZmFsc2UsIGl0ZW1zKSA6IGV4cGFuZG8pOwoJCQljYXNlICdEaWN0aW9uYXJ5JzoKCQkJCXZhciBpc0Nsb3NlZCA9IGV4cGFuZG8uYTsKCQkJCXZhciBrZXlWYWx1ZVBhaXJzID0gZXhwYW5kby5iOwoJCQkJcmV0dXJuIGlzT3V0ZXIgPyBBMigKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyREaWN0aW9uYXJ5LAoJCQkJCWZhbHNlLAoJCQkJCUEyKAoJCQkJCQkkZWxtJGNvcmUkTGlzdCRtYXAsCgkJCQkJCWZ1bmN0aW9uIChfdjEpIHsKCQkJCQkJCXZhciBrID0gX3YxLmE7CgkJCQkJCQl2YXIgdiA9IF92MS5iOwoJCQkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCQkJaywKCQkJCQkJCQlBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRpbml0SGVscCwgZmFsc2UsIHYpKTsKCQkJCQkJfSwKCQkJCQkJa2V5VmFsdWVQYWlycykpIDogKCgkZWxtJGNvcmUkTGlzdCRsZW5ndGgoa2V5VmFsdWVQYWlycykgPD0gOCkgPyBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyREaWN0aW9uYXJ5LCBmYWxzZSwga2V5VmFsdWVQYWlycykgOiBleHBhbmRvKTsKCQkJY2FzZSAnUmVjb3JkJzoKCQkJCXZhciBpc0Nsb3NlZCA9IGV4cGFuZG8uYTsKCQkJCXZhciBlbnRyaWVzID0gZXhwYW5kby5iOwoJCQkJcmV0dXJuIGlzT3V0ZXIgPyBBMigKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRSZWNvcmQsCgkJCQkJZmFsc2UsCgkJCQkJQTIoCgkJCQkJCSRlbG0kY29yZSREaWN0JG1hcCwKCQkJCQkJRjIoCgkJCQkJCQlmdW5jdGlvbiAoX3YyLCB2KSB7CgkJCQkJCQkJcmV0dXJuIEEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGluaXRIZWxwLCBmYWxzZSwgdik7CgkJCQkJCQl9KSwKCQkJCQkJZW50cmllcykpIDogKCgkZWxtJGNvcmUkRGljdCRzaXplKGVudHJpZXMpIDw9IDQpID8gQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kUmVjb3JkLCBmYWxzZSwgZW50cmllcykgOiBleHBhbmRvKTsKCQkJZGVmYXVsdDoKCQkJCXZhciBtYXliZU5hbWUgPSBleHBhbmRvLmE7CgkJCQl2YXIgaXNDbG9zZWQgPSBleHBhbmRvLmI7CgkJCQl2YXIgYXJncyA9IGV4cGFuZG8uYzsKCQkJCXJldHVybiBpc091dGVyID8gQTMoCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kQ29uc3RydWN0b3IsCgkJCQkJbWF5YmVOYW1lLAoJCQkJCWZhbHNlLAoJCQkJCUEyKAoJCQkJCQkkZWxtJGNvcmUkTGlzdCRtYXAsCgkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGluaXRIZWxwKGZhbHNlKSwKCQkJCQkJYXJncykpIDogKCgkZWxtJGNvcmUkTGlzdCRsZW5ndGgoYXJncykgPD0gNCkgPyBBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRDb25zdHJ1Y3RvciwgbWF5YmVOYW1lLCBmYWxzZSwgYXJncykgOiBleHBhbmRvKTsKCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGluaXQgPSBmdW5jdGlvbiAodmFsdWUpIHsKCXJldHVybiBBMigKCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRpbml0SGVscCwKCQl0cnVlLAoJCV9EZWJ1Z2dlcl9pbml0KHZhbHVlKSk7Cn07CnZhciAkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG1hcCA9IF9QbGF0Zm9ybV9tYXA7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSROb25lID0geyQ6ICdOb25lJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRub25lID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkTm9uZTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHdyYXBJbml0ID0gRjQoCglmdW5jdGlvbiAobWV0YWRhdGEsIHBvcG91dCwgaW5pdCwgZmxhZ3MpIHsKCQl2YXIgX3YwID0gaW5pdChmbGFncyk7CgkJdmFyIHVzZXJNb2RlbCA9IF92MC5hOwoJCXZhciB1c2VyQ29tbWFuZHMgPSBfdjAuYjsKCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJewoJCQkJZXhwYW5kb01vZGVsOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRpbml0KHVzZXJNb2RlbCksCgkJCQlleHBhbmRvTXNnOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRpbml0KF9VdGlsc19UdXBsZTApLAoJCQkJaGlzdG9yeTogJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZW1wdHkodXNlck1vZGVsKSwKCQkJCWxheW91dDogQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kSG9yaXpvbnRhbCwgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kU3RhdGljLCAwLjMsIDAuNSksCgkJCQltZXRhZGF0YTogJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGRlY29kZShtZXRhZGF0YSksCgkJCQlvdmVybGF5OiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRub25lLAoJCQkJcG9wb3V0OiBwb3BvdXQsCgkJCQlzdGF0ZTogJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kUnVubmluZyh1c2VyTW9kZWwpCgkJCX0sCgkJCUEyKCRlbG0kY29yZSRQbGF0Zm9ybSRDbWQkbWFwLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRVc2VyTXNnLCB1c2VyQ29tbWFuZHMpKTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kZ2V0TGF0ZXN0TW9kZWwgPSBmdW5jdGlvbiAoc3RhdGUpIHsKCWlmIChzdGF0ZS4kID09PSAnUnVubmluZycpIHsKCQl2YXIgbW9kZWwgPSBzdGF0ZS5hOwoJCXJldHVybiBtb2RlbDsKCX0gZWxzZSB7CgkJdmFyIG1vZGVsID0gc3RhdGUuYzsKCQlyZXR1cm4gbW9kZWw7Cgl9Cn07CnZhciAkZWxtJGNvcmUkUGxhdGZvcm0kU3ViJG1hcCA9IF9QbGF0Zm9ybV9tYXA7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR3cmFwU3VicyA9IEYyKAoJZnVuY3Rpb24gKHN1YnNjcmlwdGlvbnMsIG1vZGVsKSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGNvcmUkUGxhdGZvcm0kU3ViJG1hcCwKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVXNlck1zZywKCQkJc3Vic2NyaXB0aW9ucygKCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGdldExhdGVzdE1vZGVsKG1vZGVsLnN0YXRlKSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRNb3ZpbmcgPSB7JDogJ01vdmluZyd9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kUGF1c2VkID0gRjUoCglmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewoJCXJldHVybiB7JDogJ1BhdXNlZCcsIGE6IGEsIGI6IGIsIGM6IGMsIGQ6IGQsIGU6IGV9OwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRTbmFwc2hvdCA9IEYyKAoJZnVuY3Rpb24gKG1vZGVsLCBtZXNzYWdlcykgewoJCXJldHVybiB7bWVzc2FnZXM6IG1lc3NhZ2VzLCBtb2RlbDogbW9kZWx9OwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRhZGRSZWNlbnQgPSBGMygKCWZ1bmN0aW9uIChtc2csIG5ld01vZGVsLCBfdjApIHsKCQl2YXIgbW9kZWwgPSBfdjAubW9kZWw7CgkJdmFyIG1lc3NhZ2VzID0gX3YwLm1lc3NhZ2VzOwoJCXZhciBudW1NZXNzYWdlcyA9IF92MC5udW1NZXNzYWdlczsKCQlyZXR1cm4gX1V0aWxzX2VxKG51bU1lc3NhZ2VzLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRtYXhTbmFwc2hvdFNpemUpID8gX1V0aWxzX1R1cGxlMigKCQkJJGVsbSRjb3JlJE1heWJlJEp1c3QoCgkJCQlBMigKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRTbmFwc2hvdCwKCQkJCQltb2RlbCwKCQkJCQkkZWxtJGNvcmUkQXJyYXkkZnJvbUxpc3QobWVzc2FnZXMpKSksCgkJCUEzKAoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkUmVjZW50SGlzdG9yeSwKCQkJCW5ld01vZGVsLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVttc2ddKSwKCQkJCTEpKSA6IF9VdGlsc19UdXBsZTIoCgkJCSRlbG0kY29yZSRNYXliZSROb3RoaW5nLAoJCQlBMygKCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JFJlY2VudEhpc3RvcnksCgkJCQltb2RlbCwKCQkJCUEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIG1zZywgbWVzc2FnZXMpLAoJCQkJbnVtTWVzc2FnZXMgKyAxKSk7Cgl9KTsKdmFyICRlbG0kY29yZSRFbG0kSnNBcnJheSRwdXNoID0gX0pzQXJyYXlfcHVzaDsKdmFyICRlbG0kY29yZSRFbG0kSnNBcnJheSRzaW5nbGV0b24gPSBfSnNBcnJheV9zaW5nbGV0b247CnZhciAkZWxtJGNvcmUkQXJyYXkkaW5zZXJ0VGFpbEluVHJlZSA9IEY0KAoJZnVuY3Rpb24gKHNoaWZ0LCBpbmRleCwgdGFpbCwgdHJlZSkgewoJCXZhciBwb3MgPSAkZWxtJGNvcmUkQXJyYXkkYml0TWFzayAmIChpbmRleCA+Pj4gc2hpZnQpOwoJCWlmIChfVXRpbHNfY21wKAoJCQlwb3MsCgkJCSRlbG0kY29yZSRFbG0kSnNBcnJheSRsZW5ndGgodHJlZSkpID4gLTEpIHsKCQkJaWYgKHNoaWZ0ID09PSA1KSB7CgkJCQlyZXR1cm4gQTIoCgkJCQkJJGVsbSRjb3JlJEVsbSRKc0FycmF5JHB1c2gsCgkJCQkJJGVsbSRjb3JlJEFycmF5JExlYWYodGFpbCksCgkJCQkJdHJlZSk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgbmV3U3ViID0gJGVsbSRjb3JlJEFycmF5JFN1YlRyZWUoCgkJCQkJQTQoJGVsbSRjb3JlJEFycmF5JGluc2VydFRhaWxJblRyZWUsIHNoaWZ0IC0gJGVsbSRjb3JlJEFycmF5JHNoaWZ0U3RlcCwgaW5kZXgsIHRhaWwsICRlbG0kY29yZSRFbG0kSnNBcnJheSRlbXB0eSkpOwoJCQkJcmV0dXJuIEEyKCRlbG0kY29yZSRFbG0kSnNBcnJheSRwdXNoLCBuZXdTdWIsIHRyZWUpOwoJCQl9CgkJfSBlbHNlIHsKCQkJdmFyIHZhbHVlID0gQTIoJGVsbSRjb3JlJEVsbSRKc0FycmF5JHVuc2FmZUdldCwgcG9zLCB0cmVlKTsKCQkJaWYgKHZhbHVlLiQgPT09ICdTdWJUcmVlJykgewoJCQkJdmFyIHN1YlRyZWUgPSB2YWx1ZS5hOwoJCQkJdmFyIG5ld1N1YiA9ICRlbG0kY29yZSRBcnJheSRTdWJUcmVlKAoJCQkJCUE0KCRlbG0kY29yZSRBcnJheSRpbnNlcnRUYWlsSW5UcmVlLCBzaGlmdCAtICRlbG0kY29yZSRBcnJheSRzaGlmdFN0ZXAsIGluZGV4LCB0YWlsLCBzdWJUcmVlKSk7CgkJCQlyZXR1cm4gQTMoJGVsbSRjb3JlJEVsbSRKc0FycmF5JHVuc2FmZVNldCwgcG9zLCBuZXdTdWIsIHRyZWUpOwoJCQl9IGVsc2UgewoJCQkJdmFyIG5ld1N1YiA9ICRlbG0kY29yZSRBcnJheSRTdWJUcmVlKAoJCQkJCUE0KAoJCQkJCQkkZWxtJGNvcmUkQXJyYXkkaW5zZXJ0VGFpbEluVHJlZSwKCQkJCQkJc2hpZnQgLSAkZWxtJGNvcmUkQXJyYXkkc2hpZnRTdGVwLAoJCQkJCQlpbmRleCwKCQkJCQkJdGFpbCwKCQkJCQkJJGVsbSRjb3JlJEVsbSRKc0FycmF5JHNpbmdsZXRvbih2YWx1ZSkpKTsKCQkJCXJldHVybiBBMygkZWxtJGNvcmUkRWxtJEpzQXJyYXkkdW5zYWZlU2V0LCBwb3MsIG5ld1N1YiwgdHJlZSk7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRBcnJheSR1bnNhZmVSZXBsYWNlVGFpbCA9IEYyKAoJZnVuY3Rpb24gKG5ld1RhaWwsIF92MCkgewoJCXZhciBsZW4gPSBfdjAuYTsKCQl2YXIgc3RhcnRTaGlmdCA9IF92MC5iOwoJCXZhciB0cmVlID0gX3YwLmM7CgkJdmFyIHRhaWwgPSBfdjAuZDsKCQl2YXIgb3JpZ2luYWxUYWlsTGVuID0gJGVsbSRjb3JlJEVsbSRKc0FycmF5JGxlbmd0aCh0YWlsKTsKCQl2YXIgbmV3VGFpbExlbiA9ICRlbG0kY29yZSRFbG0kSnNBcnJheSRsZW5ndGgobmV3VGFpbCk7CgkJdmFyIG5ld0FycmF5TGVuID0gbGVuICsgKG5ld1RhaWxMZW4gLSBvcmlnaW5hbFRhaWxMZW4pOwoJCWlmIChfVXRpbHNfZXEobmV3VGFpbExlbiwgJGVsbSRjb3JlJEFycmF5JGJyYW5jaEZhY3RvcikpIHsKCQkJdmFyIG92ZXJmbG93ID0gX1V0aWxzX2NtcChuZXdBcnJheUxlbiA+Pj4gJGVsbSRjb3JlJEFycmF5JHNoaWZ0U3RlcCwgMSA8PCBzdGFydFNoaWZ0KSA+IDA7CgkJCWlmIChvdmVyZmxvdykgewoJCQkJdmFyIG5ld1NoaWZ0ID0gc3RhcnRTaGlmdCArICRlbG0kY29yZSRBcnJheSRzaGlmdFN0ZXA7CgkJCQl2YXIgbmV3VHJlZSA9IEE0KAoJCQkJCSRlbG0kY29yZSRBcnJheSRpbnNlcnRUYWlsSW5UcmVlLAoJCQkJCW5ld1NoaWZ0LAoJCQkJCWxlbiwKCQkJCQluZXdUYWlsLAoJCQkJCSRlbG0kY29yZSRFbG0kSnNBcnJheSRzaW5nbGV0b24oCgkJCQkJCSRlbG0kY29yZSRBcnJheSRTdWJUcmVlKHRyZWUpKSk7CgkJCQlyZXR1cm4gQTQoJGVsbSRjb3JlJEFycmF5JEFycmF5X2VsbV9idWlsdGluLCBuZXdBcnJheUxlbiwgbmV3U2hpZnQsIG5ld1RyZWUsICRlbG0kY29yZSRFbG0kSnNBcnJheSRlbXB0eSk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gQTQoCgkJCQkJJGVsbSRjb3JlJEFycmF5JEFycmF5X2VsbV9idWlsdGluLAoJCQkJCW5ld0FycmF5TGVuLAoJCQkJCXN0YXJ0U2hpZnQsCgkJCQkJQTQoJGVsbSRjb3JlJEFycmF5JGluc2VydFRhaWxJblRyZWUsIHN0YXJ0U2hpZnQsIGxlbiwgbmV3VGFpbCwgdHJlZSksCgkJCQkJJGVsbSRjb3JlJEVsbSRKc0FycmF5JGVtcHR5KTsKCQkJfQoJCX0gZWxzZSB7CgkJCXJldHVybiBBNCgkZWxtJGNvcmUkQXJyYXkkQXJyYXlfZWxtX2J1aWx0aW4sIG5ld0FycmF5TGVuLCBzdGFydFNoaWZ0LCB0cmVlLCBuZXdUYWlsKTsKCQl9Cgl9KTsKdmFyICRlbG0kY29yZSRBcnJheSRwdXNoID0gRjIoCglmdW5jdGlvbiAoYSwgYXJyYXkpIHsKCQl2YXIgdGFpbCA9IGFycmF5LmQ7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGNvcmUkQXJyYXkkdW5zYWZlUmVwbGFjZVRhaWwsCgkJCUEyKCRlbG0kY29yZSRFbG0kSnNBcnJheSRwdXNoLCBhLCB0YWlsKSwKCQkJYXJyYXkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRhZGQgPSBGMygKCWZ1bmN0aW9uIChtc2csIG1vZGVsLCBfdjApIHsKCQl2YXIgc25hcHNob3RzID0gX3YwLnNuYXBzaG90czsKCQl2YXIgcmVjZW50ID0gX3YwLnJlY2VudDsKCQl2YXIgbnVtTWVzc2FnZXMgPSBfdjAubnVtTWVzc2FnZXM7CgkJdmFyIF92MSA9IEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGFkZFJlY2VudCwgbXNnLCBtb2RlbCwgcmVjZW50KTsKCQlpZiAoX3YxLmEuJCA9PT0gJ0p1c3QnKSB7CgkJCXZhciBzbmFwc2hvdCA9IF92MS5hLmE7CgkJCXZhciBuZXdSZWNlbnQgPSBfdjEuYjsKCQkJcmV0dXJuIEEzKAoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkSGlzdG9yeSwKCQkJCUEyKCRlbG0kY29yZSRBcnJheSRwdXNoLCBzbmFwc2hvdCwgc25hcHNob3RzKSwKCQkJCW5ld1JlY2VudCwKCQkJCW51bU1lc3NhZ2VzICsgMSk7CgkJfSBlbHNlIHsKCQkJdmFyIF92MiA9IF92MS5hOwoJCQl2YXIgbmV3UmVjZW50ID0gX3YxLmI7CgkJCXJldHVybiBBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRIaXN0b3J5LCBzbmFwc2hvdHMsIG5ld1JlY2VudCwgbnVtTWVzc2FnZXMgKyAxKTsKCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JEJhZEltcG9ydCA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdCYWRJbXBvcnQnLCBhOiBhfTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JFJpc2t5SW1wb3J0ID0gRjIoCglmdW5jdGlvbiAoYSwgYikgewoJCXJldHVybiB7JDogJ1Jpc2t5SW1wb3J0JywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkVmVyc2lvbkNoYW5nZWQgPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnVmVyc2lvbkNoYW5nZWQnLCBhOiBhLCBiOiBifTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRNZXNzYWdlQ2hhbmdlZCA9IEYyKAoJZnVuY3Rpb24gKGEsIGIpIHsKCQlyZXR1cm4geyQ6ICdNZXNzYWdlQ2hhbmdlZCcsIGE6IGEsIGI6IGJ9OwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JFNvbWV0aGluZ0NoYW5nZWQgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnU29tZXRoaW5nQ2hhbmdlZCcsIGE6IGF9Owp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRBbGlhc0NoYW5nZSA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdBbGlhc0NoYW5nZScsIGE6IGF9Owp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGNoZWNrQWxpYXMgPSBGNCgKCWZ1bmN0aW9uIChuYW1lLCBvbGQsIF9uZXcsIGNoYW5nZXMpIHsKCQlyZXR1cm4gKF9VdGlsc19lcShvbGQudGlwZSwgX25ldy50aXBlKSAmJiBfVXRpbHNfZXEob2xkLmFyZ3MsIF9uZXcuYXJncykpID8gY2hhbmdlcyA6IEEyKAoJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JEFsaWFzQ2hhbmdlKG5hbWUpLAoJCQljaGFuZ2VzKTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRVbmlvbkNoYW5nZSA9IEYyKAoJZnVuY3Rpb24gKGEsIGIpIHsKCQlyZXR1cm4geyQ6ICdVbmlvbkNoYW5nZScsIGE6IGEsIGI6IGJ9OwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkYWRkVGFnID0gRjMoCglmdW5jdGlvbiAodGFnLCBfdjAsIGNoYW5nZXMpIHsKCQlyZXR1cm4gX1V0aWxzX3VwZGF0ZSgKCQkJY2hhbmdlcywKCQkJewoJCQkJYWRkZWQ6IEEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIHRhZywgY2hhbmdlcy5hZGRlZCkKCQkJfSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRjaGVja1RhZyA9IEY0KAoJZnVuY3Rpb24gKHRhZywgb2xkLCBfbmV3LCBjaGFuZ2VzKSB7CgkJcmV0dXJuIF9VdGlsc19lcShvbGQsIF9uZXcpID8gY2hhbmdlcyA6IF9VdGlsc191cGRhdGUoCgkJCWNoYW5nZXMsCgkJCXsKCQkJCWNoYW5nZWQ6IEEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIHRhZywgY2hhbmdlcy5jaGFuZ2VkKQoJCQl9KTsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRUYWdDaGFuZ2VzID0gRjQoCglmdW5jdGlvbiAocmVtb3ZlZCwgY2hhbmdlZCwgYWRkZWQsIGFyZ3NNYXRjaCkgewoJCXJldHVybiB7YWRkZWQ6IGFkZGVkLCBhcmdzTWF0Y2g6IGFyZ3NNYXRjaCwgY2hhbmdlZDogY2hhbmdlZCwgcmVtb3ZlZDogcmVtb3ZlZH07Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkZW1wdHlUYWdDaGFuZ2VzID0gZnVuY3Rpb24gKGFyZ3NNYXRjaCkgewoJcmV0dXJuIEE0KCRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkVGFnQ2hhbmdlcywgX0xpc3RfTmlsLCBfTGlzdF9OaWwsIF9MaXN0X05pbCwgYXJnc01hdGNoKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkaGFzVGFnQ2hhbmdlcyA9IGZ1bmN0aW9uICh0YWdDaGFuZ2VzKSB7CglyZXR1cm4gX1V0aWxzX2VxKAoJCXRhZ0NoYW5nZXMsCgkJQTQoJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRUYWdDaGFuZ2VzLCBfTGlzdF9OaWwsIF9MaXN0X05pbCwgX0xpc3RfTmlsLCB0cnVlKSk7Cn07CnZhciAkZWxtJGNvcmUkRGljdCRtZXJnZSA9IEY2KAoJZnVuY3Rpb24gKGxlZnRTdGVwLCBib3RoU3RlcCwgcmlnaHRTdGVwLCBsZWZ0RGljdCwgcmlnaHREaWN0LCBpbml0aWFsUmVzdWx0KSB7CgkJdmFyIHN0ZXBTdGF0ZSA9IEYzKAoJCQlmdW5jdGlvbiAocktleSwgclZhbHVlLCBfdjApIHsKCQkJCXN0ZXBTdGF0ZToKCQkJCXdoaWxlICh0cnVlKSB7CgkJCQkJdmFyIGxpc3QgPSBfdjAuYTsKCQkJCQl2YXIgcmVzdWx0ID0gX3YwLmI7CgkJCQkJaWYgKCFsaXN0LmIpIHsKCQkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCQlsaXN0LAoJCQkJCQkJQTMocmlnaHRTdGVwLCByS2V5LCByVmFsdWUsIHJlc3VsdCkpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXZhciBfdjIgPSBsaXN0LmE7CgkJCQkJCXZhciBsS2V5ID0gX3YyLmE7CgkJCQkJCXZhciBsVmFsdWUgPSBfdjIuYjsKCQkJCQkJdmFyIHJlc3QgPSBsaXN0LmI7CgkJCQkJCWlmIChfVXRpbHNfY21wKGxLZXksIHJLZXkpIDwgMCkgewoJCQkJCQkJdmFyICR0ZW1wJHJLZXkgPSByS2V5LAoJCQkJCQkJCSR0ZW1wJHJWYWx1ZSA9IHJWYWx1ZSwKCQkJCQkJCQkkdGVtcCRfdjAgPSBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCXJlc3QsCgkJCQkJCQkJQTMobGVmdFN0ZXAsIGxLZXksIGxWYWx1ZSwgcmVzdWx0KSk7CgkJCQkJCQlyS2V5ID0gJHRlbXAkcktleTsKCQkJCQkJCXJWYWx1ZSA9ICR0ZW1wJHJWYWx1ZTsKCQkJCQkJCV92MCA9ICR0ZW1wJF92MDsKCQkJCQkJCWNvbnRpbnVlIHN0ZXBTdGF0ZTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCWlmIChfVXRpbHNfY21wKGxLZXksIHJLZXkpID4gMCkgewoJCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCQlsaXN0LAoJCQkJCQkJCQlBMyhyaWdodFN0ZXAsIHJLZXksIHJWYWx1ZSwgcmVzdWx0KSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCQlyZXN0LAoJCQkJCQkJCQlBNChib3RoU3RlcCwgbEtleSwgbFZhbHVlLCByVmFsdWUsIHJlc3VsdCkpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9KTsKCQl2YXIgX3YzID0gQTMoCgkJCSRlbG0kY29yZSREaWN0JGZvbGRsLAoJCQlzdGVwU3RhdGUsCgkJCV9VdGlsc19UdXBsZTIoCgkJCQkkZWxtJGNvcmUkRGljdCR0b0xpc3QobGVmdERpY3QpLAoJCQkJaW5pdGlhbFJlc3VsdCksCgkJCXJpZ2h0RGljdCk7CgkJdmFyIGxlZnRvdmVycyA9IF92My5hOwoJCXZhciBpbnRlcm1lZGlhdGVSZXN1bHQgPSBfdjMuYjsKCQlyZXR1cm4gQTMoCgkJCSRlbG0kY29yZSRMaXN0JGZvbGRsLAoJCQlGMigKCQkJCWZ1bmN0aW9uIChfdjQsIHJlc3VsdCkgewoJCQkJCXZhciBrID0gX3Y0LmE7CgkJCQkJdmFyIHYgPSBfdjQuYjsKCQkJCQlyZXR1cm4gQTMobGVmdFN0ZXAsIGssIHYsIHJlc3VsdCk7CgkJCQl9KSwKCQkJaW50ZXJtZWRpYXRlUmVzdWx0LAoJCQlsZWZ0b3ZlcnMpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkcmVtb3ZlVGFnID0gRjMoCglmdW5jdGlvbiAodGFnLCBfdjAsIGNoYW5nZXMpIHsKCQlyZXR1cm4gX1V0aWxzX3VwZGF0ZSgKCQkJY2hhbmdlcywKCQkJewoJCQkJcmVtb3ZlZDogQTIoJGVsbSRjb3JlJExpc3QkY29ucywgdGFnLCBjaGFuZ2VzLnJlbW92ZWQpCgkJCX0pOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkY2hlY2tVbmlvbiA9IEY0KAoJZnVuY3Rpb24gKG5hbWUsIG9sZCwgX25ldywgY2hhbmdlcykgewoJCXZhciB0YWdDaGFuZ2VzID0gQTYoCgkJCSRlbG0kY29yZSREaWN0JG1lcmdlLAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkcmVtb3ZlVGFnLAoJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkY2hlY2tUYWcsCgkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRhZGRUYWcsCgkJCW9sZC50YWdzLAoJCQlfbmV3LnRhZ3MsCgkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkZW1wdHlUYWdDaGFuZ2VzKAoJCQkJX1V0aWxzX2VxKG9sZC5hcmdzLCBfbmV3LmFyZ3MpKSk7CgkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkaGFzVGFnQ2hhbmdlcyh0YWdDaGFuZ2VzKSA/IGNoYW5nZXMgOiBBMigKCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRVbmlvbkNoYW5nZSwgbmFtZSwgdGFnQ2hhbmdlcyksCgkJCWNoYW5nZXMpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkaWdub3JlID0gRjMoCglmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgcmVwb3J0KSB7CgkJcmV0dXJuIHJlcG9ydDsKCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGNoZWNrVHlwZXMgPSBGMigKCWZ1bmN0aW9uIChvbGQsIF9uZXcpIHsKCQlyZXR1cm4gKCFfVXRpbHNfZXEob2xkLm1lc3NhZ2UsIF9uZXcubWVzc2FnZSkpID8gQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRNZXNzYWdlQ2hhbmdlZCwgb2xkLm1lc3NhZ2UsIF9uZXcubWVzc2FnZSkgOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JFNvbWV0aGluZ0NoYW5nZWQoCgkJCUE2KAoJCQkJJGVsbSRjb3JlJERpY3QkbWVyZ2UsCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkaWdub3JlLAoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGNoZWNrVW5pb24sCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkaWdub3JlLAoJCQkJb2xkLnVuaW9ucywKCQkJCV9uZXcudW5pb25zLAoJCQkJQTYoJGVsbSRjb3JlJERpY3QkbWVyZ2UsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRpZ25vcmUsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRjaGVja0FsaWFzLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkaWdub3JlLCBvbGQuYWxpYXNlcywgX25ldy5hbGlhc2VzLCBfTGlzdF9OaWwpKSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRjaGVjayA9IEYyKAoJZnVuY3Rpb24gKG9sZCwgX25ldykgewoJCXJldHVybiAoIV9VdGlsc19lcShvbGQudmVyc2lvbnMuZWxtLCBfbmV3LnZlcnNpb25zLmVsbSkpID8gQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRWZXJzaW9uQ2hhbmdlZCwgb2xkLnZlcnNpb25zLmVsbSwgX25ldy52ZXJzaW9ucy5lbG0pIDogQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGNoZWNrVHlwZXMsIG9sZC50eXBlcywgX25ldy50eXBlcyk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkQ29ycnVwdEhpc3RvcnkgPSB7JDogJ0NvcnJ1cHRIaXN0b3J5J307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRjb3JydXB0SW1wb3J0ID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQmFkSW1wb3J0KCRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkQ29ycnVwdEhpc3RvcnkpOwp2YXIgJGVsbSRqc29uJEpzb24kRGVjb2RlJGRlY29kZVN0cmluZyA9IF9Kc29uX3J1bk9uU3RyaW5nOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRGaW5lID0geyQ6ICdGaW5lJ307CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JEltcG9zc2libGUgPSB7JDogJ0ltcG9zc2libGUnfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkUmlza3kgPSB7JDogJ1Jpc2t5J307CnZhciAkZWxtJGNvcmUkQmFzaWNzJG5vdCA9IF9CYXNpY3Nfbm90Owp2YXIgJGVsbSRjb3JlJExpc3QkaXNFbXB0eSA9IGZ1bmN0aW9uICh4cykgewoJaWYgKCF4cy5iKSB7CgkJcmV0dXJuIHRydWU7Cgl9IGVsc2UgewoJCXJldHVybiBmYWxzZTsKCX0KfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkc29tZSA9IGZ1bmN0aW9uIChsaXN0KSB7CglyZXR1cm4gISRlbG0kY29yZSRMaXN0JGlzRW1wdHkobGlzdCk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JGV2YWx1YXRlQ2hhbmdlID0gZnVuY3Rpb24gKGNoYW5nZSkgewoJaWYgKGNoYW5nZS4kID09PSAnQWxpYXNDaGFuZ2UnKSB7CgkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkSW1wb3NzaWJsZTsKCX0gZWxzZSB7CgkJdmFyIHJlbW92ZWQgPSBjaGFuZ2UuYi5yZW1vdmVkOwoJCXZhciBjaGFuZ2VkID0gY2hhbmdlLmIuY2hhbmdlZDsKCQl2YXIgYWRkZWQgPSBjaGFuZ2UuYi5hZGRlZDsKCQl2YXIgYXJnc01hdGNoID0gY2hhbmdlLmIuYXJnc01hdGNoOwoJCXJldHVybiAoKCFhcmdzTWF0Y2gpIHx8ICgkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JHNvbWUoY2hhbmdlZCkgfHwgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRzb21lKHJlbW92ZWQpKSkgPyAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JEltcG9zc2libGUgOiAoJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRzb21lKGFkZGVkKSA/ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkUmlza3kgOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JEZpbmUpOwoJfQp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCR3b3JzdENhc2UgPSBGMigKCWZ1bmN0aW9uIChzdGF0dXMsIHN0YXR1c0xpc3QpIHsKCQl3b3JzdENhc2U6CgkJd2hpbGUgKHRydWUpIHsKCQkJaWYgKCFzdGF0dXNMaXN0LmIpIHsKCQkJCXJldHVybiBzdGF0dXM7CgkJCX0gZWxzZSB7CgkJCQlzd2l0Y2ggKHN0YXR1c0xpc3QuYS4kKSB7CgkJCQkJY2FzZSAnSW1wb3NzaWJsZSc6CgkJCQkJCXZhciBfdjEgPSBzdGF0dXNMaXN0LmE7CgkJCQkJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JEltcG9zc2libGU7CgkJCQkJY2FzZSAnUmlza3knOgoJCQkJCQl2YXIgX3YyID0gc3RhdHVzTGlzdC5hOwoJCQkJCQl2YXIgcmVzdCA9IHN0YXR1c0xpc3QuYjsKCQkJCQkJdmFyICR0ZW1wJHN0YXR1cyA9ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkUmlza3ksCgkJCQkJCQkkdGVtcCRzdGF0dXNMaXN0ID0gcmVzdDsKCQkJCQkJc3RhdHVzID0gJHRlbXAkc3RhdHVzOwoJCQkJCQlzdGF0dXNMaXN0ID0gJHRlbXAkc3RhdHVzTGlzdDsKCQkJCQkJY29udGludWUgd29yc3RDYXNlOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCXZhciBfdjMgPSBzdGF0dXNMaXN0LmE7CgkJCQkJCXZhciByZXN0ID0gc3RhdHVzTGlzdC5iOwoJCQkJCQl2YXIgJHRlbXAkc3RhdHVzID0gc3RhdHVzLAoJCQkJCQkJJHRlbXAkc3RhdHVzTGlzdCA9IHJlc3Q7CgkJCQkJCXN0YXR1cyA9ICR0ZW1wJHN0YXR1czsKCQkJCQkJc3RhdHVzTGlzdCA9ICR0ZW1wJHN0YXR1c0xpc3Q7CgkJCQkJCWNvbnRpbnVlIHdvcnN0Q2FzZTsKCQkJCX0KCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRldmFsdWF0ZSA9IGZ1bmN0aW9uIChyZXBvcnQpIHsKCXN3aXRjaCAocmVwb3J0LiQpIHsKCQljYXNlICdDb3JydXB0SGlzdG9yeSc6CgkJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JEltcG9zc2libGU7CgkJY2FzZSAnVmVyc2lvbkNoYW5nZWQnOgoJCQlyZXR1cm4gJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRJbXBvc3NpYmxlOwoJCWNhc2UgJ01lc3NhZ2VDaGFuZ2VkJzoKCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkSW1wb3NzaWJsZTsKCQlkZWZhdWx0OgoJCQl2YXIgY2hhbmdlcyA9IHJlcG9ydC5hOwoJCQlyZXR1cm4gQTIoCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JHdvcnN0Q2FzZSwKCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRSZXBvcnQkRmluZSwKCQkJCUEyKCRlbG0kY29yZSRMaXN0JG1hcCwgJGVsbSRicm93c2VyJERlYnVnZ2VyJFJlcG9ydCRldmFsdWF0ZUNoYW5nZSwgY2hhbmdlcykpOwoJfQp9Owp2YXIgJGVsbSRqc29uJEpzb24kRGVjb2RlJHZhbHVlID0gX0pzb25fZGVjb2RlVmFsdWU7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR1cGxvYWREZWNvZGVyID0gQTMoCgkkZWxtJGpzb24kSnNvbiREZWNvZGUkbWFwMiwKCUYyKAoJCWZ1bmN0aW9uICh4LCB5KSB7CgkJCXJldHVybiBfVXRpbHNfVHVwbGUyKHgsIHkpOwoJCX0pLAoJQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJGZpZWxkLCAnbWV0YWRhdGEnLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZGVjb2RlciksCglBMigkZWxtJGpzb24kSnNvbiREZWNvZGUkZmllbGQsICdoaXN0b3J5JywgJGVsbSRqc29uJEpzb24kRGVjb2RlJHZhbHVlKSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRhc3Nlc3NJbXBvcnQgPSBGMigKCWZ1bmN0aW9uIChtZXRhZGF0YSwganNvblN0cmluZykgewoJCXZhciBfdjAgPSBBMigkZWxtJGpzb24kSnNvbiREZWNvZGUkZGVjb2RlU3RyaW5nLCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSR1cGxvYWREZWNvZGVyLCBqc29uU3RyaW5nKTsKCQlpZiAoX3YwLiQgPT09ICdFcnInKSB7CgkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycigkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRjb3JydXB0SW1wb3J0KTsKCQl9IGVsc2UgewoJCQl2YXIgX3YxID0gX3YwLmE7CgkJCXZhciBmb3JlaWduTWV0YWRhdGEgPSBfdjEuYTsKCQkJdmFyIHJhd0hpc3RvcnkgPSBfdjEuYjsKCQkJdmFyIHJlcG9ydCA9IEEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRjaGVjaywgZm9yZWlnbk1ldGFkYXRhLCBtZXRhZGF0YSk7CgkJCXZhciBfdjIgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkUmVwb3J0JGV2YWx1YXRlKHJlcG9ydCk7CgkJCXN3aXRjaCAoX3YyLiQpIHsKCQkJCWNhc2UgJ0ltcG9zc2libGUnOgoJCQkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycigKCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkQmFkSW1wb3J0KHJlcG9ydCkpOwoJCQkJY2FzZSAnUmlza3knOgoJCQkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycigKCQkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkUmlza3lJbXBvcnQsIHJlcG9ydCwgcmF3SGlzdG9yeSkpOwoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPayhyYXdIaXN0b3J5KTsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJFBsYXRmb3JtJENtZCRiYXRjaCA9IF9QbGF0Zm9ybV9iYXRjaDsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRPdmVybGF5JGNsb3NlID0gRjIoCglmdW5jdGlvbiAobXNnLCBzdGF0ZSkgewoJCXN3aXRjaCAoc3RhdGUuJCkgewoJCQljYXNlICdOb25lJzoKCQkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZzsKCQkJY2FzZSAnQmFkTWV0YWRhdGEnOgoJCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJCQljYXNlICdCYWRJbXBvcnQnOgoJCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJCQlkZWZhdWx0OgoJCQkJdmFyIHJhd0hpc3RvcnkgPSBzdGF0ZS5iOwoJCQkJaWYgKG1zZy4kID09PSAnQ2FuY2VsJykgewoJCQkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZzsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSRKdXN0KHJhd0hpc3RvcnkpOwoJCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZWxtVG9KcyA9IEEyKCRlbG0kY29yZSRCYXNpY3MkY29tcG9zZVIsIF9Kc29uX3dyYXAsIF9EZWJ1Z2dlcl91bnNhZmVDb2VyY2UpOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZW5jb2RlSGVscCA9IEYyKAoJZnVuY3Rpb24gKHNuYXBzaG90LCBhbGxNZXNzYWdlcykgewoJCXJldHVybiBBMygkZWxtJGNvcmUkQXJyYXkkZm9sZGwsICRlbG0kY29yZSRMaXN0JGNvbnMsIGFsbE1lc3NhZ2VzLCBzbmFwc2hvdC5tZXNzYWdlcyk7Cgl9KTsKdmFyICRlbG0kanNvbiRKc29uJEVuY29kZSRsaXN0ID0gRjIoCglmdW5jdGlvbiAoZnVuYywgZW50cmllcykgewoJCXJldHVybiBfSnNvbl93cmFwKAoJCQlBMygKCQkJCSRlbG0kY29yZSRMaXN0JGZvbGRsLAoJCQkJX0pzb25fYWRkRW50cnkoZnVuYyksCgkJCQlfSnNvbl9lbXB0eUFycmF5KF9VdGlsc19UdXBsZTApLAoJCQkJZW50cmllcykpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRlbmNvZGUgPSBmdW5jdGlvbiAoX3YwKSB7Cgl2YXIgc25hcHNob3RzID0gX3YwLnNuYXBzaG90czsKCXZhciByZWNlbnQgPSBfdjAucmVjZW50OwoJcmV0dXJuIEEyKAoJCSRlbG0kanNvbiRKc29uJEVuY29kZSRsaXN0LAoJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGVsbVRvSnMsCgkJQTMoCgkJCSRlbG0kY29yZSRBcnJheSRmb2xkciwKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZW5jb2RlSGVscCwKCQkJJGVsbSRjb3JlJExpc3QkcmV2ZXJzZShyZWNlbnQubWVzc2FnZXMpLAoJCQlzbmFwc2hvdHMpKTsKfTsKdmFyICRlbG0kanNvbiRKc29uJEVuY29kZSRvYmplY3QgPSBmdW5jdGlvbiAocGFpcnMpIHsKCXJldHVybiBfSnNvbl93cmFwKAoJCUEzKAoJCQkkZWxtJGNvcmUkTGlzdCRmb2xkbCwKCQkJRjIoCgkJCQlmdW5jdGlvbiAoX3YwLCBvYmopIHsKCQkJCQl2YXIgayA9IF92MC5hOwoJCQkJCXZhciB2ID0gX3YwLmI7CgkJCQkJcmV0dXJuIEEzKF9Kc29uX2FkZEZpZWxkLCBrLCB2LCBvYmopOwoJCQkJfSksCgkJCV9Kc29uX2VtcHR5T2JqZWN0KF9VdGlsc19UdXBsZTApLAoJCQlwYWlycykpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGVuY29kZUFsaWFzID0gZnVuY3Rpb24gKF92MCkgewoJdmFyIGFyZ3MgPSBfdjAuYXJnczsKCXZhciB0aXBlID0gX3YwLnRpcGU7CglyZXR1cm4gJGVsbSRqc29uJEpzb24kRW5jb2RlJG9iamVjdCgKCQlfTGlzdF9mcm9tQXJyYXkoCgkJCVsKCQkJCV9VdGlsc19UdXBsZTIoCgkJCQknYXJncycsCgkJCQlBMigkZWxtJGpzb24kSnNvbiRFbmNvZGUkbGlzdCwgJGVsbSRqc29uJEpzb24kRW5jb2RlJHN0cmluZywgYXJncykpLAoJCQkJX1V0aWxzX1R1cGxlMigKCQkJCSd0eXBlJywKCQkJCSRlbG0kanNvbiRKc29uJEVuY29kZSRzdHJpbmcodGlwZSkpCgkJCV0pKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRlbmNvZGVEaWN0ID0gRjIoCglmdW5jdGlvbiAoZiwgZGljdCkgewoJCXJldHVybiAkZWxtJGpzb24kSnNvbiRFbmNvZGUkb2JqZWN0KAoJCQkkZWxtJGNvcmUkRGljdCR0b0xpc3QoCgkJCQlBMigKCQkJCQkkZWxtJGNvcmUkRGljdCRtYXAsCgkJCQkJRjIoCgkJCQkJCWZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CgkJCQkJCQlyZXR1cm4gZih2YWx1ZSk7CgkJCQkJCX0pLAoJCQkJCWRpY3QpKSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRlbmNvZGVVbmlvbiA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciBhcmdzID0gX3YwLmFyZ3M7Cgl2YXIgdGFncyA9IF92MC50YWdzOwoJcmV0dXJuICRlbG0kanNvbiRKc29uJEVuY29kZSRvYmplY3QoCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlfVXRpbHNfVHVwbGUyKAoJCQkJJ2FyZ3MnLAoJCQkJQTIoJGVsbSRqc29uJEpzb24kRW5jb2RlJGxpc3QsICRlbG0kanNvbiRKc29uJEVuY29kZSRzdHJpbmcsIGFyZ3MpKSwKCQkJCV9VdGlsc19UdXBsZTIoCgkJCQkndGFncycsCgkJCQlBMigKCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZW5jb2RlRGljdCwKCQkJCQkkZWxtJGpzb24kSnNvbiRFbmNvZGUkbGlzdCgkZWxtJGpzb24kSnNvbiRFbmNvZGUkc3RyaW5nKSwKCQkJCQl0YWdzKSkKCQkJXSkpOwp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGVuY29kZVR5cGVzID0gZnVuY3Rpb24gKF92MCkgewoJdmFyIG1lc3NhZ2UgPSBfdjAubWVzc2FnZTsKCXZhciB1bmlvbnMgPSBfdjAudW5pb25zOwoJdmFyIGFsaWFzZXMgPSBfdjAuYWxpYXNlczsKCXJldHVybiAkZWxtJGpzb24kSnNvbiRFbmNvZGUkb2JqZWN0KAoJCV9MaXN0X2Zyb21BcnJheSgKCQkJWwoJCQkJX1V0aWxzX1R1cGxlMigKCQkJCSdtZXNzYWdlJywKCQkJCSRlbG0kanNvbiRKc29uJEVuY29kZSRzdHJpbmcobWVzc2FnZSkpLAoJCQkJX1V0aWxzX1R1cGxlMigKCQkJCSdhbGlhc2VzJywKCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRlbmNvZGVEaWN0LCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZW5jb2RlQWxpYXMsIGFsaWFzZXMpKSwKCQkJCV9VdGlsc19UdXBsZTIoCgkJCQkndW5pb25zJywKCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRlbmNvZGVEaWN0LCAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWV0YWRhdGEkZW5jb2RlVW5pb24sIHVuaW9ucykpCgkJCV0pKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRlbmNvZGVWZXJzaW9ucyA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciBlbG0gPSBfdjAuZWxtOwoJcmV0dXJuICRlbG0kanNvbiRKc29uJEVuY29kZSRvYmplY3QoCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlfVXRpbHNfVHVwbGUyKAoJCQkJJ2VsbScsCgkJCQkkZWxtJGpzb24kSnNvbiRFbmNvZGUkc3RyaW5nKGVsbSkpCgkJCV0pKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRlbmNvZGUgPSBmdW5jdGlvbiAoX3YwKSB7Cgl2YXIgdmVyc2lvbnMgPSBfdjAudmVyc2lvbnM7Cgl2YXIgdHlwZXMgPSBfdjAudHlwZXM7CglyZXR1cm4gJGVsbSRqc29uJEpzb24kRW5jb2RlJG9iamVjdCgKCQlfTGlzdF9mcm9tQXJyYXkoCgkJCVsKCQkJCV9VdGlsc19UdXBsZTIoCgkJCQkndmVyc2lvbnMnLAoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1ldGFkYXRhJGVuY29kZVZlcnNpb25zKHZlcnNpb25zKSksCgkJCQlfVXRpbHNfVHVwbGUyKAoJCQkJJ3R5cGVzJywKCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRlbmNvZGVUeXBlcyh0eXBlcykpCgkJCV0pKTsKfTsKdmFyICRlbG0kY29yZSRCYXNpY3MkaWRlbnRpdHkgPSBmdW5jdGlvbiAoeCkgewoJcmV0dXJuIHg7Cn07CnZhciAkZWxtJGNvcmUkVGFzayRQZXJmb3JtID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ1BlcmZvcm0nLCBhOiBhfTsKfTsKdmFyICRlbG0kY29yZSRUYXNrJHN1Y2NlZWQgPSBfU2NoZWR1bGVyX3N1Y2NlZWQ7CnZhciAkZWxtJGNvcmUkVGFzayRpbml0ID0gJGVsbSRjb3JlJFRhc2skc3VjY2VlZChfVXRpbHNfVHVwbGUwKTsKdmFyICRlbG0kY29yZSRUYXNrJGFuZFRoZW4gPSBfU2NoZWR1bGVyX2FuZFRoZW47CnZhciAkZWxtJGNvcmUkVGFzayRtYXAgPSBGMigKCWZ1bmN0aW9uIChmdW5jLCB0YXNrQSkgewoJCXJldHVybiBBMigKCQkJJGVsbSRjb3JlJFRhc2skYW5kVGhlbiwKCQkJZnVuY3Rpb24gKGEpIHsKCQkJCXJldHVybiAkZWxtJGNvcmUkVGFzayRzdWNjZWVkKAoJCQkJCWZ1bmMoYSkpOwoJCQl9LAoJCQl0YXNrQSk7Cgl9KTsKdmFyICRlbG0kY29yZSRUYXNrJG1hcDIgPSBGMygKCWZ1bmN0aW9uIChmdW5jLCB0YXNrQSwgdGFza0IpIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kY29yZSRUYXNrJGFuZFRoZW4sCgkJCWZ1bmN0aW9uIChhKSB7CgkJCQlyZXR1cm4gQTIoCgkJCQkJJGVsbSRjb3JlJFRhc2skYW5kVGhlbiwKCQkJCQlmdW5jdGlvbiAoYikgewoJCQkJCQlyZXR1cm4gJGVsbSRjb3JlJFRhc2skc3VjY2VlZCgKCQkJCQkJCUEyKGZ1bmMsIGEsIGIpKTsKCQkJCQl9LAoJCQkJCXRhc2tCKTsKCQkJfSwKCQkJdGFza0EpOwoJfSk7CnZhciAkZWxtJGNvcmUkVGFzayRzZXF1ZW5jZSA9IGZ1bmN0aW9uICh0YXNrcykgewoJcmV0dXJuIEEzKAoJCSRlbG0kY29yZSRMaXN0JGZvbGRyLAoJCSRlbG0kY29yZSRUYXNrJG1hcDIoJGVsbSRjb3JlJExpc3QkY29ucyksCgkJJGVsbSRjb3JlJFRhc2skc3VjY2VlZChfTGlzdF9OaWwpLAoJCXRhc2tzKTsKfTsKdmFyICRlbG0kY29yZSRQbGF0Zm9ybSRzZW5kVG9BcHAgPSBfUGxhdGZvcm1fc2VuZFRvQXBwOwp2YXIgJGVsbSRjb3JlJFRhc2skc3Bhd25DbWQgPSBGMigKCWZ1bmN0aW9uIChyb3V0ZXIsIF92MCkgewoJCXZhciB0YXNrID0gX3YwLmE7CgkJcmV0dXJuIF9TY2hlZHVsZXJfc3Bhd24oCgkJCUEyKAoJCQkJJGVsbSRjb3JlJFRhc2skYW5kVGhlbiwKCQkJCSRlbG0kY29yZSRQbGF0Zm9ybSRzZW5kVG9BcHAocm91dGVyKSwKCQkJCXRhc2spKTsKCX0pOwp2YXIgJGVsbSRjb3JlJFRhc2skb25FZmZlY3RzID0gRjMoCglmdW5jdGlvbiAocm91dGVyLCBjb21tYW5kcywgc3RhdGUpIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kY29yZSRUYXNrJG1hcCwKCQkJZnVuY3Rpb24gKF92MCkgewoJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTA7CgkJCX0sCgkJCSRlbG0kY29yZSRUYXNrJHNlcXVlbmNlKAoJCQkJQTIoCgkJCQkJJGVsbSRjb3JlJExpc3QkbWFwLAoJCQkJCSRlbG0kY29yZSRUYXNrJHNwYXduQ21kKHJvdXRlciksCgkJCQkJY29tbWFuZHMpKSk7Cgl9KTsKdmFyICRlbG0kY29yZSRUYXNrJG9uU2VsZk1zZyA9IEYzKAoJZnVuY3Rpb24gKF92MCwgX3YxLCBfdjIpIHsKCQlyZXR1cm4gJGVsbSRjb3JlJFRhc2skc3VjY2VlZChfVXRpbHNfVHVwbGUwKTsKCX0pOwp2YXIgJGVsbSRjb3JlJFRhc2skY21kTWFwID0gRjIoCglmdW5jdGlvbiAodGFnZ2VyLCBfdjApIHsKCQl2YXIgdGFzayA9IF92MC5hOwoJCXJldHVybiAkZWxtJGNvcmUkVGFzayRQZXJmb3JtKAoJCQlBMigkZWxtJGNvcmUkVGFzayRtYXAsIHRhZ2dlciwgdGFzaykpOwoJfSk7Cl9QbGF0Zm9ybV9lZmZlY3RNYW5hZ2Vyc1snVGFzayddID0gX1BsYXRmb3JtX2NyZWF0ZU1hbmFnZXIoJGVsbSRjb3JlJFRhc2skaW5pdCwgJGVsbSRjb3JlJFRhc2skb25FZmZlY3RzLCAkZWxtJGNvcmUkVGFzayRvblNlbGZNc2csICRlbG0kY29yZSRUYXNrJGNtZE1hcCk7CnZhciAkZWxtJGNvcmUkVGFzayRjb21tYW5kID0gX1BsYXRmb3JtX2xlYWYoJ1Rhc2snKTsKdmFyICRlbG0kY29yZSRUYXNrJHBlcmZvcm0gPSBGMigKCWZ1bmN0aW9uICh0b01lc3NhZ2UsIHRhc2spIHsKCQlyZXR1cm4gJGVsbSRjb3JlJFRhc2skY29tbWFuZCgKCQkJJGVsbSRjb3JlJFRhc2skUGVyZm9ybSgKCQkJCUEyKCRlbG0kY29yZSRUYXNrJG1hcCwgdG9NZXNzYWdlLCB0YXNrKSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRkb3dubG9hZCA9IEYyKAoJZnVuY3Rpb24gKG1ldGFkYXRhLCBoaXN0b3J5KSB7CgkJdmFyIGhpc3RvcnlMZW5ndGggPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRzaXplKGhpc3RvcnkpOwoJCXJldHVybiBBMigKCQkJJGVsbSRjb3JlJFRhc2skcGVyZm9ybSwKCQkJZnVuY3Rpb24gKF92MCkgewoJCQkJcmV0dXJuICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJE5vT3A7CgkJCX0sCgkJCUEyKAoJCQkJX0RlYnVnZ2VyX2Rvd25sb2FkLAoJCQkJaGlzdG9yeUxlbmd0aCwKCQkJCV9Kc29uX3Vud3JhcCgKCQkJCQkkZWxtJGpzb24kSnNvbiRFbmNvZGUkb2JqZWN0KAoJCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCQlbCgkJCQkJCQkJX1V0aWxzX1R1cGxlMigKCQkJCQkJCQknbWV0YWRhdGEnLAoJCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNZXRhZGF0YSRlbmNvZGUobWV0YWRhdGEpKSwKCQkJCQkJCQlfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCSdoaXN0b3J5JywKCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRlbmNvZGUoaGlzdG9yeSkpCgkJCQkJCQldKSkpKSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFZlcnRpY2FsID0gRjMoCglmdW5jdGlvbiAoYSwgYiwgYykgewoJCXJldHVybiB7JDogJ1ZlcnRpY2FsJywgYTogYSwgYjogYiwgYzogY307Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGRyYWcgPSBGMigKCWZ1bmN0aW9uIChpbmZvLCBsYXlvdXQpIHsKCQlpZiAobGF5b3V0LiQgPT09ICdIb3Jpem9udGFsJykgewoJCQl2YXIgc3RhdHVzID0gbGF5b3V0LmE7CgkJCXZhciB5ID0gbGF5b3V0LmM7CgkJCXJldHVybiBBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRIb3Jpem9udGFsLCBzdGF0dXMsIGluZm8ueCAvIGluZm8ud2lkdGgsIHkpOwoJCX0gZWxzZSB7CgkJCXZhciBzdGF0dXMgPSBsYXlvdXQuYTsKCQkJdmFyIHggPSBsYXlvdXQuYjsKCQkJcmV0dXJuIEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFZlcnRpY2FsLCBzdGF0dXMsIHgsIGluZm8ueSAvIGluZm8uaGVpZ2h0KTsKCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JFN0ZXBwaW5nID0gRjIoCglmdW5jdGlvbiAoYSwgYikgewoJCXJldHVybiB7JDogJ1N0ZXBwaW5nJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JERvbmUgPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnRG9uZScsIGE6IGEsIGI6IGJ9OwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRnZXRIZWxwID0gRjMoCglmdW5jdGlvbiAodXBkYXRlLCBtc2csIGdldFJlc3VsdCkgewoJCWlmIChnZXRSZXN1bHQuJCA9PT0gJ0RvbmUnKSB7CgkJCXJldHVybiBnZXRSZXN1bHQ7CgkJfSBlbHNlIHsKCQkJdmFyIG4gPSBnZXRSZXN1bHQuYTsKCQkJdmFyIG1vZGVsID0gZ2V0UmVzdWx0LmI7CgkJCXJldHVybiAoIW4pID8gQTIoCgkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSREb25lLAoJCQkJbXNnLAoJCQkJQTIodXBkYXRlLCBtc2csIG1vZGVsKS5hKSA6IEEyKAoJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkU3RlcHBpbmcsCgkJCQluIC0gMSwKCQkJCUEyKHVwZGF0ZSwgbXNnLCBtb2RlbCkuYSk7CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSR1bmRvbmUgPSBmdW5jdGlvbiAoZ2V0UmVzdWx0KSB7Cgl1bmRvbmU6Cgl3aGlsZSAodHJ1ZSkgewoJCWlmIChnZXRSZXN1bHQuJCA9PT0gJ0RvbmUnKSB7CgkJCXZhciBtc2cgPSBnZXRSZXN1bHQuYTsKCQkJdmFyIG1vZGVsID0gZ2V0UmVzdWx0LmI7CgkJCXJldHVybiBfVXRpbHNfVHVwbGUyKG1vZGVsLCBtc2cpOwoJCX0gZWxzZSB7CgkJCXZhciAkdGVtcCRnZXRSZXN1bHQgPSBnZXRSZXN1bHQ7CgkJCWdldFJlc3VsdCA9ICR0ZW1wJGdldFJlc3VsdDsKCQkJY29udGludWUgdW5kb25lOwoJCX0KCX0KfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGdldCA9IEYzKAoJZnVuY3Rpb24gKHVwZGF0ZSwgaW5kZXgsIGhpc3RvcnkpIHsKCQlnZXQ6CgkJd2hpbGUgKHRydWUpIHsKCQkJdmFyIHJlY2VudCA9IGhpc3RvcnkucmVjZW50OwoJCQl2YXIgc25hcHNob3RNYXggPSBoaXN0b3J5Lm51bU1lc3NhZ2VzIC0gcmVjZW50Lm51bU1lc3NhZ2VzOwoJCQlpZiAoX1V0aWxzX2NtcChpbmRleCwgc25hcHNob3RNYXgpID4gLTEpIHsKCQkJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSR1bmRvbmUoCgkJCQkJQTMoCgkJCQkJCSRlbG0kY29yZSRMaXN0JGZvbGRyLAoJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRnZXRIZWxwKHVwZGF0ZSksCgkJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JFN0ZXBwaW5nLCBpbmRleCAtIHNuYXBzaG90TWF4LCByZWNlbnQubW9kZWwpLAoJCQkJCQlyZWNlbnQubWVzc2FnZXMpKTsKCQkJfSBlbHNlIHsKCQkJCXZhciBfdjAgPSBBMigkZWxtJGNvcmUkQXJyYXkkZ2V0LCAoaW5kZXggLyAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRtYXhTbmFwc2hvdFNpemUpIHwgMCwgaGlzdG9yeS5zbmFwc2hvdHMpOwoJCQkJaWYgKF92MC4kID09PSAnTm90aGluZycpIHsKCQkJCQl2YXIgJHRlbXAkdXBkYXRlID0gdXBkYXRlLAoJCQkJCQkkdGVtcCRpbmRleCA9IGluZGV4LAoJCQkJCQkkdGVtcCRoaXN0b3J5ID0gaGlzdG9yeTsKCQkJCQl1cGRhdGUgPSAkdGVtcCR1cGRhdGU7CgkJCQkJaW5kZXggPSAkdGVtcCRpbmRleDsKCQkJCQloaXN0b3J5ID0gJHRlbXAkaGlzdG9yeTsKCQkJCQljb250aW51ZSBnZXQ7CgkJCQl9IGVsc2UgewoJCQkJCXZhciBtb2RlbCA9IF92MC5hLm1vZGVsOwoJCQkJCXZhciBtZXNzYWdlcyA9IF92MC5hLm1lc3NhZ2VzOwoJCQkJCXJldHVybiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSR1bmRvbmUoCgkJCQkJCUEzKAoJCQkJCQkJJGVsbSRjb3JlJEFycmF5JGZvbGRyLAoJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZ2V0SGVscCh1cGRhdGUpLAoJCQkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkU3RlcHBpbmcsIGluZGV4ICUgJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkbWF4U25hcHNob3RTaXplLCBtb2RlbCksCgkJCQkJCQltZXNzYWdlcykpOwoJCQkJfQoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRnZXRSZWNlbnRNc2cgPSBmdW5jdGlvbiAoaGlzdG9yeSkgewoJZ2V0UmVjZW50TXNnOgoJd2hpbGUgKHRydWUpIHsKCQl2YXIgX3YwID0gaGlzdG9yeS5yZWNlbnQubWVzc2FnZXM7CgkJaWYgKCFfdjAuYikgewoJCQl2YXIgJHRlbXAkaGlzdG9yeSA9IGhpc3Rvcnk7CgkJCWhpc3RvcnkgPSAkdGVtcCRoaXN0b3J5OwoJCQljb250aW51ZSBnZXRSZWNlbnRNc2c7CgkJfSBlbHNlIHsKCQkJdmFyIGZpcnN0ID0gX3YwLmE7CgkJCXJldHVybiBmaXJzdDsKCQl9Cgl9Cn07CnZhciAkZWxtJGNvcmUkRGljdCRnZXQgPSBGMigKCWZ1bmN0aW9uICh0YXJnZXRLZXksIGRpY3QpIHsKCQlnZXQ6CgkJd2hpbGUgKHRydWUpIHsKCQkJaWYgKGRpY3QuJCA9PT0gJ1JCRW1wdHlfZWxtX2J1aWx0aW4nKSB7CgkJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJE5vdGhpbmc7CgkJCX0gZWxzZSB7CgkJCQl2YXIga2V5ID0gZGljdC5iOwoJCQkJdmFyIHZhbHVlID0gZGljdC5jOwoJCQkJdmFyIGxlZnQgPSBkaWN0LmQ7CgkJCQl2YXIgcmlnaHQgPSBkaWN0LmU7CgkJCQl2YXIgX3YxID0gQTIoJGVsbSRjb3JlJEJhc2ljcyRjb21wYXJlLCB0YXJnZXRLZXksIGtleSk7CgkJCQlzd2l0Y2ggKF92MS4kKSB7CgkJCQkJY2FzZSAnTFQnOgoJCQkJCQl2YXIgJHRlbXAkdGFyZ2V0S2V5ID0gdGFyZ2V0S2V5LAoJCQkJCQkJJHRlbXAkZGljdCA9IGxlZnQ7CgkJCQkJCXRhcmdldEtleSA9ICR0ZW1wJHRhcmdldEtleTsKCQkJCQkJZGljdCA9ICR0ZW1wJGRpY3Q7CgkJCQkJCWNvbnRpbnVlIGdldDsKCQkJCQljYXNlICdFUSc6CgkJCQkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkSnVzdCh2YWx1ZSk7CgkJCQkJZGVmYXVsdDoKCQkJCQkJdmFyICR0ZW1wJHRhcmdldEtleSA9IHRhcmdldEtleSwKCQkJCQkJCSR0ZW1wJGRpY3QgPSByaWdodDsKCQkJCQkJdGFyZ2V0S2V5ID0gJHRlbXAkdGFyZ2V0S2V5OwoJCQkJCQlkaWN0ID0gJHRlbXAkZGljdDsKCQkJCQkJY29udGludWUgZ2V0OwoJCQkJfQoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZURpY3RIZWxwID0gRjMoCglmdW5jdGlvbiAob2xkRGljdCwga2V5LCB2YWx1ZSkgewoJCXZhciBfdjEyID0gQTIoJGVsbSRjb3JlJERpY3QkZ2V0LCBrZXksIG9sZERpY3QpOwoJCWlmIChfdjEyLiQgPT09ICdOb3RoaW5nJykgewoJCQlyZXR1cm4gdmFsdWU7CgkJfSBlbHNlIHsKCQkJdmFyIG9sZFZhbHVlID0gX3YxMi5hOwoJCQlyZXR1cm4gQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbWVyZ2VIZWxwLCBvbGRWYWx1ZSwgdmFsdWUpOwoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbWVyZ2VIZWxwID0gRjIoCglmdW5jdGlvbiAob2xkLCBfbmV3KSB7CgkJdmFyIF92MyA9IF9VdGlsc19UdXBsZTIob2xkLCBfbmV3KTsKCQlfdjMkNjoKCQl3aGlsZSAodHJ1ZSkgewoJCQlzd2l0Y2ggKF92My5iLiQpIHsKCQkJCWNhc2UgJ1MnOgoJCQkJCXJldHVybiBfbmV3OwoJCQkJY2FzZSAnUHJpbWl0aXZlJzoKCQkJCQlyZXR1cm4gX25ldzsKCQkJCWNhc2UgJ1NlcXVlbmNlJzoKCQkJCQlpZiAoX3YzLmEuJCA9PT0gJ1NlcXVlbmNlJykgewoJCQkJCQl2YXIgX3Y0ID0gX3YzLmE7CgkJCQkJCXZhciBpc0Nsb3NlZCA9IF92NC5iOwoJCQkJCQl2YXIgb2xkVmFsdWVzID0gX3Y0LmM7CgkJCQkJCXZhciBfdjUgPSBfdjMuYjsKCQkJCQkJdmFyIHNlcVR5cGUgPSBfdjUuYTsKCQkJCQkJdmFyIG5ld1ZhbHVlcyA9IF92NS5jOwoJCQkJCQlyZXR1cm4gQTMoCgkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRTZXF1ZW5jZSwKCQkJCQkJCXNlcVR5cGUsCgkJCQkJCQlpc0Nsb3NlZCwKCQkJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJG1lcmdlTGlzdEhlbHAsIG9sZFZhbHVlcywgbmV3VmFsdWVzKSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJYnJlYWsgX3YzJDY7CgkJCQkJfQoJCQkJY2FzZSAnRGljdGlvbmFyeSc6CgkJCQkJaWYgKF92My5hLiQgPT09ICdEaWN0aW9uYXJ5JykgewoJCQkJCQl2YXIgX3Y2ID0gX3YzLmE7CgkJCQkJCXZhciBpc0Nsb3NlZCA9IF92Ni5hOwoJCQkJCQl2YXIgX3Y3ID0gX3YzLmI7CgkJCQkJCXZhciBrZXlWYWx1ZVBhaXJzID0gX3Y3LmI7CgkJCQkJCXJldHVybiBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyREaWN0aW9uYXJ5LCBpc0Nsb3NlZCwga2V5VmFsdWVQYWlycyk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJYnJlYWsgX3YzJDY7CgkJCQkJfQoJCQkJY2FzZSAnUmVjb3JkJzoKCQkJCQlpZiAoX3YzLmEuJCA9PT0gJ1JlY29yZCcpIHsKCQkJCQkJdmFyIF92OCA9IF92My5hOwoJCQkJCQl2YXIgaXNDbG9zZWQgPSBfdjguYTsKCQkJCQkJdmFyIG9sZERpY3QgPSBfdjguYjsKCQkJCQkJdmFyIF92OSA9IF92My5iOwoJCQkJCQl2YXIgbmV3RGljdCA9IF92OS5iOwoJCQkJCQlyZXR1cm4gQTIoCgkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRSZWNvcmQsCgkJCQkJCQlpc0Nsb3NlZCwKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kY29yZSREaWN0JG1hcCwKCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZURpY3RIZWxwKG9sZERpY3QpLAoJCQkJCQkJCW5ld0RpY3QpKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlicmVhayBfdjMkNjsKCQkJCQl9CgkJCQlkZWZhdWx0OgoJCQkJCWlmIChfdjMuYS4kID09PSAnQ29uc3RydWN0b3InKSB7CgkJCQkJCXZhciBfdjEwID0gX3YzLmE7CgkJCQkJCXZhciBpc0Nsb3NlZCA9IF92MTAuYjsKCQkJCQkJdmFyIG9sZFZhbHVlcyA9IF92MTAuYzsKCQkJCQkJdmFyIF92MTEgPSBfdjMuYjsKCQkJCQkJdmFyIG1heWJlTmFtZSA9IF92MTEuYTsKCQkJCQkJdmFyIG5ld1ZhbHVlcyA9IF92MTEuYzsKCQkJCQkJcmV0dXJuIEEzKAoJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kQ29uc3RydWN0b3IsCgkJCQkJCQltYXliZU5hbWUsCgkJCQkJCQlpc0Nsb3NlZCwKCQkJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJG1lcmdlTGlzdEhlbHAsIG9sZFZhbHVlcywgbmV3VmFsdWVzKSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJYnJlYWsgX3YzJDY7CgkJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBfbmV3OwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZUxpc3RIZWxwID0gRjIoCglmdW5jdGlvbiAob2xkcywgbmV3cykgewoJCXZhciBfdjAgPSBfVXRpbHNfVHVwbGUyKG9sZHMsIG5ld3MpOwoJCWlmICghX3YwLmEuYikgewoJCQlyZXR1cm4gbmV3czsKCQl9IGVsc2UgewoJCQlpZiAoIV92MC5iLmIpIHsKCQkJCXJldHVybiBuZXdzOwoJCQl9IGVsc2UgewoJCQkJdmFyIF92MSA9IF92MC5hOwoJCQkJdmFyIHggPSBfdjEuYTsKCQkJCXZhciB4cyA9IF92MS5iOwoJCQkJdmFyIF92MiA9IF92MC5iOwoJCQkJdmFyIHkgPSBfdjIuYTsKCQkJCXZhciB5cyA9IF92Mi5iOwoJCQkJcmV0dXJuIEEyKAoJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbWVyZ2VIZWxwLCB4LCB5KSwKCQkJCQlBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZUxpc3RIZWxwLCB4cywgeXMpKTsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbWVyZ2UgPSBGMigKCWZ1bmN0aW9uICh2YWx1ZSwgZXhwYW5kbykgewoJCXJldHVybiBBMigKCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbWVyZ2VIZWxwLAoJCQlleHBhbmRvLAoJCQlfRGVidWdnZXJfaW5pdCh2YWx1ZSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRqdW1wVXBkYXRlID0gRjMoCglmdW5jdGlvbiAodXBkYXRlLCBpbmRleCwgbW9kZWwpIHsKCQl2YXIgaGlzdG9yeSA9ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGNhY2hlZEhpc3RvcnkobW9kZWwpOwoJCXZhciBjdXJyZW50TXNnID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZ2V0UmVjZW50TXNnKGhpc3RvcnkpOwoJCXZhciBjdXJyZW50TW9kZWwgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRnZXRMYXRlc3RNb2RlbChtb2RlbC5zdGF0ZSk7CgkJdmFyIF92MCA9IEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGdldCwgdXBkYXRlLCBpbmRleCwgaGlzdG9yeSk7CgkJdmFyIGluZGV4TW9kZWwgPSBfdjAuYTsKCQl2YXIgaW5kZXhNc2cgPSBfdjAuYjsKCQlyZXR1cm4gX1V0aWxzX3VwZGF0ZSgKCQkJbW9kZWwsCgkJCXsKCQkJCWV4cGFuZG9Nb2RlbDogQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kbWVyZ2UsIGluZGV4TW9kZWwsIG1vZGVsLmV4cGFuZG9Nb2RlbCksCgkJCQlleHBhbmRvTXNnOiBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZSwgaW5kZXhNc2csIG1vZGVsLmV4cGFuZG9Nc2cpLAoJCQkJc3RhdGU6IEE1KCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFBhdXNlZCwgaW5kZXgsIGluZGV4TW9kZWwsIGN1cnJlbnRNb2RlbCwgY3VycmVudE1zZywgaGlzdG9yeSkKCQkJfSk7Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGpzVG9FbG0gPSBBMigkZWxtJGNvcmUkQmFzaWNzJGNvbXBvc2VSLCBfSnNvbl91bndyYXAsIF9EZWJ1Z2dlcl91bnNhZmVDb2VyY2UpOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZGVjb2RlciA9IEYyKAoJZnVuY3Rpb24gKGluaXRpYWxNb2RlbCwgdXBkYXRlKSB7CgkJdmFyIGFkZE1lc3NhZ2UgPSBGMigKCQkJZnVuY3Rpb24gKHJhd01zZywgX3YwKSB7CgkJCQl2YXIgbW9kZWwgPSBfdjAuYTsKCQkJCXZhciBoaXN0b3J5ID0gX3YwLmI7CgkJCQl2YXIgbXNnID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkanNUb0VsbShyYXdNc2cpOwoJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJQTIodXBkYXRlLCBtc2csIG1vZGVsKSwKCQkJCQlBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRhZGQsIG1zZywgbW9kZWwsIGhpc3RvcnkpKTsKCQkJfSk7CgkJdmFyIHVwZGF0ZU1vZGVsID0gZnVuY3Rpb24gKHJhd01zZ3MpIHsKCQkJcmV0dXJuIEEzKAoJCQkJJGVsbSRjb3JlJExpc3QkZm9sZGwsCgkJCQlhZGRNZXNzYWdlLAoJCQkJX1V0aWxzX1R1cGxlMigKCQkJCQlpbml0aWFsTW9kZWwsCgkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3RvcnkkZW1wdHkoaW5pdGlhbE1vZGVsKSksCgkJCQlyYXdNc2dzKTsKCQl9OwoJCXJldHVybiBBMigKCQkJJGVsbSRqc29uJEpzb24kRGVjb2RlJG1hcCwKCQkJdXBkYXRlTW9kZWwsCgkJCSRlbG0kanNvbiRKc29uJERlY29kZSRsaXN0KCRlbG0kanNvbiRKc29uJERlY29kZSR2YWx1ZSkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRnZXRJbml0aWFsTW9kZWwgPSBmdW5jdGlvbiAoX3YwKSB7Cgl2YXIgc25hcHNob3RzID0gX3YwLnNuYXBzaG90czsKCXZhciByZWNlbnQgPSBfdjAucmVjZW50OwoJdmFyIF92MSA9IEEyKCRlbG0kY29yZSRBcnJheSRnZXQsIDAsIHNuYXBzaG90cyk7CglpZiAoX3YxLiQgPT09ICdKdXN0JykgewoJCXZhciBtb2RlbCA9IF92MS5hLm1vZGVsOwoJCXJldHVybiBtb2RlbDsKCX0gZWxzZSB7CgkJcmV0dXJuIHJlY2VudC5tb2RlbDsKCX0KfTsKdmFyICRlbG0kY29yZSRQbGF0Zm9ybSRDbWQkbm9uZSA9ICRlbG0kY29yZSRQbGF0Zm9ybSRDbWQkYmF0Y2goX0xpc3RfTmlsKTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGxvYWROZXdIaXN0b3J5ID0gRjMoCglmdW5jdGlvbiAocmF3SGlzdG9yeSwgdXBkYXRlLCBtb2RlbCkgewoJCXZhciBwdXJlVXNlclVwZGF0ZSA9IEYyKAoJCQlmdW5jdGlvbiAobXNnLCB1c2VyTW9kZWwpIHsKCQkJCXJldHVybiBBMih1cGRhdGUsIG1zZywgdXNlck1vZGVsKS5hOwoJCQl9KTsKCQl2YXIgaW5pdGlhbFVzZXJNb2RlbCA9ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGdldEluaXRpYWxNb2RlbChtb2RlbC5oaXN0b3J5KTsKCQl2YXIgZGVjb2RlciA9IEEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGRlY29kZXIsIGluaXRpYWxVc2VyTW9kZWwsIHB1cmVVc2VyVXBkYXRlKTsKCQl2YXIgX3YwID0gQTIoJGVsbSRqc29uJEpzb24kRGVjb2RlJGRlY29kZVZhbHVlLCBkZWNvZGVyLCByYXdIaXN0b3J5KTsKCQlpZiAoX3YwLiQgPT09ICdFcnInKSB7CgkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJX1V0aWxzX3VwZGF0ZSgKCQkJCQltb2RlbCwKCQkJCQl7b3ZlcmxheTogJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkY29ycnVwdEltcG9ydH0pLAoJCQkJJGVsbSRjb3JlJFBsYXRmb3JtJENtZCRub25lKTsKCQl9IGVsc2UgewoJCQl2YXIgX3YxID0gX3YwLmE7CgkJCXZhciBsYXRlc3RVc2VyTW9kZWwgPSBfdjEuYTsKCQkJdmFyIG5ld0hpc3RvcnkgPSBfdjEuYjsKCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQlfVXRpbHNfdXBkYXRlKAoJCQkJCW1vZGVsLAoJCQkJCXsKCQkJCQkJZXhwYW5kb01vZGVsOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRpbml0KGxhdGVzdFVzZXJNb2RlbCksCgkJCQkJCWV4cGFuZG9Nc2c6ICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJGluaXQoCgkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRnZXRSZWNlbnRNc2cobmV3SGlzdG9yeSkpLAoJCQkJCQloaXN0b3J5OiBuZXdIaXN0b3J5LAoJCQkJCQlvdmVybGF5OiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRub25lLAoJCQkJCQlzdGF0ZTogJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kUnVubmluZyhsYXRlc3RVc2VyTW9kZWwpCgkJCQkJfSksCgkJCQkkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUpOwoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kc2Nyb2xsID0gZnVuY3Rpb24gKHBvcG91dCkgewoJcmV0dXJuIEEyKAoJCSRlbG0kY29yZSRUYXNrJHBlcmZvcm0sCgkJJGVsbSRjb3JlJEJhc2ljcyRhbHdheXMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kTm9PcCksCgkJX0RlYnVnZ2VyX3Njcm9sbChwb3BvdXQpKTsKfTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHNjcm9sbFRvID0gRjIoCglmdW5jdGlvbiAoaWQsIHBvcG91dCkgewoJCXJldHVybiBBMigKCQkJJGVsbSRjb3JlJFRhc2skcGVyZm9ybSwKCQkJJGVsbSRjb3JlJEJhc2ljcyRhbHdheXMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kTm9PcCksCgkJCUEyKF9EZWJ1Z2dlcl9zY3JvbGxUbywgaWQsIHBvcG91dCkpOwoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRzZXREcmFnU3RhdHVzID0gRjIoCglmdW5jdGlvbiAoc3RhdHVzLCBsYXlvdXQpIHsKCQlpZiAobGF5b3V0LiQgPT09ICdIb3Jpem9udGFsJykgewoJCQl2YXIgeCA9IGxheW91dC5iOwoJCQl2YXIgeSA9IGxheW91dC5jOwoJCQlyZXR1cm4gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kSG9yaXpvbnRhbCwgc3RhdHVzLCB4LCB5KTsKCQl9IGVsc2UgewoJCQl2YXIgeCA9IGxheW91dC5iOwoJCQl2YXIgeSA9IGxheW91dC5jOwoJCQlyZXR1cm4gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVmVydGljYWwsIHN0YXR1cywgeCwgeSk7CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRzd2FwTGF5b3V0ID0gZnVuY3Rpb24gKGxheW91dCkgewoJaWYgKGxheW91dC4kID09PSAnSG9yaXpvbnRhbCcpIHsKCQl2YXIgcyA9IGxheW91dC5hOwoJCXZhciB4ID0gbGF5b3V0LmI7CgkJdmFyIHkgPSBsYXlvdXQuYzsKCQlyZXR1cm4gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVmVydGljYWwsIHMsIHgsIHkpOwoJfSBlbHNlIHsKCQl2YXIgcyA9IGxheW91dC5hOwoJCXZhciB4ID0gbGF5b3V0LmI7CgkJdmFyIHkgPSBsYXlvdXQuYzsKCQlyZXR1cm4gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kSG9yaXpvbnRhbCwgcywgeCwgeSk7Cgl9Cn07CnZhciAkZWxtJGNvcmUkRGljdCRnZXRNaW4gPSBmdW5jdGlvbiAoZGljdCkgewoJZ2V0TWluOgoJd2hpbGUgKHRydWUpIHsKCQlpZiAoKGRpY3QuJCA9PT0gJ1JCTm9kZV9lbG1fYnVpbHRpbicpICYmIChkaWN0LmQuJCA9PT0gJ1JCTm9kZV9lbG1fYnVpbHRpbicpKSB7CgkJCXZhciBsZWZ0ID0gZGljdC5kOwoJCQl2YXIgJHRlbXAkZGljdCA9IGxlZnQ7CgkJCWRpY3QgPSAkdGVtcCRkaWN0OwoJCQljb250aW51ZSBnZXRNaW47CgkJfSBlbHNlIHsKCQkJcmV0dXJuIGRpY3Q7CgkJfQoJfQp9Owp2YXIgJGVsbSRjb3JlJERpY3QkbW92ZVJlZExlZnQgPSBmdW5jdGlvbiAoZGljdCkgewoJaWYgKCgoZGljdC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykgJiYgKGRpY3QuZC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykpICYmIChkaWN0LmUuJCA9PT0gJ1JCTm9kZV9lbG1fYnVpbHRpbicpKSB7CgkJaWYgKChkaWN0LmUuZC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykgJiYgKGRpY3QuZS5kLmEuJCA9PT0gJ1JlZCcpKSB7CgkJCXZhciBjbHIgPSBkaWN0LmE7CgkJCXZhciBrID0gZGljdC5iOwoJCQl2YXIgdiA9IGRpY3QuYzsKCQkJdmFyIF92MSA9IGRpY3QuZDsKCQkJdmFyIGxDbHIgPSBfdjEuYTsKCQkJdmFyIGxLID0gX3YxLmI7CgkJCXZhciBsViA9IF92MS5jOwoJCQl2YXIgbExlZnQgPSBfdjEuZDsKCQkJdmFyIGxSaWdodCA9IF92MS5lOwoJCQl2YXIgX3YyID0gZGljdC5lOwoJCQl2YXIgckNsciA9IF92Mi5hOwoJCQl2YXIgcksgPSBfdjIuYjsKCQkJdmFyIHJWID0gX3YyLmM7CgkJCXZhciByTGVmdCA9IF92Mi5kOwoJCQl2YXIgX3YzID0gckxlZnQuYTsKCQkJdmFyIHJsSyA9IHJMZWZ0LmI7CgkJCXZhciBybFYgPSByTGVmdC5jOwoJCQl2YXIgcmxMID0gckxlZnQuZDsKCQkJdmFyIHJsUiA9IHJMZWZ0LmU7CgkJCXZhciByUmlnaHQgPSBfdjIuZTsKCQkJcmV0dXJuIEE1KAoJCQkJJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLAoJCQkJJGVsbSRjb3JlJERpY3QkUmVkLAoJCQkJcmxLLAoJCQkJcmxWLAoJCQkJQTUoCgkJCQkJJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLAoJCQkJCSRlbG0kY29yZSREaWN0JEJsYWNrLAoJCQkJCWssCgkJCQkJdiwKCQkJCQlBNSgkZWxtJGNvcmUkRGljdCRSQk5vZGVfZWxtX2J1aWx0aW4sICRlbG0kY29yZSREaWN0JFJlZCwgbEssIGxWLCBsTGVmdCwgbFJpZ2h0KSwKCQkJCQlybEwpLAoJCQkJQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCAkZWxtJGNvcmUkRGljdCRCbGFjaywgckssIHJWLCBybFIsIHJSaWdodCkpOwoJCX0gZWxzZSB7CgkJCXZhciBjbHIgPSBkaWN0LmE7CgkJCXZhciBrID0gZGljdC5iOwoJCQl2YXIgdiA9IGRpY3QuYzsKCQkJdmFyIF92NCA9IGRpY3QuZDsKCQkJdmFyIGxDbHIgPSBfdjQuYTsKCQkJdmFyIGxLID0gX3Y0LmI7CgkJCXZhciBsViA9IF92NC5jOwoJCQl2YXIgbExlZnQgPSBfdjQuZDsKCQkJdmFyIGxSaWdodCA9IF92NC5lOwoJCQl2YXIgX3Y1ID0gZGljdC5lOwoJCQl2YXIgckNsciA9IF92NS5hOwoJCQl2YXIgcksgPSBfdjUuYjsKCQkJdmFyIHJWID0gX3Y1LmM7CgkJCXZhciByTGVmdCA9IF92NS5kOwoJCQl2YXIgclJpZ2h0ID0gX3Y1LmU7CgkJCWlmIChjbHIuJCA9PT0gJ0JsYWNrJykgewoJCQkJcmV0dXJuIEE1KAoJCQkJCSRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwKCQkJCQkkZWxtJGNvcmUkRGljdCRCbGFjaywKCQkJCQlrLAoJCQkJCXYsCgkJCQkJQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCAkZWxtJGNvcmUkRGljdCRSZWQsIGxLLCBsViwgbExlZnQsIGxSaWdodCksCgkJCQkJQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCAkZWxtJGNvcmUkRGljdCRSZWQsIHJLLCByViwgckxlZnQsIHJSaWdodCkpOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIEE1KAoJCQkJCSRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwKCQkJCQkkZWxtJGNvcmUkRGljdCRCbGFjaywKCQkJCQlrLAoJCQkJCXYsCgkJCQkJQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCAkZWxtJGNvcmUkRGljdCRSZWQsIGxLLCBsViwgbExlZnQsIGxSaWdodCksCgkJCQkJQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCAkZWxtJGNvcmUkRGljdCRSZWQsIHJLLCByViwgckxlZnQsIHJSaWdodCkpOwoJCQl9CgkJfQoJfSBlbHNlIHsKCQlyZXR1cm4gZGljdDsKCX0KfTsKdmFyICRlbG0kY29yZSREaWN0JG1vdmVSZWRSaWdodCA9IGZ1bmN0aW9uIChkaWN0KSB7CglpZiAoKChkaWN0LiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSAmJiAoZGljdC5kLiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSkgJiYgKGRpY3QuZS4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykpIHsKCQlpZiAoKGRpY3QuZC5kLiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSAmJiAoZGljdC5kLmQuYS4kID09PSAnUmVkJykpIHsKCQkJdmFyIGNsciA9IGRpY3QuYTsKCQkJdmFyIGsgPSBkaWN0LmI7CgkJCXZhciB2ID0gZGljdC5jOwoJCQl2YXIgX3YxID0gZGljdC5kOwoJCQl2YXIgbENsciA9IF92MS5hOwoJCQl2YXIgbEsgPSBfdjEuYjsKCQkJdmFyIGxWID0gX3YxLmM7CgkJCXZhciBfdjIgPSBfdjEuZDsKCQkJdmFyIF92MyA9IF92Mi5hOwoJCQl2YXIgbGxLID0gX3YyLmI7CgkJCXZhciBsbFYgPSBfdjIuYzsKCQkJdmFyIGxsTGVmdCA9IF92Mi5kOwoJCQl2YXIgbGxSaWdodCA9IF92Mi5lOwoJCQl2YXIgbFJpZ2h0ID0gX3YxLmU7CgkJCXZhciBfdjQgPSBkaWN0LmU7CgkJCXZhciByQ2xyID0gX3Y0LmE7CgkJCXZhciBySyA9IF92NC5iOwoJCQl2YXIgclYgPSBfdjQuYzsKCQkJdmFyIHJMZWZ0ID0gX3Y0LmQ7CgkJCXZhciByUmlnaHQgPSBfdjQuZTsKCQkJcmV0dXJuIEE1KAoJCQkJJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLAoJCQkJJGVsbSRjb3JlJERpY3QkUmVkLAoJCQkJbEssCgkJCQlsViwKCQkJCUE1KCRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkQmxhY2ssIGxsSywgbGxWLCBsbExlZnQsIGxsUmlnaHQpLAoJCQkJQTUoCgkJCQkJJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLAoJCQkJCSRlbG0kY29yZSREaWN0JEJsYWNrLAoJCQkJCWssCgkJCQkJdiwKCQkJCQlsUmlnaHQsCgkJCQkJQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCAkZWxtJGNvcmUkRGljdCRSZWQsIHJLLCByViwgckxlZnQsIHJSaWdodCkpKTsKCQl9IGVsc2UgewoJCQl2YXIgY2xyID0gZGljdC5hOwoJCQl2YXIgayA9IGRpY3QuYjsKCQkJdmFyIHYgPSBkaWN0LmM7CgkJCXZhciBfdjUgPSBkaWN0LmQ7CgkJCXZhciBsQ2xyID0gX3Y1LmE7CgkJCXZhciBsSyA9IF92NS5iOwoJCQl2YXIgbFYgPSBfdjUuYzsKCQkJdmFyIGxMZWZ0ID0gX3Y1LmQ7CgkJCXZhciBsUmlnaHQgPSBfdjUuZTsKCQkJdmFyIF92NiA9IGRpY3QuZTsKCQkJdmFyIHJDbHIgPSBfdjYuYTsKCQkJdmFyIHJLID0gX3Y2LmI7CgkJCXZhciByViA9IF92Ni5jOwoJCQl2YXIgckxlZnQgPSBfdjYuZDsKCQkJdmFyIHJSaWdodCA9IF92Ni5lOwoJCQlpZiAoY2xyLiQgPT09ICdCbGFjaycpIHsKCQkJCXJldHVybiBBNSgKCQkJCQkkZWxtJGNvcmUkRGljdCRSQk5vZGVfZWxtX2J1aWx0aW4sCgkJCQkJJGVsbSRjb3JlJERpY3QkQmxhY2ssCgkJCQkJaywKCQkJCQl2LAoJCQkJCUE1KCRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkUmVkLCBsSywgbFYsIGxMZWZ0LCBsUmlnaHQpLAoJCQkJCUE1KCRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkUmVkLCBySywgclYsIHJMZWZ0LCByUmlnaHQpKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBBNSgKCQkJCQkkZWxtJGNvcmUkRGljdCRSQk5vZGVfZWxtX2J1aWx0aW4sCgkJCQkJJGVsbSRjb3JlJERpY3QkQmxhY2ssCgkJCQkJaywKCQkJCQl2LAoJCQkJCUE1KCRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkUmVkLCBsSywgbFYsIGxMZWZ0LCBsUmlnaHQpLAoJCQkJCUE1KCRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwgJGVsbSRjb3JlJERpY3QkUmVkLCBySywgclYsIHJMZWZ0LCByUmlnaHQpKTsKCQkJfQoJCX0KCX0gZWxzZSB7CgkJcmV0dXJuIGRpY3Q7Cgl9Cn07CnZhciAkZWxtJGNvcmUkRGljdCRyZW1vdmVIZWxwUHJlcEVRR1QgPSBGNygKCWZ1bmN0aW9uICh0YXJnZXRLZXksIGRpY3QsIGNvbG9yLCBrZXksIHZhbHVlLCBsZWZ0LCByaWdodCkgewoJCWlmICgobGVmdC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykgJiYgKGxlZnQuYS4kID09PSAnUmVkJykpIHsKCQkJdmFyIF92MSA9IGxlZnQuYTsKCQkJdmFyIGxLID0gbGVmdC5iOwoJCQl2YXIgbFYgPSBsZWZ0LmM7CgkJCXZhciBsTGVmdCA9IGxlZnQuZDsKCQkJdmFyIGxSaWdodCA9IGxlZnQuZTsKCQkJcmV0dXJuIEE1KAoJCQkJJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLAoJCQkJY29sb3IsCgkJCQlsSywKCQkJCWxWLAoJCQkJbExlZnQsCgkJCQlBNSgkZWxtJGNvcmUkRGljdCRSQk5vZGVfZWxtX2J1aWx0aW4sICRlbG0kY29yZSREaWN0JFJlZCwga2V5LCB2YWx1ZSwgbFJpZ2h0LCByaWdodCkpOwoJCX0gZWxzZSB7CgkJCV92MiQyOgoJCQl3aGlsZSAodHJ1ZSkgewoJCQkJaWYgKChyaWdodC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykgJiYgKHJpZ2h0LmEuJCA9PT0gJ0JsYWNrJykpIHsKCQkJCQlpZiAocmlnaHQuZC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykgewoJCQkJCQlpZiAocmlnaHQuZC5hLiQgPT09ICdCbGFjaycpIHsKCQkJCQkJCXZhciBfdjMgPSByaWdodC5hOwoJCQkJCQkJdmFyIF92NCA9IHJpZ2h0LmQ7CgkJCQkJCQl2YXIgX3Y1ID0gX3Y0LmE7CgkJCQkJCQlyZXR1cm4gJGVsbSRjb3JlJERpY3QkbW92ZVJlZFJpZ2h0KGRpY3QpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJYnJlYWsgX3YyJDI7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQl2YXIgX3Y2ID0gcmlnaHQuYTsKCQkJCQkJdmFyIF92NyA9IHJpZ2h0LmQ7CgkJCQkJCXJldHVybiAkZWxtJGNvcmUkRGljdCRtb3ZlUmVkUmlnaHQoZGljdCk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlicmVhayBfdjIkMjsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gZGljdDsKCQl9Cgl9KTsKdmFyICRlbG0kY29yZSREaWN0JHJlbW92ZU1pbiA9IGZ1bmN0aW9uIChkaWN0KSB7CglpZiAoKGRpY3QuJCA9PT0gJ1JCTm9kZV9lbG1fYnVpbHRpbicpICYmIChkaWN0LmQuJCA9PT0gJ1JCTm9kZV9lbG1fYnVpbHRpbicpKSB7CgkJdmFyIGNvbG9yID0gZGljdC5hOwoJCXZhciBrZXkgPSBkaWN0LmI7CgkJdmFyIHZhbHVlID0gZGljdC5jOwoJCXZhciBsZWZ0ID0gZGljdC5kOwoJCXZhciBsQ29sb3IgPSBsZWZ0LmE7CgkJdmFyIGxMZWZ0ID0gbGVmdC5kOwoJCXZhciByaWdodCA9IGRpY3QuZTsKCQlpZiAobENvbG9yLiQgPT09ICdCbGFjaycpIHsKCQkJaWYgKChsTGVmdC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykgJiYgKGxMZWZ0LmEuJCA9PT0gJ1JlZCcpKSB7CgkJCQl2YXIgX3YzID0gbExlZnQuYTsKCQkJCXJldHVybiBBNSgKCQkJCQkkZWxtJGNvcmUkRGljdCRSQk5vZGVfZWxtX2J1aWx0aW4sCgkJCQkJY29sb3IsCgkJCQkJa2V5LAoJCQkJCXZhbHVlLAoJCQkJCSRlbG0kY29yZSREaWN0JHJlbW92ZU1pbihsZWZ0KSwKCQkJCQlyaWdodCk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgX3Y0ID0gJGVsbSRjb3JlJERpY3QkbW92ZVJlZExlZnQoZGljdCk7CgkJCQlpZiAoX3Y0LiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSB7CgkJCQkJdmFyIG5Db2xvciA9IF92NC5hOwoJCQkJCXZhciBuS2V5ID0gX3Y0LmI7CgkJCQkJdmFyIG5WYWx1ZSA9IF92NC5jOwoJCQkJCXZhciBuTGVmdCA9IF92NC5kOwoJCQkJCXZhciBuUmlnaHQgPSBfdjQuZTsKCQkJCQlyZXR1cm4gQTUoCgkJCQkJCSRlbG0kY29yZSREaWN0JGJhbGFuY2UsCgkJCQkJCW5Db2xvciwKCQkJCQkJbktleSwKCQkJCQkJblZhbHVlLAoJCQkJCQkkZWxtJGNvcmUkRGljdCRyZW1vdmVNaW4obkxlZnQpLAoJCQkJCQluUmlnaHQpOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gJGVsbSRjb3JlJERpY3QkUkJFbXB0eV9lbG1fYnVpbHRpbjsKCQkJCX0KCQkJfQoJCX0gZWxzZSB7CgkJCXJldHVybiBBNSgKCQkJCSRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwKCQkJCWNvbG9yLAoJCQkJa2V5LAoJCQkJdmFsdWUsCgkJCQkkZWxtJGNvcmUkRGljdCRyZW1vdmVNaW4obGVmdCksCgkJCQlyaWdodCk7CgkJfQoJfSBlbHNlIHsKCQlyZXR1cm4gJGVsbSRjb3JlJERpY3QkUkJFbXB0eV9lbG1fYnVpbHRpbjsKCX0KfTsKdmFyICRlbG0kY29yZSREaWN0JHJlbW92ZUhlbHAgPSBGMigKCWZ1bmN0aW9uICh0YXJnZXRLZXksIGRpY3QpIHsKCQlpZiAoZGljdC4kID09PSAnUkJFbXB0eV9lbG1fYnVpbHRpbicpIHsKCQkJcmV0dXJuICRlbG0kY29yZSREaWN0JFJCRW1wdHlfZWxtX2J1aWx0aW47CgkJfSBlbHNlIHsKCQkJdmFyIGNvbG9yID0gZGljdC5hOwoJCQl2YXIga2V5ID0gZGljdC5iOwoJCQl2YXIgdmFsdWUgPSBkaWN0LmM7CgkJCXZhciBsZWZ0ID0gZGljdC5kOwoJCQl2YXIgcmlnaHQgPSBkaWN0LmU7CgkJCWlmIChfVXRpbHNfY21wKHRhcmdldEtleSwga2V5KSA8IDApIHsKCQkJCWlmICgobGVmdC4kID09PSAnUkJOb2RlX2VsbV9idWlsdGluJykgJiYgKGxlZnQuYS4kID09PSAnQmxhY2snKSkgewoJCQkJCXZhciBfdjQgPSBsZWZ0LmE7CgkJCQkJdmFyIGxMZWZ0ID0gbGVmdC5kOwoJCQkJCWlmICgobExlZnQuJCA9PT0gJ1JCTm9kZV9lbG1fYnVpbHRpbicpICYmIChsTGVmdC5hLiQgPT09ICdSZWQnKSkgewoJCQkJCQl2YXIgX3Y2ID0gbExlZnQuYTsKCQkJCQkJcmV0dXJuIEE1KAoJCQkJCQkJJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLAoJCQkJCQkJY29sb3IsCgkJCQkJCQlrZXksCgkJCQkJCQl2YWx1ZSwKCQkJCQkJCUEyKCRlbG0kY29yZSREaWN0JHJlbW92ZUhlbHAsIHRhcmdldEtleSwgbGVmdCksCgkJCQkJCQlyaWdodCk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdmFyIF92NyA9ICRlbG0kY29yZSREaWN0JG1vdmVSZWRMZWZ0KGRpY3QpOwoJCQkJCQlpZiAoX3Y3LiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSB7CgkJCQkJCQl2YXIgbkNvbG9yID0gX3Y3LmE7CgkJCQkJCQl2YXIgbktleSA9IF92Ny5iOwoJCQkJCQkJdmFyIG5WYWx1ZSA9IF92Ny5jOwoJCQkJCQkJdmFyIG5MZWZ0ID0gX3Y3LmQ7CgkJCQkJCQl2YXIgblJpZ2h0ID0gX3Y3LmU7CgkJCQkJCQlyZXR1cm4gQTUoCgkJCQkJCQkJJGVsbSRjb3JlJERpY3QkYmFsYW5jZSwKCQkJCQkJCQluQ29sb3IsCgkJCQkJCQkJbktleSwKCQkJCQkJCQluVmFsdWUsCgkJCQkJCQkJQTIoJGVsbSRjb3JlJERpY3QkcmVtb3ZlSGVscCwgdGFyZ2V0S2V5LCBuTGVmdCksCgkJCQkJCQkJblJpZ2h0KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXJldHVybiAkZWxtJGNvcmUkRGljdCRSQkVtcHR5X2VsbV9idWlsdGluOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gQTUoCgkJCQkJCSRlbG0kY29yZSREaWN0JFJCTm9kZV9lbG1fYnVpbHRpbiwKCQkJCQkJY29sb3IsCgkJCQkJCWtleSwKCQkJCQkJdmFsdWUsCgkJCQkJCUEyKCRlbG0kY29yZSREaWN0JHJlbW92ZUhlbHAsIHRhcmdldEtleSwgbGVmdCksCgkJCQkJCXJpZ2h0KTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBBMigKCQkJCQkkZWxtJGNvcmUkRGljdCRyZW1vdmVIZWxwRVFHVCwKCQkJCQl0YXJnZXRLZXksCgkJCQkJQTcoJGVsbSRjb3JlJERpY3QkcmVtb3ZlSGVscFByZXBFUUdULCB0YXJnZXRLZXksIGRpY3QsIGNvbG9yLCBrZXksIHZhbHVlLCBsZWZ0LCByaWdodCkpOwoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkRGljdCRyZW1vdmVIZWxwRVFHVCA9IEYyKAoJZnVuY3Rpb24gKHRhcmdldEtleSwgZGljdCkgewoJCWlmIChkaWN0LiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSB7CgkJCXZhciBjb2xvciA9IGRpY3QuYTsKCQkJdmFyIGtleSA9IGRpY3QuYjsKCQkJdmFyIHZhbHVlID0gZGljdC5jOwoJCQl2YXIgbGVmdCA9IGRpY3QuZDsKCQkJdmFyIHJpZ2h0ID0gZGljdC5lOwoJCQlpZiAoX1V0aWxzX2VxKHRhcmdldEtleSwga2V5KSkgewoJCQkJdmFyIF92MSA9ICRlbG0kY29yZSREaWN0JGdldE1pbihyaWdodCk7CgkJCQlpZiAoX3YxLiQgPT09ICdSQk5vZGVfZWxtX2J1aWx0aW4nKSB7CgkJCQkJdmFyIG1pbktleSA9IF92MS5iOwoJCQkJCXZhciBtaW5WYWx1ZSA9IF92MS5jOwoJCQkJCXJldHVybiBBNSgKCQkJCQkJJGVsbSRjb3JlJERpY3QkYmFsYW5jZSwKCQkJCQkJY29sb3IsCgkJCQkJCW1pbktleSwKCQkJCQkJbWluVmFsdWUsCgkJCQkJCWxlZnQsCgkJCQkJCSRlbG0kY29yZSREaWN0JHJlbW92ZU1pbihyaWdodCkpOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gJGVsbSRjb3JlJERpY3QkUkJFbXB0eV9lbG1fYnVpbHRpbjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBBNSgKCQkJCQkkZWxtJGNvcmUkRGljdCRiYWxhbmNlLAoJCQkJCWNvbG9yLAoJCQkJCWtleSwKCQkJCQl2YWx1ZSwKCQkJCQlsZWZ0LAoJCQkJCUEyKCRlbG0kY29yZSREaWN0JHJlbW92ZUhlbHAsIHRhcmdldEtleSwgcmlnaHQpKTsKCQkJfQoJCX0gZWxzZSB7CgkJCXJldHVybiAkZWxtJGNvcmUkRGljdCRSQkVtcHR5X2VsbV9idWlsdGluOwoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJERpY3QkcmVtb3ZlID0gRjIoCglmdW5jdGlvbiAoa2V5LCBkaWN0KSB7CgkJdmFyIF92MCA9IEEyKCRlbG0kY29yZSREaWN0JHJlbW92ZUhlbHAsIGtleSwgZGljdCk7CgkJaWYgKChfdjAuJCA9PT0gJ1JCTm9kZV9lbG1fYnVpbHRpbicpICYmIChfdjAuYS4kID09PSAnUmVkJykpIHsKCQkJdmFyIF92MSA9IF92MC5hOwoJCQl2YXIgayA9IF92MC5iOwoJCQl2YXIgdiA9IF92MC5jOwoJCQl2YXIgbCA9IF92MC5kOwoJCQl2YXIgciA9IF92MC5lOwoJCQlyZXR1cm4gQTUoJGVsbSRjb3JlJERpY3QkUkJOb2RlX2VsbV9idWlsdGluLCAkZWxtJGNvcmUkRGljdCRCbGFjaywgaywgdiwgbCwgcik7CgkJfSBlbHNlIHsKCQkJdmFyIHggPSBfdjA7CgkJCXJldHVybiB4OwoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJERpY3QkdXBkYXRlID0gRjMoCglmdW5jdGlvbiAodGFyZ2V0S2V5LCBhbHRlciwgZGljdGlvbmFyeSkgewoJCXZhciBfdjAgPSBhbHRlcigKCQkJQTIoJGVsbSRjb3JlJERpY3QkZ2V0LCB0YXJnZXRLZXksIGRpY3Rpb25hcnkpKTsKCQlpZiAoX3YwLiQgPT09ICdKdXN0JykgewoJCQl2YXIgdmFsdWUgPSBfdjAuYTsKCQkJcmV0dXJuIEEzKCRlbG0kY29yZSREaWN0JGluc2VydCwgdGFyZ2V0S2V5LCB2YWx1ZSwgZGljdGlvbmFyeSk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIEEyKCRlbG0kY29yZSREaWN0JHJlbW92ZSwgdGFyZ2V0S2V5LCBkaWN0aW9uYXJ5KTsKCQl9Cgl9KTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHVwZGF0ZUluZGV4ID0gRjMoCglmdW5jdGlvbiAobiwgZnVuYywgbGlzdCkgewoJCWlmICghbGlzdC5iKSB7CgkJCXJldHVybiBfTGlzdF9OaWw7CgkJfSBlbHNlIHsKCQkJdmFyIHggPSBsaXN0LmE7CgkJCXZhciB4cyA9IGxpc3QuYjsKCQkJcmV0dXJuIChuIDw9IDApID8gQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJZnVuYyh4KSwKCQkJCXhzKSA6IEEyKAoJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCXgsCgkJCQlBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR1cGRhdGVJbmRleCwgbiAtIDEsIGZ1bmMsIHhzKSk7CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR1cGRhdGUgPSBGMigKCWZ1bmN0aW9uIChtc2csIHZhbHVlKSB7CgkJc3dpdGNoICh2YWx1ZS4kKSB7CgkJCWNhc2UgJ1MnOgoJCQkJcmV0dXJuIHZhbHVlOwoJCQljYXNlICdQcmltaXRpdmUnOgoJCQkJcmV0dXJuIHZhbHVlOwoJCQljYXNlICdTZXF1ZW5jZSc6CgkJCQl2YXIgc2VxVHlwZSA9IHZhbHVlLmE7CgkJCQl2YXIgaXNDbG9zZWQgPSB2YWx1ZS5iOwoJCQkJdmFyIHZhbHVlTGlzdCA9IHZhbHVlLmM7CgkJCQlzd2l0Y2ggKG1zZy4kKSB7CgkJCQkJY2FzZSAnVG9nZ2xlJzoKCQkJCQkJcmV0dXJuIEEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFNlcXVlbmNlLCBzZXFUeXBlLCAhaXNDbG9zZWQsIHZhbHVlTGlzdCk7CgkJCQkJY2FzZSAnSW5kZXgnOgoJCQkJCQlpZiAobXNnLmEuJCA9PT0gJ05vbmUnKSB7CgkJCQkJCQl2YXIgX3YzID0gbXNnLmE7CgkJCQkJCQl2YXIgaW5kZXggPSBtc2cuYjsKCQkJCQkJCXZhciBzdWJNc2cgPSBtc2cuYzsKCQkJCQkJCXJldHVybiBBMygKCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRTZXF1ZW5jZSwKCQkJCQkJCQlzZXFUeXBlLAoJCQkJCQkJCWlzQ2xvc2VkLAoJCQkJCQkJCUEzKAoJCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR1cGRhdGVJbmRleCwKCQkJCQkJCQkJaW5kZXgsCgkJCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHVwZGF0ZShzdWJNc2cpLAoJCQkJCQkJCQl2YWx1ZUxpc3QpKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXJldHVybiB2YWx1ZTsKCQkJCQkJfQoJCQkJCWRlZmF1bHQ6CgkJCQkJCXJldHVybiB2YWx1ZTsKCQkJCX0KCQkJY2FzZSAnRGljdGlvbmFyeSc6CgkJCQl2YXIgaXNDbG9zZWQgPSB2YWx1ZS5hOwoJCQkJdmFyIGtleVZhbHVlUGFpcnMgPSB2YWx1ZS5iOwoJCQkJc3dpdGNoIChtc2cuJCkgewoJCQkJCWNhc2UgJ1RvZ2dsZSc6CgkJCQkJCXJldHVybiBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyREaWN0aW9uYXJ5LCAhaXNDbG9zZWQsIGtleVZhbHVlUGFpcnMpOwoJCQkJCWNhc2UgJ0luZGV4JzoKCQkJCQkJdmFyIHJlZGlyZWN0ID0gbXNnLmE7CgkJCQkJCXZhciBpbmRleCA9IG1zZy5iOwoJCQkJCQl2YXIgc3ViTXNnID0gbXNnLmM7CgkJCQkJCXN3aXRjaCAocmVkaXJlY3QuJCkgewoJCQkJCQkJY2FzZSAnTm9uZSc6CgkJCQkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJCQkJY2FzZSAnS2V5JzoKCQkJCQkJCQlyZXR1cm4gQTIoCgkJCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJERpY3Rpb25hcnksCgkJCQkJCQkJCWlzQ2xvc2VkLAoJCQkJCQkJCQlBMygKCQkJCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHVwZGF0ZUluZGV4LAoJCQkJCQkJCQkJaW5kZXgsCgkJCQkJCQkJCQlmdW5jdGlvbiAoX3Y2KSB7CgkJCQkJCQkJCQkJdmFyIGsgPSBfdjYuYTsKCQkJCQkJCQkJCQl2YXIgdiA9IF92Ni5iOwoJCQkJCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCQkJCQlBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR1cGRhdGUsIHN1Yk1zZywgayksCgkJCQkJCQkJCQkJCXYpOwoJCQkJCQkJCQkJfSwKCQkJCQkJCQkJCWtleVZhbHVlUGFpcnMpKTsKCQkJCQkJCWRlZmF1bHQ6CgkJCQkJCQkJcmV0dXJuIEEyKAoJCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyREaWN0aW9uYXJ5LAoJCQkJCQkJCQlpc0Nsb3NlZCwKCQkJCQkJCQkJQTMoCgkJCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR1cGRhdGVJbmRleCwKCQkJCQkJCQkJCWluZGV4LAoJCQkJCQkJCQkJZnVuY3Rpb24gKF92NykgewoJCQkJCQkJCQkJCXZhciBrID0gX3Y3LmE7CgkJCQkJCQkJCQkJdmFyIHYgPSBfdjcuYjsKCQkJCQkJCQkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQkJCQkJCQkJaywKCQkJCQkJCQkJCQkJQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdXBkYXRlLCBzdWJNc2csIHYpKTsKCQkJCQkJCQkJCX0sCgkJCQkJCQkJCQlrZXlWYWx1ZVBhaXJzKSk7CgkJCQkJCX0KCQkJCQlkZWZhdWx0OgoJCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCWNhc2UgJ1JlY29yZCc6CgkJCQl2YXIgaXNDbG9zZWQgPSB2YWx1ZS5hOwoJCQkJdmFyIHZhbHVlRGljdCA9IHZhbHVlLmI7CgkJCQlzd2l0Y2ggKG1zZy4kKSB7CgkJCQkJY2FzZSAnVG9nZ2xlJzoKCQkJCQkJcmV0dXJuIEEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFJlY29yZCwgIWlzQ2xvc2VkLCB2YWx1ZURpY3QpOwoJCQkJCWNhc2UgJ0luZGV4JzoKCQkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCXZhciBmaWVsZCA9IG1zZy5hOwoJCQkJCQl2YXIgc3ViTXNnID0gbXNnLmI7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJFJlY29yZCwKCQkJCQkJCWlzQ2xvc2VkLAoJCQkJCQkJQTMoCgkJCQkJCQkJJGVsbSRjb3JlJERpY3QkdXBkYXRlLAoJCQkJCQkJCWZpZWxkLAoJCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJHVwZGF0ZUZpZWxkKHN1Yk1zZyksCgkJCQkJCQkJdmFsdWVEaWN0KSk7CgkJCQl9CgkJCWRlZmF1bHQ6CgkJCQl2YXIgbWF5YmVOYW1lID0gdmFsdWUuYTsKCQkJCXZhciBpc0Nsb3NlZCA9IHZhbHVlLmI7CgkJCQl2YXIgdmFsdWVMaXN0ID0gdmFsdWUuYzsKCQkJCXN3aXRjaCAobXNnLiQpIHsKCQkJCQljYXNlICdUb2dnbGUnOgoJCQkJCQlyZXR1cm4gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kQ29uc3RydWN0b3IsIG1heWJlTmFtZSwgIWlzQ2xvc2VkLCB2YWx1ZUxpc3QpOwoJCQkJCWNhc2UgJ0luZGV4JzoKCQkJCQkJaWYgKG1zZy5hLiQgPT09ICdOb25lJykgewoJCQkJCQkJdmFyIF92MTAgPSBtc2cuYTsKCQkJCQkJCXZhciBpbmRleCA9IG1zZy5iOwoJCQkJCQkJdmFyIHN1Yk1zZyA9IG1zZy5jOwoJCQkJCQkJcmV0dXJuIEEzKAoJCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRFeHBhbmRvJENvbnN0cnVjdG9yLAoJCQkJCQkJCW1heWJlTmFtZSwKCQkJCQkJCQlpc0Nsb3NlZCwKCQkJCQkJCQlBMygKCQkJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdXBkYXRlSW5kZXgsCgkJCQkJCQkJCWluZGV4LAoJCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR1cGRhdGUoc3ViTXNnKSwKCQkJCQkJCQkJdmFsdWVMaXN0KSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQkJCX0KCQkJCQlkZWZhdWx0OgoJCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJfQoJfSk7CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR1cGRhdGVGaWVsZCA9IEYyKAoJZnVuY3Rpb24gKG1zZywgbWF5YmVFeHBhbmRvKSB7CgkJaWYgKG1heWJlRXhwYW5kby4kID09PSAnTm90aGluZycpIHsKCQkJcmV0dXJuIG1heWJlRXhwYW5kbzsKCQl9IGVsc2UgewoJCQl2YXIgZXhwYW5kbyA9IG1heWJlRXhwYW5kby5hOwoJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJEp1c3QoCgkJCQlBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyR1cGRhdGUsIG1zZywgZXhwYW5kbykpOwoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVXBsb2FkID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ1VwbG9hZCcsIGE6IGF9Owp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kdXBsb2FkID0gZnVuY3Rpb24gKHBvcG91dCkgewoJcmV0dXJuIEEyKAoJCSRlbG0kY29yZSRUYXNrJHBlcmZvcm0sCgkJJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kVXBsb2FkLAoJCV9EZWJ1Z2dlcl91cGxvYWQocG9wb3V0KSk7Cn07CnZhciAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRCYWRNZXRhZGF0YSA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdCYWRNZXRhZGF0YScsIGE6IGF9Owp9Owp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkYmFkTWV0YWRhdGEgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRCYWRNZXRhZGF0YTsKdmFyICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHdpdGhHb29kTWV0YWRhdGEgPSBGMigKCWZ1bmN0aW9uIChtb2RlbCwgZnVuYykgewoJCXZhciBfdjAgPSBtb2RlbC5tZXRhZGF0YTsKCQlpZiAoX3YwLiQgPT09ICdPaycpIHsKCQkJdmFyIG1ldGFkYXRhID0gX3YwLmE7CgkJCXJldHVybiBmdW5jKG1ldGFkYXRhKTsKCQl9IGVsc2UgewoJCQl2YXIgZXJyb3IgPSBfdjAuYTsKCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQlfVXRpbHNfdXBkYXRlKAoJCQkJCW1vZGVsLAoJCQkJCXsKCQkJCQkJb3ZlcmxheTogJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkYmFkTWV0YWRhdGEoZXJyb3IpCgkJCQkJfSksCgkJCQkkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUpOwoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kd3JhcFVwZGF0ZSA9IEYzKAoJZnVuY3Rpb24gKHVwZGF0ZSwgbXNnLCBtb2RlbCkgewoJCXdyYXBVcGRhdGU6CgkJd2hpbGUgKHRydWUpIHsKCQkJc3dpdGNoIChtc2cuJCkgewoJCQkJY2FzZSAnTm9PcCc6CgkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIobW9kZWwsICRlbG0kY29yZSRQbGF0Zm9ybSRDbWQkbm9uZSk7CgkJCQljYXNlICdVc2VyTXNnJzoKCQkJCQl2YXIgdXNlck1zZyA9IG1zZy5hOwoJCQkJCXZhciB1c2VyTW9kZWwgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRnZXRMYXRlc3RNb2RlbChtb2RlbC5zdGF0ZSk7CgkJCQkJdmFyIG5ld0hpc3RvcnkgPSBBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRhZGQsIHVzZXJNc2csIHVzZXJNb2RlbCwgbW9kZWwuaGlzdG9yeSk7CgkJCQkJdmFyIF92MSA9IEEyKHVwZGF0ZSwgdXNlck1zZywgdXNlck1vZGVsKTsKCQkJCQl2YXIgbmV3VXNlck1vZGVsID0gX3YxLmE7CgkJCQkJdmFyIHVzZXJDbWRzID0gX3YxLmI7CgkJCQkJdmFyIGNvbW1hbmRzID0gQTIoJGVsbSRjb3JlJFBsYXRmb3JtJENtZCRtYXAsICRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJFVzZXJNc2csIHVzZXJDbWRzKTsKCQkJCQl2YXIgX3YyID0gbW9kZWwuc3RhdGU7CgkJCQkJaWYgKF92Mi4kID09PSAnUnVubmluZycpIHsKCQkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCQlfVXRpbHNfdXBkYXRlKAoJCQkJCQkJCW1vZGVsLAoJCQkJCQkJCXsKCQkJCQkJCQkJZXhwYW5kb01vZGVsOiBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZSwgbmV3VXNlck1vZGVsLCBtb2RlbC5leHBhbmRvTW9kZWwpLAoJCQkJCQkJCQlleHBhbmRvTXNnOiBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZSwgdXNlck1zZywgbW9kZWwuZXhwYW5kb01zZyksCgkJCQkJCQkJCWhpc3Rvcnk6IG5ld0hpc3RvcnksCgkJCQkJCQkJCXN0YXRlOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRSdW5uaW5nKG5ld1VzZXJNb2RlbCkKCQkJCQkJCQl9KSwKCQkJCQkJCSRlbG0kY29yZSRQbGF0Zm9ybSRDbWQkYmF0Y2goCgkJCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJCQlbCgkJCQkJCQkJCQljb21tYW5kcywKCQkJCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHNjcm9sbChtb2RlbC5wb3BvdXQpCgkJCQkJCQkJCV0pKSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdmFyIGluZGV4ID0gX3YyLmE7CgkJCQkJCXZhciBpbmRleE1vZGVsID0gX3YyLmI7CgkJCQkJCXZhciBoaXN0b3J5ID0gX3YyLmU7CgkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJX1V0aWxzX3VwZGF0ZSgKCQkJCQkJCQltb2RlbCwKCQkJCQkJCQl7CgkJCQkJCQkJCWhpc3Rvcnk6IG5ld0hpc3RvcnksCgkJCQkJCQkJCXN0YXRlOiBBNSgkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRQYXVzZWQsIGluZGV4LCBpbmRleE1vZGVsLCBuZXdVc2VyTW9kZWwsIHVzZXJNc2csIGhpc3RvcnkpCgkJCQkJCQkJfSksCgkJCQkJCQljb21tYW5kcyk7CgkJCQkJfQoJCQkJY2FzZSAnVHdlYWtFeHBhbmRvTXNnJzoKCQkJCQl2YXIgZU1zZyA9IG1zZy5hOwoJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQlfVXRpbHNfdXBkYXRlKAoJCQkJCQkJbW9kZWwsCgkJCQkJCQl7CgkJCQkJCQkJZXhwYW5kb01zZzogQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdXBkYXRlLCBlTXNnLCBtb2RlbC5leHBhbmRvTXNnKQoJCQkJCQkJfSksCgkJCQkJCSRlbG0kY29yZSRQbGF0Zm9ybSRDbWQkbm9uZSk7CgkJCQljYXNlICdUd2Vha0V4cGFuZG9Nb2RlbCc6CgkJCQkJdmFyIGVNc2cgPSBtc2cuYTsKCQkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQkJX1V0aWxzX3VwZGF0ZSgKCQkJCQkJCW1vZGVsLAoJCQkJCQkJewoJCQkJCQkJCWV4cGFuZG9Nb2RlbDogQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJEV4cGFuZG8kdXBkYXRlLCBlTXNnLCBtb2RlbC5leHBhbmRvTW9kZWwpCgkJCQkJCQl9KSwKCQkJCQkJJGVsbSRjb3JlJFBsYXRmb3JtJENtZCRub25lKTsKCQkJCWNhc2UgJ1Jlc3VtZSc6CgkJCQkJdmFyIF92MyA9IG1vZGVsLnN0YXRlOwoJCQkJCWlmIChfdjMuJCA9PT0gJ1J1bm5pbmcnKSB7CgkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKG1vZGVsLCAkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXZhciB1c2VyTW9kZWwgPSBfdjMuYzsKCQkJCQkJdmFyIHVzZXJNc2cgPSBfdjMuZDsKCQkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCQlfVXRpbHNfdXBkYXRlKAoJCQkJCQkJCW1vZGVsLAoJCQkJCQkJCXsKCQkJCQkJCQkJZXhwYW5kb01vZGVsOiBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZSwgdXNlck1vZGVsLCBtb2RlbC5leHBhbmRvTW9kZWwpLAoJCQkJCQkJCQlleHBhbmRvTXNnOiBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkRXhwYW5kbyRtZXJnZSwgdXNlck1zZywgbW9kZWwuZXhwYW5kb01zZyksCgkJCQkJCQkJCXN0YXRlOiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRSdW5uaW5nKHVzZXJNb2RlbCkKCQkJCQkJCQl9KSwKCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHNjcm9sbChtb2RlbC5wb3BvdXQpKTsKCQkJCQl9CgkJCQljYXNlICdKdW1wJzoKCQkJCQl2YXIgaW5kZXggPSBtc2cuYTsKCQkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQkJQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kanVtcFVwZGF0ZSwgdXBkYXRlLCBpbmRleCwgbW9kZWwpLAoJCQkJCQkkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUpOwoJCQkJY2FzZSAnU2xpZGVySnVtcCc6CgkJCQkJdmFyIGluZGV4ID0gbXNnLmE7CgkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCUEzKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGp1bXBVcGRhdGUsIHVwZGF0ZSwgaW5kZXgsIG1vZGVsKSwKCQkJCQkJQTIoCgkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRzY3JvbGxUbywKCQkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRIaXN0b3J5JGlkRm9yTWVzc2FnZUluZGV4KGluZGV4KSwKCQkJCQkJCW1vZGVsLnBvcG91dCkpOwoJCQkJY2FzZSAnT3Blbic6CgkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCW1vZGVsLAoJCQkJCQlBMigKCQkJCQkJCSRlbG0kY29yZSRUYXNrJHBlcmZvcm0sCgkJCQkJCQkkZWxtJGNvcmUkQmFzaWNzJGFsd2F5cygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiROb09wKSwKCQkJCQkJCV9EZWJ1Z2dlcl9vcGVuKG1vZGVsLnBvcG91dCkpKTsKCQkJCWNhc2UgJ1VwJzoKCQkJCQl2YXIgX3Y0ID0gbW9kZWwuc3RhdGU7CgkJCQkJaWYgKF92NC4kID09PSAnUnVubmluZycpIHsKCQkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIobW9kZWwsICRlbG0kY29yZSRQbGF0Zm9ybSRDbWQkbm9uZSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdmFyIGkgPSBfdjQuYTsKCQkJCQkJdmFyIGhpc3RvcnkgPSBfdjQuZTsKCQkJCQkJdmFyIHRhcmdldEluZGV4ID0gaSArIDE7CgkJCQkJCWlmIChfVXRpbHNfY21wKAoJCQkJCQkJdGFyZ2V0SW5kZXgsCgkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkSGlzdG9yeSRzaXplKGhpc3RvcnkpKSA8IDApIHsKCQkJCQkJCXZhciAkdGVtcCR1cGRhdGUgPSB1cGRhdGUsCgkJCQkJCQkJJHRlbXAkbXNnID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kU2xpZGVySnVtcCh0YXJnZXRJbmRleCksCgkJCQkJCQkJJHRlbXAkbW9kZWwgPSBtb2RlbDsKCQkJCQkJCXVwZGF0ZSA9ICR0ZW1wJHVwZGF0ZTsKCQkJCQkJCW1zZyA9ICR0ZW1wJG1zZzsKCQkJCQkJCW1vZGVsID0gJHRlbXAkbW9kZWw7CgkJCQkJCQljb250aW51ZSB3cmFwVXBkYXRlOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdmFyICR0ZW1wJHVwZGF0ZSA9IHVwZGF0ZSwKCQkJCQkJCQkkdGVtcCRtc2cgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRSZXN1bWUsCgkJCQkJCQkJJHRlbXAkbW9kZWwgPSBtb2RlbDsKCQkJCQkJCXVwZGF0ZSA9ICR0ZW1wJHVwZGF0ZTsKCQkJCQkJCW1zZyA9ICR0ZW1wJG1zZzsKCQkJCQkJCW1vZGVsID0gJHRlbXAkbW9kZWw7CgkJCQkJCQljb250aW51ZSB3cmFwVXBkYXRlOwoJCQkJCQl9CgkJCQkJfQoJCQkJY2FzZSAnRG93bic6CgkJCQkJdmFyIF92NSA9IG1vZGVsLnN0YXRlOwoJCQkJCWlmIChfdjUuJCA9PT0gJ1J1bm5pbmcnKSB7CgkJCQkJCXZhciAkdGVtcCR1cGRhdGUgPSB1cGRhdGUsCgkJCQkJCQkkdGVtcCRtc2cgPSAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRKdW1wKAoJCQkJCQkJJGVsbSRicm93c2VyJERlYnVnZ2VyJEhpc3Rvcnkkc2l6ZShtb2RlbC5oaXN0b3J5KSAtIDEpLAoJCQkJCQkJJHRlbXAkbW9kZWwgPSBtb2RlbDsKCQkJCQkJdXBkYXRlID0gJHRlbXAkdXBkYXRlOwoJCQkJCQltc2cgPSAkdGVtcCRtc2c7CgkJCQkJCW1vZGVsID0gJHRlbXAkbW9kZWw7CgkJCQkJCWNvbnRpbnVlIHdyYXBVcGRhdGU7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdmFyIGluZGV4ID0gX3Y1LmE7CgkJCQkJCWlmIChpbmRleCA+IDApIHsKCQkJCQkJCXZhciAkdGVtcCR1cGRhdGUgPSB1cGRhdGUsCgkJCQkJCQkJJHRlbXAkbXNnID0gJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kU2xpZGVySnVtcChpbmRleCAtIDEpLAoJCQkJCQkJCSR0ZW1wJG1vZGVsID0gbW9kZWw7CgkJCQkJCQl1cGRhdGUgPSAkdGVtcCR1cGRhdGU7CgkJCQkJCQltc2cgPSAkdGVtcCRtc2c7CgkJCQkJCQltb2RlbCA9ICR0ZW1wJG1vZGVsOwoJCQkJCQkJY29udGludWUgd3JhcFVwZGF0ZTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKG1vZGVsLCAkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUpOwoJCQkJCQl9CgkJCQkJfQoJCQkJY2FzZSAnSW1wb3J0JzoKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHdpdGhHb29kTWV0YWRhdGEsCgkJCQkJCW1vZGVsLAoJCQkJCQlmdW5jdGlvbiAoX3Y2KSB7CgkJCQkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQkJCQltb2RlbCwKCQkJCQkJCQkkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiR1cGxvYWQobW9kZWwucG9wb3V0KSk7CgkJCQkJCX0pOwoJCQkJY2FzZSAnRXhwb3J0JzoKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHdpdGhHb29kTWV0YWRhdGEsCgkJCQkJCW1vZGVsLAoJCQkJCQlmdW5jdGlvbiAobWV0YWRhdGEpIHsKCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCW1vZGVsLAoJCQkJCQkJCUEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGRvd25sb2FkLCBtZXRhZGF0YSwgbW9kZWwuaGlzdG9yeSkpOwoJCQkJCQl9KTsKCQkJCWNhc2UgJ1VwbG9hZCc6CgkJCQkJdmFyIGpzb25TdHJpbmcgPSBtc2cuYTsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJHdpdGhHb29kTWV0YWRhdGEsCgkJCQkJCW1vZGVsLAoJCQkJCQlmdW5jdGlvbiAobWV0YWRhdGEpIHsKCQkJCQkJCXZhciBfdjcgPSBBMigkZWxtJGJyb3dzZXIkRGVidWdnZXIkT3ZlcmxheSRhc3Nlc3NJbXBvcnQsIG1ldGFkYXRhLCBqc29uU3RyaW5nKTsKCQkJCQkJCWlmIChfdjcuJCA9PT0gJ0VycicpIHsKCQkJCQkJCQl2YXIgbmV3T3ZlcmxheSA9IF92Ny5hOwoJCQkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJCQlfVXRpbHNfdXBkYXRlKAoJCQkJCQkJCQkJbW9kZWwsCgkJCQkJCQkJCQl7b3ZlcmxheTogbmV3T3ZlcmxheX0pLAoJCQkJCQkJCQkkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl2YXIgcmF3SGlzdG9yeSA9IF92Ny5hOwoJCQkJCQkJCXJldHVybiBBMygkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRsb2FkTmV3SGlzdG9yeSwgcmF3SGlzdG9yeSwgdXBkYXRlLCBtb2RlbCk7CgkJCQkJCQl9CgkJCQkJCX0pOwoJCQkJY2FzZSAnT3ZlcmxheU1zZyc6CgkJCQkJdmFyIG92ZXJsYXlNc2cgPSBtc2cuYTsKCQkJCQl2YXIgX3Y4ID0gQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkY2xvc2UsIG92ZXJsYXlNc2csIG1vZGVsLm92ZXJsYXkpOwoJCQkJCWlmIChfdjguJCA9PT0gJ05vdGhpbmcnKSB7CgkJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQkJX1V0aWxzX3VwZGF0ZSgKCQkJCQkJCQltb2RlbCwKCQkJCQkJCQl7b3ZlcmxheTogJGVsbSRicm93c2VyJERlYnVnZ2VyJE92ZXJsYXkkbm9uZX0pLAoJCQkJCQkJJGVsbSRjb3JlJFBsYXRmb3JtJENtZCRub25lKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl2YXIgcmF3SGlzdG9yeSA9IF92OC5hOwoJCQkJCQlyZXR1cm4gQTMoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kbG9hZE5ld0hpc3RvcnksIHJhd0hpc3RvcnksIHVwZGF0ZSwgbW9kZWwpOwoJCQkJCX0KCQkJCWNhc2UgJ1N3YXBMYXlvdXQnOgoJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQlfVXRpbHNfdXBkYXRlKAoJCQkJCQkJbW9kZWwsCgkJCQkJCQl7CgkJCQkJCQkJbGF5b3V0OiAkZWxtJGJyb3dzZXIkRGVidWdnZXIkTWFpbiRzd2FwTGF5b3V0KG1vZGVsLmxheW91dCkKCQkJCQkJCX0pLAoJCQkJCQkkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUpOwoJCQkJY2FzZSAnRHJhZ1N0YXJ0JzoKCQkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQkJX1V0aWxzX3VwZGF0ZSgKCQkJCQkJCW1vZGVsLAoJCQkJCQkJewoJCQkJCQkJCWxheW91dDogQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kc2V0RHJhZ1N0YXR1cywgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kTW92aW5nLCBtb2RlbC5sYXlvdXQpCgkJCQkJCQl9KSwKCQkJCQkJJGVsbSRjb3JlJFBsYXRmb3JtJENtZCRub25lKTsKCQkJCWNhc2UgJ0RyYWcnOgoJCQkJCXZhciBpbmZvID0gbXNnLmE7CgkJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJCV9VdGlsc191cGRhdGUoCgkJCQkJCQltb2RlbCwKCQkJCQkJCXsKCQkJCQkJCQlsYXlvdXQ6IEEyKCRlbG0kYnJvd3NlciREZWJ1Z2dlciRNYWluJGRyYWcsIGluZm8sIG1vZGVsLmxheW91dCkKCQkJCQkJCX0pLAoJCQkJCQkkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUpOwoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQkJX1V0aWxzX3VwZGF0ZSgKCQkJCQkJCW1vZGVsLAoJCQkJCQkJewoJCQkJCQkJCWxheW91dDogQTIoJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kc2V0RHJhZ1N0YXR1cywgJGVsbSRicm93c2VyJERlYnVnZ2VyJE1haW4kU3RhdGljLCBtb2RlbC5sYXlvdXQpCgkJCQkJCQl9KSwKCQkJCQkJJGVsbSRjb3JlJFBsYXRmb3JtJENtZCRub25lKTsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRicm93c2VyJEJyb3dzZXIkRXh0ZXJuYWwgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnRXh0ZXJuYWwnLCBhOiBhfTsKfTsKdmFyICRlbG0kYnJvd3NlciRCcm93c2VyJEludGVybmFsID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ0ludGVybmFsJywgYTogYX07Cn07CnZhciAkZWxtJGJyb3dzZXIkQnJvd3NlciREb20kTm90Rm91bmQgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnTm90Rm91bmQnLCBhOiBhfTsKfTsKdmFyICRlbG0kdXJsJFVybCRIdHRwID0geyQ6ICdIdHRwJ307CnZhciAkZWxtJHVybCRVcmwkSHR0cHMgPSB7JDogJ0h0dHBzJ307CnZhciAkZWxtJHVybCRVcmwkVXJsID0gRjYoCglmdW5jdGlvbiAocHJvdG9jb2wsIGhvc3QsIHBvcnRfLCBwYXRoLCBxdWVyeSwgZnJhZ21lbnQpIHsKCQlyZXR1cm4ge2ZyYWdtZW50OiBmcmFnbWVudCwgaG9zdDogaG9zdCwgcGF0aDogcGF0aCwgcG9ydF86IHBvcnRfLCBwcm90b2NvbDogcHJvdG9jb2wsIHF1ZXJ5OiBxdWVyeX07Cgl9KTsKdmFyICRlbG0kY29yZSRTdHJpbmckZHJvcExlZnQgPSBGMigKCWZ1bmN0aW9uIChuLCBzdHJpbmcpIHsKCQlyZXR1cm4gKG4gPCAxKSA/IHN0cmluZyA6IEEzKAoJCQkkZWxtJGNvcmUkU3RyaW5nJHNsaWNlLAoJCQluLAoJCQkkZWxtJGNvcmUkU3RyaW5nJGxlbmd0aChzdHJpbmcpLAoJCQlzdHJpbmcpOwoJfSk7CnZhciAkZWxtJGNvcmUkU3RyaW5nJGluZGV4ZXMgPSBfU3RyaW5nX2luZGV4ZXM7CnZhciAkZWxtJGNvcmUkU3RyaW5nJGlzRW1wdHkgPSBmdW5jdGlvbiAoc3RyaW5nKSB7CglyZXR1cm4gc3RyaW5nID09PSAnJzsKfTsKdmFyICRlbG0kdXJsJFVybCRjaG9tcEJlZm9yZVBhdGggPSBGNSgKCWZ1bmN0aW9uIChwcm90b2NvbCwgcGF0aCwgcGFyYW1zLCBmcmFnLCBzdHIpIHsKCQlpZiAoJGVsbSRjb3JlJFN0cmluZyRpc0VtcHR5KHN0cikgfHwgQTIoJGVsbSRjb3JlJFN0cmluZyRjb250YWlucywgJ0AnLCBzdHIpKSB7CgkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZzsKCQl9IGVsc2UgewoJCQl2YXIgX3YwID0gQTIoJGVsbSRjb3JlJFN0cmluZyRpbmRleGVzLCAnOicsIHN0cik7CgkJCWlmICghX3YwLmIpIHsKCQkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkSnVzdCgKCQkJCQlBNigkZWxtJHVybCRVcmwkVXJsLCBwcm90b2NvbCwgc3RyLCAkZWxtJGNvcmUkTWF5YmUkTm90aGluZywgcGF0aCwgcGFyYW1zLCBmcmFnKSk7CgkJCX0gZWxzZSB7CgkJCQlpZiAoIV92MC5iLmIpIHsKCQkJCQl2YXIgaSA9IF92MC5hOwoJCQkJCXZhciBfdjEgPSAkZWxtJGNvcmUkU3RyaW5nJHRvSW50KAoJCQkJCQlBMigkZWxtJGNvcmUkU3RyaW5nJGRyb3BMZWZ0LCBpICsgMSwgc3RyKSk7CgkJCQkJaWYgKF92MS4kID09PSAnTm90aGluZycpIHsKCQkJCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXZhciBwb3J0XyA9IF92MTsKCQkJCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSRKdXN0KAoJCQkJCQkJQTYoCgkJCQkJCQkJJGVsbSR1cmwkVXJsJFVybCwKCQkJCQkJCQlwcm90b2NvbCwKCQkJCQkJCQlBMigkZWxtJGNvcmUkU3RyaW5nJGxlZnQsIGksIHN0ciksCgkJCQkJCQkJcG9ydF8sCgkJCQkJCQkJcGF0aCwKCQkJCQkJCQlwYXJhbXMsCgkJCQkJCQkJZnJhZykpOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJCQkJfQoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJHVybCRVcmwkY2hvbXBCZWZvcmVRdWVyeSA9IEY0KAoJZnVuY3Rpb24gKHByb3RvY29sLCBwYXJhbXMsIGZyYWcsIHN0cikgewoJCWlmICgkZWxtJGNvcmUkU3RyaW5nJGlzRW1wdHkoc3RyKSkgewoJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJE5vdGhpbmc7CgkJfSBlbHNlIHsKCQkJdmFyIF92MCA9IEEyKCRlbG0kY29yZSRTdHJpbmckaW5kZXhlcywgJy8nLCBzdHIpOwoJCQlpZiAoIV92MC5iKSB7CgkJCQlyZXR1cm4gQTUoJGVsbSR1cmwkVXJsJGNob21wQmVmb3JlUGF0aCwgcHJvdG9jb2wsICcvJywgcGFyYW1zLCBmcmFnLCBzdHIpOwoJCQl9IGVsc2UgewoJCQkJdmFyIGkgPSBfdjAuYTsKCQkJCXJldHVybiBBNSgKCQkJCQkkZWxtJHVybCRVcmwkY2hvbXBCZWZvcmVQYXRoLAoJCQkJCXByb3RvY29sLAoJCQkJCUEyKCRlbG0kY29yZSRTdHJpbmckZHJvcExlZnQsIGksIHN0ciksCgkJCQkJcGFyYW1zLAoJCQkJCWZyYWcsCgkJCQkJQTIoJGVsbSRjb3JlJFN0cmluZyRsZWZ0LCBpLCBzdHIpKTsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSR1cmwkVXJsJGNob21wQmVmb3JlRnJhZ21lbnQgPSBGMygKCWZ1bmN0aW9uIChwcm90b2NvbCwgZnJhZywgc3RyKSB7CgkJaWYgKCRlbG0kY29yZSRTdHJpbmckaXNFbXB0eShzdHIpKSB7CgkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZzsKCQl9IGVsc2UgewoJCQl2YXIgX3YwID0gQTIoJGVsbSRjb3JlJFN0cmluZyRpbmRleGVzLCAnPycsIHN0cik7CgkJCWlmICghX3YwLmIpIHsKCQkJCXJldHVybiBBNCgkZWxtJHVybCRVcmwkY2hvbXBCZWZvcmVRdWVyeSwgcHJvdG9jb2wsICRlbG0kY29yZSRNYXliZSROb3RoaW5nLCBmcmFnLCBzdHIpOwoJCQl9IGVsc2UgewoJCQkJdmFyIGkgPSBfdjAuYTsKCQkJCXJldHVybiBBNCgKCQkJCQkkZWxtJHVybCRVcmwkY2hvbXBCZWZvcmVRdWVyeSwKCQkJCQlwcm90b2NvbCwKCQkJCQkkZWxtJGNvcmUkTWF5YmUkSnVzdCgKCQkJCQkJQTIoJGVsbSRjb3JlJFN0cmluZyRkcm9wTGVmdCwgaSArIDEsIHN0cikpLAoJCQkJCWZyYWcsCgkJCQkJQTIoJGVsbSRjb3JlJFN0cmluZyRsZWZ0LCBpLCBzdHIpKTsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSR1cmwkVXJsJGNob21wQWZ0ZXJQcm90b2NvbCA9IEYyKAoJZnVuY3Rpb24gKHByb3RvY29sLCBzdHIpIHsKCQlpZiAoJGVsbSRjb3JlJFN0cmluZyRpc0VtcHR5KHN0cikpIHsKCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJCX0gZWxzZSB7CgkJCXZhciBfdjAgPSBBMigkZWxtJGNvcmUkU3RyaW5nJGluZGV4ZXMsICcjJywgc3RyKTsKCQkJaWYgKCFfdjAuYikgewoJCQkJcmV0dXJuIEEzKCRlbG0kdXJsJFVybCRjaG9tcEJlZm9yZUZyYWdtZW50LCBwcm90b2NvbCwgJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcsIHN0cik7CgkJCX0gZWxzZSB7CgkJCQl2YXIgaSA9IF92MC5hOwoJCQkJcmV0dXJuIEEzKAoJCQkJCSRlbG0kdXJsJFVybCRjaG9tcEJlZm9yZUZyYWdtZW50LAoJCQkJCXByb3RvY29sLAoJCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KAoJCQkJCQlBMigkZWxtJGNvcmUkU3RyaW5nJGRyb3BMZWZ0LCBpICsgMSwgc3RyKSksCgkJCQkJQTIoJGVsbSRjb3JlJFN0cmluZyRsZWZ0LCBpLCBzdHIpKTsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJFN0cmluZyRzdGFydHNXaXRoID0gX1N0cmluZ19zdGFydHNXaXRoOwp2YXIgJGVsbSR1cmwkVXJsJGZyb21TdHJpbmcgPSBmdW5jdGlvbiAoc3RyKSB7CglyZXR1cm4gQTIoJGVsbSRjb3JlJFN0cmluZyRzdGFydHNXaXRoLCAnaHR0cDovLycsIHN0cikgPyBBMigKCQkkZWxtJHVybCRVcmwkY2hvbXBBZnRlclByb3RvY29sLAoJCSRlbG0kdXJsJFVybCRIdHRwLAoJCUEyKCRlbG0kY29yZSRTdHJpbmckZHJvcExlZnQsIDcsIHN0cikpIDogKEEyKCRlbG0kY29yZSRTdHJpbmckc3RhcnRzV2l0aCwgJ2h0dHBzOi8vJywgc3RyKSA/IEEyKAoJCSRlbG0kdXJsJFVybCRjaG9tcEFmdGVyUHJvdG9jb2wsCgkJJGVsbSR1cmwkVXJsJEh0dHBzLAoJCUEyKCRlbG0kY29yZSRTdHJpbmckZHJvcExlZnQsIDgsIHN0cikpIDogJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcpOwp9Owp2YXIgJGVsbSRjb3JlJEJhc2ljcyRuZXZlciA9IGZ1bmN0aW9uIChfdjApIHsKCW5ldmVyOgoJd2hpbGUgKHRydWUpIHsKCQl2YXIgbnZyID0gX3YwLmE7CgkJdmFyICR0ZW1wJF92MCA9IG52cjsKCQlfdjAgPSAkdGVtcCRfdjA7CgkJY29udGludWUgbmV2ZXI7Cgl9Cn07CnZhciAkZWxtJGJyb3dzZXIkQnJvd3NlciRhcHBsaWNhdGlvbiA9IF9Ccm93c2VyX2FwcGxpY2F0aW9uOwp2YXIgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kTm90Rm91bmQgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnTm90Rm91bmQnLCBhOiBhfTsKfTsKdmFyICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJEFib3V0ID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ0Fib3V0JywgYTogYX07Cn07CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRGYWlsdXJlID0geyQ6ICdGYWlsdXJlJ307CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRIb21lID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ0hvbWUnLCBhOiBhfTsKfTsKdmFyICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJExvYWRpbmcgPSB7JDogJ0xvYWRpbmcnfTsKdmFyICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJE5hdmlnYXRlVG9BYm91dCA9IHskOiAnTmF2aWdhdGVUb0Fib3V0J307CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiROYXZpZ2F0ZVRvSG9tZSA9IHskOiAnTmF2aWdhdGVUb0hvbWUnfTsKdmFyICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJFN1Y2Nlc3MgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnU3VjY2VzcycsIGE6IGF9Owp9Owp2YXIgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kQmFja2VuZFJlc3BvbnNlID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ0JhY2tlbmRSZXNwb25zZScsIGE6IGF9Owp9Owp2YXIgJGVsbSRodHRwJEh0dHAkQmFkU3RhdHVzXyA9IEYyKAoJZnVuY3Rpb24gKGEsIGIpIHsKCQlyZXR1cm4geyQ6ICdCYWRTdGF0dXNfJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kaHR0cCRIdHRwJEJhZFVybF8gPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnQmFkVXJsXycsIGE6IGF9Owp9Owp2YXIgJGVsbSRodHRwJEh0dHAkR29vZFN0YXR1c18gPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnR29vZFN0YXR1c18nLCBhOiBhLCBiOiBifTsKCX0pOwp2YXIgJGVsbSRodHRwJEh0dHAkTmV0d29ya0Vycm9yXyA9IHskOiAnTmV0d29ya0Vycm9yXyd9Owp2YXIgJGVsbSRodHRwJEh0dHAkUmVjZWl2aW5nID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ1JlY2VpdmluZycsIGE6IGF9Owp9Owp2YXIgJGVsbSRodHRwJEh0dHAkU2VuZGluZyA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdTZW5kaW5nJywgYTogYX07Cn07CnZhciAkZWxtJGh0dHAkSHR0cCRUaW1lb3V0XyA9IHskOiAnVGltZW91dF8nfTsKdmFyICRlbG0kY29yZSRNYXliZSRpc0p1c3QgPSBmdW5jdGlvbiAobWF5YmUpIHsKCWlmIChtYXliZS4kID09PSAnSnVzdCcpIHsKCQlyZXR1cm4gdHJ1ZTsKCX0gZWxzZSB7CgkJcmV0dXJuIGZhbHNlOwoJfQp9Owp2YXIgJGVsbSRjb3JlJFBsYXRmb3JtJHNlbmRUb1NlbGYgPSBfUGxhdGZvcm1fc2VuZFRvU2VsZjsKdmFyICRlbG0kaHR0cCRIdHRwJGV4cGVjdFN0cmluZ1Jlc3BvbnNlID0gRjIoCglmdW5jdGlvbiAodG9Nc2csIHRvUmVzdWx0KSB7CgkJcmV0dXJuIEEzKAoJCQlfSHR0cF9leHBlY3QsCgkJCScnLAoJCQkkZWxtJGNvcmUkQmFzaWNzJGlkZW50aXR5LAoJCQlBMigkZWxtJGNvcmUkQmFzaWNzJGNvbXBvc2VSLCB0b1Jlc3VsdCwgdG9Nc2cpKTsKCX0pOwp2YXIgJGVsbSRodHRwJEh0dHAkQmFkQm9keSA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdCYWRCb2R5JywgYTogYX07Cn07CnZhciAkZWxtJGh0dHAkSHR0cCRCYWRTdGF0dXMgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnQmFkU3RhdHVzJywgYTogYX07Cn07CnZhciAkZWxtJGh0dHAkSHR0cCRCYWRVcmwgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnQmFkVXJsJywgYTogYX07Cn07CnZhciAkZWxtJGh0dHAkSHR0cCROZXR3b3JrRXJyb3IgPSB7JDogJ05ldHdvcmtFcnJvcid9Owp2YXIgJGVsbSRodHRwJEh0dHAkVGltZW91dCA9IHskOiAnVGltZW91dCd9Owp2YXIgJGVsbSRjb3JlJFJlc3VsdCRtYXBFcnJvciA9IEYyKAoJZnVuY3Rpb24gKGYsIHJlc3VsdCkgewoJCWlmIChyZXN1bHQuJCA9PT0gJ09rJykgewoJCQl2YXIgdiA9IHJlc3VsdC5hOwoJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPayh2KTsKCQl9IGVsc2UgewoJCQl2YXIgZSA9IHJlc3VsdC5hOwoJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRFcnIoCgkJCQlmKGUpKTsKCQl9Cgl9KTsKdmFyICRlbG0kaHR0cCRIdHRwJHJlc29sdmUgPSBGMigKCWZ1bmN0aW9uICh0b1Jlc3VsdCwgcmVzcG9uc2UpIHsKCQlzd2l0Y2ggKHJlc3BvbnNlLiQpIHsKCQkJY2FzZSAnQmFkVXJsXyc6CgkJCQl2YXIgdXJsID0gcmVzcG9uc2UuYTsKCQkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycigKCQkJCQkkZWxtJGh0dHAkSHR0cCRCYWRVcmwodXJsKSk7CgkJCWNhc2UgJ1RpbWVvdXRfJzoKCQkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycigkZWxtJGh0dHAkSHR0cCRUaW1lb3V0KTsKCQkJY2FzZSAnTmV0d29ya0Vycm9yXyc6CgkJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRFcnIoJGVsbSRodHRwJEh0dHAkTmV0d29ya0Vycm9yKTsKCQkJY2FzZSAnQmFkU3RhdHVzXyc6CgkJCQl2YXIgbWV0YWRhdGEgPSByZXNwb25zZS5hOwoJCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKAoJCQkJCSRlbG0kaHR0cCRIdHRwJEJhZFN0YXR1cyhtZXRhZGF0YS5zdGF0dXNDb2RlKSk7CgkJCWRlZmF1bHQ6CgkJCQl2YXIgYm9keSA9IHJlc3BvbnNlLmI7CgkJCQlyZXR1cm4gQTIoCgkJCQkJJGVsbSRjb3JlJFJlc3VsdCRtYXBFcnJvciwKCQkJCQkkZWxtJGh0dHAkSHR0cCRCYWRCb2R5LAoJCQkJCXRvUmVzdWx0KGJvZHkpKTsKCQl9Cgl9KTsKdmFyICRlbG0kaHR0cCRIdHRwJGV4cGVjdFN0cmluZyA9IGZ1bmN0aW9uICh0b01zZykgewoJcmV0dXJuIEEyKAoJCSRlbG0kaHR0cCRIdHRwJGV4cGVjdFN0cmluZ1Jlc3BvbnNlLAoJCXRvTXNnLAoJCSRlbG0kaHR0cCRIdHRwJHJlc29sdmUoJGVsbSRjb3JlJFJlc3VsdCRPaykpOwp9Owp2YXIgJGVsbSRodHRwJEh0dHAkZW1wdHlCb2R5ID0gX0h0dHBfZW1wdHlCb2R5Owp2YXIgJGVsbSRodHRwJEh0dHAkUmVxdWVzdCA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdSZXF1ZXN0JywgYTogYX07Cn07CnZhciAkZWxtJGh0dHAkSHR0cCRTdGF0ZSA9IEYyKAoJZnVuY3Rpb24gKHJlcXMsIHN1YnMpIHsKCQlyZXR1cm4ge3JlcXM6IHJlcXMsIHN1YnM6IHN1YnN9OwoJfSk7CnZhciAkZWxtJGh0dHAkSHR0cCRpbml0ID0gJGVsbSRjb3JlJFRhc2skc3VjY2VlZCgKCUEyKCRlbG0kaHR0cCRIdHRwJFN0YXRlLCAkZWxtJGNvcmUkRGljdCRlbXB0eSwgX0xpc3RfTmlsKSk7CnZhciAkZWxtJGNvcmUkUHJvY2VzcyRraWxsID0gX1NjaGVkdWxlcl9raWxsOwp2YXIgJGVsbSRjb3JlJFByb2Nlc3Mkc3Bhd24gPSBfU2NoZWR1bGVyX3NwYXduOwp2YXIgJGVsbSRodHRwJEh0dHAkdXBkYXRlUmVxcyA9IEYzKAoJZnVuY3Rpb24gKHJvdXRlciwgY21kcywgcmVxcykgewoJCXVwZGF0ZVJlcXM6CgkJd2hpbGUgKHRydWUpIHsKCQkJaWYgKCFjbWRzLmIpIHsKCQkJCXJldHVybiAkZWxtJGNvcmUkVGFzayRzdWNjZWVkKHJlcXMpOwoJCQl9IGVsc2UgewoJCQkJdmFyIGNtZCA9IGNtZHMuYTsKCQkJCXZhciBvdGhlckNtZHMgPSBjbWRzLmI7CgkJCQlpZiAoY21kLiQgPT09ICdDYW5jZWwnKSB7CgkJCQkJdmFyIHRyYWNrZXIgPSBjbWQuYTsKCQkJCQl2YXIgX3YyID0gQTIoJGVsbSRjb3JlJERpY3QkZ2V0LCB0cmFja2VyLCByZXFzKTsKCQkJCQlpZiAoX3YyLiQgPT09ICdOb3RoaW5nJykgewoJCQkJCQl2YXIgJHRlbXAkcm91dGVyID0gcm91dGVyLAoJCQkJCQkJJHRlbXAkY21kcyA9IG90aGVyQ21kcywKCQkJCQkJCSR0ZW1wJHJlcXMgPSByZXFzOwoJCQkJCQlyb3V0ZXIgPSAkdGVtcCRyb3V0ZXI7CgkJCQkJCWNtZHMgPSAkdGVtcCRjbWRzOwoJCQkJCQlyZXFzID0gJHRlbXAkcmVxczsKCQkJCQkJY29udGludWUgdXBkYXRlUmVxczsKCQkJCQl9IGVsc2UgewoJCQkJCQl2YXIgcGlkID0gX3YyLmE7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCSRlbG0kY29yZSRUYXNrJGFuZFRoZW4sCgkJCQkJCQlmdW5jdGlvbiAoX3YzKSB7CgkJCQkJCQkJcmV0dXJuIEEzKAoJCQkJCQkJCQkkZWxtJGh0dHAkSHR0cCR1cGRhdGVSZXFzLAoJCQkJCQkJCQlyb3V0ZXIsCgkJCQkJCQkJCW90aGVyQ21kcywKCQkJCQkJCQkJQTIoJGVsbSRjb3JlJERpY3QkcmVtb3ZlLCB0cmFja2VyLCByZXFzKSk7CgkJCQkJCQl9LAoJCQkJCQkJJGVsbSRjb3JlJFByb2Nlc3Mka2lsbChwaWQpKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCXZhciByZXEgPSBjbWQuYTsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kY29yZSRUYXNrJGFuZFRoZW4sCgkJCQkJCWZ1bmN0aW9uIChwaWQpIHsKCQkJCQkJCXZhciBfdjQgPSByZXEudHJhY2tlcjsKCQkJCQkJCWlmIChfdjQuJCA9PT0gJ05vdGhpbmcnKSB7CgkJCQkJCQkJcmV0dXJuIEEzKCRlbG0kaHR0cCRIdHRwJHVwZGF0ZVJlcXMsIHJvdXRlciwgb3RoZXJDbWRzLCByZXFzKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJdmFyIHRyYWNrZXIgPSBfdjQuYTsKCQkJCQkJCQlyZXR1cm4gQTMoCgkJCQkJCQkJCSRlbG0kaHR0cCRIdHRwJHVwZGF0ZVJlcXMsCgkJCQkJCQkJCXJvdXRlciwKCQkJCQkJCQkJb3RoZXJDbWRzLAoJCQkJCQkJCQlBMygkZWxtJGNvcmUkRGljdCRpbnNlcnQsIHRyYWNrZXIsIHBpZCwgcmVxcykpOwoJCQkJCQkJfQoJCQkJCQl9LAoJCQkJCQkkZWxtJGNvcmUkUHJvY2VzcyRzcGF3bigKCQkJCQkJCUEzKAoJCQkJCQkJCV9IdHRwX3RvVGFzaywKCQkJCQkJCQlyb3V0ZXIsCgkJCQkJCQkJJGVsbSRjb3JlJFBsYXRmb3JtJHNlbmRUb0FwcChyb3V0ZXIpLAoJCQkJCQkJCXJlcSkpKTsKCQkJCX0KCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRodHRwJEh0dHAkb25FZmZlY3RzID0gRjQoCglmdW5jdGlvbiAocm91dGVyLCBjbWRzLCBzdWJzLCBzdGF0ZSkgewoJCXJldHVybiBBMigKCQkJJGVsbSRjb3JlJFRhc2skYW5kVGhlbiwKCQkJZnVuY3Rpb24gKHJlcXMpIHsKCQkJCXJldHVybiAkZWxtJGNvcmUkVGFzayRzdWNjZWVkKAoJCQkJCUEyKCRlbG0kaHR0cCRIdHRwJFN0YXRlLCByZXFzLCBzdWJzKSk7CgkJCX0sCgkJCUEzKCRlbG0kaHR0cCRIdHRwJHVwZGF0ZVJlcXMsIHJvdXRlciwgY21kcywgc3RhdGUucmVxcykpOwoJfSk7CnZhciAkZWxtJGh0dHAkSHR0cCRtYXliZVNlbmQgPSBGNCgKCWZ1bmN0aW9uIChyb3V0ZXIsIGRlc2lyZWRUcmFja2VyLCBwcm9ncmVzcywgX3YwKSB7CgkJdmFyIGFjdHVhbFRyYWNrZXIgPSBfdjAuYTsKCQl2YXIgdG9Nc2cgPSBfdjAuYjsKCQlyZXR1cm4gX1V0aWxzX2VxKGRlc2lyZWRUcmFja2VyLCBhY3R1YWxUcmFja2VyKSA/ICRlbG0kY29yZSRNYXliZSRKdXN0KAoJCQlBMigKCQkJCSRlbG0kY29yZSRQbGF0Zm9ybSRzZW5kVG9BcHAsCgkJCQlyb3V0ZXIsCgkJCQl0b01zZyhwcm9ncmVzcykpKSA6ICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJfSk7CnZhciAkZWxtJGh0dHAkSHR0cCRvblNlbGZNc2cgPSBGMygKCWZ1bmN0aW9uIChyb3V0ZXIsIF92MCwgc3RhdGUpIHsKCQl2YXIgdHJhY2tlciA9IF92MC5hOwoJCXZhciBwcm9ncmVzcyA9IF92MC5iOwoJCXJldHVybiBBMigKCQkJJGVsbSRjb3JlJFRhc2skYW5kVGhlbiwKCQkJZnVuY3Rpb24gKF92MSkgewoJCQkJcmV0dXJuICRlbG0kY29yZSRUYXNrJHN1Y2NlZWQoc3RhdGUpOwoJCQl9LAoJCQkkZWxtJGNvcmUkVGFzayRzZXF1ZW5jZSgKCQkJCUEyKAoJCQkJCSRlbG0kY29yZSRMaXN0JGZpbHRlck1hcCwKCQkJCQlBMygkZWxtJGh0dHAkSHR0cCRtYXliZVNlbmQsIHJvdXRlciwgdHJhY2tlciwgcHJvZ3Jlc3MpLAoJCQkJCXN0YXRlLnN1YnMpKSk7Cgl9KTsKdmFyICRlbG0kaHR0cCRIdHRwJENhbmNlbCA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdDYW5jZWwnLCBhOiBhfTsKfTsKdmFyICRlbG0kaHR0cCRIdHRwJGNtZE1hcCA9IEYyKAoJZnVuY3Rpb24gKGZ1bmMsIGNtZCkgewoJCWlmIChjbWQuJCA9PT0gJ0NhbmNlbCcpIHsKCQkJdmFyIHRyYWNrZXIgPSBjbWQuYTsKCQkJcmV0dXJuICRlbG0kaHR0cCRIdHRwJENhbmNlbCh0cmFja2VyKTsKCQl9IGVsc2UgewoJCQl2YXIgciA9IGNtZC5hOwoJCQlyZXR1cm4gJGVsbSRodHRwJEh0dHAkUmVxdWVzdCgKCQkJCXsKCQkJCQlhbGxvd0Nvb2tpZXNGcm9tT3RoZXJEb21haW5zOiByLmFsbG93Q29va2llc0Zyb21PdGhlckRvbWFpbnMsCgkJCQkJYm9keTogci5ib2R5LAoJCQkJCWV4cGVjdDogQTIoX0h0dHBfbWFwRXhwZWN0LCBmdW5jLCByLmV4cGVjdCksCgkJCQkJaGVhZGVyczogci5oZWFkZXJzLAoJCQkJCW1ldGhvZDogci5tZXRob2QsCgkJCQkJdGltZW91dDogci50aW1lb3V0LAoJCQkJCXRyYWNrZXI6IHIudHJhY2tlciwKCQkJCQl1cmw6IHIudXJsCgkJCQl9KTsKCQl9Cgl9KTsKdmFyICRlbG0kaHR0cCRIdHRwJE15U3ViID0gRjIoCglmdW5jdGlvbiAoYSwgYikgewoJCXJldHVybiB7JDogJ015U3ViJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kaHR0cCRIdHRwJHN1Yk1hcCA9IEYyKAoJZnVuY3Rpb24gKGZ1bmMsIF92MCkgewoJCXZhciB0cmFja2VyID0gX3YwLmE7CgkJdmFyIHRvTXNnID0gX3YwLmI7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGh0dHAkSHR0cCRNeVN1YiwKCQkJdHJhY2tlciwKCQkJQTIoJGVsbSRjb3JlJEJhc2ljcyRjb21wb3NlUiwgdG9Nc2csIGZ1bmMpKTsKCX0pOwpfUGxhdGZvcm1fZWZmZWN0TWFuYWdlcnNbJ0h0dHAnXSA9IF9QbGF0Zm9ybV9jcmVhdGVNYW5hZ2VyKCRlbG0kaHR0cCRIdHRwJGluaXQsICRlbG0kaHR0cCRIdHRwJG9uRWZmZWN0cywgJGVsbSRodHRwJEh0dHAkb25TZWxmTXNnLCAkZWxtJGh0dHAkSHR0cCRjbWRNYXAsICRlbG0kaHR0cCRIdHRwJHN1Yk1hcCk7CnZhciAkZWxtJGh0dHAkSHR0cCRjb21tYW5kID0gX1BsYXRmb3JtX2xlYWYoJ0h0dHAnKTsKdmFyICRlbG0kaHR0cCRIdHRwJHN1YnNjcmlwdGlvbiA9IF9QbGF0Zm9ybV9sZWFmKCdIdHRwJyk7CnZhciAkZWxtJGh0dHAkSHR0cCRyZXF1ZXN0ID0gZnVuY3Rpb24gKHIpIHsKCXJldHVybiAkZWxtJGh0dHAkSHR0cCRjb21tYW5kKAoJCSRlbG0kaHR0cCRIdHRwJFJlcXVlc3QoCgkJCXthbGxvd0Nvb2tpZXNGcm9tT3RoZXJEb21haW5zOiBmYWxzZSwgYm9keTogci5ib2R5LCBleHBlY3Q6IHIuZXhwZWN0LCBoZWFkZXJzOiByLmhlYWRlcnMsIG1ldGhvZDogci5tZXRob2QsIHRpbWVvdXQ6IHIudGltZW91dCwgdHJhY2tlcjogci50cmFja2VyLCB1cmw6IHIudXJsfSkpOwp9Owp2YXIgJGVsbSRodHRwJEh0dHAkZ2V0ID0gZnVuY3Rpb24gKHIpIHsKCXJldHVybiAkZWxtJGh0dHAkSHR0cCRyZXF1ZXN0KAoJCXtib2R5OiAkZWxtJGh0dHAkSHR0cCRlbXB0eUJvZHksIGV4cGVjdDogci5leHBlY3QsIGhlYWRlcnM6IF9MaXN0X05pbCwgbWV0aG9kOiAnR0VUJywgdGltZW91dDogJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcsIHRyYWNrZXI6ICRlbG0kY29yZSRNYXliZSROb3RoaW5nLCB1cmw6IHIudXJsfSk7Cn07CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRhcGlSZXF1ZXN0Q21kRnJvbU9mZmVyZWRQYWdlID0gZnVuY3Rpb24gKHBhZ2UpIHsKCXZhciBwYXRoID0gZnVuY3Rpb24gKCkgewoJCWlmIChwYWdlLiQgPT09ICdOYXZpZ2F0ZVRvSG9tZScpIHsKCQkJcmV0dXJuICdhcGkvaG9tZSc7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICdhcGkvYWJvdXQnOwoJCX0KCX0oKTsKCXJldHVybiAkZWxtJGh0dHAkSHR0cCRnZXQoCgkJewoJCQlleHBlY3Q6ICRlbG0kaHR0cCRIdHRwJGV4cGVjdFN0cmluZygKCQkJCWZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kQmFja2VuZFJlc3BvbnNlKAoJCQkJCQl7cmVxdWVzdFBhZ2U6IHBhZ2UsIHJlc3VsdDogcmVzdWx0fSk7CgkJCQl9KSwKCQkJdXJsOiBwYXRoCgkJfSk7Cn07CnZhciAkZWxtJGNvcmUkTWF5YmUkbWFwID0gRjIoCglmdW5jdGlvbiAoZiwgbWF5YmUpIHsKCQlpZiAobWF5YmUuJCA9PT0gJ0p1c3QnKSB7CgkJCXZhciB2YWx1ZSA9IG1heWJlLmE7CgkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkSnVzdCgKCQkJCWYodmFsdWUpKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJE5vdGhpbmc7CgkJfQoJfSk7CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRvZmZlcmVkUGFnZUZyb21TZWxlY3RlZFBhZ2UgPSBmdW5jdGlvbiAoc2VsZWN0ZWRQYWdlKSB7Cglzd2l0Y2ggKHNlbGVjdGVkUGFnZS4kKSB7CgkJY2FzZSAnSG9tZSc6CgkJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkSnVzdCgkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiROYXZpZ2F0ZVRvSG9tZSk7CgkJY2FzZSAnQWJvdXQnOgoJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJEp1c3QoJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kTmF2aWdhdGVUb0Fib3V0KTsKCQlkZWZhdWx0OgoJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJE5vdGhpbmc7Cgl9Cn07CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRhcGlSZXF1ZXN0Q21kRnJvbVNlbGVjdGVkUGFnZSA9IEEyKAoJJGVsbSRjb3JlJEJhc2ljcyRjb21wb3NlUiwKCSRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJG9mZmVyZWRQYWdlRnJvbVNlbGVjdGVkUGFnZSwKCSRlbG0kY29yZSRNYXliZSRtYXAoJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kYXBpUmVxdWVzdENtZEZyb21PZmZlcmVkUGFnZSkpOwp2YXIgJGVsbSRicm93c2VyJEJyb3dzZXIkTmF2aWdhdGlvbiRsb2FkID0gX0Jyb3dzZXJfbG9hZDsKdmFyICRlbG0kYnJvd3NlciRCcm93c2VyJE5hdmlnYXRpb24kcHVzaFVybCA9IF9Ccm93c2VyX3B1c2hVcmw7CnZhciAkZWxtJHVybCRVcmwkYWRkUG9ydCA9IEYyKAoJZnVuY3Rpb24gKG1heWJlUG9ydCwgc3RhcnRlcikgewoJCWlmIChtYXliZVBvcnQuJCA9PT0gJ05vdGhpbmcnKSB7CgkJCXJldHVybiBzdGFydGVyOwoJCX0gZWxzZSB7CgkJCXZhciBwb3J0XyA9IG1heWJlUG9ydC5hOwoJCQlyZXR1cm4gc3RhcnRlciArICgnOicgKyAkZWxtJGNvcmUkU3RyaW5nJGZyb21JbnQocG9ydF8pKTsKCQl9Cgl9KTsKdmFyICRlbG0kdXJsJFVybCRhZGRQcmVmaXhlZCA9IEYzKAoJZnVuY3Rpb24gKHByZWZpeCwgbWF5YmVTZWdtZW50LCBzdGFydGVyKSB7CgkJaWYgKG1heWJlU2VnbWVudC4kID09PSAnTm90aGluZycpIHsKCQkJcmV0dXJuIHN0YXJ0ZXI7CgkJfSBlbHNlIHsKCQkJdmFyIHNlZ21lbnQgPSBtYXliZVNlZ21lbnQuYTsKCQkJcmV0dXJuIF9VdGlsc19hcCgKCQkJCXN0YXJ0ZXIsCgkJCQlfVXRpbHNfYXAocHJlZml4LCBzZWdtZW50KSk7CgkJfQoJfSk7CnZhciAkZWxtJHVybCRVcmwkdG9TdHJpbmcgPSBmdW5jdGlvbiAodXJsKSB7Cgl2YXIgaHR0cCA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgX3YwID0gdXJsLnByb3RvY29sOwoJCWlmIChfdjAuJCA9PT0gJ0h0dHAnKSB7CgkJCXJldHVybiAnaHR0cDovLyc7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICdodHRwczovLyc7CgkJfQoJfSgpOwoJcmV0dXJuIEEzKAoJCSRlbG0kdXJsJFVybCRhZGRQcmVmaXhlZCwKCQknIycsCgkJdXJsLmZyYWdtZW50LAoJCUEzKAoJCQkkZWxtJHVybCRVcmwkYWRkUHJlZml4ZWQsCgkJCSc/JywKCQkJdXJsLnF1ZXJ5LAoJCQlfVXRpbHNfYXAoCgkJCQlBMigKCQkJCQkkZWxtJHVybCRVcmwkYWRkUG9ydCwKCQkJCQl1cmwucG9ydF8sCgkJCQkJX1V0aWxzX2FwKGh0dHAsIHVybC5ob3N0KSksCgkJCQl1cmwucGF0aCkpKTsKfTsKdmFyICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJHVwZGF0ZSA9IEYyKAoJZnVuY3Rpb24gKGV2ZW50LCBzdGF0ZUJlZm9yZSkgewoJCXN3aXRjaCAoZXZlbnQuJCkgewoJCQljYXNlICdCYWNrZW5kUmVzcG9uc2UnOgoJCQkJdmFyIHJlcXVlc3RQYWdlID0gZXZlbnQuYS5yZXF1ZXN0UGFnZTsKCQkJCXZhciByZXN1bHQgPSBldmVudC5hLnJlc3VsdDsKCQkJCXZhciBzZWxlY3RlZFBhZ2UgPSBmdW5jdGlvbiAoKSB7CgkJCQkJdmFyIF92MSA9IHN0YXRlQmVmb3JlLnNlbGVjdGVkUGFnZTsKCQkJCQlzd2l0Y2ggKF92MS4kKSB7CgkJCQkJCWNhc2UgJ0hvbWUnOgoJCQkJCQkJaWYgKCFfVXRpbHNfZXEocmVxdWVzdFBhZ2UsICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJE5hdmlnYXRlVG9Ib21lKSkgewoJCQkJCQkJCXJldHVybiBzdGF0ZUJlZm9yZS5zZWxlY3RlZFBhZ2U7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXZhciBwYWdlU3RhdGUgPSBmdW5jdGlvbiAoKSB7CgkJCQkJCQkJCWlmIChyZXN1bHQuJCA9PT0gJ09rJykgewoJCQkJCQkJCQkJdmFyIGZ1bGxUZXh0ID0gcmVzdWx0LmE7CgkJCQkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kU3VjY2VzcyhmdWxsVGV4dCk7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kRmFpbHVyZTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0oKTsKCQkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kSG9tZShwYWdlU3RhdGUpOwoJCQkJCQkJfQoJCQkJCQljYXNlICdBYm91dCc6CgkJCQkJCQlpZiAoIV9VdGlsc19lcShyZXF1ZXN0UGFnZSwgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kTmF2aWdhdGVUb0Fib3V0KSkgewoJCQkJCQkJCXJldHVybiBzdGF0ZUJlZm9yZS5zZWxlY3RlZFBhZ2U7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXZhciBwYWdlU3RhdGUgPSBmdW5jdGlvbiAoKSB7CgkJCQkJCQkJCWlmIChyZXN1bHQuJCA9PT0gJ09rJykgewoJCQkJCQkJCQkJdmFyIGZ1bGxUZXh0ID0gcmVzdWx0LmE7CgkJCQkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kU3VjY2VzcyhmdWxsVGV4dCk7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kRmFpbHVyZTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0oKTsKCQkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kQWJvdXQocGFnZVN0YXRlKTsKCQkJCQkJCX0KCQkJCQkJZGVmYXVsdDoKCQkJCQkJCXJldHVybiBzdGF0ZUJlZm9yZS5zZWxlY3RlZFBhZ2U7CgkJCQkJfQoJCQkJfSgpOwoJCQkJcmV0dXJuIF9VdGlsc19UdXBsZTIoCgkJCQkJX1V0aWxzX3VwZGF0ZSgKCQkJCQkJc3RhdGVCZWZvcmUsCgkJCQkJCXtzZWxlY3RlZFBhZ2U6IHNlbGVjdGVkUGFnZX0pLAoJCQkJCSRlbG0kY29yZSRQbGF0Zm9ybSRDbWQkbm9uZSk7CgkJCWNhc2UgJ1VybENoYW5nZSc6CgkJCQl2YXIgdXJsID0gZXZlbnQuYTsKCQkJCXZhciBzZWxlY3RlZFBhZ2UgPSBmdW5jdGlvbiAoKSB7CgkJCQkJdmFyIF92NCA9IHVybC5wYXRoOwoJCQkJCXN3aXRjaCAoX3Y0KSB7CgkJCQkJCWNhc2UgJyc6CgkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kSG9tZSgkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRMb2FkaW5nKTsKCQkJCQkJY2FzZSAnLyc6CgkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kSG9tZSgkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRMb2FkaW5nKTsKCQkJCQkJY2FzZSAnL2hvbWUnOgoJCQkJCQkJcmV0dXJuICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJEhvbWUoJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kTG9hZGluZyk7CgkJCQkJCWNhc2UgJy9hYm91dCc6CgkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kQWJvdXQoJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kTG9hZGluZyk7CgkJCQkJCWRlZmF1bHQ6CgkJCQkJCQl2YXIgb3RoZXIgPSBfdjQ7CgkJCQkJCQlyZXR1cm4gJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kTm90Rm91bmQob3RoZXIpOwoJCQkJCX0KCQkJCX0oKTsKCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCV9VdGlsc191cGRhdGUoCgkJCQkJCXN0YXRlQmVmb3JlLAoJCQkJCQl7c2VsZWN0ZWRQYWdlOiBzZWxlY3RlZFBhZ2V9KSwKCQkJCQlBMigKCQkJCQkJJGVsbSRjb3JlJE1heWJlJHdpdGhEZWZhdWx0LAoJCQkJCQkkZWxtJGNvcmUkUGxhdGZvcm0kQ21kJG5vbmUsCgkJCQkJCSRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJGFwaVJlcXVlc3RDbWRGcm9tU2VsZWN0ZWRQYWdlKHNlbGVjdGVkUGFnZSkpKTsKCQkJZGVmYXVsdDoKCQkJCXZhciB1cmxSZXF1ZXN0ID0gZXZlbnQuYTsKCQkJCWlmICh1cmxSZXF1ZXN0LiQgPT09ICdJbnRlcm5hbCcpIHsKCQkJCQl2YXIgdXJsID0gdXJsUmVxdWVzdC5hOwoJCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCQlzdGF0ZUJlZm9yZSwKCQkJCQkJQTIoCgkJCQkJCQkkZWxtJGJyb3dzZXIkQnJvd3NlciROYXZpZ2F0aW9uJHB1c2hVcmwsCgkJCQkJCQlzdGF0ZUJlZm9yZS5uYXZpZ2F0aW9uS2V5LAoJCQkJCQkJJGVsbSR1cmwkVXJsJHRvU3RyaW5nKHVybCkpKTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIHVybCA9IHVybFJlcXVlc3QuYTsKCQkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQkJc3RhdGVCZWZvcmUsCgkJCQkJCSRlbG0kYnJvd3NlciRCcm93c2VyJE5hdmlnYXRpb24kbG9hZCh1cmwpKTsKCQkJCX0KCQl9Cgl9KTsKdmFyICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJGluaXQgPSBGMygKCWZ1bmN0aW9uIChfdjAsIHVybCwgbmF2aWdhdGlvbktleSkgewoJCXJldHVybiBBMigKCQkJJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kdXBkYXRlLAoJCQkkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRVcmxDaGFuZ2UodXJsKSwKCQkJewoJCQkJbmF2aWdhdGlvbktleTogbmF2aWdhdGlvbktleSwKCQkJCXNlbGVjdGVkUGFnZTogJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kTm90Rm91bmQoJycpCgkJCX0pOwoJfSk7CnZhciAkZWxtJGNvcmUkUGxhdGZvcm0kU3ViJGJhdGNoID0gX1BsYXRmb3JtX2JhdGNoOwp2YXIgJGVsbSRjb3JlJFBsYXRmb3JtJFN1YiRub25lID0gJGVsbSRjb3JlJFBsYXRmb3JtJFN1YiRiYXRjaChfTGlzdF9OaWwpOwp2YXIgJGVsbSRjb3JlJExpc3Qkc2luZ2xldG9uID0gZnVuY3Rpb24gKHZhbHVlKSB7CglyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCVt2YWx1ZV0pOwp9Owp2YXIgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kZ2xvYmFsU3R5bGVzSHRtbEVsZW1lbnQgPSBBMygKCSRlbG0kaHRtbCRIdG1sJG5vZGUsCgknc3R5bGUnLAoJX0xpc3RfTmlsLAoJJGVsbSRjb3JlJExpc3Qkc2luZ2xldG9uKAoJCSRlbG0kaHRtbCRIdG1sJHRleHQoJ1xuYm9keSB7XG5mb250LWZhbWlseTogXCdTZWdvZSBVSVwnLCBUYWhvbWEsIEdlbmV2YSwgVmVyZGFuYSwgc2Fucy1zZXJpZjtcbm1hcmdpbjogMWVtO1xufVxuJykpKTsKdmFyICRlbG0kaHRtbCRIdG1sJGgxID0gX1ZpcnR1YWxEb21fbm9kZSgnaDEnKTsKdmFyICRlbG0kaHRtbCRIdG1sJHByZSA9IF9WaXJ0dWFsRG9tX25vZGUoJ3ByZScpOwp2YXIgJGVsbSRjb3JlJFJlc3VsdCRhbmRUaGVuID0gRjIoCglmdW5jdGlvbiAoY2FsbGJhY2ssIHJlc3VsdCkgewoJCWlmIChyZXN1bHQuJCA9PT0gJ09rJykgewoJCQl2YXIgdmFsdWUgPSByZXN1bHQuYTsKCQkJcmV0dXJuIGNhbGxiYWNrKHZhbHVlKTsKCQl9IGVsc2UgewoJCQl2YXIgbXNnID0gcmVzdWx0LmE7CgkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycihtc2cpOwoJCX0KCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHByb2JsZW1Ub1N0cmluZyA9IGZ1bmN0aW9uIChwcm9ibGVtKSB7Cglzd2l0Y2ggKHByb2JsZW0uJCkgewoJCWNhc2UgJ0V4cGVjdGluZyc6CgkJCXZhciBzdHJpbmcgPSBwcm9ibGVtLmE7CgkJCXJldHVybiAnRXhwZWN0aW5nICcgKyBzdHJpbmc7CgkJY2FzZSAnRXhwZWN0aW5nSW50JzoKCQkJcmV0dXJuICdFeHBlY3RpbmcgaW50JzsKCQljYXNlICdFeHBlY3RpbmdIZXgnOgoJCQlyZXR1cm4gJ0V4cGVjdGluZyBoZXgnOwoJCWNhc2UgJ0V4cGVjdGluZ09jdGFsJzoKCQkJcmV0dXJuICdFeHBlY3Rpbmcgb2N0YWwnOwoJCWNhc2UgJ0V4cGVjdGluZ0JpbmFyeSc6CgkJCXJldHVybiAnRXhwZWN0aW5nIGJpbmFyeSc7CgkJY2FzZSAnRXhwZWN0aW5nRmxvYXQnOgoJCQlyZXR1cm4gJ0V4cGVjdGluZyBmbG9hdCc7CgkJY2FzZSAnRXhwZWN0aW5nTnVtYmVyJzoKCQkJcmV0dXJuICdFeHBlY3RpbmcgbnVtYmVyJzsKCQljYXNlICdFeHBlY3RpbmdWYXJpYWJsZSc6CgkJCXJldHVybiAnRXhwZWN0aW5nIHZhcmlhYmxlJzsKCQljYXNlICdFeHBlY3RpbmdTeW1ib2wnOgoJCQl2YXIgc3RyaW5nID0gcHJvYmxlbS5hOwoJCQlyZXR1cm4gJ0V4cGVjdGluZyBzeW1ib2wgJyArIHN0cmluZzsKCQljYXNlICdFeHBlY3RpbmdLZXl3b3JkJzoKCQkJdmFyIHN0cmluZyA9IHByb2JsZW0uYTsKCQkJcmV0dXJuICdFeHBlY3Rpbmcga2V5d29yZCAnICsgc3RyaW5nOwoJCWNhc2UgJ0V4cGVjdGluZ0VuZCc6CgkJCXJldHVybiAnRXhwZWN0aW5nIGtleXdvcmQgZW5kJzsKCQljYXNlICdVbmV4cGVjdGVkQ2hhcic6CgkJCXJldHVybiAnVW5leHBlY3RlZCBjaGFyJzsKCQljYXNlICdQcm9ibGVtJzoKCQkJdmFyIHByb2JsZW1EZXNjcmlwdGlvbiA9IHByb2JsZW0uYTsKCQkJcmV0dXJuIHByb2JsZW1EZXNjcmlwdGlvbjsKCQlkZWZhdWx0OgoJCQlyZXR1cm4gJ0JhZCByZXBlYXQnOwoJfQp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGRlYWRFbmRUb1N0cmluZyA9IGZ1bmN0aW9uIChkZWFkRW5kKSB7CglyZXR1cm4gJ1Byb2JsZW0gYXQgcm93ICcgKyAoJGVsbSRjb3JlJFN0cmluZyRmcm9tSW50KGRlYWRFbmQucm93KSArICgnXG4nICsgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHByb2JsZW1Ub1N0cmluZyhkZWFkRW5kLnByb2JsZW0pKSk7Cn07CnZhciAkZWxtJGh0bWwkSHRtbCRlbSA9IF9WaXJ0dWFsRG9tX25vZGUoJ2VtJyk7CnZhciAkZWxtJGh0bWwkSHRtbCRoMiA9IF9WaXJ0dWFsRG9tX25vZGUoJ2gyJyk7CnZhciAkZWxtJGh0bWwkSHRtbCRoMyA9IF9WaXJ0dWFsRG9tX25vZGUoJ2gzJyk7CnZhciAkZWxtJGh0bWwkSHRtbCRoNCA9IF9WaXJ0dWFsRG9tX25vZGUoJ2g0Jyk7CnZhciAkZWxtJGh0bWwkSHRtbCRoNSA9IF9WaXJ0dWFsRG9tX25vZGUoJ2g1Jyk7CnZhciAkZWxtJGh0bWwkSHRtbCRoNiA9IF9WaXJ0dWFsRG9tX25vZGUoJ2g2Jyk7CnZhciAkZWxtJGh0bWwkSHRtbCRociA9IF9WaXJ0dWFsRG9tX25vZGUoJ2hyJyk7CnZhciAkZWxtJGh0bWwkSHRtbCRpbWcgPSBfVmlydHVhbERvbV9ub2RlKCdpbWcnKTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEh0bWxSZW5kZXJlciRIdG1sUmVuZGVyZXIgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnSHRtbFJlbmRlcmVyJywgYTogYX07Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRIdG1sJHJlc3VsdE9yID0gRjIoCglmdW5jdGlvbiAocmEsIHJiKSB7CgkJaWYgKHJhLiQgPT09ICdFcnInKSB7CgkJCXZhciBzaW5nbGVFcnJvciA9IHJhLmE7CgkJCWlmIChyYi4kID09PSAnT2snKSB7CgkJCQl2YXIgb2tWYWx1ZSA9IHJiLmE7CgkJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPayhva1ZhbHVlKTsKCQkJfSBlbHNlIHsKCQkJCXZhciBlcnJvcnNTb0ZhciA9IHJiLmE7CgkJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRFcnIoCgkJCQkJQTIoJGVsbSRjb3JlJExpc3QkY29ucywgc2luZ2xlRXJyb3IsIGVycm9yc1NvRmFyKSk7CgkJCX0KCQl9IGVsc2UgewoJCQl2YXIgb2tWYWx1ZSA9IHJhLmE7CgkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JE9rKG9rVmFsdWUpOwoJCX0KCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSHRtbCRhdHRyaWJ1dGVzVG9TdHJpbmcgPSBmdW5jdGlvbiAoYXR0cmlidXRlcykgewoJcmV0dXJuIEEyKAoJCSRlbG0kY29yZSRTdHJpbmckam9pbiwKCQknICcsCgkJQTIoCgkJCSRlbG0kY29yZSRMaXN0JG1hcCwKCQkJZnVuY3Rpb24gKF92MCkgewoJCQkJdmFyIG5hbWUgPSBfdjAubmFtZTsKCQkJCXZhciB2YWx1ZSA9IF92MC52YWx1ZTsKCQkJCXJldHVybiBuYW1lICsgKCc9XCInICsgKHZhbHVlICsgJ1wiJykpOwoJCQl9LAoJCQlhdHRyaWJ1dGVzKSk7Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRIdG1sJHRhZ1RvU3RyaW5nID0gRjIoCglmdW5jdGlvbiAodGFnTmFtZSwgYXR0cmlidXRlcykgewoJCXJldHVybiAkZWxtJGNvcmUkTGlzdCRpc0VtcHR5KGF0dHJpYnV0ZXMpID8gKCc8JyArICh0YWdOYW1lICsgJz4nKSkgOiAoJzwnICsgKHRhZ05hbWUgKyAoJyAnICsgKCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEh0bWwkYXR0cmlidXRlc1RvU3RyaW5nKGF0dHJpYnV0ZXMpICsgJz4nKSkpKTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSHRtbCRvbmVPZiA9IGZ1bmN0aW9uIChkZWNvZGVycykgewoJdmFyIHVud3JhcHBlZERlY29kZXJzID0gQTIoCgkJJGVsbSRjb3JlJExpc3QkbWFwLAoJCWZ1bmN0aW9uIChfdjEpIHsKCQkJdmFyIHJhd0RlY29kZXIgPSBfdjEuYTsKCQkJcmV0dXJuIHJhd0RlY29kZXI7CgkJfSwKCQlkZWNvZGVycyk7CglyZXR1cm4gZnVuY3Rpb24gKHJhd0RlY29kZXIpIHsKCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSHRtbFJlbmRlcmVyJEh0bWxSZW5kZXJlcigKCQkJRjMoCgkJCQlmdW5jdGlvbiAodGFnTmFtZSwgYXR0cmlidXRlcywgaW5uZXJCbG9ja3MpIHsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kY29yZSRSZXN1bHQkbWFwRXJyb3IsCgkJCQkJCWZ1bmN0aW9uIChlcnJvcnMpIHsKCQkJCQkJCWlmICghZXJyb3JzLmIpIHsKCQkJCQkJCQlyZXR1cm4gJ1JhbiBpbnRvIGEgb25lT2Ygd2l0aCBubyBwb3NzaWJpbGl0aWVzISc7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWlmICghZXJyb3JzLmIuYikgewoJCQkJCQkJCQl2YXIgc2luZ2xlRXJyb3IgPSBlcnJvcnMuYTsKCQkJCQkJCQkJcmV0dXJuICdQcm9ibGVtIHdpdGggdGhlIGdpdmVuIHZhbHVlOlxuXG4nICsgKEEyKCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEh0bWwkdGFnVG9TdHJpbmcsIHRhZ05hbWUsIGF0dHJpYnV0ZXMpICsgKCdcblxuJyArIChzaW5nbGVFcnJvciArICdcbicpKSk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJcmV0dXJuICdvbmVPZiBmYWlsZWQgcGFyc2luZyB0aGlzIHZhbHVlOlxuICAgICcgKyAoQTIoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSHRtbCR0YWdUb1N0cmluZywgdGFnTmFtZSwgYXR0cmlidXRlcykgKyAoJ1xuXG5QYXJzaW5nIGZhaWxlZCBpbiB0aGUgZm9sbG93aW5nIDIgd2F5czpcblxuXG4nICsgKEEyKAoJCQkJCQkJCQkJJGVsbSRjb3JlJFN0cmluZyRqb2luLAoJCQkJCQkJCQkJJ1xuXG4nLAoJCQkJCQkJCQkJQTIoCgkJCQkJCQkJCQkJJGVsbSRjb3JlJExpc3QkaW5kZXhlZE1hcCwKCQkJCQkJCQkJCQlGMigKCQkJCQkJCQkJCQkJZnVuY3Rpb24gKGluZGV4LCBlcnJvcikgewoJCQkJCQkJCQkJCQkJcmV0dXJuICcoJyArICgkZWxtJGNvcmUkU3RyaW5nJGZyb21JbnQoaW5kZXggKyAxKSArICgnKSAnICsgZXJyb3IpKTsKCQkJCQkJCQkJCQkJfSksCgkJCQkJCQkJCQkJZXJyb3JzKSkgKyAnXG4nKSkpOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSwKCQkJCQkJQTMocmF3RGVjb2RlciwgdGFnTmFtZSwgYXR0cmlidXRlcywgaW5uZXJCbG9ja3MpKTsKCQkJCX0pKTsKCX0oCgkJQTMoCgkJCSRlbG0kY29yZSRMaXN0JGZvbGRsLAoJCQlGMigKCQkJCWZ1bmN0aW9uIChkZWNvZGVyLCBzb0ZhcikgewoJCQkJCXJldHVybiBGMygKCQkJCQkJZnVuY3Rpb24gKHRhZ05hbWUsIGF0dHJpYnV0ZXMsIGNoaWxkcmVuKSB7CgkJCQkJCQlyZXR1cm4gQTIoCgkJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSHRtbCRyZXN1bHRPciwKCQkJCQkJCQlBMyhkZWNvZGVyLCB0YWdOYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbiksCgkJCQkJCQkJQTMoc29GYXIsIHRhZ05hbWUsIGF0dHJpYnV0ZXMsIGNoaWxkcmVuKSk7CgkJCQkJCX0pOwoJCQkJfSksCgkJCUYzKAoJCQkJZnVuY3Rpb24gKHRhZ05hbWUsIGF0dHJpYnV0ZXMsIGNoaWxkcmVuKSB7CgkJCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKF9MaXN0X05pbCk7CgkJCQl9KSwKCQkJdW53cmFwcGVkRGVjb2RlcnMpKTsKfTsKdmFyICRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3JjID0gZnVuY3Rpb24gKHVybCkgewoJcmV0dXJuIEEyKAoJCSRlbG0kaHRtbCRIdG1sJEF0dHJpYnV0ZXMkc3RyaW5nUHJvcGVydHksCgkJJ3NyYycsCgkJX1ZpcnR1YWxEb21fbm9KYXZhU2NyaXB0T3JIdG1sVXJpKHVybCkpOwp9Owp2YXIgJGVsbSRodG1sJEh0bWwkc3Ryb25nID0gX1ZpcnR1YWxEb21fbm9kZSgnc3Ryb25nJyk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkZGVmYXVsdEh0bWxSZW5kZXJlciA9IHsKCWJvbGQ6IGZ1bmN0aW9uIChjb250ZW50KSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGh0bWwkSHRtbCRzdHJvbmcsCgkJCV9MaXN0X05pbCwKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoY29udGVudCkKCQkJCV0pKTsKCX0sCgljb2RlOiBmdW5jdGlvbiAoY29udGVudCkgewoJCXJldHVybiBBMigKCQkJJGVsbSRodG1sJEh0bWwkY29kZSwKCQkJX0xpc3RfTmlsLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dChjb250ZW50KQoJCQkJXSkpOwoJfSwKCWNvZGVCbG9jazogZnVuY3Rpb24gKF92MCkgewoJCXZhciBib2R5ID0gX3YwLmJvZHk7CgkJdmFyIGxhbmd1YWdlID0gX3YwLmxhbmd1YWdlOwoJCXJldHVybiBBMigKCQkJJGVsbSRodG1sJEh0bWwkcHJlLAoJCQlfTGlzdF9OaWwsCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRjb2RlLAoJCQkJCV9MaXN0X05pbCwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoYm9keSkKCQkJCQkJXSkpCgkJCQldKSk7Cgl9LAoJaGVhZGluZzogZnVuY3Rpb24gKF92MSkgewoJCXZhciBsZXZlbCA9IF92MS5sZXZlbDsKCQl2YXIgY2hpbGRyZW4gPSBfdjEuY2hpbGRyZW47CgkJc3dpdGNoIChsZXZlbCkgewoJCQljYXNlIDE6CgkJCQlyZXR1cm4gQTIoJGVsbSRodG1sJEh0bWwkaDEsIF9MaXN0X05pbCwgY2hpbGRyZW4pOwoJCQljYXNlIDI6CgkJCQlyZXR1cm4gQTIoJGVsbSRodG1sJEh0bWwkaDIsIF9MaXN0X05pbCwgY2hpbGRyZW4pOwoJCQljYXNlIDM6CgkJCQlyZXR1cm4gQTIoJGVsbSRodG1sJEh0bWwkaDMsIF9MaXN0X05pbCwgY2hpbGRyZW4pOwoJCQljYXNlIDQ6CgkJCQlyZXR1cm4gQTIoJGVsbSRodG1sJEh0bWwkaDQsIF9MaXN0X05pbCwgY2hpbGRyZW4pOwoJCQljYXNlIDU6CgkJCQlyZXR1cm4gQTIoJGVsbSRodG1sJEh0bWwkaDUsIF9MaXN0X05pbCwgY2hpbGRyZW4pOwoJCQljYXNlIDY6CgkJCQlyZXR1cm4gQTIoJGVsbSRodG1sJEh0bWwkaDYsIF9MaXN0X05pbCwgY2hpbGRyZW4pOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICRlbG0kaHRtbCRIdG1sJHRleHQoJ1RPRE8gbWF5ZSB1c2UgYSB0eXBlIGhlcmUgdG8gY2xlYW4gaXQgdXAuLi4gdGhpcyB3aWxsIG5ldmVyIGhhcHBlbicpOwoJCX0KCX0sCglodG1sOiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRIdG1sJG9uZU9mKF9MaXN0X05pbCksCglpbWFnZTogRjIoCgkJZnVuY3Rpb24gKGltYWdlLCBjb250ZW50KSB7CgkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JE9rKAoJCQkJQTIoCgkJCQkJJGVsbSRodG1sJEh0bWwkaW1nLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzcmMoaW1hZ2Uuc3JjKQoJCQkJCQldKSwKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoY29udGVudCkKCQkJCQkJXSkpKTsKCQl9KSwKCWl0YWxpYzogZnVuY3Rpb24gKGNvbnRlbnQpIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kaHRtbCRIdG1sJGVtLAoJCQlfTGlzdF9OaWwsCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQkkZWxtJGh0bWwkSHRtbCR0ZXh0KGNvbnRlbnQpCgkJCQldKSk7Cgl9LAoJbGluazogRjIoCgkJZnVuY3Rpb24gKGxpbmssIGNvbnRlbnQpIHsKCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkT2soCgkJCQlBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRhLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRocmVmKGxpbmsuZGVzdGluYXRpb24pCgkJCQkJCV0pLAoJCQkJCWNvbnRlbnQpKTsKCQl9KSwKCWxpc3Q6IGZ1bmN0aW9uIChpdGVtcykgewoJCXJldHVybiBBMigKCQkJJGVsbSRodG1sJEh0bWwkdWwsCgkJCV9MaXN0X05pbCwKCQkJQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRtYXAsCgkJCQlmdW5jdGlvbiAoaXRlbUJsb2NrcykgewoJCQkJCXJldHVybiBBMigKCQkJCQkJJGVsbSRodG1sJEh0bWwkbGksCgkJCQkJCV9MaXN0X05pbCwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJW2l0ZW1CbG9ja3NdKSk7CgkJCQl9LAoJCQkJaXRlbXMpKTsKCX0sCglwbGFpbjogJGVsbSRodG1sJEh0bWwkdGV4dCwKCXJhdzogJGVsbSRodG1sJEh0bWwkcChfTGlzdF9OaWwpLAoJdGhlbWF0aWNCcmVhazogQTIoJGVsbSRodG1sJEh0bWwkaHIsIF9MaXN0X05pbCwgX0xpc3RfTmlsKQp9Owp2YXIgJGVsbV9jb21tdW5pdHkkcmVzdWx0X2V4dHJhJFJlc3VsdCRFeHRyYSRleHRyYWN0ID0gRjIoCglmdW5jdGlvbiAoZiwgeCkgewoJCWlmICh4LiQgPT09ICdPaycpIHsKCQkJdmFyIGEgPSB4LmE7CgkJCXJldHVybiBhOwoJCX0gZWxzZSB7CgkJCXZhciBlID0geC5hOwoJCQlyZXR1cm4gZihlKTsKCQl9Cgl9KTsKdmFyICRhdXRob3IkcHJvamVjdCRDb21tb24kZGVzY3JpYmVBcHAgPSAnVGhpcyBleGFtcGxlIGFwcCBkZW1vbnN0cmF0ZXMgaG93IEVsbSB2YWx1ZXMgYXJlIHNlcmlhbGl6ZWQgYW5kIGRlc2VyaWFsaXplZCBhdXRvbWF0aWNhbGx5LiBIYXZlIGEgbG9vayBhdCBcJy9hcGkvZWxtLWFwcC1zdGF0ZVwnIG9uIHRoZSBhZG1pbiBpbnRlcmZhY2UgcG9ydCB0byBzZWUgdGhlIGNhbm9uaWNhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY3VycmVudCBiYWNrZW5kIHN0YXRlLiBZb3UgY2FuIGFsc28gY2hhbmdlIHRoZSBiYWNrZW5kIHN0YXRlIGJ5IHNlbmRpbmcgYSBcJ1BPU1RcJyBIVFRQIHJlcXVlc3QuJzsKdmFyICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJGd1aWRlTWFya2Rvd24gPSAkYXV0aG9yJHByb2plY3QkQ29tbW9uJGRlc2NyaWJlQXBwOwp2YXIgJGVsbSRjb3JlJFJlc3VsdCRtYXAgPSBGMigKCWZ1bmN0aW9uIChmdW5jLCByYSkgewoJCWlmIChyYS4kID09PSAnT2snKSB7CgkJCXZhciBhID0gcmEuYTsKCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkT2soCgkJCQlmdW5jKGEpKTsKCQl9IGVsc2UgewoJCQl2YXIgZSA9IHJhLmE7CgkJCXJldHVybiAkZWxtJGNvcmUkUmVzdWx0JEVycihlKTsKCQl9Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEJsb2NrJEJvZHkgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnQm9keScsIGE6IGF9Owp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJEJvZHkgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnQm9keScsIGE6IGF9Owp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJENvZGVCbG9jayA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdDb2RlQmxvY2snLCBhOiBhfTsKfTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCREb25lID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ0RvbmUnLCBhOiBhfTsKfTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmcgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnRXhwZWN0aW5nJywgYTogYX07Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRCbG9jayRIdG1sID0gRjMoCglmdW5jdGlvbiAoYSwgYiwgYykgewoJCXJldHVybiB7JDogJ0h0bWwnLCBhOiBhLCBiOiBiLCBjOiBjfTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJEh0bWwgPSBGMygKCWZ1bmN0aW9uIChhLCBiLCBjKSB7CgkJcmV0dXJuIHskOiAnSHRtbCcsIGE6IGEsIGI6IGIsIGM6IGN9OwoJfSk7CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkTG9vcCA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdMb29wJywgYTogYX07Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkVW5wYXJzZWRJbmxpbmVzID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ1VucGFyc2VkSW5saW5lcycsIGE6IGF9Owp9Owp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEJhZCA9IEYyKAoJZnVuY3Rpb24gKGEsIGIpIHsKCQlyZXR1cm4geyQ6ICdCYWQnLCBhOiBhLCBiOiBifTsKCX0pOwp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEdvb2QgPSBGMygKCWZ1bmN0aW9uIChhLCBiLCBjKSB7CgkJcmV0dXJuIHskOiAnR29vZCcsIGE6IGEsIGI6IGIsIGM6IGN9OwoJfSk7CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkUGFyc2VyID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ1BhcnNlcicsIGE6IGF9Owp9Owp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGFuZFRoZW4gPSBGMigKCWZ1bmN0aW9uIChjYWxsYmFjaywgX3YwKSB7CgkJdmFyIHBhcnNlQSA9IF92MC5hOwoJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkUGFyc2VyKAoJCQlmdW5jdGlvbiAoczApIHsKCQkJCXZhciBfdjEgPSBwYXJzZUEoczApOwoJCQkJaWYgKF92MS4kID09PSAnQmFkJykgewoJCQkJCXZhciBwID0gX3YxLmE7CgkJCQkJdmFyIHggPSBfdjEuYjsKCQkJCQlyZXR1cm4gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEJhZCwgcCwgeCk7CgkJCQl9IGVsc2UgewoJCQkJCXZhciBwMSA9IF92MS5hOwoJCQkJCXZhciBhID0gX3YxLmI7CgkJCQkJdmFyIHMxID0gX3YxLmM7CgkJCQkJdmFyIF92MiA9IGNhbGxiYWNrKGEpOwoJCQkJCXZhciBwYXJzZUIgPSBfdjIuYTsKCQkJCQl2YXIgX3YzID0gcGFyc2VCKHMxKTsKCQkJCQlpZiAoX3YzLiQgPT09ICdCYWQnKSB7CgkJCQkJCXZhciBwMiA9IF92My5hOwoJCQkJCQl2YXIgeCA9IF92My5iOwoJCQkJCQlyZXR1cm4gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEJhZCwgcDEgfHwgcDIsIHgpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXZhciBwMiA9IF92My5hOwoJCQkJCQl2YXIgYiA9IF92My5iOwoJCQkJCQl2YXIgczIgPSBfdjMuYzsKCQkJCQkJcmV0dXJuIEEzKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRHb29kLCBwMSB8fCBwMiwgYiwgczIpOwoJCQkJCX0KCQkJCX0KCQkJfSk7Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRCbGFua0xpbmUgPSB7JDogJ0JsYW5rTGluZSd9Owp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuID0gRjIoCglmdW5jdGlvbiAoYSwgYikgewoJCXJldHVybiB7JDogJ1Rva2VuJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpc1N1YkNoYXIgPSBfUGFyc2VyX2lzU3ViQ2hhcjsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFdoaWxlSGVscCA9IEY1KAoJZnVuY3Rpb24gKGlzR29vZCwgb2Zmc2V0LCByb3csIGNvbCwgczApIHsKCQljaG9tcFdoaWxlSGVscDoKCQl3aGlsZSAodHJ1ZSkgewoJCQl2YXIgbmV3T2Zmc2V0ID0gQTMoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlzU3ViQ2hhciwgaXNHb29kLCBvZmZzZXQsIHMwLnNyYyk7CgkJCWlmIChfVXRpbHNfZXEobmV3T2Zmc2V0LCAtMSkpIHsKCQkJCXJldHVybiBBMygKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkR29vZCwKCQkJCQlfVXRpbHNfY21wKHMwLm9mZnNldCwgb2Zmc2V0KSA8IDAsCgkJCQkJX1V0aWxzX1R1cGxlMCwKCQkJCQl7Y29sOiBjb2wsIGNvbnRleHQ6IHMwLmNvbnRleHQsIGluZGVudDogczAuaW5kZW50LCBvZmZzZXQ6IG9mZnNldCwgcm93OiByb3csIHNyYzogczAuc3JjfSk7CgkJCX0gZWxzZSB7CgkJCQlpZiAoX1V0aWxzX2VxKG5ld09mZnNldCwgLTIpKSB7CgkJCQkJdmFyICR0ZW1wJGlzR29vZCA9IGlzR29vZCwKCQkJCQkJJHRlbXAkb2Zmc2V0ID0gb2Zmc2V0ICsgMSwKCQkJCQkJJHRlbXAkcm93ID0gcm93ICsgMSwKCQkJCQkJJHRlbXAkY29sID0gMSwKCQkJCQkJJHRlbXAkczAgPSBzMDsKCQkJCQlpc0dvb2QgPSAkdGVtcCRpc0dvb2Q7CgkJCQkJb2Zmc2V0ID0gJHRlbXAkb2Zmc2V0OwoJCQkJCXJvdyA9ICR0ZW1wJHJvdzsKCQkJCQljb2wgPSAkdGVtcCRjb2w7CgkJCQkJczAgPSAkdGVtcCRzMDsKCQkJCQljb250aW51ZSBjaG9tcFdoaWxlSGVscDsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyICR0ZW1wJGlzR29vZCA9IGlzR29vZCwKCQkJCQkJJHRlbXAkb2Zmc2V0ID0gbmV3T2Zmc2V0LAoJCQkJCQkkdGVtcCRyb3cgPSByb3csCgkJCQkJCSR0ZW1wJGNvbCA9IGNvbCArIDEsCgkJCQkJCSR0ZW1wJHMwID0gczA7CgkJCQkJaXNHb29kID0gJHRlbXAkaXNHb29kOwoJCQkJCW9mZnNldCA9ICR0ZW1wJG9mZnNldDsKCQkJCQlyb3cgPSAkdGVtcCRyb3c7CgkJCQkJY29sID0gJHRlbXAkY29sOwoJCQkJCXMwID0gJHRlbXAkczA7CgkJCQkJY29udGludWUgY2hvbXBXaGlsZUhlbHA7CgkJCQl9CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFdoaWxlID0gZnVuY3Rpb24gKGlzR29vZCkgewoJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRQYXJzZXIoCgkJZnVuY3Rpb24gKHMpIHsKCQkJcmV0dXJuIEE1KCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFdoaWxlSGVscCwgaXNHb29kLCBzLm9mZnNldCwgcy5yb3csIHMuY29sLCBzKTsKCQl9KTsKfTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAyID0gRjMoCglmdW5jdGlvbiAoZnVuYywgX3YwLCBfdjEpIHsKCQl2YXIgcGFyc2VBID0gX3YwLmE7CgkJdmFyIHBhcnNlQiA9IF92MS5hOwoJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkUGFyc2VyKAoJCQlmdW5jdGlvbiAoczApIHsKCQkJCXZhciBfdjIgPSBwYXJzZUEoczApOwoJCQkJaWYgKF92Mi4kID09PSAnQmFkJykgewoJCQkJCXZhciBwID0gX3YyLmE7CgkJCQkJdmFyIHggPSBfdjIuYjsKCQkJCQlyZXR1cm4gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEJhZCwgcCwgeCk7CgkJCQl9IGVsc2UgewoJCQkJCXZhciBwMSA9IF92Mi5hOwoJCQkJCXZhciBhID0gX3YyLmI7CgkJCQkJdmFyIHMxID0gX3YyLmM7CgkJCQkJdmFyIF92MyA9IHBhcnNlQihzMSk7CgkJCQkJaWYgKF92My4kID09PSAnQmFkJykgewoJCQkJCQl2YXIgcDIgPSBfdjMuYTsKCQkJCQkJdmFyIHggPSBfdjMuYjsKCQkJCQkJcmV0dXJuIEEyKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRCYWQsIHAxIHx8IHAyLCB4KTsKCQkJCQl9IGVsc2UgewoJCQkJCQl2YXIgcDIgPSBfdjMuYTsKCQkJCQkJdmFyIGIgPSBfdjMuYjsKCQkJCQkJdmFyIHMyID0gX3YzLmM7CgkJCQkJCXJldHVybiBBMygKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRHb29kLAoJCQkJCQkJcDEgfHwgcDIsCgkJCQkJCQlBMihmdW5jLCBhLCBiKSwKCQkJCQkJCXMyKTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJfSk7CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciA9IEYyKAoJZnVuY3Rpb24gKGtlZXBQYXJzZXIsIGlnbm9yZVBhcnNlcikgewoJCXJldHVybiBBMygkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbWFwMiwgJGVsbSRjb3JlJEJhc2ljcyRhbHdheXMsIGtlZXBQYXJzZXIsIGlnbm9yZVBhcnNlcik7Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAgPSBGMigKCWZ1bmN0aW9uIChmdW5jLCBfdjApIHsKCQl2YXIgcGFyc2UgPSBfdjAuYTsKCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFBhcnNlcigKCQkJZnVuY3Rpb24gKHMwKSB7CgkJCQl2YXIgX3YxID0gcGFyc2UoczApOwoJCQkJaWYgKF92MS4kID09PSAnR29vZCcpIHsKCQkJCQl2YXIgcCA9IF92MS5hOwoJCQkJCXZhciBhID0gX3YxLmI7CgkJCQkJdmFyIHMxID0gX3YxLmM7CgkJCQkJcmV0dXJuIEEzKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkR29vZCwKCQkJCQkJcCwKCQkJCQkJZnVuYyhhKSwKCQkJCQkJczEpOwoJCQkJfSBlbHNlIHsKCQkJCQl2YXIgcCA9IF92MS5hOwoJCQkJCXZhciB4ID0gX3YxLmI7CgkJCQkJcmV0dXJuIEEyKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRCYWQsIHAsIHgpOwoJCQkJfQoJCQl9KTsKCX0pOwp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEFkZFJpZ2h0ID0gRjIoCglmdW5jdGlvbiAoYSwgYikgewoJCXJldHVybiB7JDogJ0FkZFJpZ2h0JywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCREZWFkRW5kID0gRjQoCglmdW5jdGlvbiAocm93LCBjb2wsIHByb2JsZW0sIGNvbnRleHRTdGFjaykgewoJCXJldHVybiB7Y29sOiBjb2wsIGNvbnRleHRTdGFjazogY29udGV4dFN0YWNrLCBwcm9ibGVtOiBwcm9ibGVtLCByb3c6IHJvd307Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRFbXB0eSA9IHskOiAnRW1wdHknfTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRmcm9tU3RhdGUgPSBGMigKCWZ1bmN0aW9uIChzLCB4KSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkQWRkUmlnaHQsCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRFbXB0eSwKCQkJQTQoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJERlYWRFbmQsIHMucm93LCBzLmNvbCwgeCwgcy5jb250ZXh0KSk7Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpc1N1YlN0cmluZyA9IF9QYXJzZXJfaXNTdWJTdHJpbmc7CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkdG9rZW4gPSBmdW5jdGlvbiAoX3YwKSB7Cgl2YXIgc3RyID0gX3YwLmE7Cgl2YXIgZXhwZWN0aW5nID0gX3YwLmI7Cgl2YXIgcHJvZ3Jlc3MgPSAhJGVsbSRjb3JlJFN0cmluZyRpc0VtcHR5KHN0cik7CglyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFBhcnNlcigKCQlmdW5jdGlvbiAocykgewoJCQl2YXIgX3YxID0gQTUoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlzU3ViU3RyaW5nLCBzdHIsIHMub2Zmc2V0LCBzLnJvdywgcy5jb2wsIHMuc3JjKTsKCQkJdmFyIG5ld09mZnNldCA9IF92MS5hOwoJCQl2YXIgbmV3Um93ID0gX3YxLmI7CgkJCXZhciBuZXdDb2wgPSBfdjEuYzsKCQkJcmV0dXJuIF9VdGlsc19lcShuZXdPZmZzZXQsIC0xKSA/IEEyKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEJhZCwKCQkJCWZhbHNlLAoJCQkJQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGZyb21TdGF0ZSwgcywgZXhwZWN0aW5nKSkgOiBBMygKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRHb29kLAoJCQkJcHJvZ3Jlc3MsCgkJCQlfVXRpbHNfVHVwbGUwLAoJCQkJe2NvbDogbmV3Q29sLCBjb250ZXh0OiBzLmNvbnRleHQsIGluZGVudDogcy5pbmRlbnQsIG9mZnNldDogbmV3T2Zmc2V0LCByb3c6IG5ld1Jvdywgc3JjOiBzLnNyY30pOwoJCX0pOwp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGJsYW5rTGluZSA9IEEyKAoJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG1hcCwKCWZ1bmN0aW9uIChfdjApIHsKCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJEJsYW5rTGluZTsKCX0sCglBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkdG9rZW4oCgkJCUEyKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJJ1xuJywKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmcoJ1xuJykpKSwKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBXaGlsZSgKCQkJZnVuY3Rpb24gKGMpIHsKCQkJCXJldHVybiBfVXRpbHNfZXEoCgkJCQkJYywKCQkJCQlfVXRpbHNfY2hyKCdcbicpKTsKCQkJfSkpKTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkUGFyc2VyKAoJCWZ1bmN0aW9uIChzKSB7CgkJCXJldHVybiBBMygkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkR29vZCwgZmFsc2UsIGEsIHMpOwoJCX0pOwp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGNvbWJpbmUgPSBmdW5jdGlvbiAobGlzdCkgewoJcmV0dXJuIEEzKAoJCSRlbG0kY29yZSRMaXN0JGZvbGRsLAoJCUYyKAoJCQlmdW5jdGlvbiAocGFyc2VyLCBsaXN0UGFyc2VyKSB7CgkJCQlyZXR1cm4gQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGFuZFRoZW4sCgkJCQkJZnVuY3Rpb24gKHNvRmFyKSB7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCQkJCQlmdW5jdGlvbiAoYSkgewoJCQkJCQkJCXJldHVybiBBMigkZWxtJGNvcmUkTGlzdCRjb25zLCBhLCBzb0Zhcik7CgkJCQkJCQl9LAoJCQkJCQkJcGFyc2VyKTsKCQkJCQl9LAoJCQkJCWxpc3RQYXJzZXIpOwoJCQl9KSwKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChfTGlzdF9OaWwpLAoJCWxpc3QpOwp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJEVsZW1lbnQgPSBGMygKCWZ1bmN0aW9uIChhLCBiLCBjKSB7CgkJcmV0dXJuIHskOiAnRWxlbWVudCcsIGE6IGEsIGI6IGIsIGM6IGN9OwoJfSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkVGV4dCA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdUZXh0JywgYTogYX07Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkQXR0cmlidXRlID0gRjIoCglmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHsKCQlyZXR1cm4ge25hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZX07Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRMb2NhdGVkID0gRjMoCglmdW5jdGlvbiAocm93LCBjb2wsIGNvbnRleHQpIHsKCQlyZXR1cm4ge2NvbDogY29sLCBjb250ZXh0OiBjb250ZXh0LCByb3c6IHJvd307Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaGFuZ2VDb250ZXh0ID0gRjIoCglmdW5jdGlvbiAobmV3Q29udGV4dCwgcykgewoJCXJldHVybiB7Y29sOiBzLmNvbCwgY29udGV4dDogbmV3Q29udGV4dCwgaW5kZW50OiBzLmluZGVudCwgb2Zmc2V0OiBzLm9mZnNldCwgcm93OiBzLnJvdywgc3JjOiBzLnNyY307Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpbkNvbnRleHQgPSBGMigKCWZ1bmN0aW9uIChjb250ZXh0LCBfdjApIHsKCQl2YXIgcGFyc2UgPSBfdjAuYTsKCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFBhcnNlcigKCQkJZnVuY3Rpb24gKHMwKSB7CgkJCQl2YXIgX3YxID0gcGFyc2UoCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaGFuZ2VDb250ZXh0LAoJCQkJCQlBMigKCQkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCQlBMygkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkTG9jYXRlZCwgczAucm93LCBzMC5jb2wsIGNvbnRleHQpLAoJCQkJCQkJczAuY29udGV4dCksCgkJCQkJCXMwKSk7CgkJCQlpZiAoX3YxLiQgPT09ICdHb29kJykgewoJCQkJCXZhciBwID0gX3YxLmE7CgkJCQkJdmFyIGEgPSBfdjEuYjsKCQkJCQl2YXIgczEgPSBfdjEuYzsKCQkJCQlyZXR1cm4gQTMoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRHb29kLAoJCQkJCQlwLAoJCQkJCQlhLAoJCQkJCQlBMigkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hhbmdlQ29udGV4dCwgczAuY29udGV4dCwgczEpKTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIHN0ZXAgPSBfdjE7CgkJCQkJcmV0dXJuIHN0ZXA7CgkJCQl9CgkJCX0pOwoJfSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkaXNXaGl0ZXNwYWNlID0gZnVuY3Rpb24gKGMpIHsKCXJldHVybiBfVXRpbHNfZXEoCgkJYywKCQlfVXRpbHNfY2hyKCcgJykpIHx8IChfVXRpbHNfZXEoCgkJYywKCQlfVXRpbHNfY2hyKCdcdTAwMEQnKSkgfHwgKF9VdGlsc19lcSgKCQljLAoJCV9VdGlsc19jaHIoJ1xuJykpIHx8IF9VdGlsc19lcSgKCQljLAoJCV9VdGlsc19jaHIoJ1x0JykpKSk7Cn07CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQmFkUmVwZWF0ID0geyQ6ICdCYWRSZXBlYXQnfTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXBDaG9tcGVkU3RyaW5nID0gRjIoCglmdW5jdGlvbiAoZnVuYywgX3YwKSB7CgkJdmFyIHBhcnNlID0gX3YwLmE7CgkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRQYXJzZXIoCgkJCWZ1bmN0aW9uIChzMCkgewoJCQkJdmFyIF92MSA9IHBhcnNlKHMwKTsKCQkJCWlmIChfdjEuJCA9PT0gJ0JhZCcpIHsKCQkJCQl2YXIgcCA9IF92MS5hOwoJCQkJCXZhciB4ID0gX3YxLmI7CgkJCQkJcmV0dXJuIEEyKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRCYWQsIHAsIHgpOwoJCQkJfSBlbHNlIHsKCQkJCQl2YXIgcCA9IF92MS5hOwoJCQkJCXZhciBhID0gX3YxLmI7CgkJCQkJdmFyIHMxID0gX3YxLmM7CgkJCQkJcmV0dXJuIEEzKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkR29vZCwKCQkJCQkJcCwKCQkJCQkJQTIoCgkJCQkJCQlmdW5jLAoJCQkJCQkJQTMoJGVsbSRjb3JlJFN0cmluZyRzbGljZSwgczAub2Zmc2V0LCBzMS5vZmZzZXQsIHMwLnNyYyksCgkJCQkJCQlhKSwKCQkJCQkJczEpOwoJCQkJfQoJCQl9KTsKCX0pOwp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGdldENob21wZWRTdHJpbmcgPSBmdW5jdGlvbiAocGFyc2VyKSB7CglyZXR1cm4gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG1hcENob21wZWRTdHJpbmcsICRlbG0kY29yZSRCYXNpY3MkYWx3YXlzLCBwYXJzZXIpOwp9Owp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHByb2JsZW0gPSBmdW5jdGlvbiAoeCkgewoJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRQYXJzZXIoCgkJZnVuY3Rpb24gKHMpIHsKCQkJcmV0dXJuIEEyKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEJhZCwKCQkJCWZhbHNlLAoJCQkJQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGZyb21TdGF0ZSwgcywgeCkpOwoJCX0pOwp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGtlZXAgPSBGMigKCWZ1bmN0aW9uIChjb3VudCwgcHJlZGljYXRlKSB7CgkJdmFyIG4gPSBjb3VudC5hOwoJCXJldHVybiBBMigKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGFuZFRoZW4sCgkJCWZ1bmN0aW9uIChzdHIpIHsKCQkJCXJldHVybiAoX1V0aWxzX2NtcCgKCQkJCQluLAoJCQkJCSRlbG0kY29yZSRTdHJpbmckbGVuZ3RoKHN0cikpIDwgMSkgPyAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChzdHIpIDogJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHByb2JsZW0oJGVsbSRwYXJzZXIkUGFyc2VyJEJhZFJlcGVhdCk7CgkJCX0sCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRDaG9tcGVkU3RyaW5nKAoJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoX1V0aWxzX1R1cGxlMCksCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wV2hpbGUocHJlZGljYXRlKSkpKTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJEF0TGVhc3QgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnQXRMZWFzdCcsIGE6IGF9Owp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJG9uZU9yTW9yZSA9ICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRBdExlYXN0KDEpOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGF0dHJpYnV0ZU5hbWUgPSBBMigKCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpbkNvbnRleHQsCgknYXR0cmlidXRlTmFtZScsCglBMigKCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIka2VlcCwKCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkb25lT3JNb3JlLAoJCWZ1bmN0aW9uIChjKSB7CgkJCXJldHVybiAoISRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRpc1doaXRlc3BhY2UoYykpICYmICgoIV9VdGlsc19lcSgKCQkJCWMsCgkJCQlfVXRpbHNfY2hyKCcvJykpKSAmJiAoKCFfVXRpbHNfZXEoCgkJCQljLAoJCQkJX1V0aWxzX2NocignPCcpKSkgJiYgKCghX1V0aWxzX2VxKAoJCQkJYywKCQkJCV9VdGlsc19jaHIoJz4nKSkpICYmICgoIV9VdGlsc19lcSgKCQkJCWMsCgkJCQlfVXRpbHNfY2hyKCdcIicpKSkgJiYgKCghX1V0aWxzX2VxKAoJCQkJYywKCQkJCV9VdGlsc19jaHIoJ1wnJykpKSAmJiAoIV9VdGlsc19lcSgKCQkJCWMsCgkJCQlfVXRpbHNfY2hyKCc9JykpKSkpKSkpOwoJCX0pKTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIgPSBGMigKCWZ1bmN0aW9uIChwYXJzZUZ1bmMsIHBhcnNlQXJnKSB7CgkJcmV0dXJuIEEzKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAyLCAkZWxtJGNvcmUkQmFzaWNzJGFwTCwgcGFyc2VGdW5jLCBwYXJzZUFyZyk7Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRBcHBlbmQgPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnQXBwZW5kJywgYTogYSwgYjogYn07Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZkhlbHAgPSBGMygKCWZ1bmN0aW9uIChzMCwgYmFnLCBwYXJzZXJzKSB7CgkJb25lT2ZIZWxwOgoJCXdoaWxlICh0cnVlKSB7CgkJCWlmICghcGFyc2Vycy5iKSB7CgkJCQlyZXR1cm4gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEJhZCwgZmFsc2UsIGJhZyk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgcGFyc2UgPSBwYXJzZXJzLmEuYTsKCQkJCXZhciByZW1haW5pbmdQYXJzZXJzID0gcGFyc2Vycy5iOwoJCQkJdmFyIF92MSA9IHBhcnNlKHMwKTsKCQkJCWlmIChfdjEuJCA9PT0gJ0dvb2QnKSB7CgkJCQkJdmFyIHN0ZXAgPSBfdjE7CgkJCQkJcmV0dXJuIHN0ZXA7CgkJCQl9IGVsc2UgewoJCQkJCXZhciBzdGVwID0gX3YxOwoJCQkJCXZhciBwID0gc3RlcC5hOwoJCQkJCXZhciB4ID0gc3RlcC5iOwoJCQkJCWlmIChwKSB7CgkJCQkJCXJldHVybiBzdGVwOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXZhciAkdGVtcCRzMCA9IHMwLAoJCQkJCQkJJHRlbXAkYmFnID0gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEFwcGVuZCwgYmFnLCB4KSwKCQkJCQkJCSR0ZW1wJHBhcnNlcnMgPSByZW1haW5pbmdQYXJzZXJzOwoJCQkJCQlzMCA9ICR0ZW1wJHMwOwoJCQkJCQliYWcgPSAkdGVtcCRiYWc7CgkJCQkJCXBhcnNlcnMgPSAkdGVtcCRwYXJzZXJzOwoJCQkJCQljb250aW51ZSBvbmVPZkhlbHA7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfSk7CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YgPSBmdW5jdGlvbiAocGFyc2VycykgewoJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRQYXJzZXIoCgkJZnVuY3Rpb24gKHMpIHsKCQkJcmV0dXJuIEEzKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZkhlbHAsIHMsICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRFbXB0eSwgcGFyc2Vycyk7CgkJfSk7Cn07CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nU3ltYm9sID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ0V4cGVjdGluZ1N5bWJvbCcsIGE6IGF9Owp9Owp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCA9ICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCR0b2tlbjsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRzeW1ib2wgPSBmdW5jdGlvbiAoc3RyKSB7CglyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQlBMigKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQlzdHIsCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woc3RyKSkpOwp9Owp2YXIgJGVsbSRjb3JlJFN0cmluZyRjb25zID0gX1N0cmluZ19jb25zOwp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJFByb2JsZW0gPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnUHJvYmxlbScsIGE6IGF9Owp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGVudGl0aWVzID0gJGVsbSRjb3JlJERpY3QkZnJvbUxpc3QoCglfTGlzdF9mcm9tQXJyYXkoCgkJWwoJCQlfVXRpbHNfVHVwbGUyKAoJCQknYW1wJywKCQkJX1V0aWxzX2NocignJicpKSwKCQkJX1V0aWxzX1R1cGxlMigKCQkJJ2x0JywKCQkJX1V0aWxzX2NocignPCcpKSwKCQkJX1V0aWxzX1R1cGxlMigKCQkJJ2d0JywKCQkJX1V0aWxzX2NocignPicpKSwKCQkJX1V0aWxzX1R1cGxlMigKCQkJJ2Fwb3MnLAoJCQlfVXRpbHNfY2hyKCdcJycpKSwKCQkJX1V0aWxzX1R1cGxlMigKCQkJJ3F1b3QnLAoJCQlfVXRpbHNfY2hyKCdcIicpKQoJCV0pKTsKdmFyICRlbG0kY29yZSRDaGFyJGZyb21Db2RlID0gX0NoYXJfZnJvbUNvZGU7CnZhciAkZWxtJGNvcmUkUmVzdWx0JGZyb21NYXliZSA9IEYyKAoJZnVuY3Rpb24gKGVyciwgbWF5YmUpIHsKCQlpZiAobWF5YmUuJCA9PT0gJ0p1c3QnKSB7CgkJCXZhciB2ID0gbWF5YmUuYTsKCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkT2sodik7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKGVycik7CgkJfQoJfSk7CnZhciAkZWxtJGNvcmUkU3RyaW5nJGZyb21DaGFyID0gZnVuY3Rpb24gKF9jaGFyKSB7CglyZXR1cm4gQTIoJGVsbSRjb3JlJFN0cmluZyRjb25zLCBfY2hhciwgJycpOwp9Owp2YXIgJGVsbSRjb3JlJEJhc2ljcyRwb3cgPSBfQmFzaWNzX3BvdzsKdmFyICRydGZlbGRtYW4kZWxtX2hleCRIZXgkZnJvbVN0cmluZ0hlbHAgPSBGMygKCWZ1bmN0aW9uIChwb3NpdGlvbiwgY2hhcnMsIGFjY3VtdWxhdGVkKSB7CgkJZnJvbVN0cmluZ0hlbHA6CgkJd2hpbGUgKHRydWUpIHsKCQkJaWYgKCFjaGFycy5iKSB7CgkJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPayhhY2N1bXVsYXRlZCk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgX2NoYXIgPSBjaGFycy5hOwoJCQkJdmFyIHJlc3QgPSBjaGFycy5iOwoJCQkJc3dpdGNoIChfY2hhci52YWx1ZU9mKCkpIHsKCQkJCQljYXNlICcwJzoKCQkJCQkJdmFyICR0ZW1wJHBvc2l0aW9uID0gcG9zaXRpb24gLSAxLAoJCQkJCQkJJHRlbXAkY2hhcnMgPSByZXN0LAoJCQkJCQkJJHRlbXAkYWNjdW11bGF0ZWQgPSBhY2N1bXVsYXRlZDsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnMSc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyBBMigkZWxtJGNvcmUkQmFzaWNzJHBvdywgMTYsIHBvc2l0aW9uKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnMic6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoMiAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnMyc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoMyAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnNCc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoNCAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnNSc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoNSAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnNic6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoNiAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnNyc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoNyAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnOCc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoOCAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnOSc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoOSAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnYSc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoMTAgKiBBMigkZWxtJGNvcmUkQmFzaWNzJHBvdywgMTYsIHBvc2l0aW9uKSk7CgkJCQkJCXBvc2l0aW9uID0gJHRlbXAkcG9zaXRpb247CgkJCQkJCWNoYXJzID0gJHRlbXAkY2hhcnM7CgkJCQkJCWFjY3VtdWxhdGVkID0gJHRlbXAkYWNjdW11bGF0ZWQ7CgkJCQkJCWNvbnRpbnVlIGZyb21TdHJpbmdIZWxwOwoJCQkJCWNhc2UgJ2InOgoJCQkJCQl2YXIgJHRlbXAkcG9zaXRpb24gPSBwb3NpdGlvbiAtIDEsCgkJCQkJCQkkdGVtcCRjaGFycyA9IHJlc3QsCgkJCQkJCQkkdGVtcCRhY2N1bXVsYXRlZCA9IGFjY3VtdWxhdGVkICsgKDExICogQTIoJGVsbSRjb3JlJEJhc2ljcyRwb3csIDE2LCBwb3NpdGlvbikpOwoJCQkJCQlwb3NpdGlvbiA9ICR0ZW1wJHBvc2l0aW9uOwoJCQkJCQljaGFycyA9ICR0ZW1wJGNoYXJzOwoJCQkJCQlhY2N1bXVsYXRlZCA9ICR0ZW1wJGFjY3VtdWxhdGVkOwoJCQkJCQljb250aW51ZSBmcm9tU3RyaW5nSGVscDsKCQkJCQljYXNlICdjJzoKCQkJCQkJdmFyICR0ZW1wJHBvc2l0aW9uID0gcG9zaXRpb24gLSAxLAoJCQkJCQkJJHRlbXAkY2hhcnMgPSByZXN0LAoJCQkJCQkJJHRlbXAkYWNjdW11bGF0ZWQgPSBhY2N1bXVsYXRlZCArICgxMiAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJY2FzZSAnZCc6CgkJCQkJCXZhciAkdGVtcCRwb3NpdGlvbiA9IHBvc2l0aW9uIC0gMSwKCQkJCQkJCSR0ZW1wJGNoYXJzID0gcmVzdCwKCQkJCQkJCSR0ZW1wJGFjY3VtdWxhdGVkID0gYWNjdW11bGF0ZWQgKyAoMTMgKiBBMigkZWxtJGNvcmUkQmFzaWNzJHBvdywgMTYsIHBvc2l0aW9uKSk7CgkJCQkJCXBvc2l0aW9uID0gJHRlbXAkcG9zaXRpb247CgkJCQkJCWNoYXJzID0gJHRlbXAkY2hhcnM7CgkJCQkJCWFjY3VtdWxhdGVkID0gJHRlbXAkYWNjdW11bGF0ZWQ7CgkJCQkJCWNvbnRpbnVlIGZyb21TdHJpbmdIZWxwOwoJCQkJCWNhc2UgJ2UnOgoJCQkJCQl2YXIgJHRlbXAkcG9zaXRpb24gPSBwb3NpdGlvbiAtIDEsCgkJCQkJCQkkdGVtcCRjaGFycyA9IHJlc3QsCgkJCQkJCQkkdGVtcCRhY2N1bXVsYXRlZCA9IGFjY3VtdWxhdGVkICsgKDE0ICogQTIoJGVsbSRjb3JlJEJhc2ljcyRwb3csIDE2LCBwb3NpdGlvbikpOwoJCQkJCQlwb3NpdGlvbiA9ICR0ZW1wJHBvc2l0aW9uOwoJCQkJCQljaGFycyA9ICR0ZW1wJGNoYXJzOwoJCQkJCQlhY2N1bXVsYXRlZCA9ICR0ZW1wJGFjY3VtdWxhdGVkOwoJCQkJCQljb250aW51ZSBmcm9tU3RyaW5nSGVscDsKCQkJCQljYXNlICdmJzoKCQkJCQkJdmFyICR0ZW1wJHBvc2l0aW9uID0gcG9zaXRpb24gLSAxLAoJCQkJCQkJJHRlbXAkY2hhcnMgPSByZXN0LAoJCQkJCQkJJHRlbXAkYWNjdW11bGF0ZWQgPSBhY2N1bXVsYXRlZCArICgxNSAqIEEyKCRlbG0kY29yZSRCYXNpY3MkcG93LCAxNiwgcG9zaXRpb24pKTsKCQkJCQkJcG9zaXRpb24gPSAkdGVtcCRwb3NpdGlvbjsKCQkJCQkJY2hhcnMgPSAkdGVtcCRjaGFyczsKCQkJCQkJYWNjdW11bGF0ZWQgPSAkdGVtcCRhY2N1bXVsYXRlZDsKCQkJCQkJY29udGludWUgZnJvbVN0cmluZ0hlbHA7CgkJCQkJZGVmYXVsdDoKCQkJCQkJdmFyIG5vbkhleCA9IF9jaGFyOwoJCQkJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRFcnIoCgkJCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGZyb21DaGFyKG5vbkhleCkgKyAnIGlzIG5vdCBhIHZhbGlkIGhleGFkZWNpbWFsIGNoYXJhY3Rlci4nKTsKCQkJCX0KCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJExpc3QkdGFpbCA9IGZ1bmN0aW9uIChsaXN0KSB7CglpZiAobGlzdC5iKSB7CgkJdmFyIHggPSBsaXN0LmE7CgkJdmFyIHhzID0gbGlzdC5iOwoJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkSnVzdCh4cyk7Cgl9IGVsc2UgewoJCXJldHVybiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZzsKCX0KfTsKdmFyICRlbG0kY29yZSRTdHJpbmckZm9sZHIgPSBfU3RyaW5nX2ZvbGRyOwp2YXIgJGVsbSRjb3JlJFN0cmluZyR0b0xpc3QgPSBmdW5jdGlvbiAoc3RyaW5nKSB7CglyZXR1cm4gQTMoJGVsbSRjb3JlJFN0cmluZyRmb2xkciwgJGVsbSRjb3JlJExpc3QkY29ucywgX0xpc3RfTmlsLCBzdHJpbmcpOwp9Owp2YXIgJHJ0ZmVsZG1hbiRlbG1faGV4JEhleCRmcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cikgewoJaWYgKCRlbG0kY29yZSRTdHJpbmckaXNFbXB0eShzdHIpKSB7CgkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKCdFbXB0eSBzdHJpbmdzIGFyZSBub3QgdmFsaWQgaGV4YWRlY2ltYWwgc3RyaW5ncy4nKTsKCX0gZWxzZSB7CgkJdmFyIHJlc3VsdCA9IGZ1bmN0aW9uICgpIHsKCQkJaWYgKEEyKCRlbG0kY29yZSRTdHJpbmckc3RhcnRzV2l0aCwgJy0nLCBzdHIpKSB7CgkJCQl2YXIgbGlzdCA9IEEyKAoJCQkJCSRlbG0kY29yZSRNYXliZSR3aXRoRGVmYXVsdCwKCQkJCQlfTGlzdF9OaWwsCgkJCQkJJGVsbSRjb3JlJExpc3QkdGFpbCgKCQkJCQkJJGVsbSRjb3JlJFN0cmluZyR0b0xpc3Qoc3RyKSkpOwoJCQkJcmV0dXJuIEEyKAoJCQkJCSRlbG0kY29yZSRSZXN1bHQkbWFwLAoJCQkJCSRlbG0kY29yZSRCYXNpY3MkbmVnYXRlLAoJCQkJCUEzKAoJCQkJCQkkcnRmZWxkbWFuJGVsbV9oZXgkSGV4JGZyb21TdHJpbmdIZWxwLAoJCQkJCQkkZWxtJGNvcmUkTGlzdCRsZW5ndGgobGlzdCkgLSAxLAoJCQkJCQlsaXN0LAoJCQkJCQkwKSk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gQTMoCgkJCQkJJHJ0ZmVsZG1hbiRlbG1faGV4JEhleCRmcm9tU3RyaW5nSGVscCwKCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGxlbmd0aChzdHIpIC0gMSwKCQkJCQkkZWxtJGNvcmUkU3RyaW5nJHRvTGlzdChzdHIpLAoJCQkJCTApOwoJCQl9CgkJfSgpOwoJCXZhciBmb3JtYXRFcnJvciA9IGZ1bmN0aW9uIChlcnIpIHsKCQkJcmV0dXJuIEEyKAoJCQkJJGVsbSRjb3JlJFN0cmluZyRqb2luLAoJCQkJJyAnLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsnXCInICsgKHN0ciArICdcIicpLCAnaXMgbm90IGEgdmFsaWQgaGV4YWRlY2ltYWwgc3RyaW5nIGJlY2F1c2UnLCBlcnJdKSk7CgkJfTsKCQlyZXR1cm4gQTIoJGVsbSRjb3JlJFJlc3VsdCRtYXBFcnJvciwgZm9ybWF0RXJyb3IsIHJlc3VsdCk7Cgl9Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkZGVjb2RlRXNjYXBlID0gZnVuY3Rpb24gKHMpIHsKCXJldHVybiBBMigkZWxtJGNvcmUkU3RyaW5nJHN0YXJ0c1dpdGgsICcjeCcsIHMpID8gQTIoCgkJJGVsbSRjb3JlJFJlc3VsdCRtYXBFcnJvciwKCQkkZWxtJHBhcnNlciRQYXJzZXIkUHJvYmxlbSwKCQlBMigKCQkJJGVsbSRjb3JlJFJlc3VsdCRtYXAsCgkJCSRlbG0kY29yZSRDaGFyJGZyb21Db2RlLAoJCQkkcnRmZWxkbWFuJGVsbV9oZXgkSGV4JGZyb21TdHJpbmcoCgkJCQlBMigkZWxtJGNvcmUkU3RyaW5nJGRyb3BMZWZ0LCAyLCBzKSkpKSA6IChBMigkZWxtJGNvcmUkU3RyaW5nJHN0YXJ0c1dpdGgsICcjJywgcykgPyBBMigKCQkkZWxtJGNvcmUkUmVzdWx0JGZyb21NYXliZSwKCQkkZWxtJHBhcnNlciRQYXJzZXIkUHJvYmxlbSgnSW52YWxpZCBlc2NhcGVkIGNoYXJhY3RvcjogJyArIHMpLAoJCUEyKAoJCQkkZWxtJGNvcmUkTWF5YmUkbWFwLAoJCQkkZWxtJGNvcmUkQ2hhciRmcm9tQ29kZSwKCQkJJGVsbSRjb3JlJFN0cmluZyR0b0ludCgKCQkJCUEyKCRlbG0kY29yZSRTdHJpbmckZHJvcExlZnQsIDEsIHMpKSkpIDogQTIoCgkJJGVsbSRjb3JlJFJlc3VsdCRmcm9tTWF5YmUsCgkJJGVsbSRwYXJzZXIkUGFyc2VyJFByb2JsZW0oJ05vIGVudGl0eSBuYW1lZCBcIiYnICsgKHMgKyAnO1wiIGZvdW5kLicpKSwKCQlBMigkZWxtJGNvcmUkRGljdCRnZXQsIHMsICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRlbnRpdGllcykpKTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRmYWlsID0gZnVuY3Rpb24gKHN0cikgewoJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRwcm9ibGVtKAoJCSRlbG0kcGFyc2VyJFBhcnNlciRQcm9ibGVtKHN0cikpOwp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGVzY2FwZWRDaGFyID0gZnVuY3Rpb24gKGVuZF8pIHsKCXJldHVybiBBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaW5Db250ZXh0LAoJCSdlc2NhcGVkQ2hhcicsCgkJQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCQlmdW5jdGlvbiAocykgewoJCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZigKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCUEyKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGFuZFRoZW4sCgkJCQkJCQlmdW5jdGlvbiAoX3YwKSB7CgkJCQkJCQkJdmFyIF92MSA9ICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRkZWNvZGVFc2NhcGUocyk7CgkJCQkJCQkJaWYgKF92MS4kID09PSAnT2snKSB7CgkJCQkJCQkJCXZhciBjID0gX3YxLmE7CgkJCQkJCQkJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChjKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQl2YXIgZSA9IF92MS5hOwoJCQkJCQkJCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHByb2JsZW0oZSk7CgkJCQkJCQkJfQoJCQkJCQkJfSwKCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRzeW1ib2woJzsnKSksCgkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkZmFpbCgnRW50aXRpZXMgbXVzdCBlbmRfIHdpdGggXCI7XCI6ICYnICsgcykKCQkJCQkJXSkpOwoJCQl9LAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZWxtJGNvcmUkQmFzaWNzJGlkZW50aXR5KSwKCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCcmJykpLAoJCQkJQTIoCgkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGtlZXAsCgkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJG9uZU9yTW9yZSwKCQkJCQlmdW5jdGlvbiAoYykgewoJCQkJCQlyZXR1cm4gKCFfVXRpbHNfZXEoYywgZW5kXykpICYmICghX1V0aWxzX2VxKAoJCQkJCQkJYywKCQkJCQkJCV9VdGlsc19jaHIoJzsnKSkpOwoJCQkJCX0pKSkpOwp9Owp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGxhenkgPSBmdW5jdGlvbiAodGh1bmspIHsKCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkUGFyc2VyKAoJCWZ1bmN0aW9uIChzKSB7CgkJCXZhciBfdjAgPSB0aHVuayhfVXRpbHNfVHVwbGUwKTsKCQkJdmFyIHBhcnNlID0gX3YwLmE7CgkJCXJldHVybiBwYXJzZShzKTsKCQl9KTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciR6ZXJvT3JNb3JlID0gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJEF0TGVhc3QoMCk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkdGV4dFN0cmluZyA9IGZ1bmN0aW9uIChlbmRfKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGluQ29udGV4dCwKCQkndGV4dFN0cmluZycsCgkJQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCQlmdW5jdGlvbiAocykgewoJCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZigKCQkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJCVsKCQkJCQkJCUEyKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoJGVsbSRjb3JlJFN0cmluZyRjb25zKSwKCQkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkZXNjYXBlZENoYXIoZW5kXykpLAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGxhenkoCgkJCQkJCQkJZnVuY3Rpb24gKF92MCkgewoJCQkJCQkJCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHRleHRTdHJpbmcoZW5kXyk7CgkJCQkJCQkJfSkpLAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQocykKCQkJCQkJXSkpOwoJCQl9LAoJCQlBMigKCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRrZWVwLAoJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHplcm9Pck1vcmUsCgkJCQlmdW5jdGlvbiAoYykgewoJCQkJCXJldHVybiAoIV9VdGlsc19lcShjLCBlbmRfKSkgJiYgKCFfVXRpbHNfZXEoCgkJCQkJCWMsCgkJCQkJCV9VdGlsc19jaHIoJyYnKSkpOwoJCQkJfSkpKTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRhdHRyaWJ1dGVWYWx1ZSA9IEEyKAoJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGluQ29udGV4dCwKCSdhdHRyaWJ1dGVWYWx1ZScsCgkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YoCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZWxtJGNvcmUkQmFzaWNzJGlkZW50aXR5KSwKCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCdcIicpKSwKCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciR0ZXh0U3RyaW5nKAoJCQkJCQlfVXRpbHNfY2hyKCdcIicpKSwKCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCdcIicpKSksCgkJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZWxtJGNvcmUkQmFzaWNzJGlkZW50aXR5KSwKCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCdcJycpKSwKCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciR0ZXh0U3RyaW5nKAoJCQkJCQlfVXRpbHNfY2hyKCdcJycpKSwKCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCdcJycpKSkKCQkJXSkpKTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRpZ25vcmUgPSBGMigKCWZ1bmN0aW9uIChjb3VudCwgcHJlZGljYXRlKSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbWFwLAoJCQlmdW5jdGlvbiAoX3YwKSB7CgkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMDsKCQkJfSwKCQkJQTIoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGtlZXAsIGNvdW50LCBwcmVkaWNhdGUpKTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHdoaXRlU3BhY2UgPSBBMigkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkaWdub3JlLCAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkemVyb09yTW9yZSwgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGlzV2hpdGVzcGFjZSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkYXR0cmlidXRlID0gQTIoCgkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaW5Db250ZXh0LAoJJ2F0dHJpYnV0ZScsCglBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCUEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkQXR0cmlidXRlKSwKCQkJQTIoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCUEyKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLCAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkYXR0cmlidXRlTmFtZSwgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHdoaXRlU3BhY2UpLAoJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRzeW1ib2woJz0nKSksCgkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkd2hpdGVTcGFjZSkpLAoJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRhdHRyaWJ1dGVWYWx1ZSkpOwp2YXIgJGVsbSRjb3JlJFNldCRTZXRfZWxtX2J1aWx0aW4gPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnU2V0X2VsbV9idWlsdGluJywgYTogYX07Cn07CnZhciAkZWxtJGNvcmUkU2V0JGluc2VydCA9IEYyKAoJZnVuY3Rpb24gKGtleSwgX3YwKSB7CgkJdmFyIGRpY3QgPSBfdjAuYTsKCQlyZXR1cm4gJGVsbSRjb3JlJFNldCRTZXRfZWxtX2J1aWx0aW4oCgkJCUEzKCRlbG0kY29yZSREaWN0JGluc2VydCwga2V5LCBfVXRpbHNfVHVwbGUwLCBkaWN0KSk7Cgl9KTsKdmFyICRlbG0kY29yZSREaWN0JG1lbWJlciA9IEYyKAoJZnVuY3Rpb24gKGtleSwgZGljdCkgewoJCXZhciBfdjAgPSBBMigkZWxtJGNvcmUkRGljdCRnZXQsIGtleSwgZGljdCk7CgkJaWYgKF92MC4kID09PSAnSnVzdCcpIHsKCQkJcmV0dXJuIHRydWU7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCX0pOwp2YXIgJGVsbSRjb3JlJFNldCRtZW1iZXIgPSBGMigKCWZ1bmN0aW9uIChrZXksIF92MCkgewoJCXZhciBkaWN0ID0gX3YwLmE7CgkJcmV0dXJuIEEyKCRlbG0kY29yZSREaWN0JG1lbWJlciwga2V5LCBkaWN0KTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAoa2V5cykgewoJcmV0dXJuIEEyKAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpbkNvbnRleHQsCgkJJ2F0dHJpYnV0ZXMnLAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZigKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCQkJCWZ1bmN0aW9uIChhdHRyKSB7CgkJCQkJCXJldHVybiBBMigkZWxtJGNvcmUkU2V0JG1lbWJlciwgYXR0ci5uYW1lLCBrZXlzKSA/ICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRmYWlsKCdhdHRyaWJ1dGUgJyArIChhdHRyLm5hbWUgKyAnIGlzIGR1cGxpY2F0ZWQnKSkgOiBBMigKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQkJCQlBMigKCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgKCQkJCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucyhhdHRyKSksCgkJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHdoaXRlU3BhY2UpLAoJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGF0dHJpYnV0ZXMoCgkJCQkJCQkJQTIoJGVsbSRjb3JlJFNldCRpbnNlcnQsIGF0dHIubmFtZSwga2V5cykpKTsKCQkJCQl9LAoJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRhdHRyaWJ1dGUpLAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKF9MaXN0X05pbCkKCQkJCV0pKSk7Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkdGFnTmFtZSA9IEEyKAoJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGluQ29udGV4dCwKCSd0YWdOYW1lJywKCUEyKAoJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRrZWVwLAoJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRvbmVPck1vcmUsCgkJZnVuY3Rpb24gKGMpIHsKCQkJcmV0dXJuICghJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGlzV2hpdGVzcGFjZShjKSkgJiYgKCghX1V0aWxzX2VxKAoJCQkJYywKCQkJCV9VdGlsc19jaHIoJy8nKSkpICYmICgoIV9VdGlsc19lcSgKCQkJCWMsCgkJCQlfVXRpbHNfY2hyKCc8JykpKSAmJiAoKCFfVXRpbHNfZXEoCgkJCQljLAoJCQkJX1V0aWxzX2NocignPicpKSkgJiYgKCghX1V0aWxzX2VxKAoJCQkJYywKCQkJCV9VdGlsc19jaHIoJ1wiJykpKSAmJiAoKCFfVXRpbHNfZXEoCgkJCQljLAoJCQkJX1V0aWxzX2NocignXCcnKSkpICYmICghX1V0aWxzX2VxKAoJCQkJYywKCQkJCV9VdGlsc19jaHIoJz0nKSkpKSkpKSk7CgkJfSkpOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGNsb3NpbmdUYWcgPSBmdW5jdGlvbiAoc3RhcnRUYWdOYW1lKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGluQ29udGV4dCwKCQknY2xvc2luZ1RhZycsCgkJQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCQlBMigKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoX1V0aWxzX1R1cGxlMCksCgkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCc8LycpKSwKCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHdoaXRlU3BhY2UpLAoJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkYW5kVGhlbiwKCQkJCQkJZnVuY3Rpb24gKGVuZFRhZ05hbWUpIHsKCQkJCQkJCXJldHVybiBfVXRpbHNfZXEoc3RhcnRUYWdOYW1lLCBlbmRUYWdOYW1lKSA/ICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKF9VdGlsc19UdXBsZTApIDogJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGZhaWwoJ3RhZyBuYW1lIG1pc21hdGNoOiAnICsgKHN0YXJ0VGFnTmFtZSArICgnIGFuZCAnICsgZW5kVGFnTmFtZSkpKTsKCQkJCQkJfSwKCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHRhZ05hbWUpKSwKCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciR3aGl0ZVNwYWNlKSwKCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHN5bWJvbCgnPicpKSk7Cn07CnZhciAkZWxtJGNvcmUkU2V0JGVtcHR5ID0gJGVsbSRjb3JlJFNldCRTZXRfZWxtX2J1aWx0aW4oJGVsbSRjb3JlJERpY3QkZW1wdHkpOwpmdW5jdGlvbiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY3ljbGljJGNkYXRhQ29udGVudCgpIHsKCXJldHVybiBBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaW5Db250ZXh0LAoJCSdjZGF0YUNvbnRlbnQnLAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZigKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKCcnKSwKCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCddXT4nKSksCgkJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGFuZFRoZW4sCgkJCQkJZnVuY3Rpb24gKF92MCkgewoJCQkJCQlyZXR1cm4gQTIoCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbWFwLAoJCQkJCQkJZnVuY3Rpb24gKHRhaWwpIHsKCQkJCQkJCQlyZXR1cm4gJ11dJyArIHRhaWw7CgkJCQkJCQl9LAoJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGN5Y2xpYyRjZGF0YUNvbnRlbnQoKSk7CgkJCQkJfSwKCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCddXScpKSwKCQkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkYW5kVGhlbiwKCQkJCQlmdW5jdGlvbiAoX3YxKSB7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCQkJCQlmdW5jdGlvbiAodGFpbCkgewoJCQkJCQkJCXJldHVybiAnXScgKyB0YWlsOwoJCQkJCQkJfSwKCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRjeWNsaWMkY2RhdGFDb250ZW50KCkpOwoJCQkJCX0sCgkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHN5bWJvbCgnXScpKSwKCQkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZWxtJGNvcmUkQmFzaWNzJGFwcGVuZCksCgkJCQkJCUEyKAoJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGtlZXAsCgkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkemVyb09yTW9yZSwKCQkJCQkJCWZ1bmN0aW9uIChjKSB7CgkJCQkJCQkJcmV0dXJuICFfVXRpbHNfZXEoCgkJCQkJCQkJCWMsCgkJCQkJCQkJCV9VdGlsc19jaHIoJ10nKSk7CgkJCQkJCQl9KSksCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGxhenkoCgkJCQkJCWZ1bmN0aW9uIChfdjIpIHsKCQkJCQkJCXJldHVybiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY3ljbGljJGNkYXRhQ29udGVudCgpOwoJCQkJCQl9KSkKCQkJCV0pKSk7Cn0KdHJ5IHsKCXZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY2RhdGFDb250ZW50ID0gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGN5Y2xpYyRjZGF0YUNvbnRlbnQoKTsKCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRjeWNsaWMkY2RhdGFDb250ZW50ID0gZnVuY3Rpb24gKCkgewoJCXJldHVybiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY2RhdGFDb250ZW50OwoJfTsKfSBjYXRjaCAoJCkgewoJdGhyb3cgJ1NvbWUgdG9wLWxldmVsIGRlZmluaXRpb25zIGZyb20gYFhtbFBhcnNlcmAgYXJlIGNhdXNpbmcgaW5maW5pdGUgcmVjdXJzaW9uOlxuXG4gIOKUjOKUgOKUgOKUgOKUgOKUgOKUkFxuICDilIIgICAgY2RhdGFDb250ZW50XG4gIOKUlOKUgOKUgOKUgOKUgOKUgOKUmFxuXG5UaGVzZSBlcnJvcnMgYXJlIHZlcnkgdHJpY2t5LCBzbyByZWFkIGh0dHBzOi8vZWxtLWxhbmcub3JnLzAuMTkuMS9iYWQtcmVjdXJzaW9uIHRvIGxlYXJuIGhvdyB0byBmaXggaXQhJzt9CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY2RhdGEgPSBBMigKCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpbkNvbnRleHQsCgknY2RhdGEnLAoJQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQlBMigKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKCRlbG0kY29yZSRCYXNpY3MkaWRlbnRpdHkpLAoJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCc8IVtDREFUQVsnKSksCgkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGNkYXRhQ29udGVudCkpOwp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGZpbmRTdWJTdHJpbmcgPSBfUGFyc2VyX2ZpbmRTdWJTdHJpbmc7CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkZnJvbUluZm8gPSBGNCgKCWZ1bmN0aW9uIChyb3csIGNvbCwgeCwgY29udGV4dCkgewoJCXJldHVybiBBMigKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEFkZFJpZ2h0LAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkRW1wdHksCgkJCUE0KCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCREZWFkRW5kLCByb3csIGNvbCwgeCwgY29udGV4dCkpOwoJfSk7CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBVbnRpbCA9IGZ1bmN0aW9uIChfdjApIHsKCXZhciBzdHIgPSBfdjAuYTsKCXZhciBleHBlY3RpbmcgPSBfdjAuYjsKCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkUGFyc2VyKAoJCWZ1bmN0aW9uIChzKSB7CgkJCXZhciBfdjEgPSBBNSgkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkZmluZFN1YlN0cmluZywgc3RyLCBzLm9mZnNldCwgcy5yb3csIHMuY29sLCBzLnNyYyk7CgkJCXZhciBuZXdPZmZzZXQgPSBfdjEuYTsKCQkJdmFyIG5ld1JvdyA9IF92MS5iOwoJCQl2YXIgbmV3Q29sID0gX3YxLmM7CgkJCXJldHVybiBfVXRpbHNfZXEobmV3T2Zmc2V0LCAtMSkgPyBBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRCYWQsCgkJCQlmYWxzZSwKCQkJCUE0KCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRmcm9tSW5mbywgbmV3Um93LCBuZXdDb2wsIGV4cGVjdGluZywgcy5jb250ZXh0KSkgOiBBMygKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRHb29kLAoJCQkJX1V0aWxzX2NtcChzLm9mZnNldCwgbmV3T2Zmc2V0KSA8IDAsCgkJCQlfVXRpbHNfVHVwbGUwLAoJCQkJe2NvbDogbmV3Q29sLCBjb250ZXh0OiBzLmNvbnRleHQsIGluZGVudDogcy5pbmRlbnQsIG9mZnNldDogbmV3T2Zmc2V0LCByb3c6IG5ld1Jvdywgc3JjOiBzLnNyY30pOwoJCX0pOwp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHRvVG9rZW4gPSBmdW5jdGlvbiAoc3RyKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCXN0ciwKCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nKHN0cikpOwp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGNvbW1lbnQgPSBBMigKCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChfVXRpbHNfVHVwbGUwKSwKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHRva2VuKAoJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHRvVG9rZW4oJzwhLS0nKSkpLAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFVudGlsKAoJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkdG9Ub2tlbignLS0+JykpKSwKCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCR0b2tlbigKCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkdG9Ub2tlbignLS0+JykpKTsKZnVuY3Rpb24gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGN5Y2xpYyR0ZXh0Tm9kZVN0cmluZygpIHsKCXJldHVybiBBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaW5Db250ZXh0LAoJCSd0ZXh0Tm9kZVN0cmluZycsCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG9uZU9mKAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQkJCQlGMigKCQkJCQkJCQlmdW5jdGlvbiAocywgbWF5YmVTdHJpbmcpIHsKCQkJCQkJCQkJcmV0dXJuICRlbG0kY29yZSRNYXliZSRKdXN0KAoJCQkJCQkJCQkJX1V0aWxzX2FwKAoJCQkJCQkJCQkJCXMsCgkJCQkJCQkJCQkJQTIoJGVsbSRjb3JlJE1heWJlJHdpdGhEZWZhdWx0LCAnJywgbWF5YmVTdHJpbmcpKSk7CgkJCQkJCQkJfSkpLAoJCQkJCQlBMigKCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRrZWVwLAoJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJG9uZU9yTW9yZSwKCQkJCQkJCWZ1bmN0aW9uIChjKSB7CgkJCQkJCQkJcmV0dXJuICghX1V0aWxzX2VxKAoJCQkJCQkJCQljLAoJCQkJCQkJCQlfVXRpbHNfY2hyKCc8JykpKSAmJiAoIV9VdGlsc19lcSgKCQkJCQkJCQkJYywKCQkJCQkJCQkJX1V0aWxzX2NocignJicpKSk7CgkJCQkJCQl9KSksCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGxhenkoCgkJCQkJCWZ1bmN0aW9uIChfdjApIHsKCQkJCQkJCXJldHVybiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY3ljbGljJHRleHROb2RlU3RyaW5nKCk7CgkJCQkJCX0pKSwKCQkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgKCQkJCQkJCUYyKAoJCQkJCQkJCWZ1bmN0aW9uIChjLCBtYXliZVN0cmluZykgewoJCQkJCQkJCQlyZXR1cm4gJGVsbSRjb3JlJE1heWJlJEp1c3QoCgkJCQkJCQkJCQlBMigKCQkJCQkJCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGNvbnMsCgkJCQkJCQkJCQkJYywKCQkJCQkJCQkJCQlBMigkZWxtJGNvcmUkTWF5YmUkd2l0aERlZmF1bHQsICcnLCBtYXliZVN0cmluZykpKTsKCQkJCQkJCQl9KSksCgkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRlc2NhcGVkQ2hhcigKCQkJCQkJCV9VdGlsc19jaHIoJzwnKSkpLAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRsYXp5KAoJCQkJCQlmdW5jdGlvbiAoX3YxKSB7CgkJCQkJCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGN5Y2xpYyR0ZXh0Tm9kZVN0cmluZygpOwoJCQkJCQl9KSksCgkJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQkJCQlGMigKCQkJCQkJCQlmdW5jdGlvbiAocywgbWF5YmVTdHJpbmcpIHsKCQkJCQkJCQkJdmFyIHN0ciA9IF9VdGlsc19hcCgKCQkJCQkJCQkJCXMsCgkJCQkJCQkJCQlBMigkZWxtJGNvcmUkTWF5YmUkd2l0aERlZmF1bHQsICcnLCBtYXliZVN0cmluZykpOwoJCQkJCQkJCQlyZXR1cm4gKHN0ciAhPT0gJycpID8gJGVsbSRjb3JlJE1heWJlJEp1c3Qoc3RyKSA6ICRlbG0kY29yZSRNYXliZSROb3RoaW5nOwoJCQkJCQkJCX0pKSwKCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGNkYXRhKSwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbGF6eSgKCQkJCQkJZnVuY3Rpb24gKF92MikgewoJCQkJCQkJcmV0dXJuICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRjeWNsaWMkdGV4dE5vZGVTdHJpbmcoKTsKCQkJCQkJfSkpLAoJCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgKCQkJCQkJCWZ1bmN0aW9uIChtYXliZVN0cmluZykgewoJCQkJCQkJCXZhciBzdHIgPSBBMigkZWxtJGNvcmUkTWF5YmUkd2l0aERlZmF1bHQsICcnLCBtYXliZVN0cmluZyk7CgkJCQkJCQkJcmV0dXJuIChzdHIgIT09ICcnKSA/ICRlbG0kY29yZSRNYXliZSRKdXN0KHN0cikgOiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZzsKCQkJCQkJCX0pLAoJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY29tbWVudCksCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGxhenkoCgkJCQkJCWZ1bmN0aW9uIChfdjMpIHsKCQkJCQkJCXJldHVybiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY3ljbGljJHRleHROb2RlU3RyaW5nKCk7CgkJCQkJCX0pKSwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZWxtJGNvcmUkTWF5YmUkTm90aGluZykKCQkJCV0pKSk7Cn0KdHJ5IHsKCXZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkdGV4dE5vZGVTdHJpbmcgPSAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY3ljbGljJHRleHROb2RlU3RyaW5nKCk7CgkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY3ljbGljJHRleHROb2RlU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJCXJldHVybiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkdGV4dE5vZGVTdHJpbmc7Cgl9Owp9IGNhdGNoICgkKSB7Cgl0aHJvdyAnU29tZSB0b3AtbGV2ZWwgZGVmaW5pdGlvbnMgZnJvbSBgWG1sUGFyc2VyYCBhcmUgY2F1c2luZyBpbmZpbml0ZSByZWN1cnNpb246XG5cbiAg4pSM4pSA4pSA4pSA4pSA4pSA4pSQXG4gIOKUgiAgICB0ZXh0Tm9kZVN0cmluZ1xuICDilJTilIDilIDilIDilIDilIDilJhcblxuVGhlc2UgZXJyb3JzIGFyZSB2ZXJ5IHRyaWNreSwgc28gcmVhZCBodHRwczovL2VsbS1sYW5nLm9yZy8wLjE5LjEvYmFkLXJlY3Vyc2lvbiB0byBsZWFybiBob3cgdG8gZml4IGl0ISc7fQp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGNoaWxkcmVuID0gZnVuY3Rpb24gKHN0YXJ0VGFnTmFtZSkgewoJcmV0dXJuIEEyKAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpbkNvbnRleHQsCgkJJ2NoaWxkcmVuJywKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YoCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChfTGlzdF9OaWwpLAoJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRjbG9zaW5nVGFnKHN0YXJ0VGFnTmFtZSkpLAoJCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCQkJCWZ1bmN0aW9uIChtYXliZVN0cmluZykgewoJCQkJCQlpZiAobWF5YmVTdHJpbmcuJCA9PT0gJ0p1c3QnKSB7CgkJCQkJCQl2YXIgcyA9IG1heWJlU3RyaW5nLmE7CgkJCQkJCQlyZXR1cm4gQTIoCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgKCQkJCQkJCQkJZnVuY3Rpb24gKHJlc3QpIHsKCQkJCQkJCQkJCXJldHVybiBBMigKCQkJCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRUZXh0KHMpLAoJCQkJCQkJCQkJCXJlc3QpOwoJCQkJCQkJCQl9KSwKCQkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY2hpbGRyZW4oc3RhcnRUYWdOYW1lKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlyZXR1cm4gQTIoCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoX0xpc3RfTmlsKSwKCQkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY2xvc2luZ1RhZyhzdGFydFRhZ05hbWUpKTsKCQkJCQkJfQoJCQkJCX0sCgkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHRleHROb2RlU3RyaW5nKSwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbGF6eSgKCQkJCQlmdW5jdGlvbiAoX3YyKSB7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQkJCQlBMigKCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKCRlbG0kY29yZSRMaXN0JGNvbnMpLAoJCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRjeWNsaWMkZWxlbWVudCgpKSwKCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRjaGlsZHJlbihzdGFydFRhZ05hbWUpKTsKCQkJCQl9KQoJCQkJXSkpKTsKfTsKZnVuY3Rpb24gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGN5Y2xpYyRlbGVtZW50KCkgewoJcmV0dXJuIEEyKAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpbkNvbnRleHQsCgkJJ2VsZW1lbnQnLAoJCUEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoJGVsbSRjb3JlJEJhc2ljcyRpZGVudGl0eSksCgkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCc8JykpLAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCQkJZnVuY3Rpb24gKHN0YXJ0VGFnTmFtZSkgewoJCQkJCXJldHVybiBBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQkJQTIoCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRFbGVtZW50KHN0YXJ0VGFnTmFtZSkpLAoJCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciR3aGl0ZVNwYWNlKSwKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRhdHRyaWJ1dGVzKCRlbG0kY29yZSRTZXQkZW1wdHkpLAoJCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciR3aGl0ZVNwYWNlKSksCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZigKCQkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCQlbCgkJCQkJCQkJCUEyKAoJCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoX0xpc3RfTmlsKSwKCQkJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJHN5bWJvbCgnLz4nKSksCgkJCQkJCQkJCUEyKAoJCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkJCQkJCQlBMigKCQkJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoJGVsbSRjb3JlJEJhc2ljcyRpZGVudGl0eSksCgkJCQkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkc3ltYm9sKCc+JykpLAoJCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbGF6eSgKCQkJCQkJCQkJCWZ1bmN0aW9uIChfdjApIHsKCQkJCQkJCQkJCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGNoaWxkcmVuKHN0YXJ0VGFnTmFtZSk7CgkJCQkJCQkJCQl9KSkKCQkJCQkJCQldKSkpOwoJCQkJfSwKCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciR0YWdOYW1lKSkpOwp9CnRyeSB7Cgl2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGVsZW1lbnQgPSAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkY3ljbGljJGVsZW1lbnQoKTsKCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJFhtbFBhcnNlciRjeWNsaWMkZWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kWG1sUGFyc2VyJGVsZW1lbnQ7Cgl9Owp9IGNhdGNoICgkKSB7Cgl0aHJvdyAnU29tZSB0b3AtbGV2ZWwgZGVmaW5pdGlvbnMgZnJvbSBgWG1sUGFyc2VyYCBhcmUgY2F1c2luZyBpbmZpbml0ZSByZWN1cnNpb246XG5cbiAg4pSM4pSA4pSA4pSA4pSA4pSA4pSQXG4gIOKUgiAgICBjaGlsZHJlblxuICDilIIgICAgIOKGk1xuICDilIIgICAgZWxlbWVudFxuICDilJTilIDilIDilIDilIDilIDilJhcblxuVGhlc2UgZXJyb3JzIGFyZSB2ZXJ5IHRyaWNreSwgc28gcmVhZCBodHRwczovL2VsbS1sYW5nLm9yZy8wLjE5LjEvYmFkLXJlY3Vyc2lvbiB0byBsZWFybiBob3cgdG8gZml4IGl0ISc7fQp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGVuZCA9IGZ1bmN0aW9uICh4KSB7CglyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFBhcnNlcigKCQlmdW5jdGlvbiAocykgewoJCQlyZXR1cm4gX1V0aWxzX2VxKAoJCQkJJGVsbSRjb3JlJFN0cmluZyRsZW5ndGgocy5zcmMpLAoJCQkJcy5vZmZzZXQpID8gQTMoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEdvb2QsIGZhbHNlLCBfVXRpbHNfVHVwbGUwLCBzKSA6IEEyKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEJhZCwKCQkJCWZhbHNlLAoJCQkJQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGZyb21TdGF0ZSwgcywgeCkpOwoJCX0pOwp9Owp2YXIgJGVsbSRjb3JlJExpc3QkZmlsdGVyID0gRjIoCglmdW5jdGlvbiAoaXNHb29kLCBsaXN0KSB7CgkJcmV0dXJuIEEzKAoJCQkkZWxtJGNvcmUkTGlzdCRmb2xkciwKCQkJRjIoCgkJCQlmdW5jdGlvbiAoeCwgeHMpIHsKCQkJCQlyZXR1cm4gaXNHb29kKHgpID8gQTIoJGVsbSRjb3JlJExpc3QkY29ucywgeCwgeHMpIDogeHM7CgkJCQl9KSwKCQkJX0xpc3RfTmlsLAoJCQlsaXN0KTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJEhlYWRpbmcgPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnSGVhZGluZycsIGE6IGEsIGI6IGJ9OwoJfSk7CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBVbnRpbEVuZE9yID0gZnVuY3Rpb24gKHN0cikgewoJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRQYXJzZXIoCgkJZnVuY3Rpb24gKHMpIHsKCQkJdmFyIF92MCA9IEE1KF9QYXJzZXJfZmluZFN1YlN0cmluZywgc3RyLCBzLm9mZnNldCwgcy5yb3csIHMuY29sLCBzLnNyYyk7CgkJCXZhciBuZXdPZmZzZXQgPSBfdjAuYTsKCQkJdmFyIG5ld1JvdyA9IF92MC5iOwoJCQl2YXIgbmV3Q29sID0gX3YwLmM7CgkJCXZhciBhZGp1c3RlZE9mZnNldCA9IChuZXdPZmZzZXQgPCAwKSA/ICRlbG0kY29yZSRTdHJpbmckbGVuZ3RoKHMuc3JjKSA6IG5ld09mZnNldDsKCQkJcmV0dXJuIEEzKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEdvb2QsCgkJCQlfVXRpbHNfY21wKHMub2Zmc2V0LCBhZGp1c3RlZE9mZnNldCkgPCAwLAoJCQkJX1V0aWxzX1R1cGxlMCwKCQkJCXtjb2w6IG5ld0NvbCwgY29udGV4dDogcy5jb250ZXh0LCBpbmRlbnQ6IHMuaW5kZW50LCBvZmZzZXQ6IGFkanVzdGVkT2Zmc2V0LCByb3c6IG5ld1Jvdywgc3JjOiBzLnNyY30pOwoJCX0pOwp9Owp2YXIgJGVsbSRjb3JlJFN0cmluZyRkcm9wUmlnaHQgPSBGMigKCWZ1bmN0aW9uIChuLCBzdHJpbmcpIHsKCQlyZXR1cm4gKG4gPCAxKSA/IHN0cmluZyA6IEEzKCRlbG0kY29yZSRTdHJpbmckc2xpY2UsIDAsIC1uLCBzdHJpbmcpOwoJfSk7CnZhciAkZWxtJGNvcmUkU3RyaW5nJGVuZHNXaXRoID0gX1N0cmluZ19lbmRzV2l0aDsKdmFyICRlbG0kY29yZSRTdHJpbmckdHJpbVJpZ2h0ID0gX1N0cmluZ190cmltUmlnaHQ7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkZHJvcFRyYWlsaW5nSGFzaGVzID0gZnVuY3Rpb24gKGhlYWRpbmdTdHJpbmcpIHsKCXJldHVybiBBMigkZWxtJGNvcmUkU3RyaW5nJGVuZHNXaXRoLCAnIycsIGhlYWRpbmdTdHJpbmcpID8gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGRyb3BUcmFpbGluZ0hhc2hlcygKCQkkZWxtJGNvcmUkU3RyaW5nJHRyaW1SaWdodCgKCQkJQTIoJGVsbSRjb3JlJFN0cmluZyRkcm9wUmlnaHQsIDEsIGhlYWRpbmdTdHJpbmcpKSkgOiBoZWFkaW5nU3RyaW5nOwp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGhlYWRpbmcgPSBBMigKCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCglBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCUEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJEhlYWRpbmcpLAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3ltYm9sKAoJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCScjJywKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nKCcjJykpKSksCgkJQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCQkJZnVuY3Rpb24gKGFkZGl0aW9uYWxIYXNoZXMpIHsKCQkJCQl2YXIgbGV2ZWwgPSAkZWxtJGNvcmUkU3RyaW5nJGxlbmd0aChhZGRpdGlvbmFsSGFzaGVzKSArIDE7CgkJCQkJcmV0dXJuIChsZXZlbCA+PSA3KSA/ICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRwcm9ibGVtKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nKCdoZWFkaW5nIHdpdGggPCA3ICNcJ3MnKSkgOiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChsZXZlbCk7CgkJCQl9LAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGdldENob21wZWRTdHJpbmcoCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChfVXRpbHNfVHVwbGUwKSwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wV2hpbGUoCgkJCQkJCQlmdW5jdGlvbiAoYykgewoJCQkJCQkJCXJldHVybiBfVXRpbHNfZXEoCgkJCQkJCQkJCWMsCgkJCQkJCQkJCV9VdGlsc19jaHIoJyMnKSk7CgkJCQkJCQl9KSkpKSwKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wV2hpbGUoCgkJCQlmdW5jdGlvbiAoYykgewoJCQkJCXJldHVybiBfVXRpbHNfZXEoCgkJCQkJCWMsCgkJCQkJCV9VdGlsc19jaHIoJyAnKSk7CgkJCQl9KSkpLAoJQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGFuZFRoZW4sCgkJZnVuY3Rpb24gKGhlYWRpbmdUZXh0KSB7CgkJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgKCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRVbnBhcnNlZElubGluZXMoCgkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGRyb3BUcmFpbGluZ0hhc2hlcyhoZWFkaW5nVGV4dCkpKTsKCQl9LAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRDaG9tcGVkU3RyaW5nKAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoX1V0aWxzX1R1cGxlMCksCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBVbnRpbEVuZE9yKCdcbicpKSkpKTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRMaXN0QmxvY2sgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnTGlzdEJsb2NrJywgYTogYX07Cn07CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbG9vcEhlbHAgPSBGNCgKCWZ1bmN0aW9uIChwLCBzdGF0ZSwgY2FsbGJhY2ssIHMwKSB7CgkJbG9vcEhlbHA6CgkJd2hpbGUgKHRydWUpIHsKCQkJdmFyIF92MCA9IGNhbGxiYWNrKHN0YXRlKTsKCQkJdmFyIHBhcnNlID0gX3YwLmE7CgkJCXZhciBfdjEgPSBwYXJzZShzMCk7CgkJCWlmIChfdjEuJCA9PT0gJ0dvb2QnKSB7CgkJCQl2YXIgcDEgPSBfdjEuYTsKCQkJCXZhciBzdGVwID0gX3YxLmI7CgkJCQl2YXIgczEgPSBfdjEuYzsKCQkJCWlmIChzdGVwLiQgPT09ICdMb29wJykgewoJCQkJCXZhciBuZXdTdGF0ZSA9IHN0ZXAuYTsKCQkJCQl2YXIgJHRlbXAkcCA9IHAgfHwgcDEsCgkJCQkJCSR0ZW1wJHN0YXRlID0gbmV3U3RhdGUsCgkJCQkJCSR0ZW1wJGNhbGxiYWNrID0gY2FsbGJhY2ssCgkJCQkJCSR0ZW1wJHMwID0gczE7CgkJCQkJcCA9ICR0ZW1wJHA7CgkJCQkJc3RhdGUgPSAkdGVtcCRzdGF0ZTsKCQkJCQljYWxsYmFjayA9ICR0ZW1wJGNhbGxiYWNrOwoJCQkJCXMwID0gJHRlbXAkczA7CgkJCQkJY29udGludWUgbG9vcEhlbHA7CgkJCQl9IGVsc2UgewoJCQkJCXZhciByZXN1bHQgPSBzdGVwLmE7CgkJCQkJcmV0dXJuIEEzKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRHb29kLCBwIHx8IHAxLCByZXN1bHQsIHMxKTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXZhciBwMSA9IF92MS5hOwoJCQkJdmFyIHggPSBfdjEuYjsKCQkJCXJldHVybiBBMigkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkQmFkLCBwIHx8IHAxLCB4KTsKCQkJfQoJCX0KCX0pOwp2YXIgJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGxvb3AgPSBGMigKCWZ1bmN0aW9uIChzdGF0ZSwgY2FsbGJhY2spIHsKCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFBhcnNlcigKCQkJZnVuY3Rpb24gKHMpIHsKCQkJCXJldHVybiBBNCgkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbG9vcEhlbHAsIGZhbHNlLCBzdGF0ZSwgY2FsbGJhY2ssIHMpOwoJCQl9KTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kTGlzdCRzaW5nbGVJdGVtUGFyc2VyID0gQTIoCgkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZWxtJGNvcmUkQmFzaWNzJGlkZW50aXR5KSwKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQknLScsCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbCgnLScpKSkpLAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFdoaWxlKAoJCQlmdW5jdGlvbiAoYykgewoJCQkJcmV0dXJuIF9VdGlsc19lcSgKCQkJCQljLAoJCQkJCV9VdGlsc19jaHIoJyAnKSk7CgkJCX0pKSwKCUEyKAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRDaG9tcGVkU3RyaW5nKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBVbnRpbEVuZE9yKCdcbicpKSwKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3ltYm9sKAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCSdcbicsCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nU3ltYm9sKCdcbicpKSkpKTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRPZmZzZXQgPSAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkUGFyc2VyKAoJZnVuY3Rpb24gKHMpIHsKCQlyZXR1cm4gQTMoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEdvb2QsIGZhbHNlLCBzLm9mZnNldCwgcyk7Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJExpc3Qkc3RhdGVtZW50c0hlbHAgPSBGMigKCWZ1bmN0aW9uIChmaXJzdEl0ZW0sIHJldlN0bXRzKSB7CgkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZigKCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKAoJCQkJCQkJCUYzKAoJCQkJCQkJCQlmdW5jdGlvbiAob2Zmc2V0QmVmb3JlLCBzdG10LCBvZmZzZXRBZnRlcikgewoJCQkJCQkJCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRMb29wKAoJCQkJCQkJCQkJCUEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIHN0bXQsIHJldlN0bXRzKSk7CgkJCQkJCQkJCX0pKSwKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRPZmZzZXQpLAoJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRMaXN0JHNpbmdsZUl0ZW1QYXJzZXIpLAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRPZmZzZXQpLAoJCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCQkJZnVuY3Rpb24gKF92MCkgewoJCQkJCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJERvbmUoCgkJCQkJCQlBMigKCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJCWZpcnN0SXRlbSwKCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRyZXZlcnNlKHJldlN0bXRzKSkpOwoJCQkJCX0sCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoX1V0aWxzX1R1cGxlMCkpCgkJCQldKSk7Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJExpc3QkcGFyc2VyID0gQTIoCgkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkYW5kVGhlbiwKCWZ1bmN0aW9uIChmaXJzdEl0ZW0pIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRsb29wLAoJCQlfTGlzdF9OaWwsCgkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJExpc3Qkc3RhdGVtZW50c0hlbHAoZmlyc3RJdGVtKSk7Cgl9LAoJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kTGlzdCRzaW5nbGVJdGVtUGFyc2VyKTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRsaXN0QmxvY2sgPSBBMigKCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkTGlzdEJsb2NrLAoJQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG1hcCwKCQkkZWxtJGNvcmUkTGlzdCRtYXAoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJFVucGFyc2VkSW5saW5lcyksCgkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kTGlzdCRwYXJzZXIpKTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEJsb2NrJENvZGVCbG9jayA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdDb2RlQmxvY2snLCBhOiBhfTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEJsb2NrJEhlYWRpbmcgPSBGMigKCWZ1bmN0aW9uIChhLCBiKSB7CgkJcmV0dXJuIHskOiAnSGVhZGluZycsIGE6IGEsIGI6IGJ9OwoJfSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRCbG9jayRMaXN0QmxvY2sgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnTGlzdEJsb2NrJywgYTogYX07Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRCbG9jayRUaGVtYXRpY0JyZWFrID0geyQ6ICdUaGVtYXRpY0JyZWFrJ307CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkanVzdCA9IGZ1bmN0aW9uICh2YWx1ZSkgewoJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKAoJCSRlbG0kY29yZSRNYXliZSRKdXN0KHZhbHVlKSk7Cn07CnZhciAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBJZiA9IEYyKAoJZnVuY3Rpb24gKGlzR29vZCwgZXhwZWN0aW5nKSB7CgkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRQYXJzZXIoCgkJCWZ1bmN0aW9uIChzKSB7CgkJCQl2YXIgbmV3T2Zmc2V0ID0gQTMoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlzU3ViQ2hhciwgaXNHb29kLCBzLm9mZnNldCwgcy5zcmMpOwoJCQkJcmV0dXJuIF9VdGlsc19lcShuZXdPZmZzZXQsIC0xKSA/IEEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRCYWQsCgkJCQkJZmFsc2UsCgkJCQkJQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGZyb21TdGF0ZSwgcywgZXhwZWN0aW5nKSkgOiAoX1V0aWxzX2VxKG5ld09mZnNldCwgLTIpID8gQTMoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJEdvb2QsCgkJCQkJdHJ1ZSwKCQkJCQlfVXRpbHNfVHVwbGUwLAoJCQkJCXtjb2w6IDEsIGNvbnRleHQ6IHMuY29udGV4dCwgaW5kZW50OiBzLmluZGVudCwgb2Zmc2V0OiBzLm9mZnNldCArIDEsIHJvdzogcy5yb3cgKyAxLCBzcmM6IHMuc3JjfSkgOiBBMygKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkR29vZCwKCQkJCQl0cnVlLAoJCQkJCV9VdGlsc19UdXBsZTAsCgkJCQkJe2NvbDogcy5jb2wgKyAxLCBjb250ZXh0OiBzLmNvbnRleHQsIGluZGVudDogcy5pbmRlbnQsIG9mZnNldDogbmV3T2Zmc2V0LCByb3c6IHMucm93LCBzcmM6IHMuc3JjfSkpOwoJCQl9KTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyRpc1VuaW50ZXJlc3RpbmcgPSBmdW5jdGlvbiAoX2NoYXIpIHsKCXJldHVybiAoIV9VdGlsc19lcSgKCQlfY2hhciwKCQlfVXRpbHNfY2hyKCcqJykpKSAmJiAoKCFfVXRpbHNfZXEoCgkJX2NoYXIsCgkJX1V0aWxzX2NocignYCcpKSkgJiYgKCghX1V0aWxzX2VxKAoJCV9jaGFyLAoJCV9VdGlsc19jaHIoJ1snKSkpICYmICghX1V0aWxzX2VxKAoJCV9jaGFyLAoJCV9VdGlsc19jaHIoJyEnKSkpKSk7Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRJbmxpbmVzJG5leHRTdGVwV2hlbkFsbEZhaWxlZCA9IEYyKAoJZnVuY3Rpb24gKF92MCwgc3RyaW5nKSB7CgkJdmFyIGN1cnJTdHlsZSA9IF92MC5hOwoJCXZhciByZXZTdHlsZWRTdHJpbmdzID0gX3YwLmI7CgkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRMb29wKAoJCQlfVXRpbHNfVHVwbGUzKAoJCQkJY3VyclN0eWxlLAoJCQkJcmV2U3R5bGVkU3RyaW5ncywKCQkJCSRlbG0kY29yZSRNYXliZSRKdXN0KHN0cmluZykpKTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyRuZXh0U3RlcFdoZW5Gb3VuZEJvbGQgPSBGMigKCWZ1bmN0aW9uIChfdjAsIHN0cmluZykgewoJCXZhciBjdXJyU3R5bGUgPSBfdjAuYTsKCQl2YXIgcmV2U3R5bGVkU3RyaW5ncyA9IF92MC5iOwoJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkTG9vcCgKCQkJX1V0aWxzX1R1cGxlMygKCQkJCV9VdGlsc191cGRhdGUoCgkJCQkJY3VyclN0eWxlLAoJCQkJCXtpc0JvbGQ6ICFjdXJyU3R5bGUuaXNCb2xkfSksCgkJCQlBMigKCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCXtzdHJpbmc6IHN0cmluZywgc3R5bGU6IGN1cnJTdHlsZX0sCgkJCQkJcmV2U3R5bGVkU3RyaW5ncyksCgkJCQkkZWxtJGNvcmUkTWF5YmUkTm90aGluZykpOwoJfSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRJbmxpbmVzJG5leHRTdGVwV2hlbkZvdW5kQ29kZSA9IEYyKAoJZnVuY3Rpb24gKF92MCwgc3RyaW5nKSB7CgkJdmFyIGN1cnJTdHlsZSA9IF92MC5hOwoJCXZhciByZXZTdHlsZWRTdHJpbmdzID0gX3YwLmI7CgkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRMb29wKAoJCQlfVXRpbHNfVHVwbGUzKAoJCQkJX1V0aWxzX3VwZGF0ZSgKCQkJCQljdXJyU3R5bGUsCgkJCQkJe2lzQ29kZTogIWN1cnJTdHlsZS5pc0NvZGV9KSwKCQkJCUEyKAoJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJe3N0cmluZzogc3RyaW5nLCBzdHlsZTogY3VyclN0eWxlfSwKCQkJCQlyZXZTdHlsZWRTdHJpbmdzKSwKCQkJCSRlbG0kY29yZSRNYXliZSROb3RoaW5nKSk7Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJElubGluZXMkbmV4dFN0ZXBXaGVuRm91bmRJdGFsaWMgPSBGMigKCWZ1bmN0aW9uIChfdjAsIHN0cmluZykgewoJCXZhciBjdXJyU3R5bGUgPSBfdjAuYTsKCQl2YXIgcmV2U3R5bGVkU3RyaW5ncyA9IF92MC5iOwoJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkTG9vcCgKCQkJX1V0aWxzX1R1cGxlMygKCQkJCV9VdGlsc191cGRhdGUoCgkJCQkJY3VyclN0eWxlLAoJCQkJCXtpc0l0YWxpYzogIWN1cnJTdHlsZS5pc0l0YWxpY30pLAoJCQkJQTIoCgkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQl7c3RyaW5nOiBzdHJpbmcsIHN0eWxlOiBjdXJyU3R5bGV9LAoJCQkJCXJldlN0eWxlZFN0cmluZ3MpLAoJCQkJJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcpKTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQmxvY2skSW1hZ2UgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnSW1hZ2UnLCBhOiBhfTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEJsb2NrJExpbmsgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnTGluaycsIGE6IGF9Owp9Owp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyRuZXh0U3RlcFdoZW5Gb3VuZExpbmsgPSBGMygKCWZ1bmN0aW9uIChsaW5rLCBfdjAsIHN0cmluZykgewoJCXZhciBjdXJyU3R5bGUgPSBfdjAuYTsKCQl2YXIgcmV2U3R5bGVkU3RyaW5ncyA9IF92MC5iOwoJCWlmIChsaW5rLiQgPT09ICdMaW5rJykgewoJCQl2YXIgcmVjb3JkID0gbGluay5hOwoJCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJExvb3AoCgkJCQlfVXRpbHNfVHVwbGUzKAoJCQkJCWN1cnJTdHlsZSwKCQkJCQlBMigKCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJewoJCQkJCQkJc3RyaW5nOiByZWNvcmQuZGVzY3JpcHRpb24sCgkJCQkJCQlzdHlsZTogX1V0aWxzX3VwZGF0ZSgKCQkJCQkJCQljdXJyU3R5bGUsCgkJCQkJCQkJewoJCQkJCQkJCQlsaW5rOiAkZWxtJGNvcmUkTWF5YmUkSnVzdCgKCQkJCQkJCQkJCXsKCQkJCQkJCQkJCQlkZXN0aW5hdGlvbjogJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQmxvY2skTGluayhyZWNvcmQuZGVzdGluYXRpb24pLAoJCQkJCQkJCQkJCXRpdGxlOiByZWNvcmQudGl0bGUKCQkJCQkJCQkJCX0pCgkJCQkJCQkJfSkKCQkJCQkJfSwKCQkJCQkJQTIoCgkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJe3N0cmluZzogc3RyaW5nLCBzdHlsZTogY3VyclN0eWxlfSwKCQkJCQkJCXJldlN0eWxlZFN0cmluZ3MpKSwKCQkJCQkkZWxtJGNvcmUkTWF5YmUkTm90aGluZykpOwoJCX0gZWxzZSB7CgkJCXZhciByZWNvcmQgPSBsaW5rLmE7CgkJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkTG9vcCgKCQkJCV9VdGlsc19UdXBsZTMoCgkJCQkJY3VyclN0eWxlLAoJCQkJCUEyKAoJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQl7CgkJCQkJCQlzdHJpbmc6IHJlY29yZC5hbHQsCgkJCQkJCQlzdHlsZTogX1V0aWxzX3VwZGF0ZSgKCQkJCQkJCQljdXJyU3R5bGUsCgkJCQkJCQkJewoJCQkJCQkJCQlsaW5rOiAkZWxtJGNvcmUkTWF5YmUkSnVzdCgKCQkJCQkJCQkJCXsKCQkJCQkJCQkJCQlkZXN0aW5hdGlvbjogJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQmxvY2skSW1hZ2UocmVjb3JkLnNyYyksCgkJCQkJCQkJCQkJdGl0bGU6ICRlbG0kY29yZSRNYXliZSROb3RoaW5nCgkJCQkJCQkJCQl9KQoJCQkJCQkJCX0pCgkJCQkJCX0sCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJCXtzdHJpbmc6IHN0cmluZywgc3R5bGU6IGN1cnJTdHlsZX0sCgkJCQkJCQlyZXZTdHlsZWRTdHJpbmdzKSksCgkJCQkJJGVsbSRjb3JlJE1heWJlJE5vdGhpbmcpKTsKCQl9Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJElubGluZXMkbmV4dFN0ZXBXaGVuRm91bmROb3RoaW5nID0gRjIoCglmdW5jdGlvbiAoX3YwLCBzdHJpbmcpIHsKCQl2YXIgY3VyclN0eWxlID0gX3YwLmE7CgkJdmFyIHJldlN0eWxlZFN0cmluZ3MgPSBfdjAuYjsKCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJERvbmUoCgkJCUEyKAoJCQkJJGVsbSRjb3JlJExpc3QkZmlsdGVyLAoJCQkJZnVuY3Rpb24gKHRoaW5nKSB7CgkJCQkJcmV0dXJuIHRoaW5nLnN0cmluZyAhPT0gJyc7CgkJCQl9LAoJCQkJJGVsbSRjb3JlJExpc3QkcmV2ZXJzZSgKCQkJCQlBMigKCQkJCQkJJGVsbSRjb3JlJExpc3QkY29ucywKCQkJCQkJe3N0cmluZzogc3RyaW5nLCBzdHlsZTogY3VyclN0eWxlfSwKCQkJCQkJcmV2U3R5bGVkU3RyaW5ncykpKSk7Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJExpbmskSW1hZ2UgPSBmdW5jdGlvbiAoYSkgewoJcmV0dXJuIHskOiAnSW1hZ2UnLCBhOiBhfTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJExpbmskTGluayA9IGZ1bmN0aW9uIChhKSB7CglyZXR1cm4geyQ6ICdMaW5rJywgYTogYX07Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRMaW5rJGxpbmtEZXN0aW5hdGlvbiA9ICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZigKCV9MaXN0X2Zyb21BcnJheSgKCQlbCgkJCUEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoJGVsbSRjb3JlJEJhc2ljcyRpZGVudGl0eSksCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3ltYm9sKAoJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkVG9rZW4sCgkJCQkJCSc8JywKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbCgnPCcpKSkpLAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGdldENob21wZWRTdHJpbmcoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wVW50aWwoCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQkJJz4nLAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbCgnPicpKSkpLAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQknPicsCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woJz4nKSkpKSksCgkJCUEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZWxtJGNvcmUkQmFzaWNzJGlkZW50aXR5KSwKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGdldENob21wZWRTdHJpbmcoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBVbnRpbCgKCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQknKScsCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woJyknKSkpKSkKCQldKSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRMaW5rJHBhcnNlciA9ICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRvbmVPZigKCV9MaXN0X2Zyb21BcnJheSgKCQlbCgkJCUEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRrZWVwZXIsCgkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgKCQkJCQkJRjIoCgkJCQkJCQlmdW5jdGlvbiAoYWx0LCBzcmMpIHsKCQkJCQkJCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kTGluayRJbWFnZSgKCQkJCQkJCQkJe2FsdDogYWx0LCBzcmM6IHNyY30pOwoJCQkJCQkJfSkpLAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzeW1ib2woCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQkJJyFbJywKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woJ1snKSkpKSwKCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGdldENob21wZWRTdHJpbmcoCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBVbnRpbCgKCQkJCQkJCQlBMigKCQkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQkJCQknXScsCgkJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woJ10nKSkpKSwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCQknXScsCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbCgnXScpKSkpLAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzeW1ib2woCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQkJJygnLAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbCgnKCcpKSkpKSwKCQkJQTIoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRDaG9tcGVkU3RyaW5nKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFVudGlsKAoJCQkJCQlBMigKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCScpJywKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woJyknKSkpKSwKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzeW1ib2woCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJJyknLAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nU3ltYm9sKCcpJykpKSkpLAoJCQlBMigKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJQTIoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQkJCUYyKAoJCQkJCQkJZnVuY3Rpb24gKGRlc2NyaXB0aW9uLCBkZXN0aW5hdGlvbikgewoJCQkJCQkJCXJldHVybiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRMaW5rJExpbmsoCgkJCQkJCQkJCXtkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sIGRlc3RpbmF0aW9uOiBkZXN0aW5hdGlvbiwgdGl0bGU6ICRlbG0kY29yZSRNYXliZSROb3RoaW5nfSk7CgkJCQkJCQl9KSksCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQkJCQkJQTIoCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkVG9rZW4sCgkJCQkJCQknWycsCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nU3ltYm9sKCdbJykpKSksCgkJCQlBMigKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRDaG9tcGVkU3RyaW5nKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wVW50aWwoCgkJCQkJCQkJQTIoCgkJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCQkJJ10nLAoJCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nU3ltYm9sKCddJykpKSksCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzeW1ib2woCgkJCQkJCQlBMigKCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkVG9rZW4sCgkJCQkJCQkJJ10nLAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woJ10nKSkpKSwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3ltYm9sKAoJCQkJCQlBMigKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCScoJywKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woJygnKSkpKSksCgkJCUEyKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRMaW5rJGxpbmtEZXN0aW5hdGlvbiwKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzeW1ib2woCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJJyknLAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nU3ltYm9sKCcpJykpKSkpCgkJXSkpOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyRwYXJzZUhlbHAgPSBmdW5jdGlvbiAoc3RhdGUpIHsKCXZhciBhbGxGYWlsZWQgPSBzdGF0ZS5jOwoJcmV0dXJuIEEyKAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCWZ1bmN0aW9uIChjaG9tcGVkU3RyaW5nKSB7CgkJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YoCgkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG1hcCwKCQkJCQkJZnVuY3Rpb24gKGxpbmspIHsKCQkJCQkJCXJldHVybiBBMygkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRJbmxpbmVzJG5leHRTdGVwV2hlbkZvdW5kTGluaywgbGluaywgc3RhdGUsIGNob21wZWRTdHJpbmcpOwoJCQkJCQl9LAoJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRMaW5rJHBhcnNlciksCgkJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbWFwLAoJCQkJCQlmdW5jdGlvbiAoX3YwKSB7CgkJCQkJCQlyZXR1cm4gQTIoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyRuZXh0U3RlcFdoZW5Gb3VuZENvZGUsIHN0YXRlLCBjaG9tcGVkU3RyaW5nKTsKCQkJCQkJfSwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHRva2VuKAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQkJCSdgJywKCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nKCdgJykpKSksCgkJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkbWFwLAoJCQkJCQlmdW5jdGlvbiAoX3YxKSB7CgkJCQkJCQlyZXR1cm4gQTIoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyRuZXh0U3RlcFdoZW5Gb3VuZEJvbGQsIHN0YXRlLCBjaG9tcGVkU3RyaW5nKTsKCQkJCQkJfSwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHRva2VuKAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQkJCScqKicsCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygnKionKSkpKSwKCQkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCQkJCWZ1bmN0aW9uIChfdjIpIHsKCQkJCQkJCXJldHVybiBBMigkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRJbmxpbmVzJG5leHRTdGVwV2hlbkZvdW5kSXRhbGljLCBzdGF0ZSwgY2hvbXBlZFN0cmluZyk7CgkJCQkJCX0sCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCR0b2tlbigKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCQknKicsCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygnKicpKSkpLAoJCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoJGVsbSRjb3JlJEJhc2ljcyRpZGVudGl0eSksCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgKCQkJCQkJCQlBMigkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRJbmxpbmVzJG5leHRTdGVwV2hlbkZvdW5kTm90aGluZywgc3RhdGUsIGNob21wZWRTdHJpbmcpKSwKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRlbmQoCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygnRW5kIG9mIGlubGluZXMnKSkpKSwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQkJCUEyKCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJElubGluZXMkbmV4dFN0ZXBXaGVuQWxsRmFpbGVkLCBzdGF0ZSwgY2hvbXBlZFN0cmluZykpCgkJCQkJXSkpOwoJCX0sCgkJZnVuY3Rpb24gKCkgewoJCQlpZiAoYWxsRmFpbGVkLiQgPT09ICdOb3RoaW5nJykgewoJCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRDaG9tcGVkU3RyaW5nKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFdoaWxlKCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJElubGluZXMkaXNVbmludGVyZXN0aW5nKSk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgdW5oYW5sZGVkU3RyaW5nID0gYWxsRmFpbGVkLmE7CgkJCQlyZXR1cm4gQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgKCQkJCQkJZnVuY3Rpb24gKGNob21wZWQpIHsKCQkJCQkJCXJldHVybiBfVXRpbHNfYXAodW5oYW5sZGVkU3RyaW5nLCBjaG9tcGVkKTsKCQkJCQkJfSksCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGdldENob21wZWRTdHJpbmcoCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wSWYsCgkJCQkJCQlmdW5jdGlvbiAoX3Y0KSB7CgkJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCQl9LAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygnKicpKSkpOwoJCQl9CgkJfSgpKTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJElubGluZXMkcGFyc2UgPSBBMigKCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRsb29wLAoJX1V0aWxzX1R1cGxlMygKCQl7aXNCb2xkOiBmYWxzZSwgaXNDb2RlOiBmYWxzZSwgaXNJdGFsaWM6IGZhbHNlLCBsaW5rOiAkZWxtJGNvcmUkTWF5YmUkTm90aGluZ30sCgkJX0xpc3RfTmlsLAoJCSRlbG0kY29yZSRNYXliZSROb3RoaW5nKSwKCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJElubGluZXMkcGFyc2VIZWxwKTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRiYWdUb0xpc3QgPSBGMigKCWZ1bmN0aW9uIChiYWcsIGxpc3QpIHsKCQliYWdUb0xpc3Q6CgkJd2hpbGUgKHRydWUpIHsKCQkJc3dpdGNoIChiYWcuJCkgewoJCQkJY2FzZSAnRW1wdHknOgoJCQkJCXJldHVybiBsaXN0OwoJCQkJY2FzZSAnQWRkUmlnaHQnOgoJCQkJCXZhciBiYWcxID0gYmFnLmE7CgkJCQkJdmFyIHggPSBiYWcuYjsKCQkJCQl2YXIgJHRlbXAkYmFnID0gYmFnMSwKCQkJCQkJJHRlbXAkbGlzdCA9IEEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIHgsIGxpc3QpOwoJCQkJCWJhZyA9ICR0ZW1wJGJhZzsKCQkJCQlsaXN0ID0gJHRlbXAkbGlzdDsKCQkJCQljb250aW51ZSBiYWdUb0xpc3Q7CgkJCQlkZWZhdWx0OgoJCQkJCXZhciBiYWcxID0gYmFnLmE7CgkJCQkJdmFyIGJhZzIgPSBiYWcuYjsKCQkJCQl2YXIgJHRlbXAkYmFnID0gYmFnMSwKCQkJCQkJJHRlbXAkbGlzdCA9IEEyKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRiYWdUb0xpc3QsIGJhZzIsIGxpc3QpOwoJCQkJCWJhZyA9ICR0ZW1wJGJhZzsKCQkJCQlsaXN0ID0gJHRlbXAkbGlzdDsKCQkJCQljb250aW51ZSBiYWdUb0xpc3Q7CgkJCX0KCQl9Cgl9KTsKdmFyICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRydW4gPSBGMigKCWZ1bmN0aW9uIChfdjAsIHNyYykgewoJCXZhciBwYXJzZSA9IF92MC5hOwoJCXZhciBfdjEgPSBwYXJzZSgKCQkJe2NvbDogMSwgY29udGV4dDogX0xpc3RfTmlsLCBpbmRlbnQ6IDEsIG9mZnNldDogMCwgcm93OiAxLCBzcmM6IHNyY30pOwoJCWlmIChfdjEuJCA9PT0gJ0dvb2QnKSB7CgkJCXZhciB2YWx1ZSA9IF92MS5iOwoJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPayh2YWx1ZSk7CgkJfSBlbHNlIHsKCQkJdmFyIGJhZyA9IF92MS5iOwoJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRFcnIoCgkJCQlBMigkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkYmFnVG9MaXN0LCBiYWcsIF9MaXN0X05pbCkpOwoJCX0KCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHBhcnNlUmF3SW5saW5lID0gRjIoCglmdW5jdGlvbiAod3JhcCwgX3YwKSB7CgkJdmFyIHVucGFyc2VkSW5saW5lcyA9IF92MC5hOwoJCXZhciBfdjEgPSBBMigkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkcnVuLCAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRJbmxpbmVzJHBhcnNlLCB1bnBhcnNlZElubGluZXMpOwoJCWlmIChfdjEuJCA9PT0gJ09rJykgewoJCQl2YXIgc3R5bGVkTGluZSA9IF92MS5hOwoJCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQl3cmFwKHN0eWxlZExpbmUpKTsKCQl9IGVsc2UgewoJCQl2YXIgZXJyb3IgPSBfdjEuYTsKCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRwcm9ibGVtKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygKCQkJCQlBMigKCQkJCQkJJGVsbSRjb3JlJFN0cmluZyRqb2luLAoJCQkJCQknXG4nLAoJCQkJCQlBMigkZWxtJGNvcmUkTGlzdCRtYXAsICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRkZWFkRW5kVG9TdHJpbmcsIGVycm9yKSkpKTsKCQl9Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRwYXJzZUlubGluZXMgPSBmdW5jdGlvbiAocmF3QmxvY2spIHsKCXN3aXRjaCAocmF3QmxvY2suJCkgewoJCWNhc2UgJ0hlYWRpbmcnOgoJCQl2YXIgbGV2ZWwgPSByYXdCbG9jay5hOwoJCQl2YXIgdW5wYXJzZWRJbmxpbmVzID0gcmF3QmxvY2suYi5hOwoJCQl2YXIgX3YxID0gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHJ1biwgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyRwYXJzZSwgdW5wYXJzZWRJbmxpbmVzKTsKCQkJaWYgKF92MS4kID09PSAnT2snKSB7CgkJCQl2YXIgc3R5bGVkTGluZSA9IF92MS5hOwoJCQkJcmV0dXJuICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRqdXN0KAoJCQkJCUEyKCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEJsb2NrJEhlYWRpbmcsIGxldmVsLCBzdHlsZWRMaW5lKSk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgZXJyb3IgPSBfdjEuYTsKCQkJCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkcHJvYmxlbSgKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nKAoJCQkJCQlBMigKCQkJCQkJCSRlbG0kY29yZSRTdHJpbmckam9pbiwKCQkJCQkJCSdcbicsCgkJCQkJCQlBMigkZWxtJGNvcmUkTGlzdCRtYXAsICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRkZWFkRW5kVG9TdHJpbmcsIGVycm9yKSkpKTsKCQkJfQoJCWNhc2UgJ0JvZHknOgoJCQl2YXIgdW5wYXJzZWRJbmxpbmVzID0gcmF3QmxvY2suYS5hOwoJCQl2YXIgX3YyID0gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHJ1biwgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyRwYXJzZSwgdW5wYXJzZWRJbmxpbmVzKTsKCQkJaWYgKF92Mi4kID09PSAnT2snKSB7CgkJCQl2YXIgc3R5bGVkTGluZSA9IF92Mi5hOwoJCQkJcmV0dXJuICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRqdXN0KAoJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEJsb2NrJEJvZHkoc3R5bGVkTGluZSkpOwoJCQl9IGVsc2UgewoJCQkJdmFyIGVycm9yID0gX3YyLmE7CgkJCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHByb2JsZW0oCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygKCQkJCQkJQTIoCgkJCQkJCQkkZWxtJGNvcmUkU3RyaW5nJGpvaW4sCgkJCQkJCQknXG4nLAoJCQkJCQkJQTIoJGVsbSRjb3JlJExpc3QkbWFwLCAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkZGVhZEVuZFRvU3RyaW5nLCBlcnJvcikpKSk7CgkJCX0KCQljYXNlICdIdG1sJzoKCQkJdmFyIHRhZ05hbWUgPSByYXdCbG9jay5hOwoJCQl2YXIgYXR0cmlidXRlcyA9IHJhd0Jsb2NrLmI7CgkJCXZhciBjaGlsZHJlbiA9IHJhd0Jsb2NrLmM7CgkJCXJldHVybiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkanVzdCgKCQkJCUEzKCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEJsb2NrJEh0bWwsIHRhZ05hbWUsIGF0dHJpYnV0ZXMsIGNoaWxkcmVuKSk7CgkJY2FzZSAnTGlzdEJsb2NrJzoKCQkJdmFyIHVucGFyc2VkSW5saW5lcyA9IHJhd0Jsb2NrLmE7CgkJCXJldHVybiBBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCQkkZWxtJGNvcmUkTWF5YmUkSnVzdCwKCQkJCUEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQmxvY2skTGlzdEJsb2NrLAoJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjb21iaW5lKAoJCQkJCQkkZWxtJGNvcmUkTGlzdCRyZXZlcnNlKAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRjb3JlJExpc3QkbWFwLAoJCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRwYXJzZVJhd0lubGluZSgkZWxtJGNvcmUkQmFzaWNzJGlkZW50aXR5KSwKCQkJCQkJCQl1bnBhcnNlZElubGluZXMpKSkpKTsKCQljYXNlICdDb2RlQmxvY2snOgoJCQl2YXIgY29kZUJsb2NrID0gcmF3QmxvY2suYTsKCQkJcmV0dXJuICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRqdXN0KAoJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQmxvY2skQ29kZUJsb2NrKGNvZGVCbG9jaykpOwoJCWNhc2UgJ1RoZW1hdGljQnJlYWsnOgoJCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGp1c3QoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQmxvY2skVGhlbWF0aWNCcmVhayk7CgkJZGVmYXVsdDoKCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKCRlbG0kY29yZSRNYXliZSROb3RoaW5nKTsKCX0KfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjb21iaW5lQmxvY2tzID0gRjIoCglmdW5jdGlvbiAocmF3QmxvY2ssIHNvRmFyKSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkYW5kVGhlbiwKCQkJZnVuY3Rpb24gKHBhcnNlZEJsb2NrcykgewoJCQkJcmV0dXJuIEEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCQkJZnVuY3Rpb24gKG1heWJlTmV3UGFyc2VkQmxvY2spIHsKCQkJCQkJaWYgKG1heWJlTmV3UGFyc2VkQmxvY2suJCA9PT0gJ0p1c3QnKSB7CgkJCQkJCQl2YXIgbmV3UGFyc2VkQmxvY2sgPSBtYXliZU5ld1BhcnNlZEJsb2NrLmE7CgkJCQkJCQlyZXR1cm4gQTIoJGVsbSRjb3JlJExpc3QkY29ucywgbmV3UGFyc2VkQmxvY2ssIHBhcnNlZEJsb2Nrcyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlyZXR1cm4gcGFyc2VkQmxvY2tzOwoJCQkJCQl9CgkJCQkJfSwKCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkcGFyc2VJbmxpbmVzKHJhd0Jsb2NrKSk7CgkJCX0sCgkJCXNvRmFyKTsKCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHBhcnNlQWxsSW5saW5lcyA9IGZ1bmN0aW9uIChyYXdCbG9ja3MpIHsKCXJldHVybiBBMygKCQkkZWxtJGNvcmUkTGlzdCRmb2xkbCwKCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkY29tYmluZUJsb2NrcywKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChfTGlzdF9OaWwpLAoJCXJhd0Jsb2Nrcyk7Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRDb2RlQmxvY2skaW5kZW50ZWRCbG9jayA9IEEyKAoJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCUEyKAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKAoJCQlmdW5jdGlvbiAoYm9keSkgewoJCQkJcmV0dXJuIHtib2R5OiBib2R5LCBsYW5ndWFnZTogJGVsbSRjb3JlJE1heWJlJE5vdGhpbmd9OwoJCQl9KSwKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YoCgkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCVsKCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3ltYm9sKAoJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkVG9rZW4sCgkJCQkJCScgICAgJywKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbCgnSW5kZW50YXRpb24nKSkpLAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzeW1ib2woCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJJ1x0JywKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbCgnSW5kZW50YXRpb24nKSkpCgkJCQldKSkpLAoJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGdldENob21wZWRTdHJpbmcoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wVW50aWxFbmRPcignXG4nKSkpOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQ29kZUJsb2NrJHBhcnNlckhlbHAgPSBmdW5jdGlvbiAoZGVsaW1ldGVyKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQlBMigKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGtlZXBlciwKCQkJQTIoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKAoJCQkJCUYyKAoJCQkJCQlmdW5jdGlvbiAobGFuZ3VhZ2UsIGJvZHkpIHsKCQkJCQkJCXJldHVybiB7CgkJCQkJCQkJYm9keTogYm9keSwKCQkJCQkJCQlsYW5ndWFnZTogKGxhbmd1YWdlID09PSAnJykgPyAkZWxtJGNvcmUkTWF5YmUkTm90aGluZyA6ICRlbG0kY29yZSRNYXliZSRKdXN0KGxhbmd1YWdlKQoJCQkJCQkJfTsKCQkJCQkJfSkpLAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQlkZWxpbWV0ZXIsCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmdTeW1ib2woZGVsaW1ldGVyKSkpKSwKCQkJQTIoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRnZXRDaG9tcGVkU3RyaW5nKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFVudGlsKAoJCQkJCQlBMigKCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCSdcbicsCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkUHJvYmxlbSgnRXhwZWN0aW5nIG5ld2xpbmUnKSkpKSwKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzeW1ib2woCgkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJJ1xuJywKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbCgnXG4nKSkpKSksCgkJQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkZ2V0Q2hvbXBlZFN0cmluZygKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFVudGlsRW5kT3IoJ1xuJyArIGRlbGltZXRlcikpLAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3ltYm9sKAoJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCSdcbicgKyBkZWxpbWV0ZXIsCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZ1N5bWJvbChkZWxpbWV0ZXIpKSkpKTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJENvZGVCbG9jayRwYXJzZXIgPSAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YoCglfTGlzdF9mcm9tQXJyYXkoCgkJWwoJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRDb2RlQmxvY2skcGFyc2VySGVscCgnYGBgJyksCgkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJENvZGVCbG9jayRwYXJzZXJIZWxwKCd+fn4nKSwKCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQ29kZUJsb2NrJGluZGVudGVkQmxvY2sKCQldKSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkcGxhaW5MaW5lID0gQTIoCgkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQka2VlcGVyLAoJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJZnVuY3Rpb24gKHJhd0xpbmUpIHsKCQkJcmV0dXJuICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRCb2R5KAoJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJFVucGFyc2VkSW5saW5lcyhyYXdMaW5lKSk7CgkJfSksCglBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkZ2V0Q2hvbXBlZFN0cmluZygKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wVW50aWxFbmRPcignXG4nKSksCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG9uZU9mKAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJQTIoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wSWYsCgkJCQkJZnVuY3Rpb24gKGMpIHsKCQkJCQkJcmV0dXJuIF9VdGlsc19lcSgKCQkJCQkJCWMsCgkJCQkJCQlfVXRpbHNfY2hyKCdcbicpKTsKCQkJCQl9LAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmcoJ0Egc2luZ2xlIG5vbi1uZXdsaW5lIGNoYXIuJykpLAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRlbmQoCgkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygnRW5kJykpCgkJCQldKSkpKTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRUaGVtYXRpY0JyZWFrID0geyQ6ICdUaGVtYXRpY0JyZWFrJ307CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkc3BhY2VPclRhYiA9IGZ1bmN0aW9uIChjKSB7CglyZXR1cm4gX1V0aWxzX2VxKAoJCWMsCgkJX1V0aWxzX2NocignICcpKSB8fCBfVXRpbHNfZXEoCgkJYywKCQlfVXRpbHNfY2hyKCdcdCcpKTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciR6ZXJvT3JNb3JlID0gZnVuY3Rpb24gKGNvbmRpdGlvbikgewoJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFdoaWxlKGNvbmRpdGlvbik7Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkdGhlbWF0aWNCcmVhayA9IEEyKAoJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCglBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQlBMigKCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCUEyKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZCgkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkVGhlbWF0aWNCcmVhayksCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YoCgkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQlbCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3ltYm9sKAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQkJCScgICAnLAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRQcm9ibGVtKCdFeHBlY3RpbmcgMyBzcGFjZXMnKSkpLAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCQknICAnLAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRQcm9ibGVtKCdFeHBlY3RpbmcgMiBzcGFjZXMnKSkpLAoJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCQknICcsCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJFByb2JsZW0oJ0V4cGVjdGluZyBzcGFjZScpKSksCgkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3VjY2VlZChfVXRpbHNfVHVwbGUwKQoJCQkJCQldKSkpLAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YoCgkJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQkJWwoJCQkJCQlBMigKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGlnbm9yZXIsCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzeW1ib2woCgkJCQkJCQlBMigKCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkVG9rZW4sCgkJCQkJCQkJJy0tLScsCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygnLS0tJykpKSwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGNob21wV2hpbGUoCgkJCQkJCQlmdW5jdGlvbiAoYykgewoJCQkJCQkJCXJldHVybiBfVXRpbHNfZXEoCgkJCQkJCQkJCWMsCgkJCQkJCQkJCV9VdGlsc19jaHIoJy0nKSk7CgkJCQkJCQl9KSksCgkJCQkJCUEyKAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN5bWJvbCgKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRUb2tlbiwKCQkJCQkJCQknKioqJywKCQkJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkRXhwZWN0aW5nKCcqKionKSkpLAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBXaGlsZSgKCQkJCQkJCWZ1bmN0aW9uIChjKSB7CgkJCQkJCQkJcmV0dXJuIF9VdGlsc19lcSgKCQkJCQkJCQkJYywKCQkJCQkJCQkJX1V0aWxzX2NocignKicpKTsKCQkJCQkJCX0pKSwKCQkJCQkJQTIoCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRpZ25vcmVyLAoJCQkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkc3ltYm9sKAoJCQkJCQkJQTIoCgkJCQkJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJFRva2VuLAoJCQkJCQkJCSdfX18nLAoJCQkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmcoJ19fXycpKSksCgkJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRjaG9tcFdoaWxlKAoJCQkJCQkJZnVuY3Rpb24gKGMpIHsKCQkJCQkJCQlyZXR1cm4gX1V0aWxzX2VxKAoJCQkJCQkJCQljLAoJCQkJCQkJCQlfVXRpbHNfY2hyKCdfJykpOwoJCQkJCQkJfSkpCgkJCQkJXSkpKSwKCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkemVyb09yTW9yZSgkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkc3BhY2VPclRhYikpLAoJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG9uZU9mKAoJCV9MaXN0X2Zyb21BcnJheSgKCQkJWwoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGVuZCgKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRQcm9ibGVtKCdFeHBlY3RpbmcgZW5kJykpLAoJCQkJQTIoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkY2hvbXBJZiwKCQkJCWZ1bmN0aW9uIChjKSB7CgkJCQkJcmV0dXJuIF9VdGlsc19lcSgKCQkJCQkJYywKCQkJCQkJX1V0aWxzX2NocignXG4nKSk7CgkJCQl9LAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJFByb2JsZW0oJ0V4cGVjdGluZyBuZXdsaW5lJykpCgkJCV0pKSk7CnZhciAkZWxtJGNvcmUkU3RyaW5nJHRyaW0gPSBfU3RyaW5nX3RyaW07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkY2hpbGRUb1BhcnNlciA9IGZ1bmN0aW9uIChub2RlKSB7CglpZiAobm9kZS4kID09PSAnRWxlbWVudCcpIHsKCQl2YXIgdGFnID0gbm9kZS5hOwoJCXZhciBhdHRyaWJ1dGVzID0gbm9kZS5iOwoJCXZhciBjaGlsZHJlbiA9IG5vZGUuYzsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCQlmdW5jdGlvbiAoY2hpbGRyZW5Bc0Jsb2NrcykgewoJCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJQTMoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQmxvY2skSHRtbCwgdGFnLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbkFzQmxvY2tzKQoJCQkJCQldKSk7CgkJCX0sCgkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRub2Rlc1RvQmxvY2tzUGFyc2VyKGNoaWxkcmVuKSk7Cgl9IGVsc2UgewoJCXZhciBpbm5lclRleHQgPSBub2RlLmE7CgkJdmFyIF92NSA9IEEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkcnVuLAoJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkY3ljbGljJG11bHRpUGFyc2VyMigpLAoJCQlpbm5lclRleHQpOwoJCWlmIChfdjUuJCA9PT0gJ09rJykgewoJCQl2YXIgdmFsdWUgPSBfdjUuYTsKCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRzdWNjZWVkKHZhbHVlKTsKCQl9IGVsc2UgewoJCQl2YXIgZXJyb3IgPSBfdjUuYTsKCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRwcm9ibGVtKAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEV4cGVjdGluZygKCQkJCQlBMigKCQkJCQkJJGVsbSRjb3JlJFN0cmluZyRqb2luLAoJCQkJCQknXG4nLAoJCQkJCQlBMigkZWxtJGNvcmUkTGlzdCRtYXAsICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRkZWFkRW5kVG9TdHJpbmcsIGVycm9yKSkpKTsKCQl9Cgl9Cn07CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkbm9kZXNUb0Jsb2Nrc1BhcnNlciA9IGZ1bmN0aW9uIChjaGlsZHJlbikgewoJcmV0dXJuIEEyKAoJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJJGVsbSRjb3JlJExpc3QkY29uY2F0LAoJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjb21iaW5lKAoJCQlBMigkZWxtJGNvcmUkTGlzdCRtYXAsICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjaGlsZFRvUGFyc2VyLCBjaGlsZHJlbikpKTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRzdGF0ZW1lbnRzSGVscDIgPSBmdW5jdGlvbiAocmV2U3RtdHMpIHsKCXZhciBrZWVwTG9vcGluZyA9IGZ1bmN0aW9uIChwYXJzZXIpIHsKCQlyZXR1cm4gQTIoCgkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCWZ1bmN0aW9uIChzdG10cykgewoJCQkJdmFyIF92MiA9IF9VdGlsc19UdXBsZTIoc3RtdHMsIHJldlN0bXRzKTsKCQkJCWlmICgoKF92Mi5hLiQgPT09ICdCb2R5JykgJiYgX3YyLmIuYikgJiYgKF92Mi5iLmEuJCA9PT0gJ0JvZHknKSkgewoJCQkJCXZhciBib2R5MSA9IF92Mi5hLmEuYTsKCQkJCQl2YXIgX3YzID0gX3YyLmI7CgkJCQkJdmFyIGJvZHkyID0gX3YzLmEuYS5hOwoJCQkJCXZhciByZXN0ID0gX3YzLmI7CgkJCQkJdmFyIGJvZHkyVHJpbW1lZCA9ICRlbG0kY29yZSRTdHJpbmckdHJpbShib2R5Mik7CgkJCQkJdmFyIGJvZHkxVHJpbW1lZCA9ICRlbG0kY29yZSRTdHJpbmckdHJpbShib2R5MSk7CgkJCQkJcmV0dXJuICgoYm9keTFUcmltbWVkID09PSAnJykgfHwgKGJvZHkyVHJpbW1lZCA9PT0gJycpKSA/ICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRMb29wKAoJCQkJCQlBMigKCQkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkQm9keSgKCQkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkVW5wYXJzZWRJbmxpbmVzKAoJCQkJCQkJCQlfVXRpbHNfYXAoYm9keTJUcmltbWVkLCBib2R5MVRyaW1tZWQpKSksCgkJCQkJCQlyZXN0KSkgOiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkTG9vcCgKCQkJCQkJQTIoCgkJCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJEJvZHkoCgkJCQkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJFVucGFyc2VkSW5saW5lcyhib2R5MlRyaW1tZWQgKyAoJyAnICsgYm9keTFUcmltbWVkKSkpLAoJCQkJCQkJcmVzdCkpOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJExvb3AoCgkJCQkJCUEyKCRlbG0kY29yZSRMaXN0JGNvbnMsIHN0bXRzLCByZXZTdG10cykpOwoJCQkJfQoJCQl9LAoJCQlwYXJzZXIpOwoJfTsKCXJldHVybiAkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkb25lT2YoCgkJX0xpc3RfZnJvbUFycmF5KAoJCQlbCgkJCQlBMigKCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRtYXAsCgkJCQlmdW5jdGlvbiAoX3YxKSB7CgkJCQkJcmV0dXJuICRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCREb25lKHJldlN0bXRzKTsKCQkJCX0sCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkZW5kKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRFeHBlY3RpbmcoJ0VuZCcpKSksCgkJCQlrZWVwTG9vcGluZygkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkYmxhbmtMaW5lKSwKCQkJCWtlZXBMb29waW5nKAoJCQkJQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG1hcCwgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJENvZGVCbG9jaywgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kQ29kZUJsb2NrJHBhcnNlcikpLAoJCQkJa2VlcExvb3BpbmcoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHRoZW1hdGljQnJlYWspLAoJCQkJa2VlcExvb3BpbmcoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGxpc3RCbG9jayksCgkJCQlrZWVwTG9vcGluZygkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkaGVhZGluZyksCgkJCQlrZWVwTG9vcGluZygKCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjeWNsaWMkaHRtbFBhcnNlcigpKSwKCQkJCWtlZXBMb29waW5nKCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRwbGFpbkxpbmUpLAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkRG9uZShyZXZTdG10cykpCgkJCV0pKTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciR4bWxOb2RlVG9IdG1sTm9kZSA9IGZ1bmN0aW9uIChwYXJzZXIpIHsKCXJldHVybiBBMigKCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkYW5kVGhlbiwKCQlmdW5jdGlvbiAoeG1sTm9kZSkgewoJCQlpZiAoeG1sTm9kZS4kID09PSAnVGV4dCcpIHsKCQkJCXZhciBpbm5lclRleHQgPSB4bWxOb2RlLmE7CgkJCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJEJvZHkoCgkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRVbnBhcnNlZElubGluZXMoaW5uZXJUZXh0KSkpOwoJCQl9IGVsc2UgewoJCQkJdmFyIHRhZyA9IHhtbE5vZGUuYTsKCQkJCXZhciBhdHRyaWJ1dGVzID0geG1sTm9kZS5iOwoJCQkJdmFyIGNoaWxkcmVuID0geG1sTm9kZS5jOwoJCQkJcmV0dXJuIEEyKAoJCQkJCSRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRhbmRUaGVuLAoJCQkJCWZ1bmN0aW9uIChwYXJzZWRDaGlsZHJlbikgewoJCQkJCQlyZXR1cm4gJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoCgkJCQkJCQlBMygkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkSHRtbCwgdGFnLCBhdHRyaWJ1dGVzLCBwYXJzZWRDaGlsZHJlbikpOwoJCQkJCX0sCgkJCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJG5vZGVzVG9CbG9ja3NQYXJzZXIoY2hpbGRyZW4pKTsKCQkJfQoJCX0sCgkJcGFyc2VyKTsKfTsKZnVuY3Rpb24gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGN5Y2xpYyRodG1sUGFyc2VyKCkgewoJcmV0dXJuICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciR4bWxOb2RlVG9IdG1sTm9kZSgkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRYbWxQYXJzZXIkZWxlbWVudCk7Cn0KZnVuY3Rpb24gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGN5Y2xpYyRtdWx0aVBhcnNlcjIoKSB7CglyZXR1cm4gQTIoCgkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJG1hcCwKCQkkZWxtJGNvcmUkTGlzdCRmaWx0ZXIoCgkJCWZ1bmN0aW9uIChpdGVtKSB7CgkJCQlyZXR1cm4gIV9VdGlsc19lcSgKCQkJCQlpdGVtLAoJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJEJsb2NrJEJvZHkoX0xpc3RfTmlsKSk7CgkJCX0pLAoJCUEyKAoJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkYW5kVGhlbiwKCQkJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHBhcnNlQWxsSW5saW5lcywKCQkJQTIoCgkJCQkkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkaWdub3JlciwKCQkJCUEyKCRlbG0kcGFyc2VyJFBhcnNlciRBZHZhbmNlZCRsb29wLCBfTGlzdF9OaWwsICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRzdGF0ZW1lbnRzSGVscDIpLAoJCQkJJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHN1Y2NlZWQoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJGVuZCkpKSk7Cn0KdHJ5IHsKCXZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkaHRtbFBhcnNlciA9ICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjeWNsaWMkaHRtbFBhcnNlcigpOwoJJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGN5Y2xpYyRodG1sUGFyc2VyID0gZnVuY3Rpb24gKCkgewoJCXJldHVybiAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkaHRtbFBhcnNlcjsKCX07Cgl2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJG11bHRpUGFyc2VyMiA9ICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjeWNsaWMkbXVsdGlQYXJzZXIyKCk7CgkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkY3ljbGljJG11bHRpUGFyc2VyMiA9IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJG11bHRpUGFyc2VyMjsKCX07Cn0gY2F0Y2ggKCQpIHsKCXRocm93ICdTb21lIHRvcC1sZXZlbCBkZWZpbml0aW9ucyBmcm9tIGBNYXJrZG93bi5QYXJzZXJgIGFyZSBjYXVzaW5nIGluZmluaXRlIHJlY3Vyc2lvbjpcblxuICDilIzilIDilIDilIDilIDilIDilJBcbiAg4pSCICAgIGNoaWxkVG9QYXJzZXJcbiAg4pSCICAgICDihpNcbiAg4pSCICAgIGh0bWxQYXJzZXJcbiAg4pSCICAgICDihpNcbiAg4pSCICAgIG11bHRpUGFyc2VyMlxuICDilIIgICAgIOKGk1xuICDilIIgICAgbm9kZXNUb0Jsb2Nrc1BhcnNlclxuICDilIIgICAgIOKGk1xuICDilIIgICAgc3RhdGVtZW50c0hlbHAyXG4gIOKUgiAgICAg4oaTXG4gIOKUgiAgICB4bWxOb2RlVG9IdG1sTm9kZVxuICDilJTilIDilIDilIDilIDilIDilJhcblxuVGhlc2UgZXJyb3JzIGFyZSB2ZXJ5IHRyaWNreSwgc28gcmVhZCBodHRwczovL2VsbS1sYW5nLm9yZy8wLjE5LjEvYmFkLXJlY3Vyc2lvbiB0byBsZWFybiBob3cgdG8gZml4IGl0ISc7fQp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHBhcnNlID0gZnVuY3Rpb24gKGlucHV0KSB7CglyZXR1cm4gQTIoJGVsbSRwYXJzZXIkUGFyc2VyJEFkdmFuY2VkJHJ1biwgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJG11bHRpUGFyc2VyMiwgaW5wdXQpOwp9Owp2YXIgJGVsbSRjb3JlJFJlc3VsdCRtYXAyID0gRjMoCglmdW5jdGlvbiAoZnVuYywgcmEsIHJiKSB7CgkJaWYgKHJhLiQgPT09ICdFcnInKSB7CgkJCXZhciB4ID0gcmEuYTsKCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkRXJyKHgpOwoJCX0gZWxzZSB7CgkJCXZhciBhID0gcmEuYTsKCQkJaWYgKHJiLiQgPT09ICdFcnInKSB7CgkJCQl2YXIgeCA9IHJiLmE7CgkJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRFcnIoeCk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgYiA9IHJiLmE7CgkJCQlyZXR1cm4gJGVsbSRjb3JlJFJlc3VsdCRPaygKCQkJCQlBMihmdW5jLCBhLCBiKSk7CgkJCX0KCQl9Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjb21iaW5lUmVzdWx0cyA9IEEyKAoJJGVsbSRjb3JlJExpc3QkZm9sZHIsCgkkZWxtJGNvcmUkUmVzdWx0JG1hcDIoJGVsbSRjb3JlJExpc3QkY29ucyksCgkkZWxtJGNvcmUkUmVzdWx0JE9rKF9MaXN0X05pbCkpOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHJlbmRlckh0bWwgPSBGNSgKCWZ1bmN0aW9uICh0YWdOYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbiwgX3YwLCByZW5kZXJlZENoaWxkcmVuKSB7CgkJdmFyIGh0bWxSZW5kZXJlciA9IF92MC5hOwoJCXJldHVybiBBMigKCQkJJGVsbSRjb3JlJFJlc3VsdCRhbmRUaGVuLAoJCQlmdW5jdGlvbiAob2tDaGlsZHJlbikgewoJCQkJcmV0dXJuIEEyKAoJCQkJCSRlbG0kY29yZSRSZXN1bHQkbWFwLAoJCQkJCWZ1bmN0aW9uIChteVJlbmRlcmVyKSB7CgkJCQkJCXJldHVybiBteVJlbmRlcmVyKG9rQ2hpbGRyZW4pOwoJCQkJCX0sCgkJCQkJQTMoaHRtbFJlbmRlcmVyLCB0YWdOYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbikpOwoJCQl9LAoJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkY29tYmluZVJlc3VsdHMocmVuZGVyZWRDaGlsZHJlbikpOwoJfSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkZm9sZFRoaW5nID0gRjMoCglmdW5jdGlvbiAocmVuZGVyZXIsIF92MCwgc29GYXIpIHsKCQl2YXIgc3R5bGUgPSBfdjAuc3R5bGU7CgkJdmFyIHN0cmluZyA9IF92MC5zdHJpbmc7CgkJdmFyIF92MSA9IHN0eWxlLmxpbms7CgkJaWYgKF92MS4kID09PSAnSnVzdCcpIHsKCQkJdmFyIGxpbmsgPSBfdjEuYTsKCQkJdmFyIF92MiA9IGxpbmsuZGVzdGluYXRpb247CgkJCWlmIChfdjIuJCA9PT0gJ0xpbmsnKSB7CgkJCQl2YXIgZGVzdGluYXRpb24gPSBfdjIuYTsKCQkJCXZhciBfdjMgPSBBMigkZWxtJHBhcnNlciRQYXJzZXIkQWR2YW5jZWQkcnVuLCAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRJbmxpbmVzJHBhcnNlLCBzdHJpbmcpOwoJCQkJaWYgKF92My4kID09PSAnT2snKSB7CgkJCQkJdmFyIHN0eWxlZExpbmUgPSBfdjMuYTsKCQkJCQlyZXR1cm4gQTIoCgkJCQkJCSRlbG0kY29yZSRMaXN0JGNvbnMsCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRjb3JlJFJlc3VsdCRhbmRUaGVuLAoJCQkJCQkJZnVuY3Rpb24gKGNoaWxkcmVuKSB7CgkJCQkJCQkJcmV0dXJuIEEyKAoJCQkJCQkJCQlyZW5kZXJlci5saW5rLAoJCQkJCQkJCQl7ZGVzdGluYXRpb246IGRlc3RpbmF0aW9uLCB0aXRsZTogbGluay50aXRsZX0sCgkJCQkJCQkJCWNoaWxkcmVuKTsKCQkJCQkJCX0sCgkJCQkJCQlBMigkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkcmVuZGVyU3R5bGVkLCByZW5kZXJlciwgc3R5bGVkTGluZSkpLAoJCQkJCQlzb0Zhcik7CgkJCQl9IGVsc2UgewoJCQkJCXZhciBlcnJvciA9IF92My5hOwoJCQkJCXJldHVybiBfVXRpbHNfYXAoCgkJCQkJCUEyKAoJCQkJCQkJJGVsbSRjb3JlJExpc3QkbWFwLAoJCQkJCQkJJGVsbSRjb3JlJFJlc3VsdCRFcnIsCgkJCQkJCQlBMigkZWxtJGNvcmUkTGlzdCRtYXAsICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRkZWFkRW5kVG9TdHJpbmcsIGVycm9yKSksCgkJCQkJCXNvRmFyKTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXZhciBzcmMgPSBfdjIuYTsKCQkJCXJldHVybiBBMigKCQkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJCUEyKAoJCQkJCQlyZW5kZXJlci5pbWFnZSwKCQkJCQkJe3NyYzogc3JjfSwKCQkJCQkJc3RyaW5nKSwKCQkJCQlzb0Zhcik7CgkJCX0KCQl9IGVsc2UgewoJCQlyZXR1cm4gc3R5bGUuaXNCb2xkID8gQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJJGVsbSRjb3JlJFJlc3VsdCRPaygKCQkJCQlyZW5kZXJlci5ib2xkKHN0cmluZykpLAoJCQkJc29GYXIpIDogKHN0eWxlLmlzSXRhbGljID8gQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJJGVsbSRjb3JlJFJlc3VsdCRPaygKCQkJCQlyZW5kZXJlci5pdGFsaWMoc3RyaW5nKSksCgkJCQlzb0ZhcikgOiAoc3R5bGUuaXNDb2RlID8gQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJJGVsbSRjb3JlJFJlc3VsdCRPaygKCQkJCQlyZW5kZXJlci5jb2RlKHN0cmluZykpLAoJCQkJc29GYXIpIDogQTIoCgkJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkJJGVsbSRjb3JlJFJlc3VsdCRPaygKCQkJCQlyZW5kZXJlci5wbGFpbihzdHJpbmcpKSwKCQkJCXNvRmFyKSkpOwoJCX0KCX0pOwp2YXIgJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHJlbmRlclN0eWxlZCA9IEYyKAoJZnVuY3Rpb24gKHJlbmRlcmVyLCBzdHlsZWRTdHJpbmdzKSB7CgkJcmV0dXJuICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjb21iaW5lUmVzdWx0cygKCQkJQTMoCgkJCQkkZWxtJGNvcmUkTGlzdCRmb2xkciwKCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRmb2xkVGhpbmcocmVuZGVyZXIpLAoJCQkJX0xpc3RfTmlsLAoJCQkJc3R5bGVkU3RyaW5ncykpOwoJfSk7CnZhciAkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRJbmxpbmVzJHRvU3RyaW5nID0gZnVuY3Rpb24gKGxpc3QpIHsKCXJldHVybiBBMigKCQkkZWxtJGNvcmUkU3RyaW5nJGpvaW4sCgkJJy0nLAoJCUEyKAoJCQkkZWxtJGNvcmUkTGlzdCRtYXAsCgkJCWZ1bmN0aW9uICgkKSB7CgkJCQlyZXR1cm4gJC5zdHJpbmc7CgkJCX0sCgkJCWxpc3QpKTsKfTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRyZW5kZXJIZWxwZXIgPSBGMigKCWZ1bmN0aW9uIChyZW5kZXJlciwgYmxvY2tzKSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJGNvcmUkTGlzdCRtYXAsCgkJCWZ1bmN0aW9uIChibG9jaykgewoJCQkJc3dpdGNoIChibG9jay4kKSB7CgkJCQkJY2FzZSAnSGVhZGluZyc6CgkJCQkJCXZhciBsZXZlbCA9IGJsb2NrLmE7CgkJCQkJCXZhciBjb250ZW50ID0gYmxvY2suYjsKCQkJCQkJcmV0dXJuIEEyKAoJCQkJCQkJJGVsbSRjb3JlJFJlc3VsdCRtYXAsCgkJCQkJCQlmdW5jdGlvbiAoY2hpbGRyZW4pIHsKCQkJCQkJCQlyZXR1cm4gcmVuZGVyZXIuaGVhZGluZygKCQkJCQkJCQkJewoJCQkJCQkJCQkJY2hpbGRyZW46IGNoaWxkcmVuLAoJCQkJCQkJCQkJbGV2ZWw6IGxldmVsLAoJCQkJCQkJCQkJcmF3VGV4dDogJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kSW5saW5lcyR0b1N0cmluZyhjb250ZW50KQoJCQkJCQkJCQl9KTsKCQkJCQkJCX0sCgkJCQkJCQlBMigkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkcmVuZGVyU3R5bGVkLCByZW5kZXJlciwgY29udGVudCkpOwoJCQkJCWNhc2UgJ0JvZHknOgoJCQkJCQl2YXIgY29udGVudCA9IGJsb2NrLmE7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCSRlbG0kY29yZSRSZXN1bHQkbWFwLAoJCQkJCQkJcmVuZGVyZXIucmF3LAoJCQkJCQkJQTIoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHJlbmRlclN0eWxlZCwgcmVuZGVyZXIsIGNvbnRlbnQpKTsKCQkJCQljYXNlICdIdG1sJzoKCQkJCQkJdmFyIHRhZyA9IGJsb2NrLmE7CgkJCQkJCXZhciBhdHRyaWJ1dGVzID0gYmxvY2suYjsKCQkJCQkJdmFyIGNoaWxkcmVuID0gYmxvY2suYzsKCQkJCQkJcmV0dXJuIEE0KCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRyZW5kZXJIdG1sTm9kZSwgcmVuZGVyZXIsIHRhZywgYXR0cmlidXRlcywgY2hpbGRyZW4pOwoJCQkJCWNhc2UgJ0xpc3RCbG9jayc6CgkJCQkJCXZhciBpdGVtcyA9IGJsb2NrLmE7CgkJCQkJCXJldHVybiBBMigKCQkJCQkJCSRlbG0kY29yZSRSZXN1bHQkbWFwLAoJCQkJCQkJcmVuZGVyZXIubGlzdCwKCQkJCQkJCUEyKAoJCQkJCQkJCSRlbG0kY29yZSRSZXN1bHQkbWFwLAoJCQkJCQkJCSRlbG0kY29yZSRMaXN0JG1hcChyZW5kZXJlci5yYXcpLAoJCQkJCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjb21iaW5lUmVzdWx0cygKCQkJCQkJCQkJQTIoCgkJCQkJCQkJCQkkZWxtJGNvcmUkTGlzdCRtYXAsCgkJCQkJCQkJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkcmVuZGVyU3R5bGVkKHJlbmRlcmVyKSwKCQkJCQkJCQkJCWl0ZW1zKSkpKTsKCQkJCQljYXNlICdDb2RlQmxvY2snOgoJCQkJCQl2YXIgY29kZUJsb2NrID0gYmxvY2suYTsKCQkJCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkT2soCgkJCQkJCQlyZW5kZXJlci5jb2RlQmxvY2soY29kZUJsb2NrKSk7CgkJCQkJZGVmYXVsdDoKCQkJCQkJcmV0dXJuICRlbG0kY29yZSRSZXN1bHQkT2socmVuZGVyZXIudGhlbWF0aWNCcmVhayk7CgkJCQl9CgkJCX0sCgkJCWJsb2Nrcyk7Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRyZW5kZXJIdG1sTm9kZSA9IEY0KAoJZnVuY3Rpb24gKHJlbmRlcmVyLCB0YWcsIGF0dHJpYnV0ZXMsIGNoaWxkcmVuKSB7CgkJcmV0dXJuIEE1KAoJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkcmVuZGVySHRtbCwKCQkJdGFnLAoJCQlhdHRyaWJ1dGVzLAoJCQljaGlsZHJlbiwKCQkJcmVuZGVyZXIuaHRtbCwKCQkJQTIoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHJlbmRlckhlbHBlciwgcmVuZGVyZXIsIGNoaWxkcmVuKSk7Cgl9KTsKdmFyICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRyZW5kZXIgPSBGMigKCWZ1bmN0aW9uIChyZW5kZXJlciwgYXN0KSB7CgkJcmV0dXJuICRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRjb21iaW5lUmVzdWx0cygKCQkJQTIoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJHJlbmRlckhlbHBlciwgcmVuZGVyZXIsIGFzdCkpOwoJfSk7CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiR2aWV3R3VpZGUgPSBBMigKCSRlbG1fY29tbXVuaXR5JHJlc3VsdF9leHRyYSRSZXN1bHQkRXh0cmEkZXh0cmFjdCwKCSRlbG0kaHRtbCRIdG1sJHRleHQsCglBMigKCQkkZWxtJGNvcmUkUmVzdWx0JG1hcCwKCQkkZWxtJGh0bWwkSHRtbCRkaXYoX0xpc3RfTmlsKSwKCQlBMigKCQkJJGVsbSRjb3JlJFJlc3VsdCRhbmRUaGVuLAoJCQkkZGlsbG9ua2Vhcm5zJGVsbV9tYXJrZG93biRNYXJrZG93biRQYXJzZXIkcmVuZGVyKCRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRkZWZhdWx0SHRtbFJlbmRlcmVyKSwKCQkJQTIoCgkJCQkkZWxtJGNvcmUkUmVzdWx0JG1hcEVycm9yLAoJCQkJQTIoCgkJCQkJJGVsbSRjb3JlJEJhc2ljcyRjb21wb3NlUiwKCQkJCQkkZWxtJGNvcmUkTGlzdCRtYXAoJGRpbGxvbmtlYXJucyRlbG1fbWFya2Rvd24kTWFya2Rvd24kUGFyc2VyJGRlYWRFbmRUb1N0cmluZyksCgkJCQkJJGVsbSRjb3JlJFN0cmluZyRqb2luKCdcbicpKSwKCQkJCSRkaWxsb25rZWFybnMkZWxtX21hcmtkb3duJE1hcmtkb3duJFBhcnNlciRwYXJzZSgkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRndWlkZU1hcmtkb3duKSkpKSk7CnZhciAkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kQ3VzdG9tID0gZnVuY3Rpb24gKGEpIHsKCXJldHVybiB7JDogJ0N1c3RvbScsIGE6IGF9Owp9Owp2YXIgJGVsbSRodG1sJEh0bWwkRXZlbnRzJGN1c3RvbSA9IEYyKAoJZnVuY3Rpb24gKGV2ZW50LCBkZWNvZGVyKSB7CgkJcmV0dXJuIEEyKAoJCQkkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kb24sCgkJCWV2ZW50LAoJCQkkZWxtJHZpcnR1YWxfZG9tJFZpcnR1YWxEb20kQ3VzdG9tKGRlY29kZXIpKTsKCX0pOwp2YXIgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kdGl0bGVBbmRVcmxGcm9tT2ZmZXJlZFBhZ2UgPSBmdW5jdGlvbiAob2ZmZXJlZFBhZ2UpIHsKCWlmIChvZmZlcmVkUGFnZS4kID09PSAnTmF2aWdhdGVUb0hvbWUnKSB7CgkJcmV0dXJuIF9VdGlsc19UdXBsZTIoJ0hvbWUnLCAnL2hvbWUnKTsKCX0gZWxzZSB7CgkJcmV0dXJuIF9VdGlsc19UdXBsZTIoJ0Fib3V0JywgJy9hYm91dCcpOwoJfQp9Owp2YXIgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kaHRtbExpbmtUb1BhZ2UgPSBmdW5jdGlvbiAocGFnZSkgewoJdmFyIHVybCA9ICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJHRpdGxlQW5kVXJsRnJvbU9mZmVyZWRQYWdlKHBhZ2UpLmI7Cgl2YXIgaW5wdXRBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKCkgewoJCXZhciBfdjAgPSAkZWxtJHVybCRVcmwkZnJvbVN0cmluZyh1cmwpOwoJCWlmIChfdjAuJCA9PT0gJ05vdGhpbmcnKSB7CgkJCXJldHVybiBfTGlzdF9OaWw7CgkJfSBlbHNlIHsKCQkJdmFyIHBhcnNlZFVybCA9IF92MC5hOwoJCQlyZXR1cm4gX0xpc3RfZnJvbUFycmF5KAoJCQkJWwoJCQkJCUEyKAoJCQkJCSRlbG0kaHRtbCRIdG1sJEV2ZW50cyRjdXN0b20sCgkJCQkJJ2NsaWNrJywKCQkJCQkkZWxtJGpzb24kSnNvbiREZWNvZGUkc3VjY2VlZCgKCQkJCQkJewoJCQkJCQkJbWVzc2FnZTogJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kVXJsQ2hhbmdlKHBhcnNlZFVybCksCgkJCQkJCQlwcmV2ZW50RGVmYXVsdDogdHJ1ZSwKCQkJCQkJCXN0b3BQcm9wYWdhdGlvbjogdHJ1ZQoJCQkJCQl9KSkKCQkJCV0pOwoJCX0KCX0oKTsKCXJldHVybiAkZWxtJGh0bWwkSHRtbCRhKAoJCUEyKAoJCQkkZWxtJGNvcmUkTGlzdCRjb25zLAoJCQkkZWxtJGh0bWwkSHRtbCRBdHRyaWJ1dGVzJGhyZWYodXJsKSwKCQkJaW5wdXRBdHRyaWJ1dGVzKSk7Cn07CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiR2aWV3TmF2aWdhdGlvbiA9IEEyKAoJJGVsbSRodG1sJEh0bWwkZGl2LAoJX0xpc3RfTmlsLAoJQTIoCgkJJGVsbSRjb3JlJExpc3QkbWFwLAoJCWZ1bmN0aW9uIChvZmZlcmVkUGFnZSkgewoJCQlyZXR1cm4gQTIoCgkJCQkkZWxtJGh0bWwkSHRtbCRzcGFuLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ21hcmdpbicsICc0cHQnKQoJCQkJCV0pLAoJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCVsKCQkJCQkJQTIoCgkJCQkJCSRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJGh0bWxMaW5rVG9QYWdlLAoJCQkJCQlvZmZlcmVkUGFnZSwKCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJWwoJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoCgkJCQkJCQkJJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kdGl0bGVBbmRVcmxGcm9tT2ZmZXJlZFBhZ2Uob2ZmZXJlZFBhZ2UpLmEpCgkJCQkJCQldKSkKCQkJCQldKSk7CgkJfSwKCQlfTGlzdF9mcm9tQXJyYXkoCgkJCVskYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiROYXZpZ2F0ZVRvSG9tZSwgJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kTmF2aWdhdGVUb0Fib3V0XSkpKTsKdmFyICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJHZpZXcgPSBmdW5jdGlvbiAoc3RhdGUpIHsKCXZhciBwYWdlQ29udGVudEZyb21QYWdlU3RhdGUgPSBmdW5jdGlvbiAocGFnZVN0YXRlKSB7CgkJc3dpdGNoIChwYWdlU3RhdGUuJCkgewoJCQljYXNlICdGYWlsdXJlJzoKCQkJCXJldHVybiAkZWxtJGh0bWwkSHRtbCR0ZXh0KCdIVFRQIHJlcXVlc3QgZmFpbGVkLicpOwoJCQljYXNlICdMb2FkaW5nJzoKCQkJCXJldHVybiAkZWxtJGh0bWwkSHRtbCR0ZXh0KCdMb2FkaW5nLi4uJyk7CgkJCWRlZmF1bHQ6CgkJCQl2YXIgZnVsbFRleHQgPSBwYWdlU3RhdGUuYTsKCQkJCXJldHVybiBBMigKCQkJCQkkZWxtJGh0bWwkSHRtbCRkaXYsCgkJCQkJX0xpc3RfTmlsLAoJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJWwoJCQkJCQkJQTIoCgkJCQkJCQkkZWxtJGh0bWwkSHRtbCRzcGFuLAoJCQkJCQkJX0xpc3RfTmlsLAoJCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJCVsKCQkJCQkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dCgnSSByZWNlaXZlZCB0aGUgZm9sbG93aW5nIGNvbnRlbnQgZnJvbSB0aGUgYmFja2VuZDonKQoJCQkJCQkJCV0pKSwKCQkJCQkJCUEyKAoJCQkJCQkJJGVsbSRodG1sJEh0bWwkcHJlLAoJCQkJCQkJX0xpc3RfZnJvbUFycmF5KAoJCQkJCQkJCVsKCQkJCQkJCQkJQTIoJGVsbSRodG1sJEh0bWwkQXR0cmlidXRlcyRzdHlsZSwgJ3doaXRlLXNwYWNlJywgJ3ByZS13cmFwJykKCQkJCQkJCQldKSwKCQkJCQkJCV9MaXN0X2Zyb21BcnJheSgKCQkJCQkJCQlbCgkJCQkJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoZnVsbFRleHQpCgkJCQkJCQkJXSkpCgkJCQkJCV0pKTsKCQl9Cgl9OwoJdmFyIF92MCA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgX3YxID0gc3RhdGUuc2VsZWN0ZWRQYWdlOwoJCXN3aXRjaCAoX3YxLiQpIHsKCQkJY2FzZSAnSG9tZSc6CgkJCQl2YXIgcGFnZVN0YXRlID0gX3YxLmE7CgkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQknSG9tZScsCgkJCQkJcGFnZUNvbnRlbnRGcm9tUGFnZVN0YXRlKHBhZ2VTdGF0ZSkpOwoJCQljYXNlICdBYm91dCc6CgkJCQl2YXIgcGFnZVN0YXRlID0gX3YxLmE7CgkJCQlyZXR1cm4gX1V0aWxzX1R1cGxlMigKCQkJCQknQWJvdXQnLAoJCQkJCXBhZ2VDb250ZW50RnJvbVBhZ2VTdGF0ZShwYWdlU3RhdGUpKTsKCQkJZGVmYXVsdDoKCQkJCXZhciB1cmwgPSBfdjEuYTsKCQkJCXJldHVybiBfVXRpbHNfVHVwbGUyKAoJCQkJCSdOb3QgRm91bmQnLAoJCQkJCSRlbG0kaHRtbCRIdG1sJHRleHQoJ0kgZm91bmQgbm90aGluZyBhdCAnICsgdXJsKSk7CgkJfQoJfSgpOwoJdmFyIHBhZ2VIZWFkaW5nID0gX3YwLmE7Cgl2YXIgc2VsZWN0ZWRQYWdlQ29udGVudCA9IF92MC5iOwoJdmFyIGJvZHkgPSBfTGlzdF9mcm9tQXJyYXkoCgkJWwoJCQkkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRnbG9iYWxTdHlsZXNIdG1sRWxlbWVudCwKCQkJJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kdmlld05hdmlnYXRpb24sCgkJCUEyKAoJCQkkZWxtJGh0bWwkSHRtbCRoMSwKCQkJX0xpc3RfTmlsLAoJCQlfTGlzdF9mcm9tQXJyYXkoCgkJCQlbCgkJCQkJJGVsbSRodG1sJEh0bWwkdGV4dChwYWdlSGVhZGluZykKCQkJCV0pKSwKCQkJJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kdmlld0d1aWRlLAoJCQlzZWxlY3RlZFBhZ2VDb250ZW50CgkJXSk7CglyZXR1cm4ge2JvZHk6IGJvZHksIHRpdGxlOiBwYWdlSGVhZGluZ307Cn07CnZhciAkYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRtYWluID0gJGVsbSRicm93c2VyJEJyb3dzZXIkYXBwbGljYXRpb24oCgl7CgkJaW5pdDogJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kaW5pdCwKCQlvblVybENoYW5nZTogJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kVXJsQ2hhbmdlLAoJCW9uVXJsUmVxdWVzdDogJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kVXJsUmVxdWVzdCwKCQlzdWJzY3JpcHRpb25zOiAkZWxtJGNvcmUkQmFzaWNzJGFsd2F5cygkZWxtJGNvcmUkUGxhdGZvcm0kU3ViJG5vbmUpLAoJCXVwZGF0ZTogJGF1dGhvciRwcm9qZWN0JEZyb250ZW5kJE1haW4kdXBkYXRlLAoJCXZpZXc6ICRhdXRob3IkcHJvamVjdCRGcm9udGVuZCRNYWluJHZpZXcKCX0pOwpfUGxhdGZvcm1fZXhwb3J0KHsnRnJvbnRlbmQnOnsnTWFpbic6eydpbml0JzokYXV0aG9yJHByb2plY3QkRnJvbnRlbmQkTWFpbiRtYWluKAoJJGVsbSRqc29uJEpzb24kRGVjb2RlJHN1Y2NlZWQoX1V0aWxzX1R1cGxlMCkpKHsidmVyc2lvbnMiOnsiZWxtIjoiMC4xOS4xIn0sInR5cGVzIjp7Im1lc3NhZ2UiOiJGcm9udGVuZC5NYWluLkV2ZW50IiwiYWxpYXNlcyI6eyJVcmwuVXJsIjp7ImFyZ3MiOltdLCJ0eXBlIjoieyBwcm90b2NvbCA6IFVybC5Qcm90b2NvbCwgaG9zdCA6IFN0cmluZy5TdHJpbmcsIHBvcnRfIDogTWF5YmUuTWF5YmUgQmFzaWNzLkludCwgcGF0aCA6IFN0cmluZy5TdHJpbmcsIHF1ZXJ5IDogTWF5YmUuTWF5YmUgU3RyaW5nLlN0cmluZywgZnJhZ21lbnQgOiBNYXliZS5NYXliZSBTdHJpbmcuU3RyaW5nIH0ifX0sInVuaW9ucyI6eyJGcm9udGVuZC5NYWluLkV2ZW50Ijp7ImFyZ3MiOltdLCJ0YWdzIjp7IkJhY2tlbmRSZXNwb25zZSI6WyJ7IHJlcXVlc3RQYWdlIDogRnJvbnRlbmQuTWFpbi5PZmZlcmVkUGFnZSwgcmVzdWx0IDogUmVzdWx0LlJlc3VsdCBIdHRwLkVycm9yIFN0cmluZy5TdHJpbmcgfSJdLCJVcmxSZXF1ZXN0IjpbIkJyb3dzZXIuVXJsUmVxdWVzdCJdLCJVcmxDaGFuZ2UiOlsiVXJsLlVybCJdfX0sIkh0dHAuRXJyb3IiOnsiYXJncyI6W10sInRhZ3MiOnsiQmFkVXJsIjpbIlN0cmluZy5TdHJpbmciXSwiVGltZW91dCI6W10sIk5ldHdvcmtFcnJvciI6W10sIkJhZFN0YXR1cyI6WyJCYXNpY3MuSW50Il0sIkJhZEJvZHkiOlsiU3RyaW5nLlN0cmluZyJdfX0sIkJhc2ljcy5JbnQiOnsiYXJncyI6W10sInRhZ3MiOnsiSW50IjpbXX19LCJNYXliZS5NYXliZSI6eyJhcmdzIjpbImEiXSwidGFncyI6eyJKdXN0IjpbImEiXSwiTm90aGluZyI6W119fSwiRnJvbnRlbmQuTWFpbi5PZmZlcmVkUGFnZSI6eyJhcmdzIjpbXSwidGFncyI6eyJOYXZpZ2F0ZVRvSG9tZSI6W10sIk5hdmlnYXRlVG9BYm91dCI6W119fSwiVXJsLlByb3RvY29sIjp7ImFyZ3MiOltdLCJ0YWdzIjp7Ikh0dHAiOltdLCJIdHRwcyI6W119fSwiUmVzdWx0LlJlc3VsdCI6eyJhcmdzIjpbImVycm9yIiwidmFsdWUiXSwidGFncyI6eyJPayI6WyJ2YWx1ZSJdLCJFcnIiOlsiZXJyb3IiXX19LCJTdHJpbmcuU3RyaW5nIjp7ImFyZ3MiOltdLCJ0YWdzIjp7IlN0cmluZyI6W119fSwiQnJvd3Nlci5VcmxSZXF1ZXN0Ijp7ImFyZ3MiOltdLCJ0YWdzIjp7IkludGVybmFsIjpbIlVybC5VcmwiXSwiRXh0ZXJuYWwiOlsiU3RyaW5nLlN0cmluZyJdfX19fX0pfX19KTt9KHRoaXMpKTsKCiAgdmFyIGFwcCA9IEVsbS5Gcm9udGVuZC5NYWluLmluaXQoeyBub2RlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxtIikgfSk7Cn0KY2F0Y2ggKGUpCnsKICAvLyBkaXNwbGF5IGluaXRpYWxpemF0aW9uIGVycm9ycyAoZS5nLiBiYWQgZmxhZ3MsIGluZmluaXRlIHJlY3Vyc2lvbikKICB2YXIgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDEiKTsKICBoZWFkZXIuc3R5bGUuZm9udEZhbWlseSA9ICJtb25vc3BhY2UiOwogIGhlYWRlci5pbm5lclRleHQgPSAiSW5pdGlhbGl6YXRpb24gRXJyb3IiOwogIHZhciBwcmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWxtIik7CiAgZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUoaGVhZGVyLCBwcmUpOwogIHByZS5pbm5lclRleHQgPSBlOwogIHRocm93IGU7Cn0KPC9zY3JpcHQ+Cgo8L2JvZHk+CjwvaHRtbD4=" }